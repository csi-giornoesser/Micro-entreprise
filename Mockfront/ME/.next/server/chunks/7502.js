"use strict";exports.id=7502,exports.ids=[7502],exports.modules={57502:(a,b,c)=>{c.d(b,{A:()=>h});var d=c(21124),e=c(38301);let f=a=>a?new Date(a).toLocaleDateString("fr-FR"):"-",g=a=>a?new Date(a).toLocaleString("fr-FR"):"-";function h({partnerId:a}){let[b,c]=(0,e.useState)(null),[h,i]=(0,e.useState)(!0),[j,k]=(0,e.useState)(!1),[l,m]=(0,e.useState)(!1),[n,o]=(0,e.useState)({type_interaction:"appel",direction:"sortant",sujet:"",notes:"",participant:"",duree_minutes:"",prochaine_action:"",rappel_date:""});async function p(){i(!0);try{let b=await fetch(`/api/partenaires/${a}/interactions`,{cache:"no-store"});if(b.ok){let a=await b.json();c(a)}}catch(a){console.error("Erreur chargement interactions:",a)}finally{i(!1)}}async function q(){if(!n.sujet.trim())return void alert("Sujet requis");k(!0);try{if((await fetch(`/api/partenaires/${a}/interactions`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(n)})).ok)await p(),o({type_interaction:"appel",direction:"sortant",sujet:"",notes:"",participant:"",duree_minutes:"",prochaine_action:"",rappel_date:""}),m(!1);else throw Error("Erreur cr\xe9ation")}catch(a){console.error("Erreur ajout interaction:",a),alert("Erreur lors de l'ajout")}finally{k(!1)}}if(!a)return null;if(h)return(0,d.jsxs)("section",{className:"border rounded p-4",children:[(0,d.jsx)("h3",{className:"text-lg font-semibold mb-3",children:"\uD83E\uDD1D Suivi Commercial"}),(0,d.jsx)("p",{className:"text-gray-600",children:"Chargement..."})]});let r=b?.interactions||[],s=b?.prochaines_actions||[],t=b?.stats||{},u=b?.references?.types||[],v=b?.references?.directions||[],w=b?.suggested_contacts||[];return(0,d.jsxs)("section",{className:"border rounded p-4 space-y-4",children:[(0,d.jsxs)("div",{className:"flex items-center justify-between",children:[(0,d.jsx)("h3",{className:"text-lg font-semibold",children:"\uD83E\uDD1D Suivi Commercial"}),(0,d.jsx)("button",{className:"bg-blue-600 text-white px-3 py-2 rounded text-sm",onClick:()=>m(!l),children:l?"Annuler":"+ Nouvelle interaction"})]}),(0,d.jsxs)("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-3",children:[(0,d.jsxs)("div",{className:"bg-blue-50 p-3 rounded text-center",children:[(0,d.jsx)("div",{className:"text-2xl font-bold text-blue-600",children:t.total_interactions||0}),(0,d.jsx)("div",{className:"text-xs text-gray-600",children:"Total interactions"})]}),(0,d.jsxs)("div",{className:"bg-green-50 p-3 rounded text-center",children:[(0,d.jsx)("div",{className:"text-2xl font-bold text-green-600",children:t.interactions_30j||0}),(0,d.jsx)("div",{className:"text-xs text-gray-600",children:"Ce mois"})]}),(0,d.jsxs)("div",{className:"bg-purple-50 p-3 rounded text-center",children:[(0,d.jsx)("div",{className:"text-2xl font-bold text-purple-600",children:t.nb_reunions||0}),(0,d.jsx)("div",{className:"text-xs text-gray-600",children:"R\xe9unions"})]}),(0,d.jsxs)("div",{className:"bg-orange-50 p-3 rounded text-center",children:[(0,d.jsx)("div",{className:"text-2xl font-bold text-orange-600",children:t.actions_en_attente||0}),(0,d.jsx)("div",{className:"text-xs text-gray-600",children:"Actions en attente"})]})]}),s.length>0&&(0,d.jsxs)("div",{className:"bg-yellow-50 border border-yellow-200 rounded p-3",children:[(0,d.jsx)("h4",{className:"font-medium text-yellow-800 mb-2",children:"⏰ Prochaines actions"}),(0,d.jsx)("div",{className:"space-y-1",children:s.map(a=>(0,d.jsxs)("div",{className:"text-sm",children:[(0,d.jsx)("span",{className:"font-medium",children:a.prochaine_action}),a.rappel_date&&(0,d.jsxs)("span",{className:"text-yellow-700 ml-2",children:["(Rappel: ",f(a.rappel_date),")"]})]},a.id))})]}),l&&(0,d.jsxs)("div",{className:"border rounded p-4 bg-gray-50",children:[(0,d.jsx)("h4",{className:"font-medium mb-3",children:"Nouvelle interaction"}),(0,d.jsxs)("div",{className:"grid md:grid-cols-2 gap-3",children:[(0,d.jsxs)("label",{className:"flex flex-col text-sm",children:[(0,d.jsx)("span",{className:"mb-1 font-medium",children:"Type *"}),(0,d.jsx)("select",{className:"border rounded p-2",value:n.type_interaction,onChange:a=>o(b=>({...b,type_interaction:a.target.value})),children:u.map(a=>(0,d.jsx)("option",{value:a.value,children:a.label},a.value))})]}),(0,d.jsxs)("label",{className:"flex flex-col text-sm",children:[(0,d.jsx)("span",{className:"mb-1 font-medium",children:"Direction"}),(0,d.jsx)("select",{className:"border rounded p-2",value:n.direction,onChange:a=>o(b=>({...b,direction:a.target.value})),children:v.map(a=>(0,d.jsx)("option",{value:a.value,children:a.label},a.value))})]}),(0,d.jsxs)("label",{className:"flex flex-col text-sm md:col-span-2",children:[(0,d.jsx)("span",{className:"mb-1 font-medium",children:"Sujet *"}),(0,d.jsx)("input",{type:"text",className:"border rounded p-2",value:n.sujet,onChange:a=>o(b=>({...b,sujet:a.target.value})),placeholder:"Ex: Suivi mensuel performance"})]}),(0,d.jsxs)("label",{className:"flex flex-col text-sm",children:[(0,d.jsx)("span",{className:"mb-1 font-medium",children:"Participant"}),w.length>0&&(0,d.jsxs)("div",{className:"mb-2",children:[(0,d.jsx)("div",{className:"text-xs text-gray-600 mb-1",children:"Contacts sugg\xe9r\xe9s :"}),(0,d.jsx)("div",{className:"flex flex-wrap gap-1",children:w.map((a,b)=>(0,d.jsxs)("button",{type:"button",className:"text-xs bg-blue-100 text-blue-700 px-2 py-1 rounded hover:bg-blue-200",onClick:()=>{o(b=>({...b,participant:a.nom}))},children:[a.nom,"R\xe9f\xe9rent principal"===a.type&&" \uD83D\uDC51"]},b))})]}),(0,d.jsx)("input",{type:"text",className:"border rounded p-2",value:n.participant,onChange:a=>o(b=>({...b,participant:a.target.value})),placeholder:"Nom du contact ou s\xe9lectionnez ci-dessus",list:"contacts-datalist"}),(0,d.jsx)("datalist",{id:"contacts-datalist",children:w.map((a,b)=>(0,d.jsx)("option",{value:a.nom,children:a.display},b))})]}),(0,d.jsxs)("label",{className:"flex flex-col text-sm",children:[(0,d.jsx)("span",{className:"mb-1 font-medium",children:"Dur\xe9e (minutes)"}),(0,d.jsx)("input",{type:"number",className:"border rounded p-2",value:n.duree_minutes,onChange:a=>o(b=>({...b,duree_minutes:a.target.value})),placeholder:"30"})]}),(0,d.jsxs)("label",{className:"flex flex-col text-sm md:col-span-2",children:[(0,d.jsx)("span",{className:"mb-1 font-medium",children:"Notes"}),(0,d.jsx)("textarea",{className:"border rounded p-2 h-20",value:n.notes,onChange:a=>o(b=>({...b,notes:a.target.value})),placeholder:"D\xe9tails de l'interaction..."})]}),(0,d.jsxs)("label",{className:"flex flex-col text-sm",children:[(0,d.jsx)("span",{className:"mb-1 font-medium",children:"Prochaine action"}),(0,d.jsx)("input",{type:"text",className:"border rounded p-2",value:n.prochaine_action,onChange:a=>o(b=>({...b,prochaine_action:a.target.value})),placeholder:"Ex: Programmer r\xe9union bilan"})]}),(0,d.jsxs)("label",{className:"flex flex-col text-sm",children:[(0,d.jsx)("span",{className:"mb-1 font-medium",children:"Rappel le"}),(0,d.jsx)("input",{type:"date",className:"border rounded p-2",value:n.rappel_date,onChange:a=>o(b=>({...b,rappel_date:a.target.value}))})]})]}),(0,d.jsxs)("div",{className:"flex gap-2 mt-4",children:[(0,d.jsx)("button",{className:"bg-green-600 text-white px-4 py-2 rounded disabled:opacity-50",onClick:q,disabled:j||!n.sujet.trim(),children:j?"Ajout...":"✅ Ajouter"}),(0,d.jsx)("button",{className:"border px-4 py-2 rounded",onClick:()=>m(!1),children:"Annuler"})]})]}),(0,d.jsxs)("div",{children:[(0,d.jsx)("h4",{className:"font-medium mb-3",children:"Historique des interactions"}),0===r.length?(0,d.jsx)("p",{className:"text-gray-600 text-center py-4",children:"Aucune interaction enregistr\xe9e. Ajoutez la premi\xe8re !"}):(0,d.jsx)("div",{className:"space-y-3 max-h-96 overflow-y-auto",children:r.map(a=>(0,d.jsxs)("div",{className:`border-l-4 p-3 rounded ${(a=>{switch(a){case"appel":return"bg-blue-50 border-l-blue-500";case"email":return"bg-green-50 border-l-green-500";case"reunion":return"bg-purple-50 border-l-purple-500";case"relance":return"bg-orange-50 border-l-orange-500";default:return"bg-gray-50 border-l-gray-500"}})(a.type_interaction)}`,children:[(0,d.jsxs)("div",{className:"flex items-start justify-between",children:[(0,d.jsxs)("div",{className:"flex items-center gap-2",children:[(0,d.jsx)("span",{children:(a=>{switch(a){case"appel":return"\uD83D\uDCDE";case"email":return"✉️";case"reunion":return"\uD83E\uDD1D";case"relance":return"\uD83D\uDCCB";case"note":return"\uD83D\uDCDD";default:return"\uD83D\uDCC4"}})(a.type_interaction)}),(0,d.jsxs)("div",{children:[(0,d.jsx)("h5",{className:"font-medium",children:a.sujet}),(0,d.jsxs)("div",{className:"text-sm text-gray-600",children:[a.type_interaction," ",a.direction,a.participant&&(0,d.jsxs)(d.Fragment,{children:[" avec ",(0,d.jsx)("span",{className:"font-medium",children:a.participant}),w.find(b=>b.nom===a.participant)&&(0,d.jsx)("span",{className:"text-xs bg-green-100 text-green-700 px-1 rounded ml-1",children:w.find(b=>b.nom===a.participant)?.type==="R\xe9f\xe9rent principal"?"\uD83D\uDC51":"✓"})]}),a.duree_minutes&&` (${a.duree_minutes}min)`]})]})]}),(0,d.jsx)("span",{className:"text-xs text-gray-500",children:g(a.date_interaction)})]}),a.notes&&(0,d.jsx)("div",{className:"text-sm mt-2 bg-white p-2 rounded",children:a.notes}),a.prochaine_action&&(0,d.jsxs)("div",{className:"text-sm mt-2 text-orange-700 bg-orange-100 p-2 rounded",children:[(0,d.jsx)("strong",{children:"→ Prochaine action:"})," ",a.prochaine_action,a.rappel_date&&(0,d.jsxs)("span",{className:"ml-2",children:["(Rappel: ",f(a.rappel_date),")"]})]}),(0,d.jsxs)("div",{className:"text-xs text-gray-400 mt-2",children:["Par ",a.created_by]})]},a.id))})]}),t.derniere_interaction&&(0,d.jsxs)("div",{className:"text-xs text-gray-500 text-center pt-2 border-t",children:["Derni\xe8re interaction: ",g(t.derniere_interaction)]})]})}}};