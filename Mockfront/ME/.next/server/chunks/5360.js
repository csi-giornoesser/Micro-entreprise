"use strict";exports.id=5360,exports.ids=[5360],exports.modules={55904:(a,b,c)=>{c.d(b,{A:()=>g});var d=c(21124),e=c(3991);let f=a=>a??0===a?String(a):"—";function g({dossiers:a=[],dossierPrincipalId:b}){return(0,d.jsxs)("section",{children:[(0,d.jsx)("h3",{className:"text-lg font-semibold mb-3",children:"\uD83D\uDCC2 Dossiers & entreprise"}),(0,d.jsxs)("div",{className:"bg-white border rounded p-4",children:[a.length>1&&b&&(0,d.jsxs)("p",{className:"text-sm text-blue-600 mb-2",children:["\uD83D\uDCA1 Timeline ci-dessus pour le dossier principal #",b]}),(0,d.jsx)("ul",{className:"list-disc pl-6",children:a.length?a.map(a=>(0,d.jsxs)("li",{children:["Dossier #",f(a.id)," — statut ",f(a.statut)," — cr\xe9\xe9 ",f(a.date_creation)," — ","partenaire ",(0,d.jsxs)(e,{className:"underline",href:`/crm/partenaires/${a.partenaire_id}`,children:["#",f(a.partenaire_id)]})," — ","entreprise ",(0,d.jsxs)(e,{className:"underline",href:`/crm/entreprises/${a.entreprise_id}`,children:["#",f(a.entreprise_id)]}),(a.blocages||[]).length?(0,d.jsxs)(d.Fragment,{children:[" — blocages: ",(a.blocages||[]).join(", ")]}):null,b&&a.id===b&&(0,d.jsx)("span",{className:"ml-2 text-xs bg-blue-100 text-blue-800 px-2 py-1 rounded",children:"\uD83D\uDCCC Affich\xe9 ci-dessus"})]},a.id)):(0,d.jsx)("li",{children:"—"})})]})]})}},65471:(a,b,c)=>{c.d(b,{A:()=>i});var d=c(21124),e=c(38301),f=c(3991);let g=a=>a?new Date(a).toLocaleDateString("fr-FR"):"—",h=a=>a??0===a?String(a):"—";function i({partnerId:a,data:b}){let[c,i]=(0,e.useState)([]),[j,k]=(0,e.useState)(!1),[l,m]=(0,e.useState)(null),[n,o]=(0,e.useState)(!1),[p,q]=(0,e.useState)({search:"",statut:"tous",dateDebut:"",dateFin:"",showBlocked:!1,commission:""}),[r,s]=(0,e.useState)("date_creation"),[t,u]=(0,e.useState)(!0),[v,w]=(0,e.useState)(1),[x]=(0,e.useState)(20);async function y(){try{k(!0);let b=new URLSearchParams({search:p.search,statut:p.statut,dateDebut:p.dateDebut,dateFin:p.dateFin,showBlocked:String(p.showBlocked),commission:p.commission,sortBy:r,sortDesc:String(t),limit:"1000"}),c=await fetch(`/api/partenaires/${a}/clients?${b}`,{cache:"no-store"});if(!c.ok)throw Error(`HTTP ${c.status}`);let d=await c.json();i(Array.isArray(d.clients)?d.clients:[])}catch(a){console.error(a),m("Impossible de charger les clients")}finally{k(!1)}}let z=(0,e.useMemo)(()=>{let a=[...c];if(p.search.trim()){let b=p.search.toLowerCase();a=a.filter(a=>(a.fullName||"").toLowerCase().includes(b)||(a.email||"").toLowerCase().includes(b)||(a.entreprise_nom||"").toLowerCase().includes(b)||String(a.dossier_id||"").includes(b))}if("tous"!==p.statut&&(a=a.filter(a=>a.statut===p.statut)),p.showBlocked&&(a=a.filter(a=>(a.blocages||[]).length>0)),p.dateDebut&&(a=a.filter(a=>(a.date_creation||"")>=p.dateDebut)),p.dateFin&&(a=a.filter(a=>(a.date_creation||"")<=`${p.dateFin}T23:59:59`)),p.commission){let b=parseFloat(p.commission);isNaN(b)||(a=a.filter(a=>(a.commission||0)>=b))}return a.sort((a,b)=>{let c=a||{},d=b||{},e={nom:[(c.fullName||"").toLowerCase(),(d.fullName||"").toLowerCase()],email:[(c.email||"").toLowerCase(),(d.email||"").toLowerCase()],statut:[c.statut||"",d.statut||""],commission:[Number(c.commission)||0,Number(d.commission)||0],date_creation:[new Date(c.date_creation||0),new Date(d.date_creation||0)]}[r]||[0,0];return e[0]<e[1]?t?1:-1:e[0]>e[1]?t?-1:1:0}),a},[c,p,r,t]),A=z.length,B=Math.ceil(A/x)||1,C=(v-1)*x,D=z.slice(C,C+x),E=({statut:a,blocages:b})=>{let c=(b||[]).length>0,[e,f]={valide:["bg-green-100 text-green-800","✅"],rejete:["bg-red-100 text-red-800","❌"],en_cours:["bg-blue-100 text-blue-800","\uD83D\uDD04"],en_attente:["bg-orange-100 text-orange-800","⏳"],a_corriger:["bg-yellow-100 text-yellow-800","✏️"]}[a]||["bg-gray-100 text-gray-800","\uD83D\uDCCB"];return(0,d.jsxs)("div",{className:"flex items-center gap-1",children:[(0,d.jsxs)("span",{className:`inline-flex items-center px-2 py-1 text-xs font-medium rounded-full ${e}`,children:[(0,d.jsx)("span",{className:"mr-1",children:f}),h(a)]}),c&&(0,d.jsx)("span",{className:"inline-flex items-center px-2 py-1 text-xs font-medium rounded-full bg-red-100 text-red-800",children:"\uD83D\uDEAB Bloqu\xe9"})]})};return j&&0===c.length?(0,d.jsxs)("section",{className:"bg-white border rounded-lg p-6",children:[(0,d.jsx)("h3",{className:"text-lg font-semibold mb-4",children:"\uD83D\uDC65 Suivi des clients"}),(0,d.jsx)("div",{className:"animate-pulse h-24 bg-gray-200 rounded"})]}):l?(0,d.jsxs)("section",{className:"bg-white border rounded-lg p-6",children:[(0,d.jsx)("h3",{className:"text-lg font-semibold mb-4",children:"\uD83D\uDC65 Suivi des clients"}),(0,d.jsxs)("div",{className:"bg-red-50 border border-red-200 rounded p-4",children:[(0,d.jsxs)("div",{className:"text-red-800",children:["❌ ",l]}),(0,d.jsx)("button",{onClick:y,className:"mt-2 text-sm bg-red-600 text-white px-3 py-1 rounded hover:bg-red-700",children:"\uD83D\uDD04 R\xe9essayer"})]})]}):(0,d.jsxs)("section",{className:"bg-white border rounded-lg",children:[(0,d.jsxs)("div",{className:"p-6 border-b flex items-center justify-between",children:[(0,d.jsxs)("h3",{className:"text-lg font-semibold",children:["\uD83D\uDC65 Suivi des clients (",A,")"]}),(0,d.jsxs)("div",{className:"flex gap-2",children:[(0,d.jsx)("button",{onClick:()=>window.location.reload(),className:"text-xs bg-blue-100 hover:bg-blue-200 text-blue-700 px-3 py-2 rounded-md",children:"\uD83D\uDD04 Actualiser"}),(0,d.jsxs)("button",{onClick:function(){let b=new URLSearchParams;"tous"!==p.statut&&b.set("status",p.statut),a&&b.set("partnerId",String(a)),p.dateDebut&&b.set("from",p.dateDebut),p.dateFin&&b.set("to",p.dateFin),b.set("format","csv");let c=`/api/exports/dossiers?${b.toString()}`,d=document.createElement("a");d.href=c,d.download=`dossiers_partenaire_${a}_${new Date().toISOString().slice(0,10)}.csv`,document.body.appendChild(d),d.click(),document.body.removeChild(d)},disabled:n||0===A,className:"flex items-center gap-2 bg-green-600 text-white px-4 py-2 rounded-md text-sm hover:bg-green-700 disabled:opacity-50",children:[n?"⏳":"\uD83D\uDCCA"," Exporter CSV"]})]})]}),(0,d.jsxs)("div",{className:"p-4 border-b",children:[(0,d.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-6 gap-3",children:[(0,d.jsx)("input",{type:"text",placeholder:"Rechercher (nom, email, entreprise, #dossier)",value:p.search,onChange:a=>q(b=>({...b,search:a.target.value})),className:"border rounded px-3 py-2 text-sm"}),(0,d.jsxs)("select",{value:p.statut,onChange:a=>q(b=>({...b,statut:a.target.value})),className:"border rounded px-3 py-2 text-sm",children:[(0,d.jsx)("option",{value:"tous",children:"Tous statuts"}),(0,d.jsx)("option",{value:"nouveau",children:"Nouveau"}),(0,d.jsx)("option",{value:"en_cours",children:"En cours"}),(0,d.jsx)("option",{value:"en_attente",children:"En attente"}),(0,d.jsx)("option",{value:"a_corriger",children:"\xc0 corriger"}),(0,d.jsx)("option",{value:"valide",children:"Valid\xe9"}),(0,d.jsx)("option",{value:"rejete",children:"Rejet\xe9"})]}),(0,d.jsx)("input",{type:"date",value:p.dateDebut,onChange:a=>q(b=>({...b,dateDebut:a.target.value})),className:"border rounded px-3 py-2 text-sm"}),(0,d.jsx)("input",{type:"date",value:p.dateFin,onChange:a=>q(b=>({...b,dateFin:a.target.value})),className:"border rounded px-3 py-2 text-sm"}),(0,d.jsx)("input",{type:"number",placeholder:"Commission min (€)",value:p.commission,onChange:a=>q(b=>({...b,commission:a.target.value})),className:"border rounded px-3 py-2 text-sm",min:"0",step:"10"}),(0,d.jsxs)("label",{className:"flex items-center gap-2 text-sm",children:[(0,d.jsx)("input",{type:"checkbox",checked:p.showBlocked,onChange:a=>q(b=>({...b,showBlocked:a.target.checked}))}),"Bloqu\xe9s uniquement"]})]}),(0,d.jsxs)("div",{className:"mt-3 flex items-center gap-2",children:[(0,d.jsx)("button",{onClick:y,className:"bg-blue-600 text-white px-3 py-2 rounded text-sm hover:bg-blue-700",children:"\uD83D\uDD0E Filtrer"}),(0,d.jsx)("button",{onClick:()=>{q({search:"",statut:"tous",dateDebut:"",dateFin:"",showBlocked:!1,commission:""}),s("date_creation"),u(!0),w(1),y()},className:"border px-3 py-2 rounded text-sm",children:"R\xe9initialiser"}),(0,d.jsxs)("select",{value:`${r}-${t}`,onChange:a=>{let[b,c]=a.target.value.split("-");s(b),u("true"===c)},className:"ml-auto border rounded px-2 py-2 text-sm",children:[(0,d.jsx)("option",{value:"date_creation-true",children:"Plus r\xe9cents"}),(0,d.jsx)("option",{value:"date_creation-false",children:"Plus anciens"}),(0,d.jsx)("option",{value:"nom-false",children:"Nom A→Z"}),(0,d.jsx)("option",{value:"nom-true",children:"Nom Z→A"}),(0,d.jsx)("option",{value:"statut-false",children:"Statut"}),(0,d.jsx)("option",{value:"commission-true",children:"Commission ↓"})]})]})]}),(0,d.jsx)("div",{className:"overflow-x-auto",children:0===A?(0,d.jsx)("div",{className:"p-8 text-center text-gray-500",children:0===c.length?"Aucun client trouv\xe9":"Aucun r\xe9sultat avec ces filtres"}):(0,d.jsxs)("table",{className:"min-w-full",children:[(0,d.jsx)("thead",{className:"bg-gray-50 border-b",children:(0,d.jsxs)("tr",{children:[(0,d.jsx)("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Client"}),(0,d.jsx)("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Entreprise"}),(0,d.jsx)("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Statut"}),(0,d.jsx)("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Date"}),(0,d.jsx)("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Commission"}),(0,d.jsx)("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Actions"})]})}),(0,d.jsx)("tbody",{className:"bg-white divide-y divide-gray-200",children:D.map(a=>{let b;return(0,d.jsxs)("tr",{className:"hover:bg-gray-50",children:[(0,d.jsxs)("td",{className:"px-4 py-4",children:[(0,d.jsx)("div",{className:"font-medium text-gray-900",children:h(a.fullName)}),(0,d.jsxs)("div",{className:"text-sm text-gray-500",children:[h(a.email),a.telephone?` • ${a.telephone}`:""]}),(0,d.jsxs)("div",{className:"text-xs text-gray-400",children:["Client #",h(a.id)]})]}),(0,d.jsxs)("td",{className:"px-4 py-4",children:[(0,d.jsx)("div",{className:"text-sm font-medium text-gray-900",children:h(a.entreprise_nom)}),(0,d.jsx)("div",{className:"text-xs text-gray-500",children:h(a.entreprise_forme)})]}),(0,d.jsxs)("td",{className:"px-4 py-4",children:[(0,d.jsx)(E,{statut:a.statut,blocages:a.blocages}),(a.blocages||[]).length>0&&(0,d.jsx)("div",{className:"text-xs text-red-600 mt-1",children:a.blocages.join(", ")})]}),(0,d.jsxs)("td",{className:"px-4 py-4 text-sm text-gray-900",children:[(0,d.jsxs)("div",{children:["Cr\xe9\xe9: ",g(a.date_creation)]}),a.date_creation_effective&&(0,d.jsxs)("div",{className:"text-xs text-green-600",children:["Effectif: ",g(a.date_creation_effective)]}),a.derniere_modification&&(0,d.jsxs)("div",{className:"text-xs text-gray-500",children:["MAJ: ",g(a.derniere_modification)]})]}),(0,d.jsxs)("td",{className:"px-4 py-4 text-sm text-gray-900",children:[(0,d.jsxs)("div",{className:"font-medium",children:[0===(b=a.commission)?"0":null!=b?Number(b).toLocaleString("fr-FR"):"—","€"]}),(0,d.jsxs)("div",{className:"text-xs text-gray-500",children:["Dossier #",h(a.dossier_id)]})]}),(0,d.jsx)("td",{className:"px-4 py-4",children:(0,d.jsxs)("div",{className:"flex gap-2",children:[(0,d.jsx)(f,{href:`/crm/clients/${a.id}`,className:"bg-blue-600 text-white px-3 py-1 rounded text-xs hover:bg-blue-700",children:"\uD83D\uDC64 Client"}),(0,d.jsx)(f,{href:`/crm/clients/${a.id}?dossier=${a.dossier_id}#timeline`,className:"bg-gray-600 text-white px-3 py-1 rounded text-xs hover:bg-gray-700",children:"\uD83D\uDCC1 Dossier LINK"})]})})]},`${a.id}-${a.dossier_id}`)})})]})}),B>1&&(0,d.jsxs)("div",{className:"px-6 py-4 border-t flex items-center justify-between",children:[(0,d.jsxs)("div",{className:"text-sm text-gray-700",children:["Affichage de ",C+1," \xe0 ",Math.min(C+x,A)," sur ",A," r\xe9sultats"]}),(0,d.jsxs)("div",{className:"flex gap-2",children:[(0,d.jsx)("button",{onClick:()=>w(a=>Math.max(1,a-1)),disabled:1===v,className:"px-3 py-1 border rounded text-sm disabled:opacity-50",children:"← Pr\xe9c\xe9dent"}),(0,d.jsx)("span",{className:"px-3 py-1 bg-blue-100 text-blue-700 rounded text-sm",children:v}),(0,d.jsx)("button",{onClick:()=>w(a=>Math.min(B,a+1)),disabled:v===B,className:"px-3 py-1 border rounded text-sm disabled:opacity-50",children:"Suivant →"})]})]})]})}}};