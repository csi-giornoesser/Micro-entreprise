"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[8994],{8994:(e,t,a)=>{a.d(t,{A:()=>i});var s=a(5155),n=a(2115);let r=e=>e?new Date(e).toLocaleDateString("fr-FR"):"-",l=e=>e?new Date(e).toLocaleString("fr-FR"):"-";function i(e){var t,a;let{partnerId:i}=e,[c,d]=(0,n.useState)(null),[o,x]=(0,n.useState)(!0),[m,u]=(0,n.useState)(!1),[p,h]=(0,n.useState)(!1),[j,b]=(0,n.useState)({type_interaction:"appel",direction:"sortant",sujet:"",notes:"",participant:"",duree_minutes:"",prochaine_action:"",rappel_date:""});async function g(){x(!0);try{let e=await fetch("/api/partenaires/".concat(i,"/interactions"),{cache:"no-store"});if(e.ok){let t=await e.json();d(t)}}catch(e){console.error("Erreur chargement interactions:",e)}finally{x(!1)}}async function N(){if(!j.sujet.trim())return void alert("Sujet requis");u(!0);try{if((await fetch("/api/partenaires/".concat(i,"/interactions"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(j)})).ok)await g(),b({type_interaction:"appel",direction:"sortant",sujet:"",notes:"",participant:"",duree_minutes:"",prochaine_action:"",rappel_date:""}),h(!1);else throw Error("Erreur cr\xe9ation")}catch(e){console.error("Erreur ajout interaction:",e),alert("Erreur lors de l'ajout")}finally{u(!1)}}if((0,n.useEffect)(()=>{i&&g()},[i]),!i)return null;if(o)return(0,s.jsxs)("section",{className:"border rounded p-4",children:[(0,s.jsx)("h3",{className:"text-lg font-semibold mb-3",children:"\uD83E\uDD1D Suivi Commercial"}),(0,s.jsx)("p",{className:"text-gray-600",children:"Chargement..."})]});let v=(null==c?void 0:c.interactions)||[],f=(null==c?void 0:c.prochaines_actions)||[],y=(null==c?void 0:c.stats)||{},_=(null==c||null==(t=c.references)?void 0:t.types)||[],w=(null==c||null==(a=c.references)?void 0:a.directions)||[],C=(null==c?void 0:c.suggested_contacts)||[];return(0,s.jsxs)("section",{className:"border rounded p-4 space-y-4",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsx)("h3",{className:"text-lg font-semibold",children:"\uD83E\uDD1D Suivi Commercial"}),(0,s.jsx)("button",{className:"bg-blue-600 text-white px-3 py-2 rounded text-sm",onClick:()=>h(!p),children:p?"Annuler":"+ Nouvelle interaction"})]}),(0,s.jsxs)("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-3",children:[(0,s.jsxs)("div",{className:"bg-blue-50 p-3 rounded text-center",children:[(0,s.jsx)("div",{className:"text-2xl font-bold text-blue-600",children:y.total_interactions||0}),(0,s.jsx)("div",{className:"text-xs text-gray-600",children:"Total interactions"})]}),(0,s.jsxs)("div",{className:"bg-green-50 p-3 rounded text-center",children:[(0,s.jsx)("div",{className:"text-2xl font-bold text-green-600",children:y.interactions_30j||0}),(0,s.jsx)("div",{className:"text-xs text-gray-600",children:"Ce mois"})]}),(0,s.jsxs)("div",{className:"bg-purple-50 p-3 rounded text-center",children:[(0,s.jsx)("div",{className:"text-2xl font-bold text-purple-600",children:y.nb_reunions||0}),(0,s.jsx)("div",{className:"text-xs text-gray-600",children:"R\xe9unions"})]}),(0,s.jsxs)("div",{className:"bg-orange-50 p-3 rounded text-center",children:[(0,s.jsx)("div",{className:"text-2xl font-bold text-orange-600",children:y.actions_en_attente||0}),(0,s.jsx)("div",{className:"text-xs text-gray-600",children:"Actions en attente"})]})]}),f.length>0&&(0,s.jsxs)("div",{className:"bg-yellow-50 border border-yellow-200 rounded p-3",children:[(0,s.jsx)("h4",{className:"font-medium text-yellow-800 mb-2",children:"⏰ Prochaines actions"}),(0,s.jsx)("div",{className:"space-y-1",children:f.map(e=>(0,s.jsxs)("div",{className:"text-sm",children:[(0,s.jsx)("span",{className:"font-medium",children:e.prochaine_action}),e.rappel_date&&(0,s.jsxs)("span",{className:"text-yellow-700 ml-2",children:["(Rappel: ",r(e.rappel_date),")"]})]},e.id))})]}),p&&(0,s.jsxs)("div",{className:"border rounded p-4 bg-gray-50",children:[(0,s.jsx)("h4",{className:"font-medium mb-3",children:"Nouvelle interaction"}),(0,s.jsxs)("div",{className:"grid md:grid-cols-2 gap-3",children:[(0,s.jsxs)("label",{className:"flex flex-col text-sm",children:[(0,s.jsx)("span",{className:"mb-1 font-medium",children:"Type *"}),(0,s.jsx)("select",{className:"border rounded p-2",value:j.type_interaction,onChange:e=>b(t=>({...t,type_interaction:e.target.value})),children:_.map(e=>(0,s.jsx)("option",{value:e.value,children:e.label},e.value))})]}),(0,s.jsxs)("label",{className:"flex flex-col text-sm",children:[(0,s.jsx)("span",{className:"mb-1 font-medium",children:"Direction"}),(0,s.jsx)("select",{className:"border rounded p-2",value:j.direction,onChange:e=>b(t=>({...t,direction:e.target.value})),children:w.map(e=>(0,s.jsx)("option",{value:e.value,children:e.label},e.value))})]}),(0,s.jsxs)("label",{className:"flex flex-col text-sm md:col-span-2",children:[(0,s.jsx)("span",{className:"mb-1 font-medium",children:"Sujet *"}),(0,s.jsx)("input",{type:"text",className:"border rounded p-2",value:j.sujet,onChange:e=>b(t=>({...t,sujet:e.target.value})),placeholder:"Ex: Suivi mensuel performance"})]}),(0,s.jsxs)("label",{className:"flex flex-col text-sm",children:[(0,s.jsx)("span",{className:"mb-1 font-medium",children:"Participant"}),C.length>0&&(0,s.jsxs)("div",{className:"mb-2",children:[(0,s.jsx)("div",{className:"text-xs text-gray-600 mb-1",children:"Contacts sugg\xe9r\xe9s :"}),(0,s.jsx)("div",{className:"flex flex-wrap gap-1",children:C.map((e,t)=>(0,s.jsxs)("button",{type:"button",className:"text-xs bg-blue-100 text-blue-700 px-2 py-1 rounded hover:bg-blue-200",onClick:()=>{b(t=>({...t,participant:e.nom}))},children:[e.nom,"R\xe9f\xe9rent principal"===e.type&&" \uD83D\uDC51"]},t))})]}),(0,s.jsx)("input",{type:"text",className:"border rounded p-2",value:j.participant,onChange:e=>b(t=>({...t,participant:e.target.value})),placeholder:"Nom du contact ou s\xe9lectionnez ci-dessus",list:"contacts-datalist"}),(0,s.jsx)("datalist",{id:"contacts-datalist",children:C.map((e,t)=>(0,s.jsx)("option",{value:e.nom,children:e.display},t))})]}),(0,s.jsxs)("label",{className:"flex flex-col text-sm",children:[(0,s.jsx)("span",{className:"mb-1 font-medium",children:"Dur\xe9e (minutes)"}),(0,s.jsx)("input",{type:"number",className:"border rounded p-2",value:j.duree_minutes,onChange:e=>b(t=>({...t,duree_minutes:e.target.value})),placeholder:"30"})]}),(0,s.jsxs)("label",{className:"flex flex-col text-sm md:col-span-2",children:[(0,s.jsx)("span",{className:"mb-1 font-medium",children:"Notes"}),(0,s.jsx)("textarea",{className:"border rounded p-2 h-20",value:j.notes,onChange:e=>b(t=>({...t,notes:e.target.value})),placeholder:"D\xe9tails de l'interaction..."})]}),(0,s.jsxs)("label",{className:"flex flex-col text-sm",children:[(0,s.jsx)("span",{className:"mb-1 font-medium",children:"Prochaine action"}),(0,s.jsx)("input",{type:"text",className:"border rounded p-2",value:j.prochaine_action,onChange:e=>b(t=>({...t,prochaine_action:e.target.value})),placeholder:"Ex: Programmer r\xe9union bilan"})]}),(0,s.jsxs)("label",{className:"flex flex-col text-sm",children:[(0,s.jsx)("span",{className:"mb-1 font-medium",children:"Rappel le"}),(0,s.jsx)("input",{type:"date",className:"border rounded p-2",value:j.rappel_date,onChange:e=>b(t=>({...t,rappel_date:e.target.value}))})]})]}),(0,s.jsxs)("div",{className:"flex gap-2 mt-4",children:[(0,s.jsx)("button",{className:"bg-green-600 text-white px-4 py-2 rounded disabled:opacity-50",onClick:N,disabled:m||!j.sujet.trim(),children:m?"Ajout...":"✅ Ajouter"}),(0,s.jsx)("button",{className:"border px-4 py-2 rounded",onClick:()=>h(!1),children:"Annuler"})]})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("h4",{className:"font-medium mb-3",children:"Historique des interactions"}),0===v.length?(0,s.jsx)("p",{className:"text-gray-600 text-center py-4",children:"Aucune interaction enregistr\xe9e. Ajoutez la premi\xe8re !"}):(0,s.jsx)("div",{className:"space-y-3 max-h-96 overflow-y-auto",children:v.map(e=>{var t;return(0,s.jsxs)("div",{className:"border-l-4 p-3 rounded ".concat((e=>{switch(e){case"appel":return"bg-blue-50 border-l-blue-500";case"email":return"bg-green-50 border-l-green-500";case"reunion":return"bg-purple-50 border-l-purple-500";case"relance":return"bg-orange-50 border-l-orange-500";default:return"bg-gray-50 border-l-gray-500"}})(e.type_interaction)),children:[(0,s.jsxs)("div",{className:"flex items-start justify-between",children:[(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)("span",{children:(e=>{switch(e){case"appel":return"\uD83D\uDCDE";case"email":return"✉️";case"reunion":return"\uD83E\uDD1D";case"relance":return"\uD83D\uDCCB";case"note":return"\uD83D\uDCDD";default:return"\uD83D\uDCC4"}})(e.type_interaction)}),(0,s.jsxs)("div",{children:[(0,s.jsx)("h5",{className:"font-medium",children:e.sujet}),(0,s.jsxs)("div",{className:"text-sm text-gray-600",children:[e.type_interaction," ",e.direction,e.participant&&(0,s.jsxs)(s.Fragment,{children:[" avec ",(0,s.jsx)("span",{className:"font-medium",children:e.participant}),C.find(t=>t.nom===e.participant)&&(0,s.jsx)("span",{className:"text-xs bg-green-100 text-green-700 px-1 rounded ml-1",children:(null==(t=C.find(t=>t.nom===e.participant))?void 0:t.type)==="R\xe9f\xe9rent principal"?"\uD83D\uDC51":"✓"})]}),e.duree_minutes&&" (".concat(e.duree_minutes,"min)")]})]})]}),(0,s.jsx)("span",{className:"text-xs text-gray-500",children:l(e.date_interaction)})]}),e.notes&&(0,s.jsx)("div",{className:"text-sm mt-2 bg-white p-2 rounded",children:e.notes}),e.prochaine_action&&(0,s.jsxs)("div",{className:"text-sm mt-2 text-orange-700 bg-orange-100 p-2 rounded",children:[(0,s.jsx)("strong",{children:"→ Prochaine action:"})," ",e.prochaine_action,e.rappel_date&&(0,s.jsxs)("span",{className:"ml-2",children:["(Rappel: ",r(e.rappel_date),")"]})]}),(0,s.jsxs)("div",{className:"text-xs text-gray-400 mt-2",children:["Par ",e.created_by]})]},e.id)})})]}),y.derniere_interaction&&(0,s.jsxs)("div",{className:"text-xs text-gray-500 text-center pt-2 border-t",children:["Derni\xe8re interaction: ",l(y.derniere_interaction)]})]})}}}]);