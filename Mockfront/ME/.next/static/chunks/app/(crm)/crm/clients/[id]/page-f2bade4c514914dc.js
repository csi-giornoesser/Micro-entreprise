(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[8596],{63:(e,s,t)=>{"use strict";var i=t(7260);t.o(i,"useParams")&&t.d(s,{useParams:function(){return i.useParams}}),t.o(i,"useSearchParams")&&t.d(s,{useSearchParams:function(){return i.useSearchParams}})},1384:(e,s,t)=>{Promise.resolve().then(t.bind(t,5686))},5686:(e,s,t)=>{"use strict";t.r(s),t.d(s,{default:()=>x});var i=t(5155),n=t(2115),r=t(63),l=t(2619),a=t(4101),c=t(8386),o=t(3247),d=t(6886),u=t(7730),m=t(7221),h=t(5392);function x(){var e,s,t;let x,{id:f}=(0,r.useParams)(),p=(0,r.useSearchParams)(),[j,_]=(0,n.useState)(null),[b,v]=(0,n.useState)(null),[N,g]=(0,n.useState)(null);(0,n.useEffect)(()=>{let e=!1;return _(null),v(null),(async()=>{try{let s=await fetch("/api/clients/".concat(f),{cache:"no-store"});if(!s.ok)throw Error("HTTP ".concat(s.status));let t=await s.json();e||_(t)}catch(s){e||v("Erreur chargement client")}})(),()=>{e=!0}},[f]);let D=(null==p?void 0:p.get("dossier"))||null,P=null!=(e=null==j?void 0:j.dossiers)?e:[],C=null!=(s=null==j?void 0:j.entreprise)?s:null,E=null!=(t=null==j?void 0:j.client)?t:null,w=(0,n.useMemo)(()=>P.length?D&&P.find(e=>String(e.id)===String(D))||P[0]:null,[P,D]);(0,n.useEffect)(()=>{let e=!1;return(async()=>{if(!(null==w?void 0:w.entreprise_id))return g(null);try{let s=await fetch("/api/entreprises/".concat(w.entreprise_id),{cache:"no-store"});if(!s.ok)throw Error("HTTP ".concat(s.status));let t=await s.json();e||g(t)}catch(e){}})(),()=>{e=!0}},[null==w?void 0:w.entreprise_id]);let y=(0,n.useMemo)(()=>{var e,s;if(!E||!w)return[];let t=C||{};return[{id:E.id,dossier_id:w.id,entreprise_id:w.entreprise_id,fullName:"".concat(E.prenom||""," ").concat(E.nom||"").trim()||"Client #".concat(E.id),email:E.email||"",telephone:E.telephone||"",entreprise_nom:t.denomination||"Entreprise #".concat(w.entreprise_id),entreprise_forme:t.forme||"Micro-entrepreneur",statut:w.statut,date_creation:w.date_creation,date_creation_effective:(null==t||null==(e=t.dates)?void 0:e.date_immatriculation_reelle)||(null==t||null==(s=t.dates)?void 0:s.date_debut_activite)||null,derniere_modification:w.derniere_modification||null,blocages:w.blocages||[],commission_partenaire_eur:w.commission_partenaire_eur||0}]},[E,w,C]);if(b)return(0,i.jsxs)("main",{className:"p-6 space-y-3",children:[(0,i.jsx)(l,{href:"/crm/dashboard",className:"text-blue-600 underline",children:"← Retour dashboard"}),(0,i.jsx)("h1",{className:"text-xl font-bold",children:"Erreur"}),(0,i.jsx)("pre",{className:"bg-gray-100 p-3 rounded text-sm",children:b})]});if(!j)return(0,i.jsx)("main",{className:"p-6",children:"Chargement…"});let S=j.pieces_justificatives||[],A=j.telechargements_disponibles||[];return j.communications,j.relances,null==j||j.notifications,(0,i.jsxs)("main",{className:"p-6 space-y-6",children:[(0,i.jsxs)("div",{className:"flex items-center justify-between",children:[(0,i.jsx)(l,{href:"/crm/dashboard",className:"text-blue-600 underline",children:"← Retour dashboard"}),(0,i.jsxs)("div",{className:"text-sm text-gray-600",children:["Client #",null==E?void 0:E.id," • cr\xe9\xe9 le ",(x=null==E?void 0:E.created_at)?new Date(x).toLocaleDateString("fr-FR"):"—"]})]}),(0,i.jsx)("section",{children:(0,i.jsx)(m.A,{partnerId:null,data:{clients:y}})}),(0,i.jsxs)("section",{children:[(0,i.jsx)("h3",{className:"text-lg font-semibold mb-3",children:"\uD83D\uDCE8 Historique (relances & notifications)"}),(0,i.jsx)(u.A,{relances:[],notifications:(null==j?void 0:j.notifications)||[]})]}),w&&(0,i.jsx)("section",{id:"timeline",children:(0,i.jsx)(a.A,{dossier:w})}),N?(0,i.jsx)(h.A,{data:N}):C?(0,i.jsxs)("section",{className:"border rounded p-4",children:[(0,i.jsx)("h3",{className:"text-lg font-semibold",children:"\uD83C\uDFE2 Mon entreprise"}),(0,i.jsxs)("div",{className:"text-sm text-gray-700",children:[(0,i.jsxs)("div",{children:[(0,i.jsx)("b",{children:C.denomination||"—"})," — ",C.forme||"Micro-entrepreneur"]}),(0,i.jsxs)("div",{children:["Statut dossier: ",C.statut_dossier||"—"]}),(0,i.jsx)(l,{className:"underline",href:"/crm/entreprises/".concat(C.id),children:"Voir la fiche →"})]})]}):null,(0,i.jsxs)("section",{children:[(0,i.jsx)("h3",{className:"text-lg font-semibold mb-3",children:"\uD83C\uDD94 Identit\xe9 & adresses"}),(0,i.jsx)(c.A,{client:E})]}),(0,i.jsxs)("section",{children:[(0,i.jsx)("h3",{className:"text-lg font-semibold mb-3",children:"\uD83D\uDCC4 Pi\xe8ces justificatives"}),(0,i.jsx)(o.A,{pieces:S,downloads:A,requiredTypes:["Passeport","PhotoIdentite","RIB","CNI"]})]}),(0,i.jsxs)("section",{children:[(0,i.jsx)("h3",{className:"text-lg font-semibold mb-3",children:"\uD83D\uDCC2 Dossiers & entreprise"}),(0,i.jsx)(d.A,{dossiers:P,dossierPrincipalId:null==w?void 0:w.id})]})]})}}},e=>{e.O(0,[2619,3564,1304,8441,1255,7358],()=>e(e.s=1384)),_N_E=e.O()}]);