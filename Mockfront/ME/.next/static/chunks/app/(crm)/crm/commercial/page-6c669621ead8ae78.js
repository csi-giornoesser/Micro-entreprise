(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[124],{142:(e,r,s)=>{"use strict";s.r(r),s.d(r,{default:()=>d});var a=s(5155),t=s(2115),l=s(2619);let n=e=>e?new Date(e).toLocaleDateString("fr-FR"):"-";function d(){let[e,r]=(0,t.useState)([]),[s,d]=(0,t.useState)({}),[c,i]=(0,t.useState)(!0);async function o(){i(!0);try{let e=await fetch("/api/commercial/rappels",{cache:"no-store"});if(e.ok){let s=await e.json();r(s.rappels||[]),d(s.stats||{})}}catch(e){console.error("Erreur chargement rappels:",e)}finally{i(!1)}}(0,t.useEffect)(()=>{o()},[]);let x=e.reduce((e,r)=>{let s=(e=>{if(!e.rappel_date)return"\uD83D\uDCC5 Sans \xe9ch\xe9ance";let r=new Date,s=Math.ceil((new Date(e.rappel_date)-r)/864e5);return s<0?"\uD83D\uDD34 En retard (".concat(Math.abs(s),"j)"):0===s?"\uD83D\uDFE1 Aujourd'hui":1===s?"\uD83D\uDFE1 Demain":s<=7?"\uD83D\uDD35 Dans ".concat(s," jours"):"⚪ Dans ".concat(s," jours")})(r);return e[s]||(e[s]=[]),e[s].push(r),e},{});return c?(0,a.jsx)("main",{className:"p-6",children:"Chargement du dashboard commercial..."}):(0,a.jsxs)("main",{className:"p-6 space-y-8",children:[(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsx)("h1",{className:"text-2xl font-bold",children:"\uD83E\uDD1D Dashboard Commercial"}),(0,a.jsx)(l,{href:"/crm/dashboard",className:"text-sm text-blue-600 underline",children:"← Retour dashboard"})]}),(0,a.jsxs)("div",{className:"grid md:grid-cols-4 gap-4",children:[(0,a.jsxs)("div",{className:"bg-red-50 border border-red-200 rounded p-4",children:[(0,a.jsx)("div",{className:"text-2xl font-bold text-red-600",children:s.en_retard||0}),(0,a.jsx)("div",{className:"text-sm text-gray-600",children:"Rappels en retard"})]}),(0,a.jsxs)("div",{className:"bg-orange-50 border border-orange-200 rounded p-4",children:[(0,a.jsx)("div",{className:"text-2xl font-bold text-orange-600",children:s.aujourd_hui||0}),(0,a.jsx)("div",{className:"text-sm text-gray-600",children:"\xc0 faire aujourd'hui"})]}),(0,a.jsxs)("div",{className:"bg-yellow-50 border border-yellow-200 rounded p-4",children:[(0,a.jsx)("div",{className:"text-2xl font-bold text-yellow-600",children:s.cette_semaine||0}),(0,a.jsx)("div",{className:"text-sm text-gray-600",children:"Cette semaine"})]}),(0,a.jsxs)("div",{className:"bg-blue-50 border border-blue-200 rounded p-4",children:[(0,a.jsx)("div",{className:"text-2xl font-bold text-blue-600",children:s.total||0}),(0,a.jsx)("div",{className:"text-sm text-gray-600",children:"Total actions"})]})]}),0===Object.keys(x).length?(0,a.jsxs)("div",{className:"bg-green-50 border border-green-200 rounded p-6 text-center",children:[(0,a.jsx)("h3",{className:"text-lg font-semibold text-green-800 mb-2",children:"✅ Aucune action commerciale en attente !"}),(0,a.jsx)("p",{className:"text-green-600",children:"Toutes les actions de suivi partenaires sont \xe0 jour."})]}):Object.entries(x).map(e=>{let[r,s]=e;return(0,a.jsxs)("section",{children:[(0,a.jsx)("h2",{className:"text-xl font-semibold mb-3",children:r}),(0,a.jsx)("div",{className:"space-y-3",children:s.map(e=>(0,a.jsxs)("div",{className:"border-l-4 p-4 rounded ".concat((e=>{if(!e.rappel_date)return"border-l-gray-500 bg-gray-50";let r=new Date,s=Math.ceil((new Date(e.rappel_date)-r)/864e5);return s<0?"border-l-red-500 bg-red-50":0===s?"border-l-orange-500 bg-orange-50":s<=3?"border-l-yellow-500 bg-yellow-50":"border-l-blue-500 bg-blue-50"})(e)),children:[(0,a.jsxs)("div",{className:"flex items-start justify-between",children:[(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2 mb-2",children:[(0,a.jsx)(l,{href:"/partenaires/".concat(e.partner_id),className:"font-semibold text-blue-600 hover:underline",children:e.partner_nom}),(0,a.jsx)("span",{className:"text-sm bg-white px-2 py-1 rounded border",children:e.type_interaction})]}),(0,a.jsx)("h4",{className:"font-medium mb-1",children:e.sujet}),(0,a.jsxs)("p",{className:"text-sm text-gray-700 mb-2",children:[(0,a.jsx)("strong",{children:"Action \xe0 faire :"})," ",e.prochaine_action]}),e.notes&&(0,a.jsx)("p",{className:"text-sm text-gray-600 bg-white p-2 rounded",children:e.notes})]}),(0,a.jsxs)("div",{className:"text-right text-sm text-gray-500",children:[(0,a.jsxs)("div",{children:["Interaction: ",n(e.date_interaction)]}),e.rappel_date&&(0,a.jsxs)("div",{className:"font-medium",children:["Rappel: ",n(e.rappel_date)]}),(0,a.jsxs)("div",{children:["Par: ",e.created_by]})]})]}),(0,a.jsxs)("div",{className:"flex gap-2 mt-3",children:[(0,a.jsx)(l,{href:"/partenaires/".concat(e.partner_id),className:"bg-blue-600 text-white px-3 py-1 rounded text-sm",children:"\uD83D\uDCDE Voir partenaire"}),(0,a.jsx)("button",{className:"border px-3 py-1 rounded text-sm",children:"✅ Marquer fait"})]})]},e.id))})]},r)}),(0,a.jsxs)("section",{className:"bg-gray-50 rounded p-4",children:[(0,a.jsx)("h3",{className:"font-semibold mb-3",children:"⚡ Actions rapides"}),(0,a.jsxs)("div",{className:"flex gap-3 flex-wrap",children:[(0,a.jsx)("button",{onClick:o,className:"border rounded px-4 py-2 text-sm",children:"\uD83D\uDD04 Actualiser"}),(0,a.jsx)(l,{href:"/crm/exports?export=commercial",className:"border rounded px-4 py-2 text-sm underline",children:"\uD83D\uDCCA Export rappels"}),(0,a.jsx)(l,{href:"/crm/partenaires",className:"border rounded px-4 py-2 text-sm underline",children:"\uD83D\uDC65 Tous les partenaires"})]})]})]})}},5096:(e,r,s)=>{Promise.resolve().then(s.bind(s,142))}},e=>{e.O(0,[2619,8441,1255,7358],()=>e(e.s=5096)),_N_E=e.O()}]);