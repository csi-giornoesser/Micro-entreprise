(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[9570],{63:(e,s,t)=>{"use strict";var n=t(7260);t.o(n,"useParams")&&t.d(s,{useParams:function(){return n.useParams}}),t.o(n,"useSearchParams")&&t.d(s,{useSearchParams:function(){return n.useSearchParams}})},1076:(e,s,t)=>{"use strict";t.r(s),t.d(s,{default:()=>c});var n=t(5155),i=t(63),r=t(2115),a=t(2619),l=t(8994);function c(){var e,s,t,c,o,d,u,h,m,x,p,j,f,g,N,b,_;let{id:v}=(0,i.useParams)(),[y,S]=(0,r.useState)(null),[w,C]=(0,r.useState)(null),[P,A]=(0,r.useState)(()=>new Date().toISOString().slice(0,7)),[k,E]=(0,r.useState)(null),[T,O]=(0,r.useState)(null),[D,F]=(0,r.useState)(!1);async function I(){F(!0),O(null),E(null);try{let e=await fetch("/api/partenaires/".concat(v,"/invoices"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({action:"preview",period:P})}),s=await e.json();if(!e.ok)throw Error(s.error||e.statusText);E(s.preview)}catch(e){O(String(e))}finally{F(!1)}}async function R(){F(!0),O(null);try{let e=await fetch("/api/partenaires/".concat(v,"/invoices"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({action:"create",period:P})}),s=await e.json();if(!e.ok)throw Error(s.error||e.statusText);let t=await fetch("/api/partenaires/".concat(v),{cache:"no-store"}),n=await t.json();S(n),E(s.preview)}catch(e){O(String(e))}finally{F(!1)}}if((0,r.useEffect)(()=>{let e=!1;return(async()=>{try{let s=await fetch("/api/partenaires/".concat(v),{cache:"no-store"});if(!s.ok){let e=await s.text().catch(()=>"");throw Error("HTTP ".concat(s.status," ").concat(s.statusText," — ").concat(e))}let t=await s.json();e||S(t)}catch(s){console.error(s),e||C(String(s))}})(),()=>{e=!0}},[v]),w)return(0,n.jsxs)("main",{className:"p-6 space-y-2",children:[(0,n.jsx)(a,{href:"/",children:"← Retour"}),(0,n.jsx)("h1",{className:"text-xl font-bold mt-2",children:"Erreur"}),(0,n.jsx)("pre",{className:"text-sm bg-gray-100 p-3 rounded",children:w})]});if(!y)return(0,n.jsx)("main",{className:"p-6",children:"Chargement…"});if(y.error)return(0,n.jsxs)("main",{className:"p-6 space-y-2",children:[(0,n.jsx)(a,{href:"/",children:"← Retour"}),(0,n.jsx)("h1",{className:"text-xl font-bold mt-2",children:"Partenaire introuvable"})]});let J=y.partenaire||{},B=y.ca_par_periode||[],M=y.factures||[],G=y.partner_users||[],H=y.dossiers||[],U=y.partner_exports_history||[],q=J.docs||{};return(0,n.jsxs)("main",{className:"p-6 space-y-6",children:[(0,n.jsx)(a,{href:"/",children:"← Retour"}),(0,n.jsx)("h1",{className:"text-2xl font-bold",children:J.nom}),(0,n.jsx)("p",{children:J.adresse||"-"}),(0,n.jsxs)("p",{children:["R\xe9f\xe9rent: ",(null==(e=J.referent)?void 0:e.nom)||"-"," — ",(null==(s=J.referent)?void 0:s.email)||"-"," — ",(null==(t=J.referent)?void 0:t.telephone)||"-"]}),(0,n.jsxs)("p",{children:["Int\xe9gration: ",J.integration||"-"," — Facturation: ",J.type_facturation||"-"," — Commission: ",null!=(g=J.taux_commission)?g:"-","% — Segment: ",J.segment||"-"]}),(0,n.jsxs)("p",{children:["Contrat: sign\xe9 le ",(null==(c=J.contrat)?void 0:c.date_signature)||"-"," — dur\xe9e ",null!=(N=null==(o=J.contrat)?void 0:o.duree_mois)?N:"-"," mois — statut ",(null==(d=J.contrat)?void 0:d.statut)||"-"," — ",(null==(u=J.contrat)?void 0:u.conditions_commerciales)||""]}),(0,n.jsxs)("p",{children:["Paiement: ",(null==(h=J.paiement)?void 0:h.mode)||"-"," — IBAN ",(null==(m=J.paiement)?void 0:m.iban)||"-"," — BIC ",(null==(x=J.paiement)?void 0:x.bic)||"-"]}),(0,n.jsxs)("p",{children:["Coord. facturation: ",(null==(p=J.coordonnees_facturation)?void 0:p.societe)||"-"," — ",(null==(j=J.coordonnees_facturation)?void 0:j.email_facturation)||"-"," — ",(null==(f=J.coordonnees_facturation)?void 0:f.adresse)||"-"]}),(0,n.jsx)(l.A,{partnerId:J.id}),(0,n.jsxs)("section",{children:[(0,n.jsx)("h3",{className:"text-lg font-semibold",children:"Utilisateurs (acc\xe8s partenaire)"}),(0,n.jsx)("ul",{className:"list-disc pl-6",children:G.length?G.map(e=>(0,n.jsxs)("li",{children:[e.email," — ",e.nom||"-"," — r\xf4le ",e.role," — 2FA ",e.two_fa_enabled?"✅":"❌"," — dernier login ",e.last_login_at||"-"]},e.id)):(0,n.jsx)("li",{children:"Aucun utilisateur"})})]}),(0,n.jsxs)("section",{children:[(0,n.jsx)("h3",{className:"text-lg font-semibold",children:"CA & dossiers (par p\xe9riode)"}),(0,n.jsx)("ul",{className:"list-disc pl-6",children:B.length?B.map((e,s)=>(0,n.jsxs)("li",{children:[e.periode,": ",e.ca,"€ — dossiers ",e.dossiers]},s)):(0,n.jsx)("li",{children:"Aucune donn\xe9e"})}),(0,n.jsxs)("p",{className:"mt-2",children:["CA total: ",null!=(b=J.ca_total)?b:0,"€ — Commissions: ",null!=(_=J.commissions_total)?_:0,"€"]})]}),(0,n.jsxs)("section",{className:"border rounded p-4 space-y-3",children:[(0,n.jsx)("h3",{className:"text-lg font-semibold",children:"G\xe9n\xe9rer une facture (p\xe9riode)"}),(0,n.jsxs)("div",{className:"flex gap-3 items-end",children:[(0,n.jsxs)("label",{className:"flex flex-col text-sm",children:[(0,n.jsx)("span",{className:"mb-1 font-medium",children:"P\xe9riode"}),(0,n.jsx)("input",{type:"month",value:P,onChange:e=>A(e.target.value),className:"border rounded p-2"})]}),(0,n.jsx)("button",{className:"border rounded px-3 py-2",onClick:I,disabled:D,children:"Pr\xe9visualiser"}),(0,n.jsx)("button",{className:"border rounded px-3 py-2",onClick:R,disabled:D,children:"Cr\xe9er la facture"}),D&&(0,n.jsx)("span",{className:"text-sm text-gray-500",children:"…"})]}),T&&(0,n.jsx)("div",{className:"text-sm text-red-600",children:T}),k&&(0,n.jsxs)("div",{className:"text-sm text-gray-700",children:[(0,n.jsxs)("div",{children:["P\xe9riode : ",(0,n.jsx)("b",{children:k.period})]}),(0,n.jsxs)("div",{children:["Dossiers valid\xe9s : ",(0,n.jsx)("b",{children:k.dossiers})]}),(0,n.jsxs)("div",{children:["Montant total commissions : ",(0,n.jsxs)("b",{children:[k.montant,"€"]})]})]})]}),(0,n.jsxs)("section",{children:[(0,n.jsx)("h3",{className:"text-lg font-semibold",children:"Factures"}),(0,n.jsx)("ul",{className:"list-disc pl-6",children:M.length?M.map(e=>(0,n.jsxs)("li",{children:[e.id," — ",e.montant,"€ — ",e.statut||"-"," — p\xe9riode ",e.periode||"-"," — ",e.date," — \xe9ch\xe9ance ",e.echeance||"-"," — PDF ",e.pdf||"-"]},e.id)):(0,n.jsx)("li",{children:"Aucune facture"})})]}),(0,n.jsxs)("section",{children:[(0,n.jsx)("h3",{className:"text-lg font-semibold",children:"Exports"}),(0,n.jsx)("ul",{className:"list-disc pl-6",children:U.length?U.map(e=>(0,n.jsxs)("li",{children:[e.generated_at," — ",e.format," — filtres ",JSON.stringify(e.filtres)," — fichier ",e.file||"-"]},e.id)):(0,n.jsx)("li",{children:"Aucun export"})})]}),(0,n.jsxs)("section",{children:[(0,n.jsx)("h3",{className:"text-lg font-semibold",children:"Documentation & contrats"}),(0,n.jsxs)("ul",{className:"list-disc pl-6",children:[(0,n.jsxs)("li",{children:["Contrat: ",q.contrat_pdf||"-"]}),(0,n.jsxs)("li",{children:["Modalit\xe9s: ",q.modalites_collaboration_pdf||"-"]}),(q.documentation_tech||[]).map((e,s)=>(0,n.jsxs)("li",{children:[e.type," — ",e.url]},s))]})]}),(0,n.jsxs)("section",{children:[(0,n.jsx)("h3",{className:"text-lg font-semibold",children:"Dossiers du partenaire"}),(0,n.jsx)("ul",{className:"list-disc pl-6",children:H.length?H.map(e=>(0,n.jsxs)("li",{children:["Dossier #",e.id," — statut ",e.statut," — client"," ",(0,n.jsxs)(a,{className:"underline",href:"/clients/".concat(e.client_id),children:["#",e.client_id]})," ","— entreprise ",(0,n.jsxs)(a,{className:"underline",href:"/entreprises/".concat(e.entreprise_id),children:["#",e.entreprise_id]}),(e.blocages||[]).length?(0,n.jsxs)(n.Fragment,{children:[" — blocages: ",(e.blocages||[]).join(", ")]}):null]},e.id)):(0,n.jsx)("li",{children:"Aucun dossier"})})]})]})}},2858:(e,s,t)=>{Promise.resolve().then(t.bind(t,1076))}},e=>{e.O(0,[2619,8994,8441,1255,7358],()=>e(e.s=2858)),_N_E=e.O()}]);