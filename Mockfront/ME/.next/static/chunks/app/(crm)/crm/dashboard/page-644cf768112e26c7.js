(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[7614],{6648:(e,s,t)=>{"use strict";t.r(s),t.d(s,{default:()=>g});var a=t(5155),n=t(2115),l=t(2619),r=t(4101),i=t(8386),c=t(3247),o=t(7730),d=t(442),u=t(8994),m=t(9841),x=t(5392);function h(e){return e?new Date(e):null}function p(e){return null!=e?e:"—"}function j(e){let{alert:s,onAction:t}=e;return(0,a.jsxs)("div",{className:"border-l-4 p-3 rounded ".concat((e=>{switch(e){case"critical":return"border-red-500 bg-red-50";case"important":return"border-orange-500 bg-orange-50";case"info":return"border-blue-500 bg-blue-50";default:return"border-gray-500 bg-gray-50"}})(s.priority)),children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)("span",{children:(e=>{switch(e){case"critical":return"\uD83D\uDD34";case"important":return"\uD83D\uDFE1";case"info":return"\uD83D\uDD35";default:return"⚪"}})(s.priority)}),(0,a.jsx)("span",{className:"font-semibold",children:s.title})]}),(0,a.jsx)("button",{className:"text-xs bg-white px-2 py-1 rounded border",onClick:()=>t(s),children:"traiter"===s.action?"\uD83D\uDD27 Traiter":"assigner"===s.action?"\uD83D\uDC64 Assigner":"relancer"===s.action?"\uD83D\uDCDE Relancer":"\uD83D\uDC40 Voir"})]}),(0,a.jsx)("p",{className:"text-sm text-gray-600 mb-2",children:s.description}),s.items&&s.items.length>0&&(0,a.jsxs)("div",{className:"space-y-1",children:[s.items.slice(0,3).map((e,s)=>(0,a.jsxs)("div",{className:"text-xs bg-white p-2 rounded",children:[(0,a.jsx)(l,{href:e.link,className:"font-medium text-blue-600 hover:underline",children:e.label}),(0,a.jsx)("div",{className:"text-gray-500",children:e.detail})]},s)),s.items.length>3&&(0,a.jsxs)("div",{className:"text-xs text-gray-500 text-center",children:["+",s.items.length-3," autres..."]})]})]})}function f(e){let s,{activity:t}=e;return(0,a.jsxs)("div",{className:"border-l-4 p-2 rounded ".concat((e=>{switch(e){case"blue":return"border-l-blue-500 bg-blue-50";case"green":return"border-l-green-500 bg-green-50";case"yellow":return"border-l-yellow-500 bg-yellow-50";case"orange":return"border-l-orange-500 bg-orange-50";default:return"border-l-gray-500 bg-gray-50"}})(t.color)),children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)("span",{children:t.icon}),(0,a.jsx)(l,{href:t.link,className:"font-medium text-blue-600 hover:underline",children:t.title})]}),(0,a.jsx)("span",{className:"text-xs text-gray-500",children:((s=t.timestamp)?new Date(s).toLocaleString("fr-FR"):"-").replace(/:\d{2}$/,"")})]}),(0,a.jsx)("div",{className:"text-sm text-gray-600 ml-6",children:t.description}),t.detail&&(0,a.jsx)("div",{className:"text-xs text-gray-500 ml-6 mt-1",children:t.detail})]})}function g(){var e,s,t,r,i,c,o,d;let[u,m]=(0,n.useState)("all"),[x,p]=(0,n.useState)("all"),[g,N]=(0,n.useState)("all"),[v,y]=(0,n.useState)(""),[w,D]=(0,n.useState)(""),[S,_]=(0,n.useState)(null),[C,k]=(0,n.useState)(null),I=!S&&!C,[A,E]=(0,n.useState)(null),[T,P]=(0,n.useState)([]),[O,R]=(0,n.useState)(!0),[M,V]=(0,n.useState)(!1);async function F(){let e=new URLSearchParams;"all"!==u&&e.set("status",u),"all"!==x&&e.set("partnerId",x),"all"!==g&&e.set("operatorId",g),v&&e.set("from",v),w&&e.set("to",w),k(null);try{let s=await fetch("/api/dashboard?".concat(e.toString()),{cache:"no-store"});if(!s.ok)throw Error("HTTP ".concat(s.status));let t=await s.json();_(t)}catch(e){k(String(e))}}async function H(){R(!0);try{let[e,s]=await Promise.all([fetch("/api/alerts",{cache:"no-store"}),fetch("/api/recent-activities",{cache:"no-store"})]);if(e.ok&&E(await e.json()),s.ok){let e=await s.json();P(e.activities||[])}}catch(e){console.error("Erreur chargement alertes:",e)}finally{R(!1)}}async function q(e,s){await fetch("/api/dossiers/".concat(e),{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({statut:s})}),await F(),await H()}async function L(e,s){let t=prompt("Sujet du ticket:","Support client ".concat(s||"Inconnu"));if(t)try{await fetch("/api/tickets",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({dossier_id:e,subject:t,priorite:"Moyenne",message:"Ticket cr\xe9\xe9 depuis le dashboard CRM"})}),await F(),await H()}catch(e){console.error("Erreur cr\xe9ation ticket:",e),alert("Erreur lors de la cr\xe9ation du ticket")}}async function B(e,s){let t=new Date(Date.now()+36e5).toISOString();await fetch("/api/notifications",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({type:"relance_piece",client_id:s,dossier_id:e,canal:"email",scheduled_for:t})}),await F()}async function J(){let e=new URLSearchParams;"all"!==u&&e.set("status",u),"all"!==x&&e.set("partnerId",x),"all"!==g&&e.set("operatorId",g),v&&e.set("from",v),w&&e.set("to",w),e.set("format","csv");try{let s="/api/exports/dossiers?".concat(e.toString()),t=document.createElement("a");t.href=s,t.download="dossiers_".concat(new Date().toISOString().slice(0,10),".csv"),document.body.appendChild(t),t.click(),document.body.removeChild(t)}catch(e){console.error("Erreur export:",e),alert("Erreur lors de l'export")}}function U(e){switch(e.action){case"traiter":"dossiers_blocked"===e.type&&m("en_attente"),"dossiers_a_corriger"===e.type&&m("a_corriger");break;case"assigner":window.location.href="/crm/tickets?priorite=Haute";break;case"relancer":window.alert("Fonctionnalit\xe9 de relance \xe0 impl\xe9menter");break;default:e.items&&e.items.length>0&&(window.location.href=e.items[0].link)}}(0,n.useEffect)(()=>{F(),H()},[u,x,g,v,w]);let z=null!=(s=null==S?void 0:S.partenaires)?s:[],K=null!=(t=null==S?void 0:S.operateurs)?t:[],$=null!=(r=null==S?void 0:S.dossiers)?r:[],G=null!=(i=null==S?void 0:S.clients)?i:[],Q=null!=(c=null==S||null==(e=S.refs)?void 0:e.statuts_dossier)?c:[],W=null!=(o=null==S?void 0:S.notifications_queue)?o:[],X=null!=(d=null==S?void 0:S.auth_logs)?d:[],Y=(0,n.useMemo)(()=>{let e=v?h(v):null,s=w?h(w):null;return $.filter(t=>{let a="all"===u||t.statut===u,n="all"===x||String(t.partenaireId)===String(x),l="all"===g||String(t.operateurId)===String(g),r=function(e,s,t){if(!e)return!0;let a="string"==typeof e?new Date(e):e;if(s&&a<s)return!1;if(t){let e=new Date(t);if(e.setHours(23,59,59,999),a>e)return!1}return!0}(t.date_creation,e,s);return a&&n&&l&&r})},[$,u,x,g,v,w]),Z=(0,n.useMemo)(()=>{let e={};return(Q.length?Q:Array.from(new Set($.map(e=>e.statut)))).forEach(s=>e[s]=0),Y.forEach(s=>e[s.statut]=(e[s.statut]||0)+1),e},[Y,$,Q]);if(C)return(0,a.jsxs)("main",{className:"p-6",children:[(0,a.jsx)("h1",{className:"text-xl font-bold",children:"Erreur"}),(0,a.jsx)("pre",{className:"mt-2",children:C})]});if(I)return(0,a.jsx)("main",{className:"p-6",children:"Chargement…"});let ee=A?[...A.alerts.critical,...A.alerts.important,...M?A.alerts.info:[]]:[];return(0,a.jsxs)("main",{className:"p-6 space-y-8",children:[(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsx)("h1",{className:"text-2xl font-bold",children:"CRM — Dashboard"}),(0,a.jsx)(l,{href:"/crm/tickets",className:"text-sm text-blue-600 underline",children:"→ Voir tous les tickets"}),(0,a.jsx)("button",{onClick:H,className:"text-sm bg-blue-600 text-white px-3 py-1 rounded",disabled:O,children:O?"\uD83D\uDD04":"\uD83D\uDD04 Actualiser alertes"})]}),A&&(0,a.jsxs)("section",{className:"space-y-4",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsx)("h2",{className:"text-xl font-semibold",children:"\uD83D\uDEA8 Alertes prioritaires"}),(0,a.jsxs)("div",{className:"flex gap-2 text-sm",children:[A.summary.critical>0&&(0,a.jsxs)("span",{className:"bg-red-100 text-red-800 px-2 py-1 rounded",children:["\uD83D\uDD34 ",A.summary.critical," critiques"]}),A.summary.important>0&&(0,a.jsxs)("span",{className:"bg-orange-100 text-orange-800 px-2 py-1 rounded",children:["\uD83D\uDFE1 ",A.summary.important," importantes"]}),A.summary.info>0&&(0,a.jsxs)("span",{className:"bg-blue-100 text-blue-800 px-2 py-1 rounded",children:["\uD83D\uDD35 ",A.summary.info," info"]})]})]}),0===ee.length?(0,a.jsx)("div",{className:"bg-green-50 border border-green-200 rounded p-4 text-center",children:"✅ Aucune alerte critique ou importante ! Tout va bien."}):(0,a.jsx)("div",{className:"grid md:grid-cols-2 gap-4",children:ee.map(e=>(0,a.jsx)(j,{alert:e,onAction:U},e.id))}),A.summary.info>0&&!M&&(0,a.jsx)("div",{className:"text-center",children:(0,a.jsxs)("button",{onClick:()=>V(!0),className:"text-sm text-blue-600 underline",children:["+ Voir les ",A.summary.info," alertes informatives"]})})]}),T.length>0&&(0,a.jsxs)("section",{children:[(0,a.jsx)("h2",{className:"text-xl font-semibold mb-4",children:"\uD83D\uDCCA Activit\xe9 r\xe9cente"}),(0,a.jsx)("div",{className:"grid md:grid-cols-2 gap-3",children:T.slice(0,6).map((e,s)=>(0,a.jsx)(f,{activity:e},s))}),T.length>6&&(0,a.jsx)("div",{className:"text-center mt-3",children:(0,a.jsx)(l,{href:"/crm/activities",className:"text-sm text-blue-600 underline",children:"Voir toute l'activit\xe9 →"})})]}),(0,a.jsxs)("section",{className:"border rounded p-4 space-y-3",children:[(0,a.jsxs)("div",{className:"grid md:grid-cols-5 gap-3",children:[(0,a.jsxs)("label",{className:"flex flex-col text-sm",children:[(0,a.jsx)("span",{className:"mb-1 font-medium",children:"Statut"}),(0,a.jsxs)("select",{className:"border rounded p-2",value:u,onChange:e=>m(e.target.value),children:[(0,a.jsx)("option",{value:"all",children:"Tous"}),(Q.length?Q:Array.from(new Set($.map(e=>e.statut)))).map(e=>(0,a.jsx)("option",{value:e,children:e},e))]})]}),(0,a.jsxs)("label",{className:"flex flex-col text-sm",children:[(0,a.jsx)("span",{className:"mb-1 font-medium",children:"Partenaire"}),(0,a.jsxs)("select",{className:"border rounded p-2",value:x,onChange:e=>p(e.target.value),children:[(0,a.jsx)("option",{value:"all",children:"Tous"}),z.map(e=>(0,a.jsx)("option",{value:e.id,children:e.nom},e.id))]})]}),(0,a.jsxs)("label",{className:"flex flex-col text-sm",children:[(0,a.jsx)("span",{className:"mb-1 font-medium",children:"Op\xe9rateur"}),(0,a.jsxs)("select",{className:"border rounded p-2",value:g,onChange:e=>N(e.target.value),children:[(0,a.jsx)("option",{value:"all",children:"Tous"}),K.map(e=>(0,a.jsx)("option",{value:e.id,children:e.nom},e.id))]})]}),(0,a.jsxs)("label",{className:"flex flex-col text-sm",children:[(0,a.jsx)("span",{className:"mb-1 font-medium",children:"Du"}),(0,a.jsx)("input",{type:"date",className:"border rounded p-2",value:v,onChange:e=>y(e.target.value)})]}),(0,a.jsxs)("label",{className:"flex flex-col text-sm",children:[(0,a.jsx)("span",{className:"mb-1 font-medium",children:"Au"}),(0,a.jsx)("input",{type:"date",className:"border rounded p-2",value:w,onChange:e=>D(e.target.value)})]})]}),(0,a.jsxs)("div",{className:"flex gap-3",children:[(0,a.jsx)("button",{className:"border rounded px-3 py-2",onClick:()=>{m("all"),p("all"),N("all"),y(""),D("")},children:"R\xe9initialiser"}),(0,a.jsxs)("button",{className:"bg-green-600 text-white px-3 py-2 rounded",onClick:J,children:["\uD83D\uDCCA Exporter CSV (",Y.length,")"]}),(0,a.jsxs)("div",{className:"text-sm text-gray-600 self-center",children:[Y.length," dossier(s) sur ",$.length]})]})]}),(0,a.jsxs)("section",{children:[(0,a.jsx)("h2",{className:"text-xl font-semibold mb-2",children:"KPIs dossiers (filtr\xe9s)"}),(0,a.jsxs)("div",{className:"flex gap-3 flex-wrap",children:[Object.entries(Z).map(e=>{let[s,t]=e;return(0,a.jsxs)("div",{className:"border rounded p-3",children:[(0,a.jsx)("div",{className:"text-sm text-gray-600",children:s}),(0,a.jsx)("div",{className:"text-2xl font-bold",children:t})]},s)}),(0,a.jsxs)("div",{className:"border rounded p-3",children:[(0,a.jsx)("div",{className:"text-sm text-gray-600",children:"Total"}),(0,a.jsx)("div",{className:"text-2xl font-bold",children:Y.length})]})]})]}),(0,a.jsxs)("section",{children:[(0,a.jsx)("h2",{className:"text-xl font-semibold mb-2",children:"Dossiers"}),0===Y.length?(0,a.jsx)("p",{className:"text-sm text-gray-600",children:"Aucun r\xe9sultat avec ces filtres."}):(0,a.jsx)("ul",{className:"list-disc pl-6 space-y-3",children:Y.map(e=>{let s,t,n=(s=e.clientId,G.find(e=>String(e.id)===String(s)));return(0,a.jsx)(b,{dossier:e,client:n,partner:(t=e.partenaireId,z.find(e=>String(e.id)===String(t))),changeStatut:q,createTicket:L,planRelance:B},e.id)})})]}),(0,a.jsxs)("section",{children:[(0,a.jsx)("h2",{className:"text-xl font-semibold mb-2",children:"Notifications & relances programm\xe9es"}),(0,a.jsx)("ul",{className:"list-disc pl-6 space-y-1",children:W.length?W.map(e=>(0,a.jsxs)("li",{children:[e.type," — client"," ",(0,a.jsxs)(l,{className:"underline",href:"/crm/clients/".concat(e.clientId),children:["#",e.clientId]})," ","— ",(0,a.jsxs)("span",{className:"italic text-gray-700",children:['"',e.message||"—",'"']})," — dossier #",e.dossierId," — ",e.canal," — pr\xe9vu le"," ",new Date(e.scheduled_for).toLocaleString("fr-FR")]},e.id)):(0,a.jsx)("li",{children:"Aucune notification programm\xe9e."})})]}),(0,a.jsxs)("section",{children:[(0,a.jsx)("h2",{className:"text-xl font-semibold mb-2",children:"Tickets r\xe9cents"}),(0,a.jsx)("div",{className:"text-sm",children:(0,a.jsx)(l,{href:"/crm/tickets",className:"underline",children:"Voir tous les tickets →"})})]}),(0,a.jsxs)("section",{children:[(0,a.jsx)("h2",{className:"text-xl font-semibold mb-2",children:"Connexions (s\xe9curit\xe9)"}),(0,a.jsx)("ul",{className:"list-disc pl-6 space-y-1",children:X.length?X.map((e,s)=>(0,a.jsxs)("li",{children:[e.at," — ",e.role," ",e.who," — ",e.action," — ",e.success?"✅":"❌"," — IP ",e.ip]},s)):(0,a.jsx)("li",{children:"Aucune entr\xe9e"})})]})]})}function b(e){var s,t,l,h,j,f,g,b,N,v,y,w,D,S,_,C,k,I,A,E,T,P,O;let{dossier:R,client:M,partner:V,changeStatut:F,createTicket:H,planRelance:q}=e,[L,B]=(0,n.useState)(!1),[J,U]=(0,n.useState)("");async function z(){try{let e=await fetch("/api/notifications",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({type:"relance_piece",client_id:R.clientId,dossier_id:R.id,canal:"email",scheduled_for:new Date().toISOString(),message:J||"Pas de message fourni"})});if(!e.ok)throw Error("HTTP ".concat(e.status));if(Y&&R.clientId){let e=await fetch("/api/clients/".concat(R.clientId),{cache:"no-store"});if(e.ok){let s=await e.json();Z(s)}}alert("✅ Relance envoy\xe9e !"),B(!1),U("")}catch(e){console.error("Erreur relance:",e),alert("❌ Impossible d'envoyer la relance")}}let[K,$]=(0,n.useState)(!1),[G,Q]=(0,n.useState)(!1),[W,X]=(0,n.useState)(null),[Y,Z]=(0,n.useState)(null),[ee,es]=(0,n.useState)(null),[et,ea]=(0,n.useState)(!1),[en,el]=(0,n.useState)(null),[er,ei]=(0,n.useState)(!1),[ec,eo]=(0,n.useState)(!1),[ed,eu]=(0,n.useState)(null),[em,ex]=(0,n.useState)(null);async function eh(){if(K)return void $(!1);if($(!0),!Y)try{Q(!0),X(null);let e=await fetch("/api/clients/".concat(R.clientId),{cache:"no-store"}),s=await e.json();if(!e.ok)throw Error(s.error||"HTTP ".concat(e.status));Z(s)}catch(e){X(String(e.message||e))}finally{Q(!1)}}async function ep(e){if(e.preventDefault(),e.stopPropagation(),er)return void ei(!1);if(ei(!0),!em)try{eo(!0),eu(null);let e=await fetch("/api/partenaires/".concat(R.partenaireId),{cache:"no-store"}),s=await e.json().catch(()=>({}));if(!e.ok)throw Error(s.error||e.statusText);ex(s)}catch(e){eu(String(e.message||e))}finally{eo(!1)}}(0,n.useEffect)(()=>{if(!K)return;let e=null==R?void 0:R.entrepriseId;if(!e||ee)return;let s=!1;return(async()=>{try{ea(!0);let t=await fetch("/api/entreprises/".concat(e),{cache:"no-store"}),a=await t.json().catch(()=>({}));if(!t.ok)throw Error(a.error||t.statusText);s||es(a)}catch(e){s||el(String(e.message||e))}finally{s||ea(!1)}})(),()=>{s=!0}},[K,null==R?void 0:R.entrepriseId,ee]);let ej=M?"".concat(null!=(k=M.prenom)?k:""," ").concat(null!=(I=M.nom)?I:"").trim()||"#".concat(M.id):"#".concat(R.clientId),ef=(null==em?void 0:em.partenaire)||{},eg=ef.docs||{};return(0,a.jsxs)("li",{className:"space-y-2",children:[(0,a.jsxs)("div",{className:"flex flex-wrap items-center gap-2",children:[(0,a.jsxs)("span",{className:"font-semibold",children:["#",R.id]}),(0,a.jsxs)("span",{children:["— statut: ",R.statut]}),(0,a.jsxs)("span",{children:["— cr\xe9\xe9: ",R.date_creation]}),(0,a.jsxs)("span",{children:["— modif: ",null!=(A=R.derniere_modification)?A:"-"]}),(0,a.jsxs)("span",{children:["— client: ",M?ej:R.clientId]}),(0,a.jsxs)("span",{children:["— partenaire:"," ",(0,a.jsx)("button",{type:"button",onClick:ep,className:"underline text-blue-600 hover:text-blue-800",title:"Afficher les infos du partenaire",children:V?V.nom:R.partenaireId})]}),(0,a.jsxs)("span",{children:["— entreprise: #",R.entrepriseId]}),(R.blocages||[]).length?(0,a.jsxs)("span",{children:["— blocages: ",(R.blocages||[]).join(", ")]}):null,(0,a.jsxs)("span",{children:["— commission: ",null!=(E=R.commission_partenaire_eur)?E:0,"€"]}),(0,a.jsxs)("div",{className:"inline-flex gap-2 ml-2",children:[(0,a.jsx)("select",{className:"border rounded px-1 py-0.5 text-sm",value:R.statut,onChange:e=>F(R.id,e.target.value),children:["nouveau","en_cours","en_attente","a_corriger","valide","rejete"].map(e=>(0,a.jsx)("option",{value:e,children:e},e))}),(0,a.jsx)("button",{className:"border rounded px-2 py-0.5 text-sm",onClick:()=>B(!0),children:"\uD83D\uDCE9 Relancer"}),L&&(0,a.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-40 flex items-center justify-center z-50",children:(0,a.jsxs)("div",{className:"bg-white rounded-lg shadow-lg p-6 w-96",children:[(0,a.jsx)("h3",{className:"text-lg font-semibold mb-4",children:"Relancer le client"}),(0,a.jsx)("textarea",{value:J,onChange:e=>U(e.target.value),placeholder:"Votre message...",className:"border rounded w-full p-2 mb-4 h-24"}),(0,a.jsxs)("div",{className:"flex justify-end gap-3",children:[(0,a.jsx)("button",{onClick:()=>B(!1),className:"px-3 py-1 rounded bg-gray-200 hover:bg-gray-300",children:"Annuler"}),(0,a.jsx)("button",{onClick:z,className:"px-3 py-1 rounded bg-blue-600 text-white hover:bg-blue-700",children:"Envoyer"})]})]})}),(0,a.jsx)("button",{className:"border rounded px-2 py-0.5 text-sm",onClick:eh,children:K?"Masquer":"Voir plus"})]})]}),er&&(0,a.jsxs)("div",{className:"mt-2 border-l-2 pl-4",children:[ec&&(0,a.jsx)("div",{className:"text-sm text-gray-500",children:"Chargement…"}),ed&&(0,a.jsxs)("div",{className:"text-sm text-red-600",children:["❌ ",ed]}),!ec&&!ed&&(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsxs)("section",{className:"bg-gray-50 rounded p-3",children:[(0,a.jsx)("h4",{className:"font-semibold mb-1",children:"\uD83E\uDD1D Partenaire"}),ef&&Object.keys(ef).length?(0,a.jsxs)("div",{className:"text-sm",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("b",{children:ef.nom||"#".concat(R.partenaireId)})," — segment ",ef.segment||"—"]}),(0,a.jsxs)("div",{children:["R\xe9f\xe9rent: ",(null==(s=ef.referent)?void 0:s.nom)||"—"," — ",(null==(t=ef.referent)?void 0:t.email)||"—"," — ",(null==(l=ef.referent)?void 0:l.telephone)||"—"]}),(0,a.jsxs)("div",{children:["Taux commission: ",null!=(T=ef.taux_commission)?T:"—","% • Facturation: ",ef.type_facturation||"—"]}),(0,a.jsxs)("div",{children:["Paiement: ",(null==(h=ef.paiement)?void 0:h.mode)||"—"," • IBAN: ",(null==(j=ef.paiement)?void 0:j.iban)?"".concat(ef.paiement.iban.slice(0,8),"…"):"—"," • BIC: ",(null==(f=ef.paiement)?void 0:f.bic)||"—"]}),(0,a.jsxs)("div",{className:"text-xs text-gray-500 mt-1",children:["Contrat: ",(null==(g=ef.contrat)?void 0:g.statut)||"—"," • sign\xe9 le ",(null==(b=ef.contrat)?void 0:b.date_signature)||"—"," • dur\xe9e ",null!=(P=null==(N=ef.contrat)?void 0:N.duree_mois)?P:"—"," mois"]})]}):(0,a.jsx)("div",{className:"text-sm text-gray-500",children:"—"})]}),(0,a.jsxs)("section",{children:[(0,a.jsx)("h4",{className:"font-semibold mb-2",children:"\uD83D\uDCCA Tableau de Bord"}),(0,a.jsx)(m.A,{partnerId:R.partenaireId,data:em})]}),(0,a.jsxs)("section",{children:[(0,a.jsx)("h4",{className:"font-semibold mb-2",children:"\uD83D\uDCC8 Suivi Commercial"}),(0,a.jsx)(u.A,{partnerId:R.partenaireId})]}),(0,a.jsxs)("section",{className:"bg-gray-50 rounded p-3",children:[(0,a.jsx)("h4",{className:"font-semibold mb-1",children:"\uD83D\uDCC1 Espace documentaire"}),eg&&(eg.contrat_pdf||eg.modalites_collaboration_pdf||(eg.documentation_tech||[]).length)?(0,a.jsxs)("ul",{className:"list-disc pl-5 text-sm",children:[(0,a.jsxs)("li",{children:["Contrat:"," ",eg.contrat_pdf?(0,a.jsx)("a",{className:"underline text-blue-600",href:eg.contrat_pdf,target:"_blank",rel:"noreferrer",children:"ouvrir"}):"—"]}),(0,a.jsxs)("li",{children:["Modalit\xe9s:"," ",eg.modalites_collaboration_pdf?(0,a.jsx)("a",{className:"underline text-blue-600",href:eg.modalites_collaboration_pdf,target:"_blank",rel:"noreferrer",children:"ouvrir"}):"—"]}),(eg.documentation_tech||[]).map((e,s)=>(0,a.jsxs)("li",{children:[e.type||"Doc"," — ",e.url?(0,a.jsx)("a",{className:"underline text-blue-600",href:e.url,target:"_blank",rel:"noreferrer",children:e.url}):"—"]},s))]}):(0,a.jsx)("div",{className:"text-sm text-gray-500",children:"—"})]}),(0,a.jsxs)("section",{children:[(0,a.jsx)("h4",{className:"font-semibold mb-1",children:"\uD83D\uDCCB Informations d\xe9taill\xe9es"}),(0,a.jsxs)("ul",{className:"list-disc pl-5 text-sm",children:[(0,a.jsxs)("li",{children:["Adresse: ",ef.adresse||"—"]}),(0,a.jsxs)("li",{children:["Coord. facturation: ",(null==(v=ef.coordonnees_facturation)?void 0:v.societe)||"—"," — ",(null==(y=ef.coordonnees_facturation)?void 0:y.email_facturation)||"—"," — ",(null==(w=ef.coordonnees_facturation)?void 0:w.adresse)||"—"]}),(0,a.jsxs)("li",{children:["Int\xe9gration: ",ef.integration||"—"," • Segment: ",ef.segment||"—"]})]})]})]})]}),K&&(0,a.jsxs)("div",{className:"mt-2 border-l-2 pl-4",children:[G&&(0,a.jsx)("div",{className:"text-sm text-gray-500",children:"Chargement…"}),W&&(0,a.jsxs)("div",{className:"text-sm text-red-600",children:["❌ ",W]}),Y&&(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsxs)("section",{className:"bg-gray-50 rounded p-3",children:[(0,a.jsx)("h4",{className:"font-semibold mb-2",children:"\uD83D\uDC65 Suivi des clients"}),(0,a.jsxs)("div",{className:"text-sm",children:[(0,a.jsxs)("div",{children:[(0,a.jsxs)("b",{children:[p(null==(D=Y.client)?void 0:D.prenom)," ",p(null==(S=Y.client)?void 0:S.nom)]})," — ",p(null==(_=Y.client)?void 0:_.email),(null==(C=Y.client)?void 0:C.telephone)?" • ".concat(Y.client.telephone):""]}),(0,a.jsxs)("div",{className:"text-gray-600",children:["Dossier #",R.id," — statut ",R.statut," — cr\xe9\xe9 ",R.date_creation," — commission ",0===(O=R.commission_partenaire_eur)?"0€":null==O?"—":"".concat(Number(O).toLocaleString("fr-FR"),"€")]})]})]}),(0,a.jsx)(r.A,{dossier:(Y.dossiers||[]).find(e=>e.id===R.id)||R}),(0,a.jsxs)("section",{children:[(0,a.jsx)("h4",{className:"font-semibold mb-2",children:"\uD83D\uDCE8 Historique (relances & notifications)"}),(0,a.jsx)(o.A,{communications:Y.communications||Y.historique_echanges||[],relances:Y.relances||[],notifications:Y.notifications||[],compact:!0})]}),(0,a.jsx)(d.A,{clientId:R.clientId,dossiers:Y.dossiers||[]}),(0,a.jsxs)("section",{children:[(0,a.jsx)("h4",{className:"font-semibold mb-2",children:"\uD83C\uDD94 Identit\xe9 & adresses"}),(0,a.jsx)(i.A,{client:Y.client})]}),(0,a.jsxs)("section",{children:[(0,a.jsx)("h4",{className:"font-semibold mb-2",children:"\uD83D\uDCC4 Pi\xe8ces justificatives"}),(0,a.jsx)(c.A,{pieces:Y.pieces_justificatives||[],downloads:Y.telechargements_disponibles||[]})]}),(0,a.jsxs)("section",{className:"bg-gray-50 rounded p-3",children:[(0,a.jsx)("h4",{className:"font-semibold mb-2",children:"\uD83C\uDFE2 Mon entreprise"}),et&&(0,a.jsx)("div",{className:"text-sm text-gray-500",children:"Chargement…"}),en&&(0,a.jsxs)("div",{className:"text-sm text-red-600",children:["❌ ",en]}),ee?(0,a.jsx)(x.A,{data:ee}):!et&&(0,a.jsx)("div",{className:"text-sm text-gray-500",children:"—"})]})]})]})]})}},9458:(e,s,t)=>{Promise.resolve().then(t.bind(t,6648))}},e=>{e.O(0,[2619,3564,8994,9302,8441,1255,7358],()=>e(e.s=9458)),_N_E=e.O()}]);