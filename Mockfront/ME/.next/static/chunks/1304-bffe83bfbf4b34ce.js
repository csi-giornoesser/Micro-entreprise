"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[1304],{6886:(e,t,s)=>{s.d(t,{A:()=>n});var a=s(5155),r=s(2619);let i=e=>(null!=e?e:0===e)?String(e):"—";function n(e){let{dossiers:t=[],dossierPrincipalId:s}=e;return(0,a.jsxs)("section",{children:[(0,a.jsx)("h3",{className:"text-lg font-semibold mb-3",children:"\uD83D\uDCC2 Dossiers & entreprise"}),(0,a.jsxs)("div",{className:"bg-white border rounded p-4",children:[t.length>1&&s&&(0,a.jsxs)("p",{className:"text-sm text-blue-600 mb-2",children:["\uD83D\uDCA1 Timeline ci-dessus pour le dossier principal #",s]}),(0,a.jsx)("ul",{className:"list-disc pl-6",children:t.length?t.map(e=>(0,a.jsxs)("li",{children:["Dossier #",i(e.id)," — statut ",i(e.statut)," — cr\xe9\xe9 ",i(e.date_creation)," — ","partenaire ",(0,a.jsxs)(r,{className:"underline",href:"/crm/partenaires/".concat(e.partenaire_id),children:["#",i(e.partenaire_id)]})," — ","entreprise ",(0,a.jsxs)(r,{className:"underline",href:"/crm/entreprises/".concat(e.entreprise_id),children:["#",i(e.entreprise_id)]}),(e.blocages||[]).length?(0,a.jsxs)(a.Fragment,{children:[" — blocages: ",(e.blocages||[]).join(", ")]}):null,s&&e.id===s&&(0,a.jsx)("span",{className:"ml-2 text-xs bg-blue-100 text-blue-800 px-2 py-1 rounded",children:"\uD83D\uDCCC Affich\xe9 ci-dessus"})]},e.id)):(0,a.jsx)("li",{children:"—"})})]})]})}},7221:(e,t,s)=>{s.d(t,{A:()=>c});var a=s(5155),r=s(2115),i=s(2619);let n=e=>e?new Date(e).toLocaleDateString("fr-FR"):"—",l=e=>(null!=e?e:0===e)?String(e):"—";function c(e){let{partnerId:t,data:s}=e,[c,d]=(0,r.useState)([]),[o,u]=(0,r.useState)(!1),[x,m]=(0,r.useState)(null),[h,p]=(0,r.useState)(!1),[g,b]=(0,r.useState)({search:"",statut:"tous",dateDebut:"",dateFin:"",showBlocked:!1,commission:""}),[j,f]=(0,r.useState)("date_creation"),[N,y]=(0,r.useState)(!0),[v,D]=(0,r.useState)(1),[w]=(0,r.useState)(20);async function C(){try{u(!0);let e=new URLSearchParams({search:g.search,statut:g.statut,dateDebut:g.dateDebut,dateFin:g.dateFin,showBlocked:String(g.showBlocked),commission:g.commission,sortBy:j,sortDesc:String(N),limit:"1000"}),s=await fetch("/api/partenaires/".concat(t,"/clients?").concat(e),{cache:"no-store"});if(!s.ok)throw Error("HTTP ".concat(s.status));let a=await s.json();d(Array.isArray(a.clients)?a.clients:[])}catch(e){console.error(e),m("Impossible de charger les clients")}finally{u(!1)}}(0,r.useEffect)(()=>{m(null),Array.isArray(null==s?void 0:s.clients)?d(s.clients):t?C():d([])},[t,s]);let _=(0,r.useMemo)(()=>{let e=[...c];if(g.search.trim()){let t=g.search.toLowerCase();e=e.filter(e=>(e.fullName||"").toLowerCase().includes(t)||(e.email||"").toLowerCase().includes(t)||(e.entreprise_nom||"").toLowerCase().includes(t)||String(e.dossier_id||"").includes(t))}if("tous"!==g.statut&&(e=e.filter(e=>e.statut===g.statut)),g.showBlocked&&(e=e.filter(e=>(e.blocages||[]).length>0)),g.dateDebut&&(e=e.filter(e=>(e.date_creation||"")>=g.dateDebut)),g.dateFin&&(e=e.filter(e=>(e.date_creation||"")<="".concat(g.dateFin,"T23:59:59"))),g.commission){let t=parseFloat(g.commission);isNaN(t)||(e=e.filter(e=>(e.commission||0)>=t))}return e.sort((e,t)=>{let s=e||{},a=t||{},r={nom:[(s.fullName||"").toLowerCase(),(a.fullName||"").toLowerCase()],email:[(s.email||"").toLowerCase(),(a.email||"").toLowerCase()],statut:[s.statut||"",a.statut||""],commission:[Number(s.commission)||0,Number(a.commission)||0],date_creation:[new Date(s.date_creation||0),new Date(a.date_creation||0)]}[j]||[0,0];return r[0]<r[1]?N?1:-1:r[0]>r[1]?N?-1:1:0}),e},[c,g,j,N]);(0,r.useEffect)(()=>D(1),[g,j,N]);let k=_.length,S=Math.ceil(k/w)||1,A=(v-1)*w,F=_.slice(A,A+w),E=e=>{let{statut:t,blocages:s}=e,r=(s||[]).length>0,[i,n]={valide:["bg-green-100 text-green-800","✅"],rejete:["bg-red-100 text-red-800","❌"],en_cours:["bg-blue-100 text-blue-800","\uD83D\uDD04"],en_attente:["bg-orange-100 text-orange-800","⏳"],a_corriger:["bg-yellow-100 text-yellow-800","✏️"]}[t]||["bg-gray-100 text-gray-800","\uD83D\uDCCB"];return(0,a.jsxs)("div",{className:"flex items-center gap-1",children:[(0,a.jsxs)("span",{className:"inline-flex items-center px-2 py-1 text-xs font-medium rounded-full ".concat(i),children:[(0,a.jsx)("span",{className:"mr-1",children:n}),l(t)]}),r&&(0,a.jsx)("span",{className:"inline-flex items-center px-2 py-1 text-xs font-medium rounded-full bg-red-100 text-red-800",children:"\uD83D\uDEAB Bloqu\xe9"})]})};return o&&0===c.length?(0,a.jsxs)("section",{className:"bg-white border rounded-lg p-6",children:[(0,a.jsx)("h3",{className:"text-lg font-semibold mb-4",children:"\uD83D\uDC65 Suivi des clients"}),(0,a.jsx)("div",{className:"animate-pulse h-24 bg-gray-200 rounded"})]}):x?(0,a.jsxs)("section",{className:"bg-white border rounded-lg p-6",children:[(0,a.jsx)("h3",{className:"text-lg font-semibold mb-4",children:"\uD83D\uDC65 Suivi des clients"}),(0,a.jsxs)("div",{className:"bg-red-50 border border-red-200 rounded p-4",children:[(0,a.jsxs)("div",{className:"text-red-800",children:["❌ ",x]}),(0,a.jsx)("button",{onClick:C,className:"mt-2 text-sm bg-red-600 text-white px-3 py-1 rounded hover:bg-red-700",children:"\uD83D\uDD04 R\xe9essayer"})]})]}):(0,a.jsxs)("section",{className:"bg-white border rounded-lg",children:[(0,a.jsxs)("div",{className:"p-6 border-b flex items-center justify-between",children:[(0,a.jsxs)("h3",{className:"text-lg font-semibold",children:["\uD83D\uDC65 Suivi des clients (",k,")"]}),(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsx)("button",{onClick:()=>window.location.reload(),className:"text-xs bg-blue-100 hover:bg-blue-200 text-blue-700 px-3 py-2 rounded-md",children:"\uD83D\uDD04 Actualiser"}),(0,a.jsxs)("button",{onClick:function(){let e=new URLSearchParams;"tous"!==g.statut&&e.set("status",g.statut),t&&e.set("partnerId",String(t)),g.dateDebut&&e.set("from",g.dateDebut),g.dateFin&&e.set("to",g.dateFin),e.set("format","csv");let s="/api/exports/dossiers?".concat(e.toString()),a=document.createElement("a");a.href=s,a.download="dossiers_partenaire_".concat(t,"_").concat(new Date().toISOString().slice(0,10),".csv"),document.body.appendChild(a),a.click(),document.body.removeChild(a)},disabled:h||0===k,className:"flex items-center gap-2 bg-green-600 text-white px-4 py-2 rounded-md text-sm hover:bg-green-700 disabled:opacity-50",children:[h?"⏳":"\uD83D\uDCCA"," Exporter CSV"]})]})]}),(0,a.jsxs)("div",{className:"p-4 border-b",children:[(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-6 gap-3",children:[(0,a.jsx)("input",{type:"text",placeholder:"Rechercher (nom, email, entreprise, #dossier)",value:g.search,onChange:e=>b(t=>({...t,search:e.target.value})),className:"border rounded px-3 py-2 text-sm"}),(0,a.jsxs)("select",{value:g.statut,onChange:e=>b(t=>({...t,statut:e.target.value})),className:"border rounded px-3 py-2 text-sm",children:[(0,a.jsx)("option",{value:"tous",children:"Tous statuts"}),(0,a.jsx)("option",{value:"nouveau",children:"Nouveau"}),(0,a.jsx)("option",{value:"en_cours",children:"En cours"}),(0,a.jsx)("option",{value:"en_attente",children:"En attente"}),(0,a.jsx)("option",{value:"a_corriger",children:"\xc0 corriger"}),(0,a.jsx)("option",{value:"valide",children:"Valid\xe9"}),(0,a.jsx)("option",{value:"rejete",children:"Rejet\xe9"})]}),(0,a.jsx)("input",{type:"date",value:g.dateDebut,onChange:e=>b(t=>({...t,dateDebut:e.target.value})),className:"border rounded px-3 py-2 text-sm"}),(0,a.jsx)("input",{type:"date",value:g.dateFin,onChange:e=>b(t=>({...t,dateFin:e.target.value})),className:"border rounded px-3 py-2 text-sm"}),(0,a.jsx)("input",{type:"number",placeholder:"Commission min (€)",value:g.commission,onChange:e=>b(t=>({...t,commission:e.target.value})),className:"border rounded px-3 py-2 text-sm",min:"0",step:"10"}),(0,a.jsxs)("label",{className:"flex items-center gap-2 text-sm",children:[(0,a.jsx)("input",{type:"checkbox",checked:g.showBlocked,onChange:e=>b(t=>({...t,showBlocked:e.target.checked}))}),"Bloqu\xe9s uniquement"]})]}),(0,a.jsxs)("div",{className:"mt-3 flex items-center gap-2",children:[(0,a.jsx)("button",{onClick:C,className:"bg-blue-600 text-white px-3 py-2 rounded text-sm hover:bg-blue-700",children:"\uD83D\uDD0E Filtrer"}),(0,a.jsx)("button",{onClick:()=>{b({search:"",statut:"tous",dateDebut:"",dateFin:"",showBlocked:!1,commission:""}),f("date_creation"),y(!0),D(1),C()},className:"border px-3 py-2 rounded text-sm",children:"R\xe9initialiser"}),(0,a.jsxs)("select",{value:"".concat(j,"-").concat(N),onChange:e=>{let[t,s]=e.target.value.split("-");f(t),y("true"===s)},className:"ml-auto border rounded px-2 py-2 text-sm",children:[(0,a.jsx)("option",{value:"date_creation-true",children:"Plus r\xe9cents"}),(0,a.jsx)("option",{value:"date_creation-false",children:"Plus anciens"}),(0,a.jsx)("option",{value:"nom-false",children:"Nom A→Z"}),(0,a.jsx)("option",{value:"nom-true",children:"Nom Z→A"}),(0,a.jsx)("option",{value:"statut-false",children:"Statut"}),(0,a.jsx)("option",{value:"commission-true",children:"Commission ↓"})]})]})]}),(0,a.jsx)("div",{className:"overflow-x-auto",children:0===k?(0,a.jsx)("div",{className:"p-8 text-center text-gray-500",children:0===c.length?"Aucun client trouv\xe9":"Aucun r\xe9sultat avec ces filtres"}):(0,a.jsxs)("table",{className:"min-w-full",children:[(0,a.jsx)("thead",{className:"bg-gray-50 border-b",children:(0,a.jsxs)("tr",{children:[(0,a.jsx)("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Client"}),(0,a.jsx)("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Entreprise"}),(0,a.jsx)("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Statut"}),(0,a.jsx)("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Date"}),(0,a.jsx)("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Commission"}),(0,a.jsx)("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Actions"})]})}),(0,a.jsx)("tbody",{className:"bg-white divide-y divide-gray-200",children:F.map(e=>{let t;return(0,a.jsxs)("tr",{className:"hover:bg-gray-50",children:[(0,a.jsxs)("td",{className:"px-4 py-4",children:[(0,a.jsx)("div",{className:"font-medium text-gray-900",children:l(e.fullName)}),(0,a.jsxs)("div",{className:"text-sm text-gray-500",children:[l(e.email),e.telephone?" • ".concat(e.telephone):""]}),(0,a.jsxs)("div",{className:"text-xs text-gray-400",children:["Client #",l(e.id)]})]}),(0,a.jsxs)("td",{className:"px-4 py-4",children:[(0,a.jsx)("div",{className:"text-sm font-medium text-gray-900",children:l(e.entreprise_nom)}),(0,a.jsx)("div",{className:"text-xs text-gray-500",children:l(e.entreprise_forme)})]}),(0,a.jsxs)("td",{className:"px-4 py-4",children:[(0,a.jsx)(E,{statut:e.statut,blocages:e.blocages}),(e.blocages||[]).length>0&&(0,a.jsx)("div",{className:"text-xs text-red-600 mt-1",children:e.blocages.join(", ")})]}),(0,a.jsxs)("td",{className:"px-4 py-4 text-sm text-gray-900",children:[(0,a.jsxs)("div",{children:["Cr\xe9\xe9: ",n(e.date_creation)]}),e.date_creation_effective&&(0,a.jsxs)("div",{className:"text-xs text-green-600",children:["Effectif: ",n(e.date_creation_effective)]}),e.derniere_modification&&(0,a.jsxs)("div",{className:"text-xs text-gray-500",children:["MAJ: ",n(e.derniere_modification)]})]}),(0,a.jsxs)("td",{className:"px-4 py-4 text-sm text-gray-900",children:[(0,a.jsxs)("div",{className:"font-medium",children:[0===(t=e.commission)?"0":null!=t?Number(t).toLocaleString("fr-FR"):"—","€"]}),(0,a.jsxs)("div",{className:"text-xs text-gray-500",children:["Dossier #",l(e.dossier_id)]})]}),(0,a.jsx)("td",{className:"px-4 py-4",children:(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsx)(i,{href:"/crm/clients/".concat(e.id),className:"bg-blue-600 text-white px-3 py-1 rounded text-xs hover:bg-blue-700",children:"\uD83D\uDC64 Client"}),(0,a.jsx)(i,{href:"/crm/clients/".concat(e.id,"?dossier=").concat(e.dossier_id,"#timeline"),className:"bg-gray-600 text-white px-3 py-1 rounded text-xs hover:bg-gray-700",children:"\uD83D\uDCC1 Dossier LINK"})]})})]},"".concat(e.id,"-").concat(e.dossier_id))})})]})}),S>1&&(0,a.jsxs)("div",{className:"px-6 py-4 border-t flex items-center justify-between",children:[(0,a.jsxs)("div",{className:"text-sm text-gray-700",children:["Affichage de ",A+1," \xe0 ",Math.min(A+w,k)," sur ",k," r\xe9sultats"]}),(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsx)("button",{onClick:()=>D(e=>Math.max(1,e-1)),disabled:1===v,className:"px-3 py-1 border rounded text-sm disabled:opacity-50",children:"← Pr\xe9c\xe9dent"}),(0,a.jsx)("span",{className:"px-3 py-1 bg-blue-100 text-blue-700 rounded text-sm",children:v}),(0,a.jsx)("button",{onClick:()=>D(e=>Math.min(S,e+1)),disabled:v===S,className:"px-3 py-1 border rounded text-sm disabled:opacity-50",children:"Suivant →"})]})]})]})}}}]);