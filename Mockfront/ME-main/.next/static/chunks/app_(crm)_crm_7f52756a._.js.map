{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 7, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/giorn/Desktop/Projet/Medina/Micro_entreprise/Mockfront/ME-main/app/%28crm%29/crm/clients/%5Bid%5D/DossierTimeline.js"],"sourcesContent":["\"use client\";\r\nimport { useState, useEffect, useMemo, useCallback } from \"react\";\r\n\r\n/* ---------- Utils globaux (hors composant) ---------- */\r\nconst fmt = (d) => (d ? new Date(d).toLocaleDateString(\"fr-FR\") : null);\r\nconst fmtDateTime = (d) => (d ? new Date(d).toLocaleString(\"fr-FR\") : null);\r\n\r\nconst STEP_ORDER = [\r\n  \"formulaire\",\r\n  \"pieces\",\r\n  \"mandat\",\r\n  \"transmission\",\r\n  \"traitement\",\r\n  \"siren\",\r\n  \"attestation\",\r\n];\r\n\r\nfunction computeProgress(steps) {\r\n  const total = steps.length;\r\n  const completed = steps.filter((s) => s.status === \"completed\").length;\r\n  const raw = total ? (completed / total) * 100 : 0;\r\n  return { completed, total, raw, percent: Math.round(raw) };\r\n}\r\n\r\n/* ---------- Composant ---------- */\r\nexport default function DossierTimeline({ dossier }) {\r\n  const [timelineData, setTimelineData] = useState(null);\r\n  const [loading, setLoading] = useState(true);\r\n  const [error, setError] = useState(null);\r\n\r\n  const [piecesData, setPiecesData] = useState(null); // { pieces_expected, pieces_state, summary, capabilities }\r\n  const [loadingPieces, setLoadingPieces] = useState(true);\r\n  const [uploadingStep, setUploadingStep] = useState(null);\r\n\r\n  /* ---------- Fetch ---------- */\r\n  useEffect(() => {\r\n    if (!dossier?.id) return;\r\n    loadTimelineData();\r\n    loadPiecesData();\r\n    // eslint-disable-next-line react-hooks/exhaustive-deps\r\n  }, [dossier?.id]);\r\n\r\n  const loadTimelineData = useCallback(async () => {\r\n    setLoading(true);\r\n    setError(null);\r\n    try {\r\n      const res = await fetch(`/api/dossiers/${dossier.id}/timeline`, { cache: \"no-store\" });\r\n      if (!res.ok) throw new Error(`HTTP ${res.status}`);\r\n      const data = await res.json();\r\n      setTimelineData(data);\r\n    } catch (e) {\r\n      console.error(\"Erreur chargement timeline:\", e);\r\n      setError(\"Impossible de charger les dÃ©tails du suivi\");\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  }, [dossier?.id]);\r\n\r\n  const loadPiecesData = useCallback(async () => {\r\n    setLoadingPieces(true);\r\n    try {\r\n      const res = await fetch(`/api/dossiers/${dossier.id}/pieces`, { cache: \"no-store\" });\r\n      if (!res.ok) throw new Error(`HTTP ${res.status}`);\r\n      const data = await res.json();\r\n      setPiecesData(data);\r\n    } catch (e) {\r\n      console.error(\"Erreur chargement piÃ¨ces:\", e);\r\n    } finally {\r\n      setLoadingPieces(false);\r\n    }\r\n  }, [dossier?.id]);\r\n\r\n  /* ---------- Helpers piÃ¨ces / mandat (binaire) ---------- */\r\n  const getPieceState = useCallback(\r\n    (key) => piecesData?.pieces_state?.find((p) => p.piece_key === key),\r\n    [piecesData]\r\n  );\r\n  const getPieceExpected = useCallback(\r\n    (key) => piecesData?.pieces_expected?.find((p) => p.piece_key === key),\r\n    [piecesData]\r\n  );\r\n\r\n  const piecesStatus = useMemo(() => {\r\n    if (!piecesData) return \"pending\";\r\n    const required = new Set(\r\n      (piecesData.pieces_expected || [])\r\n        .filter((p) => p.piece_key !== \"MandatSigne\" && p.required !== false)\r\n        .map((p) => p.piece_key)\r\n    );\r\n    const states = (piecesData.pieces_state || []).filter((p) => p.piece_key !== \"MandatSigne\");\r\n    if (states.length === 0) return \"pending\";\r\n    const allRequiredUploaded = [...required].every((key) => {\r\n      const piece = states.find((p) => p.piece_key === key);\r\n      return piece && (piece.status === \"valide\" || piece.status === \"en_attente\");\r\n    });\r\n    return allRequiredUploaded ? \"completed\" : \"pending\";\r\n  }, [piecesData]);\r\n\r\n  const mandatStatus = useMemo(() => {\r\n    const mandat = getPieceState(\"MandatSigne\");\r\n    if (!mandat) return \"pending\";\r\n    return mandat.status === \"valide\" || mandat.status === \"en_attente\" ? \"completed\" : \"pending\";\r\n  }, [getPieceState]);\r\n\r\n  /* ---------- Actions ---------- */\r\n  const handleUploadPiece = useCallback(\r\n    async (pieceKey) => {\r\n      if (!dossier?.id || uploadingStep || piecesData?.capabilities?.canUpload === false) return;\r\n      try {\r\n        const input = document.createElement(\"input\");\r\n        input.type = \"file\";\r\n        const exp = getPieceExpected(pieceKey);\r\n        const acc = Array.isArray(exp?.accept_ext) ? exp.accept_ext : [\".pdf\", \".jpg\", \".jpeg\", \".png\"];\r\n        input.accept = acc.join(\",\");\r\n        input.style.display = \"none\";\r\n        document.body.appendChild(input);\r\n\r\n        input.onchange = async (e) => {\r\n          const file = e.target.files?.[0];\r\n          if (!file) return document.body.removeChild(input);\r\n          if (file.size > 10 * 1024 * 1024) {\r\n            alert(\"âŒ Fichier trop volumineux (max 10MB)\");\r\n            return document.body.removeChild(input);\r\n          }\r\n          try {\r\n            setUploadingStep(pieceKey);\r\n            const form = new FormData();\r\n            form.append(\"file\", file);\r\n            const res = await fetch(\r\n              `/api/dossiers/${dossier.id}/pieces/${encodeURIComponent(pieceKey)}/upload`,\r\n              { method: \"POST\", body: form }\r\n            );\r\n            if (!res.ok) {\r\n              const body = await res.json().catch(() => ({}));\r\n              const code = body?.error_code ? ` [${body.error_code}]` : \"\";\r\n              throw new Error((body?.error || `HTTP ${res.status}`) + code);\r\n            }\r\n            await loadPiecesData();\r\n            alert(\"âœ… Fichier uploadÃ© avec succÃ¨s !\");\r\n          } catch (err) {\r\n            alert(`âŒ Upload Ã©chouÃ©: ${err.message}`);\r\n          } finally {\r\n            setUploadingStep(null);\r\n            input.value = \"\";\r\n            if (document.body.contains(input)) document.body.removeChild(input);\r\n          }\r\n        };\r\n\r\n        input.click();\r\n      } catch (error) {\r\n        setUploadingStep(null);\r\n        alert(`âŒ Erreur: ${error.message}`);\r\n      }\r\n    },\r\n    [dossier?.id, uploadingStep, piecesData?.capabilities?.canUpload, getPieceExpected, loadPiecesData]\r\n  );\r\n\r\n  const handleDownload = useCallback(\r\n    async (documentType) => {\r\n      try {\r\n        const response = await fetch(`/api/dossiers/${dossier.id}/documents/${documentType}/download`);\r\n        if (!response.ok) throw new Error(\"Document non disponible\");\r\n        const blob = await response.blob();\r\n        const url = window.URL.createObjectURL(blob);\r\n        const a = document.createElement(\"a\");\r\n        a.href = url;\r\n        a.download = `${documentType}_${dossier.id}.pdf`;\r\n        document.body.appendChild(a);\r\n        a.click();\r\n        window.URL.revokeObjectURL(url);\r\n        document.body.removeChild(a);\r\n      } catch (error) {\r\n        console.error(\"Erreur tÃ©lÃ©chargement:\", error);\r\n        alert(\"âŒ Impossible de tÃ©lÃ©charger le document\");\r\n      }\r\n    },\r\n    [dossier?.id]\r\n  );\r\n\r\n  const handleCompleteForm = useCallback(async () => {\r\n    if (!dossier?.id) return;\r\n    try {\r\n      const res = await fetch(`/api/dossiers/${dossier.id}/etapes/formulaire/completer`, { method: \"POST\" });\r\n      if (!res.ok) {\r\n        const body = await res.json().catch(() => ({}));\r\n        throw new Error(body?.error || `HTTP ${res.status}`);\r\n      }\r\n      await loadTimelineData();\r\n    } catch (e) {\r\n      alert(`âŒ ${e.message || \"Erreur\"}`);\r\n    }\r\n  }, [dossier?.id, loadTimelineData]);\r\n\r\n  /* ---------- Ã‰tapes standardisÃ©es (lecture API + Ã©tat piÃ¨ces/mandat) ---------- */\r\n  const steps = useMemo(() => {\r\n    if (!timelineData) return [];\r\n    const { timeline_steps, documents_officiels } = timelineData;\r\n\r\n    // Formulaire\r\n    const formEntry = timeline_steps?.find((s) => s.id === \"formulaire\");\r\n    const formDone = formEntry?.done ?? Boolean(dossier?.date_creation);\r\n    const formDate = formEntry?.date || dossier?.date_creation || null;\r\n    const formDesc = formDone ? \"Vos informations ont Ã©tÃ© enregistrÃ©es\" : \"Informations Ã  complÃ©ter\";\r\n\r\n    // PiÃ¨ces\r\n    const regularPieces = (piecesData?.pieces_state || []).filter((p) => p.piece_key !== \"MandatSigne\");\r\n    const uploadedPieces = regularPieces.filter(\r\n      (p) => p.status === \"valide\" || p.status === \"en_attente\"\r\n    );\r\n    const lastPieceUploadDate = uploadedPieces\r\n      .map((p) => p.uploaded_at)\r\n      .filter(Boolean)\r\n      .map((d) => new Date(d).getTime())\r\n      .sort((a, b) => b - a)[0];\r\n    const lastPieceUpload = lastPieceUploadDate ? new Date(lastPieceUploadDate) : null;\r\n\r\n    // Mandat\r\n    const mandat = getPieceState(\"MandatSigne\");\r\n\r\n    // Transmission & Traitement : on fait confiance Ã  lâ€™API\r\n    const tx = (timeline_steps || []).find((s) => s.id === \"transmission\");\r\n    const transmissionStatus = tx?.status || \"pending\";\r\n    const transmissionDate = tx?.date || null;\r\n\r\n    const proc = (timeline_steps || []).find((s) => s.id === \"processing\");\r\n    const traitementStatus = proc?.status || \"pending\";\r\n    const traitementDate = proc?.date || null;\r\n\r\n    return [\r\n      {\r\n        id: \"formulaire\",\r\n        title: \"Formulaire rempli\",\r\n        description: formDesc,\r\n        status: formDone ? \"completed\" : \"pending\",\r\n        icon: \"ğŸ“\",\r\n        date: formDate,\r\n      },\r\n      {\r\n        id: \"pieces\",\r\n        title: \"PiÃ¨ces requises\",\r\n        description: loadingPieces\r\n          ? \"Chargement des piÃ¨cesâ€¦\"\r\n          : piecesStatus === \"completed\"\r\n          ? \"Toutes les piÃ¨ces requises sont envoyÃ©es\"\r\n          : `${uploadedPieces.length} / ${regularPieces.length} piÃ¨ces uploadÃ©es`,\r\n        status: piecesStatus,\r\n        icon: \"ğŸ“„\",\r\n        date: piecesStatus === \"completed\" ? lastPieceUpload : null,\r\n      },\r\n      {\r\n        id: \"mandat\",\r\n        title: \"Mandat signÃ©\",\r\n        description:\r\n          mandatStatus === \"completed\"\r\n            ? `Mandat uploadÃ©${mandat?.uploaded_at ? \" le \" + fmtDateTime(mandat.uploaded_at) : \"\"}`\r\n            : \"Mandat Ã  signer\",\r\n        status: mandatStatus,\r\n        icon: \"âœï¸\",\r\n        date: mandat?.uploaded_at || null,\r\n      },\r\n      {\r\n        id: \"transmission\",\r\n        title: \"Dossier transmis\",\r\n        description:\r\n          transmissionStatus === \"completed\"\r\n            ? \"Dossier transmis aux administrations\"\r\n            : \"En attente de transmission\",\r\n        status: transmissionStatus,\r\n        icon: \"ğŸ“¤\",\r\n        date: transmissionDate,\r\n      },\r\n      {\r\n        id: \"traitement\",\r\n        title: \"Dossier en cours de traitement\",\r\n        description: \"VÃ©rification par les administrations\",\r\n        status: traitementStatus, // on prend le statut API\r\n        icon: \"ğŸ›ï¸\",\r\n        date: traitementDate,\r\n      },\r\n      {\r\n        id: \"siren\",\r\n        title: \"SIREN attribuÃ©\",\r\n        description: \"NumÃ©ro d'identification reÃ§u\",\r\n        status: documents_officiels?.some(\r\n          (d) =>\r\n            d.type === \"Avis de situation SIRENE\" ||\r\n            d.type?.toUpperCase()?.includes(\"SIRENE\") ||\r\n            d.type?.toUpperCase()?.includes(\"SIREN\")\r\n        )\r\n          ? \"completed\"\r\n          : \"pending\",\r\n        icon: \"ğŸ†”\",\r\n        date:\r\n          documents_officiels?.find(\r\n            (d) =>\r\n              d.type === \"Avis de situation SIRENE\" ||\r\n              d.type?.toUpperCase()?.includes(\"SIRENE\") ||\r\n              d.type?.toUpperCase()?.includes(\"SIREN\")\r\n          )?.date || null,\r\n      },\r\n      {\r\n        id: \"attestation\",\r\n        title: \"Attestation Ã  tÃ©lÃ©charger\",\r\n        description: \"Tous vos documents sont prÃªts\",\r\n        status:\r\n          documents_officiels?.some((d) => d.type === \"Attestation URSSAF\" || d.type?.includes(\"Attestation\")) &&\r\n          dossier?.statut === \"valide\"\r\n            ? \"completed\"\r\n            : documents_officiels?.some((d) => d.type === \"Attestation URSSAF\" || d.type?.includes(\"Attestation\"))\r\n            ? \"active\"\r\n            : \"pending\",\r\n        icon: \"ğŸ‰\",\r\n        date:\r\n          documents_officiels?.find(\r\n            (d) => d.type === \"Attestation URSSAF\" || d.type?.includes(\"Attestation\")\r\n          )?.date || null,\r\n      },\r\n    ];\r\n  }, [timelineData, dossier?.date_creation, dossier?.statut, piecesData, loadingPieces, getPieceState, mandatStatus, piecesStatus]);\r\n\r\n  /* ---------- Ordre + progression ---------- */\r\n  const orderedSteps = useMemo(() => {\r\n    return [...steps].sort((a, b) => STEP_ORDER.indexOf(a.id) - STEP_ORDER.indexOf(b.id));\r\n  }, [steps]);\r\n\r\n  const { completed, total, raw, percent } = useMemo(\r\n    () => computeProgress(orderedSteps),\r\n    [orderedSteps]\r\n  );\r\n  const progressPercent = Math.round(raw);\r\n\r\n  /* ---------- Rendu ---------- */\r\n  if (!dossier) {\r\n    return (\r\n      <section className=\"border rounded p-4\">\r\n        <h3 className=\"text-lg font-semibold mb-3\">ğŸ“ Suivi de votre dossier</h3>\r\n        <p className=\"text-gray-600\">Aucun dossier sÃ©lectionnÃ©</p>\r\n      </section>\r\n    );\r\n  }\r\n\r\n  if (loading) {\r\n    return (\r\n      <section className=\"border rounded p-4\">\r\n        <h3 className=\"text-lg font-semibold mb-3\">ğŸ“ Suivi de votre micro-entreprise</h3>\r\n        <div className=\"flex items-center justify-center py-8\">\r\n          <div className=\"text-sm text-gray-600\">ğŸ”„ Chargement du suivi...</div>\r\n        </div>\r\n      </section>\r\n    );\r\n  }\r\n\r\n  if (error) {\r\n    return (\r\n      <section className=\"border rounded p-4\">\r\n        <h3 className=\"text-lg font-semibold mb-3\">ğŸ“ Suivi de votre micro-entreprise</h3>\r\n        <div className=\"bg-red-50 border border-red-200 rounded p-4\">\r\n          <div className=\"text-red-800\">âŒ {error}</div>\r\n          <button\r\n            onClick={loadTimelineData}\r\n            className=\"mt-2 text-sm bg-red-600 text-white px-3 py-1 rounded hover:bg-red-700\"\r\n          >\r\n            ğŸ”„ RÃ©essayer\r\n          </button>\r\n        </div>\r\n      </section>\r\n    );\r\n  }\r\n\r\n  const getStepStyle = (status) => {\r\n    const base = \"flex items-center justify-center w-10 h-10 rounded-full text-sm font-medium\";\r\n    if (status === \"completed\") return `${base} bg-green-500 text-white`;\r\n    if (status === \"active\") return `${base} bg-blue-500 text-white animate-pulse`;\r\n    if (status === \"warning\") return `${base} bg-orange-500 text-white`;\r\n    if (status === \"error\") return `${base} bg-red-500 text-white`;\r\n    return `${base} bg-gray-300 text-gray-600`;\r\n  };\r\n\r\n  const getConnectorStyle = (status) => {\r\n    if (status === \"completed\" || status === \"active\") return \"bg-green-300\";\r\n    if (status === \"warning\") return \"bg-orange-300\";\r\n    if (status === \"error\") return \"bg-red-300\";\r\n    return \"bg-gray-200\";\r\n  };\r\n\r\n  return (\r\n    <section className=\"border rounded p-4\">\r\n      <div className=\"flex items-center justify-between mb-4\">\r\n        <h3 className=\"text-lg font-semibold\">ğŸ“ Suivi de votre micro-entreprise</h3>\r\n\r\n        {/* DEBUG progression â€” Ã  retirer en prod */}\r\n        <div className=\"mb-3 text-xs p-2 rounded border bg-gray-50 text-gray-700\">\r\n          <div>\r\n            <b>Calcul progression</b>\r\n          </div>\r\n          <div>\r\n            completed: {completed} / total: {total} â†’ raw: {raw.toFixed(2)}% â†’ affichÃ©: {progressPercent}%\r\n          </div>\r\n          <div className=\"mt-1\">\r\n            {orderedSteps.map((s) => (\r\n              <span key={s.id} className=\"inline-block mr-2 mt-1 px-2 py-0.5 rounded border\">\r\n                {s.id}: <b>{s.status}</b>\r\n              </span>\r\n            ))}\r\n          </div>\r\n        </div>\r\n\r\n        <div className=\"text-sm text-right\">\r\n          <span className=\"font-medium\">{progressPercent}% terminÃ©</span>\r\n          <div className=\"w-32 bg-gray-200 rounded-full h-2 mt-1\" aria-hidden=\"true\">\r\n            <div\r\n              className=\"bg-blue-600 h-2 rounded-full transition-all duration-300\"\r\n              style={{ width: `${progressPercent}%` }}\r\n            />\r\n          </div>\r\n          {timelineData?.metrics?.estimated_completion && (\r\n            <div className=\"text-xs text-gray-600 mt-1\">\r\n              Finalisation estimÃ©e: {fmt(timelineData.metrics.estimated_completion)}\r\n            </div>\r\n          )}\r\n        </div>\r\n      </div>\r\n\r\n      {dossier?.blocages?.length > 0 && (\r\n        <div className=\"mb-4 p-3 rounded border bg-orange-50 text-orange-800\">\r\n          <span className=\"mr-2\">âš ï¸</span>\r\n          <strong>Action requise :</strong> {dossier.blocages.join(\", \")}\r\n        </div>\r\n      )}\r\n\r\n      <div className=\"mb-6 p-4 bg-blue-50 rounded-lg\">\r\n        <div className=\"flex items-center gap-3\">\r\n          <span className=\"text-2xl\">\r\n            {dossier.statut === \"valide\" ? \"ğŸ‰\" : dossier.statut === \"rejete\" ? \"âŒ\" : dossier.blocages?.length > 0 ? \"âš ï¸\" : \"ğŸ”„\"}\r\n          </span>\r\n          <div className=\"flex-1\">\r\n            <div className=\"font-semibold text-lg\">\r\n              {dossier.statut === \"valide\"\r\n                ? \"FÃ©licitations ! Votre micro-entreprise est crÃ©Ã©e !\"\r\n                : dossier.statut === \"rejete\"\r\n                ? \"Dossier rejetÃ© - Contactez votre conseiller\"\r\n                : dossier.blocages?.length > 0\r\n                ? \"Action requise de votre part\"\r\n                : \"Votre dossier est en cours de traitement\"}\r\n            </div>\r\n            <div className=\"text-sm text-gray-600 mt-1\">\r\n              Statut: <strong>{dossier.statut}</strong> â€¢ Dossier #{dossier.id}\r\n            </div>\r\n          </div>\r\n          <button\r\n            onClick={() => {\r\n              loadTimelineData();\r\n              loadPiecesData();\r\n            }}\r\n            className=\"text-xs bg-blue-600 text-white px-2 py-1 rounded hover:bg-blue-700\"\r\n            disabled={loading || loadingPieces}\r\n            aria-label=\"Actualiser le suivi\"\r\n            aria-busy={loading || loadingPieces}\r\n          >\r\n            ğŸ”„ Actualiser\r\n          </button>\r\n        </div>\r\n      </div>\r\n\r\n      {/* Timeline des Ã©tapes */}\r\n      <div className=\"space-y-6\">\r\n        {orderedSteps.map((step, index) => (\r\n          <div key={step.id} className=\"flex gap-4\">\r\n            <div className=\"flex flex-col items-center\">\r\n              <div className={getStepStyle(step.status)}>{step.icon}</div>\r\n              {index < orderedSteps.length - 1 && (\r\n                <div className={`w-1 h-12 mt-2 ${getConnectorStyle(step.status)}`} />\r\n              )}\r\n            </div>\r\n\r\n            <div className=\"flex-1 pb-3\">\r\n              <div className=\"flex items-center justify-between mb-1\">\r\n                <h4 className=\"font-semibold text-lg\">{step.title}</h4>\r\n                {step.date && (\r\n                  <span className=\"text-sm text-gray-500 bg-gray-100 px-2 py-1 rounded\" title={new Date(step.date).toISOString()}>\r\n                    {fmt(step.date)}\r\n                  </span>\r\n                )}\r\n              </div>\r\n\r\n              <p className=\"text-gray-600 mb-2\">{step.description}</p>\r\n\r\n              {step.id === \"formulaire\" && step.status !== \"completed\" && (\r\n                <button\r\n                  onClick={handleCompleteForm}\r\n                  className=\"px-3 py-1.5 rounded text-xs font-medium border bg-blue-600 text-white hover:bg-blue-700\"\r\n                >\r\n                  âœ… Marquer le formulaire comme fait\r\n                </button>\r\n              )}\r\n\r\n              {step.id === \"pieces\" && !loadingPieces && (\r\n                <>\r\n                  <div className=\"flex flex-wrap gap-2\">\r\n                    {(piecesData?.pieces_state || [])\r\n                      .filter((p) => p.piece_key !== \"MandatSigne\")\r\n                      .map((p) => {\r\n                        const isUploaded = p.status === \"valide\" || p.status === \"en_attente\";\r\n                        const canUpload = piecesData?.capabilities?.canUpload !== false;\r\n                        const disabled = uploadingStep === p.piece_key || p.status === \"valide\" || !canUpload;\r\n\r\n                        const exp = getPieceExpected(p.piece_key);\r\n                        const ext = Array.isArray(exp?.accept_ext) ? exp.accept_ext.join(\", \") : \"pdf, jpg, png\";\r\n                        const title =\r\n                          (p.status === \"valide\"\r\n                            ? \"ValidÃ©e\"\r\n                            : p.status === \"en_attente\"\r\n                            ? \"En revue\"\r\n                            : p.status === \"refusee\"\r\n                            ? `RefusÃ©e${p.reason ? \" â€” \" + p.reason : \"\"}`\r\n                            : \"Ã€ fournir\") + ` â€¢ Formats: ${ext}`;\r\n\r\n                        return (\r\n                          <button\r\n                            key={p.piece_key}\r\n                            onClick={() => handleUploadPiece(p.piece_key)}\r\n                            disabled={disabled}\r\n                            title={title}\r\n                            className={`px-3 py-1.5 rounded text-xs font-medium border transition disabled:opacity-50 ${\r\n                              isUploaded\r\n                                ? \"bg-green-50 text-green-800 border-green-200 hover:bg-green-100\"\r\n                                : \"bg-red-50 text-red-800 border-red-200 hover:bg-red-100\"\r\n                            }`}\r\n                          >\r\n                            {uploadingStep === p.piece_key ? \"ğŸ“¤ Envoiâ€¦\" : p.piece_label || p.piece_key}\r\n                          </button>\r\n                        );\r\n                      })}\r\n                  </div>\r\n                  <div className=\"mt-1 text-[11px] text-gray-500\">ğŸŸ¢ UploadÃ© / en revue â€¢ ğŸ”´ Ã€ uploader</div>\r\n                </>\r\n              )}\r\n\r\n              {step.id === \"mandat\" && (\r\n                <div className=\"flex items-center gap-2\">\r\n                  {(() => {\r\n                    const m = getPieceState(\"MandatSigne\");\r\n                    const status = m?.status || \"missing\";\r\n                    const isUploaded = status === \"valide\" || status === \"en_attente\";\r\n                    const canUpload = piecesData?.capabilities?.canUpload !== false;\r\n                    const disabled = uploadingStep === \"MandatSigne\" || status === \"valide\" || !canUpload;\r\n\r\n                    const exp = getPieceExpected(\"MandatSigne\");\r\n                    const ext = Array.isArray(exp?.accept_ext) ? exp.accept_ext.join(\", \") : \"pdf, jpg, png\";\r\n                    const title =\r\n                      (status === \"valide\"\r\n                        ? \"Mandat validÃ©\"\r\n                        : status === \"en_attente\"\r\n                        ? \"En revue\"\r\n                        : status === \"refusee\"\r\n                        ? `RefusÃ©${m?.reason ? \" â€” \" + m.reason : \"\"}`\r\n                        : \"Ã€ fournir\") + ` â€¢ Formats: ${ext}`;\r\n\r\n                    return (\r\n                      <button\r\n                        onClick={() => handleUploadPiece(\"MandatSigne\")}\r\n                        disabled={disabled}\r\n                        title={title}\r\n                        className={`px-3 py-1.5 rounded text-xs font-medium border transition disabled:opacity-50 ${\r\n                          isUploaded\r\n                            ? \"bg-green-50 text-green-800 border-green-200 hover:bg-green-100\"\r\n                            : \"bg-red-50 text-red-800 border-red-200 hover:bg-red-100\"\r\n                        }`}\r\n                      >\r\n                        {uploadingStep === \"MandatSigne\" ? \"ğŸ“¤ Envoiâ€¦\" : isUploaded ? \"Mandat âœ…\" : \"Uploader le mandat\"}\r\n                      </button>\r\n                    );\r\n                  })()}\r\n                </div>\r\n              )}\r\n\r\n              {step.id === \"siren\" && step.status === \"completed\" && (\r\n                <div className=\"mt-2\">\r\n                  <button\r\n                    onClick={() => handleDownload(\"sirene\")}\r\n                    className=\"px-3 py-1.5 rounded text-xs font-semibold bg-green-600 text-white hover:bg-green-700\"\r\n                  >\r\n                    ğŸ“¥ TÃ©lÃ©charger l'avis SIRENE\r\n                  </button>\r\n                </div>\r\n              )}\r\n\r\n              {step.id === \"attestation\" && step.status === \"completed\" && (\r\n                <div className=\"mt-2\">\r\n                  <button\r\n                    onClick={() => handleDownload(\"attestation\")}\r\n                    className=\"px-3 py-1.5 rounded text-xs font-semibold bg-green-600 text-white hover:bg-green-700\"\r\n                  >\r\n                    ğŸ“¥ TÃ©lÃ©charger l'attestation\r\n                  </button>\r\n                </div>\r\n              )}\r\n            </div>\r\n          </div>\r\n        ))}\r\n      </div>\r\n\r\n      {/* MÃ©triques */}\r\n      <div className=\"mt-4 pt-3 border-t bg-gray-50 -m-4 p-4 rounded-b\">\r\n        <div className=\"grid md:grid-cols-4 gap-4 text-sm\">\r\n          <div>\r\n            <span className=\"font-medium\">CrÃ©Ã© le:</span>\r\n            <br />\r\n            {fmt(dossier.date_creation)}\r\n          </div>\r\n          <div>\r\n            <span className=\"font-medium\">DerniÃ¨re MAJ:</span>\r\n            <br />\r\n            {fmt(dossier.derniere_modification)}\r\n          </div>\r\n          <div>\r\n            <span className=\"font-medium\">Documents gÃ©nÃ©rÃ©s:</span>\r\n            <br />\r\n            {timelineData?.metrics?.documents_officiels_count || 0}\r\n          </div>\r\n          <div>\r\n            <span className=\"font-medium\">RÃ©fÃ©rence:</span>\r\n            <br />#{dossier.id}\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </section>\r\n  );\r\n}\r\n"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 1089, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/giorn/Desktop/Projet/Medina/Micro_entreprise/Mockfront/ME-main/app/%28crm%29/crm/clients/%5Bid%5D/ClientIdentityCard.js"],"sourcesContent":["\"use client\";\r\nconst fmt = (d) => (d ? new Date(d).toLocaleDateString(\"fr-FR\") : \"â€”\");\r\nconst show = (v) => (v ?? v === 0 ? String(v) : \"â€”\");\r\n\r\nexport default function ClientIdentityCard({ client }) {\r\n  if (!client) return null;\r\n\r\n  const adr = client.adresse_personnelle ?? {};\r\n  const adrfis = client.adresse_fiscale ?? {};\r\n\r\n  return (\r\n    <section>\r\n      <h3 className=\"text-lg font-semibold mb-3\">ğŸ†” IdentitÃ© & adresses</h3>\r\n      <div className=\"bg-white border rounded p-4\">\r\n        <ul className=\"list-disc pl-6\">\r\n          <li>\r\n            Naissance: {fmt(client.date_naissance)} â€” {show(client.commune_naissance)}, {show(client.pays_naissance)} â€” {show(client.nationalite)}\r\n          </li>\r\n          <li>\r\n            Adresse perso: {show(adr.ligne1)}, {show(adr.code_postal)} {show(adr.ville)}\r\n          </li>\r\n          <li>\r\n            Adresse fiscale{adrfis.est_differente ? \"\" : \" (identique)\"}: {show(adrfis.ligne1)}, {show(adrfis.code_postal)} {show(adrfis.ville)}\r\n          </li>\r\n          <li>NIR: {show(client.numero_securite_sociale)}</li>\r\n        </ul>\r\n      </div>\r\n    </section>\r\n  );\r\n}\r\n"],"names":[],"mappings":";;;;AAAA;;AACA,MAAM,MAAM,CAAC,IAAO,IAAI,IAAI,KAAK,GAAG,kBAAkB,CAAC,WAAW;AAClE,MAAM,OAAO,CAAC,IAAO,CAAA,cAAA,eAAA,IAAK,MAAM,CAAA,IAAI,OAAO,KAAK;AAEjC,SAAS,mBAAmB,KAAU;QAAV,EAAE,MAAM,EAAE,GAAV;IACzC,IAAI,CAAC,QAAQ,OAAO;QAER;IAAZ,MAAM,MAAM,CAAA,8BAAA,OAAO,mBAAmB,cAA1B,yCAAA,8BAA8B,CAAC;QAC5B;IAAf,MAAM,SAAS,CAAA,0BAAA,OAAO,eAAe,cAAtB,qCAAA,0BAA0B,CAAC;IAE1C,qBACE,6LAAC;;0BACC,6LAAC;gBAAG,WAAU;0BAA6B;;;;;;0BAC3C,6LAAC;gBAAI,WAAU;0BACb,cAAA,6LAAC;oBAAG,WAAU;;sCACZ,6LAAC;;gCAAG;gCACU,IAAI,OAAO,cAAc;gCAAE;gCAAI,KAAK,OAAO,iBAAiB;gCAAE;gCAAG,KAAK,OAAO,cAAc;gCAAE;gCAAI,KAAK,OAAO,WAAW;;;;;;;sCAEtI,6LAAC;;gCAAG;gCACc,KAAK,IAAI,MAAM;gCAAE;gCAAG,KAAK,IAAI,WAAW;gCAAE;gCAAE,KAAK,IAAI,KAAK;;;;;;;sCAE5E,6LAAC;;gCAAG;gCACc,OAAO,cAAc,GAAG,KAAK;gCAAe;gCAAG,KAAK,OAAO,MAAM;gCAAE;gCAAG,KAAK,OAAO,WAAW;gCAAE;gCAAE,KAAK,OAAO,KAAK;;;;;;;sCAEpI,6LAAC;;gCAAG;gCAAM,KAAK,OAAO,uBAAuB;;;;;;;;;;;;;;;;;;;;;;;;AAKvD;KAzBwB","debugId":null}},
    {"offset": {"line": 1205, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/giorn/Desktop/Projet/Medina/Micro_entreprise/Mockfront/ME-main/app/%28crm%29/crm/clients/%5Bid%5D/PiecesJustificativesCard.js"],"sourcesContent":["\"use client\";\r\nconst fmt = (d) => (d ? new Date(d).toISOString().slice(0,10) : \"â€”\");\r\nconst show = (v) => (v ?? v === 0 ? String(v) : \"â€”\");\r\n\r\n/**\r\n * props:\r\n * - pieces: [{type, fichier, statut, motif_refus, uploaded_at}]\r\n * - downloads: [{type, fichier}]\r\n * - requiredTypes?: [\"Passeport\",\"PhotoIdentite\",\"RIB\",\"CNI\"] (optionnel)\r\n */\r\nexport default function PiecesJustificativesCard({ pieces = [], downloads = [], requiredTypes = [] }) {\r\n  // Comptes dÃ©rivÃ©s de la BDD (pas de valeurs par dÃ©faut)\r\n  const total = pieces.length;\r\n  const valides = pieces.filter(p => p.statut === \"valide\").length;\r\n\r\n  const missing = requiredTypes.length\r\n    ? requiredTypes.filter(t => !pieces.some(p => p.type === t))\r\n    : [];\r\n\r\n  return (\r\n    <section>\r\n      <h3 className=\"text-lg font-semibold mb-3\">ğŸ“„ PiÃ¨ces justificatives</h3>\r\n      <div className=\"bg-white border rounded p-4\">\r\n        {/* Ã‰tat synthÃ©tique sans forcer: on affiche ce que dit la BDD */}\r\n        <div className=\"text-sm mb-3\">\r\n          <strong>Statut:</strong> {valides}/{total} validÃ©es\r\n          {requiredTypes.length ? (\r\n            <span className=\"ml-2\">\r\n              â€” Requises manquantes: {missing.length ? missing.join(\", \") : \"â€”\"}\r\n            </span>\r\n          ) : null}\r\n        </div>\r\n\r\n        <ul className=\"list-disc pl-6\">\r\n          {total ? pieces.map((p, i) => (\r\n            <li key={i}>\r\n              {show(p.type)} â€” {show(p.fichier)} â€” {show(p.statut)}\r\n              {p.motif_refus ? ` (${p.motif_refus})` : \"\"} {p.uploaded_at ? `(${fmt(p.uploaded_at)})` : \"\"}\r\n            </li>\r\n          )) : <li>â€”</li>}\r\n        </ul>\r\n\r\n        <h4 className=\"font-medium mt-3\">TÃ©lÃ©chargements disponibles</h4>\r\n        <ul className=\"list-disc pl-6\">\r\n          {downloads.length ? downloads.map((d, i) => (\r\n            <li key={i}>{show(d.type)} â€” {show(d.fichier)}</li>\r\n          )) : <li>â€”</li>}\r\n        </ul>\r\n      </div>\r\n    </section>\r\n  );\r\n}\r\n"],"names":[],"mappings":";;;;AAAA;;AACA,MAAM,MAAM,CAAC,IAAO,IAAI,IAAI,KAAK,GAAG,WAAW,GAAG,KAAK,CAAC,GAAE,MAAM;AAChE,MAAM,OAAO,CAAC,IAAO,CAAA,cAAA,eAAA,IAAK,MAAM,CAAA,IAAI,OAAO,KAAK;AAQjC,SAAS,yBAAyB,KAAmD;QAAnD,EAAE,SAAS,EAAE,EAAE,YAAY,EAAE,EAAE,gBAAgB,EAAE,EAAE,GAAnD;IAC/C,wDAAwD;IACxD,MAAM,QAAQ,OAAO,MAAM;IAC3B,MAAM,UAAU,OAAO,MAAM,CAAC,CAAA,IAAK,EAAE,MAAM,KAAK,UAAU,MAAM;IAEhE,MAAM,UAAU,cAAc,MAAM,GAChC,cAAc,MAAM,CAAC,CAAA,IAAK,CAAC,OAAO,IAAI,CAAC,CAAA,IAAK,EAAE,IAAI,KAAK,MACvD,EAAE;IAEN,qBACE,6LAAC;;0BACC,6LAAC;gBAAG,WAAU;0BAA6B;;;;;;0BAC3C,6LAAC;gBAAI,WAAU;;kCAEb,6LAAC;wBAAI,WAAU;;0CACb,6LAAC;0CAAO;;;;;;4BAAgB;4BAAE;4BAAQ;4BAAE;4BAAM;4BACzC,cAAc,MAAM,iBACnB,6LAAC;gCAAK,WAAU;;oCAAO;oCACG,QAAQ,MAAM,GAAG,QAAQ,IAAI,CAAC,QAAQ;;;;;;uCAE9D;;;;;;;kCAGN,6LAAC;wBAAG,WAAU;kCACX,QAAQ,OAAO,GAAG,CAAC,CAAC,GAAG,kBACtB,6LAAC;;oCACE,KAAK,EAAE,IAAI;oCAAE;oCAAI,KAAK,EAAE,OAAO;oCAAE;oCAAI,KAAK,EAAE,MAAM;oCAClD,EAAE,WAAW,GAAG,AAAC,KAAkB,OAAd,EAAE,WAAW,EAAC,OAAK;oCAAG;oCAAE,EAAE,WAAW,GAAG,AAAC,IAAsB,OAAnB,IAAI,EAAE,WAAW,GAAE,OAAK;;+BAFnF;;;;sDAIN,6LAAC;sCAAG;;;;;;;;;;;kCAGX,6LAAC;wBAAG,WAAU;kCAAmB;;;;;;kCACjC,6LAAC;wBAAG,WAAU;kCACX,UAAU,MAAM,GAAG,UAAU,GAAG,CAAC,CAAC,GAAG,kBACpC,6LAAC;;oCAAY,KAAK,EAAE,IAAI;oCAAE;oCAAI,KAAK,EAAE,OAAO;;+BAAnC;;;;sDACN,6LAAC;sCAAG;;;;;;;;;;;;;;;;;;;;;;;AAKnB;KAzCwB","debugId":null}},
    {"offset": {"line": 1350, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/giorn/Desktop/Projet/Medina/Micro_entreprise/Mockfront/ME-main/app/%28crm%29/crm/clients/%5Bid%5D/CommsHistory.js"],"sourcesContent":["\"use client\";\r\n\r\nexport default function NotificationsRelancesCard({ relances = [], notifications = [] }) {\r\n  // Fusionner relances + notifications\r\n  let items = [...relances, ...notifications];\r\n\r\n  // Trier par date dÃ©croissante\r\n  items = items.sort(\r\n    (a, b) =>\r\n      (new Date(b.scheduled_for).getTime() || 0) -\r\n      (new Date(a.scheduled_for).getTime() || 0)\r\n  );\r\n\r\n  if (!items.length) {\r\n    return (\r\n      <section className=\"bg-white border rounded p-4\">\r\n        <h3 className=\"text-lg font-semibold mb-3\">ğŸ“¨ Historique (relances & notifications)</h3>\r\n        <p className=\"text-gray-500 text-sm\">\r\n          Aucune relance ou notification programmÃ©e.\r\n        </p>\r\n      </section>\r\n    );\r\n  }\r\n\r\n  // Badge couleur selon le type\r\n  const badge = (type) => {\r\n    if (type.startsWith(\"relance\")) {\r\n      return (\r\n        <span className=\"text-xs px-2 py-0.5 rounded bg-amber-100 text-amber-800\">\r\n          Relance\r\n        </span>\r\n      );\r\n    }\r\n    return (\r\n      <span className=\"text-xs px-2 py-0.5 rounded bg-blue-100 text-blue-800\">\r\n        Notification\r\n      </span>\r\n    );\r\n  };\r\n\r\n  // Format date\r\n  const fmt = (d) => (d ? new Date(d).toLocaleString(\"fr-FR\") : \"â€”\");\r\n\r\n  return (\r\n    <section className=\"bg-white border rounded p-4\">\r\n      <h3 className=\"text-lg font-semibold mb-3\">ğŸ“¨ Historique (relances & notifications)</h3>\r\n      <ul className=\"space-y-3\">\r\n        {items.map((x) => (\r\n          <li key={x.id} className=\"border rounded p-3\">\r\n            <div className=\"flex items-center justify-between\">\r\n              <div className=\"flex items-center gap-2\">\r\n                {badge(x.type)}\r\n                <span className=\"text-sm text-gray-600\">\r\n                  {x.canal || \"â€”\"}\r\n                </span>\r\n              </div>\r\n              <div className=\"text-xs text-gray-500\">\r\n                {fmt(x.scheduled_for)}\r\n              </div>\r\n            </div>\r\n\r\n            {x.message && x.message.trim() !== \"\" ? (\r\n              <div className=\"mt-1 text-sm text-gray-700 whitespace-pre-wrap\">\r\n                {x.message}\r\n              </div>\r\n            ) : (\r\n              <div className=\"mt-1 text-sm text-gray-400 italic\">\r\n                Aucun message\r\n              </div>\r\n            )}\r\n          </li>\r\n        ))}\r\n      </ul>\r\n    </section>\r\n  );\r\n}\r\n"],"names":[],"mappings":";;;;AAAA;;AAEe,SAAS,0BAA0B,KAAqC;QAArC,EAAE,WAAW,EAAE,EAAE,gBAAgB,EAAE,EAAE,GAArC;IAChD,qCAAqC;IACrC,IAAI,QAAQ;WAAI;WAAa;KAAc;IAE3C,8BAA8B;IAC9B,QAAQ,MAAM,IAAI,CAChB,CAAC,GAAG,IACF,CAAC,IAAI,KAAK,EAAE,aAAa,EAAE,OAAO,MAAM,CAAC,IACzC,CAAC,IAAI,KAAK,EAAE,aAAa,EAAE,OAAO,MAAM,CAAC;IAG7C,IAAI,CAAC,MAAM,MAAM,EAAE;QACjB,qBACE,6LAAC;YAAQ,WAAU;;8BACjB,6LAAC;oBAAG,WAAU;8BAA6B;;;;;;8BAC3C,6LAAC;oBAAE,WAAU;8BAAwB;;;;;;;;;;;;IAK3C;IAEA,8BAA8B;IAC9B,MAAM,QAAQ,CAAC;QACb,IAAI,KAAK,UAAU,CAAC,YAAY;YAC9B,qBACE,6LAAC;gBAAK,WAAU;0BAA0D;;;;;;QAI9E;QACA,qBACE,6LAAC;YAAK,WAAU;sBAAwD;;;;;;IAI5E;IAEA,cAAc;IACd,MAAM,MAAM,CAAC,IAAO,IAAI,IAAI,KAAK,GAAG,cAAc,CAAC,WAAW;IAE9D,qBACE,6LAAC;QAAQ,WAAU;;0BACjB,6LAAC;gBAAG,WAAU;0BAA6B;;;;;;0BAC3C,6LAAC;gBAAG,WAAU;0BACX,MAAM,GAAG,CAAC,CAAC,kBACV,6LAAC;wBAAc,WAAU;;0CACvB,6LAAC;gCAAI,WAAU;;kDACb,6LAAC;wCAAI,WAAU;;4CACZ,MAAM,EAAE,IAAI;0DACb,6LAAC;gDAAK,WAAU;0DACb,EAAE,KAAK,IAAI;;;;;;;;;;;;kDAGhB,6LAAC;wCAAI,WAAU;kDACZ,IAAI,EAAE,aAAa;;;;;;;;;;;;4BAIvB,EAAE,OAAO,IAAI,EAAE,OAAO,CAAC,IAAI,OAAO,mBACjC,6LAAC;gCAAI,WAAU;0CACZ,EAAE,OAAO;;;;;qDAGZ,6LAAC;gCAAI,WAAU;0CAAoC;;;;;;;uBAlB9C,EAAE,EAAE;;;;;;;;;;;;;;;;AA2BvB;KAzEwB","debugId":null}},
    {"offset": {"line": 1511, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/giorn/Desktop/Projet/Medina/Micro_entreprise/Mockfront/ME-main/app/%28crm%29/crm/clients/%5Bid%5D/ClientMessaging.js"],"sourcesContent":["\"use client\";\r\nimport { useEffect, useState } from \"react\";\r\n\r\nconst fmt = (d) => d ? new Date(d).toLocaleString(\"fr-FR\") : \"-\";\r\n\r\nexport default function ClientMessaging({ clientId, dossiers, senderType = \"OpÃ©rateur\" }) {\r\n  const [selectedDossier, setSelectedDossier] = useState(null);\r\n  const [messages, setMessages] = useState([]);\r\n  const [newMessage, setNewMessage] = useState(\"\");\r\n  const [sending, setSending] = useState(false);\r\n  const [loading, setLoading] = useState(false);\r\n\r\n  // DÃ©termine qui envoie le message\r\n  const isClientSending = senderType === \"Client\";\r\n  const isOperatorSending = senderType === \"OpÃ©rateur\";\r\n\r\n  // SÃ©lectionner le premier dossier par dÃ©faut\r\n  useEffect(() => {\r\n    if (dossiers.length > 0 && !selectedDossier) {\r\n      setSelectedDossier(dossiers[0]);\r\n    }\r\n  }, [dossiers, selectedDossier]);\r\n\r\n  // Charger messages du dossier sÃ©lectionnÃ©\r\n  useEffect(() => {\r\n    if (!selectedDossier) return;\r\n    \r\n    setLoading(true);\r\n    fetch(`/api/dossiers/${selectedDossier.id}/messages`, { cache: \"no-store\" })\r\n      .then(r => r.ok ? r.json() : Promise.reject(r))\r\n      .then(data => setMessages(data.messages || []))\r\n      .catch(e => {\r\n        console.error(\"Erreur chargement messages:\", e);\r\n        setMessages([]);\r\n      })\r\n      .finally(() => setLoading(false));\r\n  }, [selectedDossier]);\r\n\r\n  // Envoyer nouveau message (adaptÃ© selon le sender)\r\n  async function sendMessage() {\r\n    if (!newMessage.trim() || !selectedDossier) return;\r\n    \r\n    setSending(true);\r\n    try {\r\n      const r = await fetch(`/api/dossiers/${selectedDossier.id}/messages`, {\r\n        method: \"POST\",\r\n        headers: { \"Content-Type\": \"application/json\" },\r\n        body: JSON.stringify({\r\n          sender_type: senderType, // ğŸ”¥ Utilise la prop\r\n          body: newMessage.trim(),\r\n          send_email: isOperatorSending // Email seulement si opÃ©rateur envoie\r\n        })\r\n      });\r\n      \r\n      if (!r.ok) throw new Error(`HTTP ${r.status}`);\r\n      \r\n      const data = await r.json();\r\n      \r\n      // Recharger les messages\r\n      setMessages(prev => [...prev, data.message]);\r\n      setNewMessage(\"\");\r\n      \r\n      // Alerte diffÃ©rente selon qui envoie\r\n      if (isOperatorSending && data.email_sent) {\r\n        alert(`Message envoyÃ© et email automatique expÃ©diÃ© Ã  ${data.client_email}`);\r\n      } else if (isClientSending) {\r\n        alert(\"Message envoyÃ© Ã  l'Ã©quipe !\");\r\n      }\r\n    } catch (e) {\r\n      console.error(\"Erreur envoi message:\", e);\r\n      alert(\"Erreur lors de l'envoi du message\");\r\n    } finally {\r\n      setSending(false);\r\n    }\r\n  }\r\n\r\n  const getSenderColor = (senderType) => {\r\n    switch (senderType) {\r\n      case \"Client\": return \"bg-blue-50 border-l-4 border-l-blue-500\";\r\n      case \"OpÃ©rateur\": return \"bg-green-50 border-l-4 border-l-green-500\";\r\n      case \"SystÃ¨me\": return \"bg-gray-50 border-l-4 border-l-gray-500\";\r\n      default: return \"bg-gray-50\";\r\n    }\r\n  };\r\n\r\n  const getSenderIcon = (senderType) => {\r\n    switch (senderType) {\r\n      case \"Client\": return \"ğŸ‘¤\";\r\n      case \"OpÃ©rateur\": return \"ğŸ‘¨â€ğŸ’¼\";\r\n      case \"SystÃ¨me\": return \"ğŸ¤–\";\r\n      default: return \"ğŸ’¬\";\r\n    }\r\n  };\r\n\r\n  // Affichage du nom de l'expÃ©diteur selon le contexte\r\n  const getSenderDisplayName = (msgSenderType) => {\r\n    if (isClientSending) {\r\n      // Vue client : \"Vous\" pour ses messages, \"Ã‰quipe\" pour les opÃ©rateurs\r\n      return msgSenderType === \"Client\" ? \"Vous\" : \r\n             msgSenderType === \"OpÃ©rateur\" ? \"Ã‰quipe\" : \r\n             msgSenderType;\r\n    } else {\r\n      // Vue opÃ©rateur : noms normaux\r\n      return msgSenderType;\r\n    }\r\n  };\r\n\r\n  if (dossiers.length === 0) {\r\n    return (\r\n      <section className=\"border rounded p-4\">\r\n        <h3 className=\"text-lg font-semibold mb-3\">ğŸ’¬ Messagerie</h3>\r\n        <p className=\"text-gray-600\">Aucun dossier trouvÃ©{isClientSending ? \"\" : \" pour ce client\"}.</p>\r\n      </section>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <section className=\"border rounded p-4 space-y-4\">\r\n      <h3 className=\"text-lg font-semibold\">\r\n        ğŸ’¬ {isClientSending ? \"Messagerie avec votre Ã©quipe\" : \"Messagerie Client\"}\r\n        <span className=\"text-sm font-normal text-gray-600 ml-2\">\r\n          {isClientSending \r\n            ? \"(Communication avec nos opÃ©rateurs)\" \r\n            : \"(Communication directe avec le client)\"\r\n          }\r\n        </span>\r\n      </h3>\r\n\r\n      {/* SÃ©lecteur de dossier */}\r\n      {dossiers.length > 1 && (\r\n        <div>\r\n          <label className=\"block text-sm font-medium mb-1\">\r\n            Dossier Ã  afficher :\r\n          </label>\r\n          <select\r\n            className=\"border rounded p-2\"\r\n            value={selectedDossier?.id || \"\"}\r\n            onChange={(e) => {\r\n              const dossier = dossiers.find(d => d.id === parseInt(e.target.value));\r\n              setSelectedDossier(dossier);\r\n            }}\r\n          >\r\n            {dossiers.map(d => (\r\n              <option key={d.id} value={d.id}>\r\n                Dossier #{d.id} - {d.statut}\r\n              </option>\r\n            ))}\r\n          </select>\r\n        </div>\r\n      )}\r\n\r\n      {selectedDossier && (\r\n        <>\r\n          <div className=\"text-sm bg-blue-50 p-2 rounded\">\r\n            ğŸ“ <strong>Dossier #{selectedDossier.id}</strong> - Statut: {selectedDossier.statut}\r\n          </div>\r\n\r\n          {/* Messages */}\r\n          <div className=\"space-y-3 max-h-96 overflow-y-auto\">\r\n            {loading ? (\r\n              <p className=\"text-gray-600\">Chargement des messages...</p>\r\n            ) : messages.length === 0 ? (\r\n              <p className=\"text-gray-600\">Aucun message pour ce dossier.</p>\r\n            ) : (\r\n              messages.map(msg => (\r\n                <div \r\n                  key={msg.id} \r\n                  className={`p-3 rounded ${getSenderColor(msg.sender_type)}`}\r\n                >\r\n                  <div className=\"flex items-center justify-between mb-1\">\r\n                    <div className=\"flex items-center gap-2\">\r\n                      <span>{getSenderIcon(msg.sender_type)}</span>\r\n                      <strong className=\"text-sm\">\r\n                        {getSenderDisplayName(msg.sender_type)}\r\n                      </strong>\r\n                    </div>\r\n                    <span className=\"text-xs text-gray-600\">\r\n                      {fmt(msg.at)}\r\n                    </span>\r\n                  </div>\r\n                  <div className=\"whitespace-pre-wrap\">{msg.body}</div>\r\n                </div>\r\n              ))\r\n            )}\r\n          </div>\r\n\r\n          {/* Nouveau message */}\r\n          <div className=\"border-t pt-4 space-y-3\">\r\n            <h4 className=\"font-medium\">\r\n              {isClientSending ? \"âœ‰ï¸ Envoyer un message Ã  l'Ã©quipe\" : \"âœ‰ï¸ RÃ©pondre au client\"}\r\n            </h4>\r\n            <textarea\r\n              className=\"w-full border rounded p-3 h-24\"\r\n              placeholder={isClientSending \r\n                ? \"Votre message Ã  l'Ã©quipe...\" \r\n                : \"Votre message sera envoyÃ© au client par email...\"\r\n              }\r\n              value={newMessage}\r\n              onChange={(e) => setNewMessage(e.target.value)}\r\n              disabled={sending}\r\n            />\r\n            <div className=\"flex gap-2\">\r\n              <button\r\n                className=\"bg-blue-600 text-white px-4 py-2 rounded disabled:opacity-50\"\r\n                onClick={sendMessage}\r\n                disabled={sending || !newMessage.trim()}\r\n              >\r\n                {sending ? \"Envoi...\" : \r\n                 isClientSending ? \"ğŸ“¤ Envoyer Ã  l'Ã©quipe\" : \"ğŸ“§ Envoyer au client\"}\r\n              </button>\r\n              <button\r\n                className=\"border px-4 py-2 rounded\"\r\n                onClick={() => setNewMessage(\"\")}\r\n                disabled={sending}\r\n              >\r\n                Effacer\r\n              </button>\r\n            </div>\r\n            <p className=\"text-xs text-gray-600\">\r\n              ğŸ’¡ {isClientSending \r\n                ? \"Votre message sera envoyÃ© Ã  l'Ã©quipe et ajoutÃ© Ã  l'historique de votre dossier.\" \r\n                : \"Le message sera ajoutÃ© Ã  l'historique et envoyÃ© automatiquement par email au client.\"\r\n              }\r\n            </p>\r\n          </div>\r\n        </>\r\n      )}\r\n    </section>\r\n  );\r\n}"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 1924, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/giorn/Desktop/Projet/Medina/Micro_entreprise/Mockfront/ME-main/app/%28crm%29/crm/partenaires/%5Bid%5D/PartnerTracking.js"],"sourcesContent":["\"use client\";\r\nimport { useEffect, useState } from \"react\";\r\n\r\nconst fmt = (d) => d ? new Date(d).toLocaleDateString(\"fr-FR\") : \"-\";\r\nconst fmtDateTime = (d) => d ? new Date(d).toLocaleString(\"fr-FR\") : \"-\";\r\n\r\nexport default function PartnerTracking({ partnerId }) {\r\n  const [data, setData] = useState(null);\r\n  const [loading, setLoading] = useState(true);\r\n  const [adding, setAdding] = useState(false);\r\n  const [showForm, setShowForm] = useState(false);\r\n  \r\n  // Formulaire nouvelle interaction\r\n  const [form, setForm] = useState({\r\n    type_interaction: 'appel',\r\n    direction: 'sortant',\r\n    sujet: '',\r\n    notes: '',\r\n    participant: '',\r\n    duree_minutes: '',\r\n    prochaine_action: '',\r\n    rappel_date: ''\r\n  });\r\n\r\n  useEffect(() => {\r\n    if (partnerId) {\r\n      loadData();\r\n    }\r\n  }, [partnerId]);\r\n\r\n  async function loadData() {\r\n    setLoading(true);\r\n    try {\r\n      const r = await fetch(`/api/partenaires/${partnerId}/interactions`, { cache: \"no-store\" });\r\n      if (r.ok) {\r\n        const json = await r.json();\r\n        setData(json);\r\n      }\r\n    } catch (e) {\r\n      console.error(\"Erreur chargement interactions:\", e);\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  }\r\n\r\n  async function addInteraction() {\r\n    if (!form.sujet.trim()) {\r\n      alert(\"Sujet requis\");\r\n      return;\r\n    }\r\n\r\n    setAdding(true);\r\n    try {\r\n      const r = await fetch(`/api/partenaires/${partnerId}/interactions`, {\r\n        method: \"POST\",\r\n        headers: { \"Content-Type\": \"application/json\" },\r\n        body: JSON.stringify(form)\r\n      });\r\n\r\n      if (r.ok) {\r\n        await loadData();\r\n        setForm({\r\n          type_interaction: 'appel',\r\n          direction: 'sortant',\r\n          sujet: '',\r\n          notes: '',\r\n          participant: '',\r\n          duree_minutes: '',\r\n          prochaine_action: '',\r\n          rappel_date: ''\r\n        });\r\n        setShowForm(false);\r\n      } else {\r\n        throw new Error(\"Erreur crÃ©ation\");\r\n      }\r\n    } catch (e) {\r\n      console.error(\"Erreur ajout interaction:\", e);\r\n      alert(\"Erreur lors de l'ajout\");\r\n    } finally {\r\n      setAdding(false);\r\n    }\r\n  }\r\n\r\n  const getTypeIcon = (type) => {\r\n    switch (type) {\r\n      case 'appel': return 'ğŸ“';\r\n      case 'email': return 'âœ‰ï¸';\r\n      case 'reunion': return 'ğŸ¤';\r\n      case 'relance': return 'ğŸ“‹';\r\n      case 'note': return 'ğŸ“';\r\n      default: return 'ğŸ“„';\r\n    }\r\n  };\r\n\r\n  const getTypeColor = (type) => {\r\n    switch (type) {\r\n      case 'appel': return 'bg-blue-50 border-l-blue-500';\r\n      case 'email': return 'bg-green-50 border-l-green-500';\r\n      case 'reunion': return 'bg-purple-50 border-l-purple-500';\r\n      case 'relance': return 'bg-orange-50 border-l-orange-500';\r\n      case 'note': return 'bg-gray-50 border-l-gray-500';\r\n      default: return 'bg-gray-50 border-l-gray-500';\r\n    }\r\n  };\r\n\r\n  if (!partnerId) {\r\n    return null;\r\n  }\r\n\r\n  if (loading) {\r\n    return (\r\n      <section className=\"border rounded p-4\">\r\n        <h3 className=\"text-lg font-semibold mb-3\">ğŸ¤ Suivi Commercial</h3>\r\n        <p className=\"text-gray-600\">Chargement...</p>\r\n      </section>\r\n    );\r\n  }\r\n\r\n  const interactions = data?.interactions || [];\r\n  const prochaines = data?.prochaines_actions || [];\r\n  const stats = data?.stats || {};\r\n  const types = data?.references?.types || [];\r\n  const directions = data?.references?.directions || [];\r\n  const suggestedContacts = data?.suggested_contacts || [];\r\n\r\n  // Fonction pour sÃ©lectionner un contact suggÃ©rÃ©\r\n  const selectContact = (contact) => {\r\n    setForm(prev => ({\r\n      ...prev,\r\n      participant: contact.nom\r\n    }));\r\n  };\r\n\r\n  return (\r\n    <section className=\"border rounded p-4 space-y-4\">\r\n      <div className=\"flex items-center justify-between\">\r\n        <h3 className=\"text-lg font-semibold\">ğŸ¤ Suivi Commercial</h3>\r\n        <button\r\n          className=\"bg-blue-600 text-white px-3 py-2 rounded text-sm\"\r\n          onClick={() => setShowForm(!showForm)}\r\n        >\r\n          {showForm ? \"Annuler\" : \"+ Nouvelle interaction\"}\r\n        </button>\r\n      </div>\r\n\r\n      {/* Statistiques rapides */}\r\n      <div className=\"grid grid-cols-2 md:grid-cols-4 gap-3\">\r\n        <div className=\"bg-blue-50 p-3 rounded text-center\">\r\n          <div className=\"text-2xl font-bold text-blue-600\">{stats.total_interactions || 0}</div>\r\n          <div className=\"text-xs text-gray-600\">Total interactions</div>\r\n        </div>\r\n        <div className=\"bg-green-50 p-3 rounded text-center\">\r\n          <div className=\"text-2xl font-bold text-green-600\">{stats.interactions_30j || 0}</div>\r\n          <div className=\"text-xs text-gray-600\">Ce mois</div>\r\n        </div>\r\n        <div className=\"bg-purple-50 p-3 rounded text-center\">\r\n          <div className=\"text-2xl font-bold text-purple-600\">{stats.nb_reunions || 0}</div>\r\n          <div className=\"text-xs text-gray-600\">RÃ©unions</div>\r\n        </div>\r\n        <div className=\"bg-orange-50 p-3 rounded text-center\">\r\n          <div className=\"text-2xl font-bold text-orange-600\">{stats.actions_en_attente || 0}</div>\r\n          <div className=\"text-xs text-gray-600\">Actions en attente</div>\r\n        </div>\r\n      </div>\r\n\r\n      {/* Prochaines actions */}\r\n      {prochaines.length > 0 && (\r\n        <div className=\"bg-yellow-50 border border-yellow-200 rounded p-3\">\r\n          <h4 className=\"font-medium text-yellow-800 mb-2\">â° Prochaines actions</h4>\r\n          <div className=\"space-y-1\">\r\n            {prochaines.map(action => (\r\n              <div key={action.id} className=\"text-sm\">\r\n                <span className=\"font-medium\">{action.prochaine_action}</span>\r\n                {action.rappel_date && (\r\n                  <span className=\"text-yellow-700 ml-2\">\r\n                    (Rappel: {fmt(action.rappel_date)})\r\n                  </span>\r\n                )}\r\n              </div>\r\n            ))}\r\n          </div>\r\n        </div>\r\n      )}\r\n\r\n      {/* Formulaire nouvelle interaction */}\r\n      {showForm && (\r\n        <div className=\"border rounded p-4 bg-gray-50\">\r\n          <h4 className=\"font-medium mb-3\">Nouvelle interaction</h4>\r\n          \r\n          <div className=\"grid md:grid-cols-2 gap-3\">\r\n            <label className=\"flex flex-col text-sm\">\r\n              <span className=\"mb-1 font-medium\">Type *</span>\r\n              <select\r\n                className=\"border rounded p-2\"\r\n                value={form.type_interaction}\r\n                onChange={(e) => setForm(prev => ({...prev, type_interaction: e.target.value}))}\r\n              >\r\n                {types.map(type => (\r\n                  <option key={type.value} value={type.value}>{type.label}</option>\r\n                ))}\r\n              </select>\r\n            </label>\r\n\r\n            <label className=\"flex flex-col text-sm\">\r\n              <span className=\"mb-1 font-medium\">Direction</span>\r\n              <select\r\n                className=\"border rounded p-2\"\r\n                value={form.direction}\r\n                onChange={(e) => setForm(prev => ({...prev, direction: e.target.value}))}\r\n              >\r\n                {directions.map(dir => (\r\n                  <option key={dir.value} value={dir.value}>{dir.label}</option>\r\n                ))}\r\n              </select>\r\n            </label>\r\n\r\n            <label className=\"flex flex-col text-sm md:col-span-2\">\r\n              <span className=\"mb-1 font-medium\">Sujet *</span>\r\n              <input\r\n                type=\"text\"\r\n                className=\"border rounded p-2\"\r\n                value={form.sujet}\r\n                onChange={(e) => setForm(prev => ({...prev, sujet: e.target.value}))}\r\n                placeholder=\"Ex: Suivi mensuel performance\"\r\n              />\r\n            </label>\r\n\r\n            <label className=\"flex flex-col text-sm\">\r\n              <span className=\"mb-1 font-medium\">Participant</span>\r\n              \r\n              {/* Contacts suggÃ©rÃ©s */}\r\n              {suggestedContacts.length > 0 && (\r\n                <div className=\"mb-2\">\r\n                  <div className=\"text-xs text-gray-600 mb-1\">Contacts suggÃ©rÃ©s :</div>\r\n                  <div className=\"flex flex-wrap gap-1\">\r\n                    {suggestedContacts.map((contact, i) => (\r\n                      <button\r\n                        key={i}\r\n                        type=\"button\"\r\n                        className=\"text-xs bg-blue-100 text-blue-700 px-2 py-1 rounded hover:bg-blue-200\"\r\n                        onClick={() => selectContact(contact)}\r\n                      >\r\n                        {contact.nom}\r\n                        {contact.type === 'RÃ©fÃ©rent principal' && ' ğŸ‘‘'}\r\n                      </button>\r\n                    ))}\r\n                  </div>\r\n                </div>\r\n              )}\r\n              \r\n              {/* Champ de saisie */}\r\n              <input\r\n                type=\"text\"\r\n                className=\"border rounded p-2\"\r\n                value={form.participant}\r\n                onChange={(e) => setForm(prev => ({...prev, participant: e.target.value}))}\r\n                placeholder=\"Nom du contact ou sÃ©lectionnez ci-dessus\"\r\n                list=\"contacts-datalist\"\r\n              />\r\n              \r\n              {/* Datalist pour autocomplÃ©tion */}\r\n              <datalist id=\"contacts-datalist\">\r\n                {suggestedContacts.map((contact, i) => (\r\n                  <option key={i} value={contact.nom}>\r\n                    {contact.display}\r\n                  </option>\r\n                ))}\r\n              </datalist>\r\n            </label>\r\n\r\n            <label className=\"flex flex-col text-sm\">\r\n              <span className=\"mb-1 font-medium\">DurÃ©e (minutes)</span>\r\n              <input\r\n                type=\"number\"\r\n                className=\"border rounded p-2\"\r\n                value={form.duree_minutes}\r\n                onChange={(e) => setForm(prev => ({...prev, duree_minutes: e.target.value}))}\r\n                placeholder=\"30\"\r\n              />\r\n            </label>\r\n\r\n            <label className=\"flex flex-col text-sm md:col-span-2\">\r\n              <span className=\"mb-1 font-medium\">Notes</span>\r\n              <textarea\r\n                className=\"border rounded p-2 h-20\"\r\n                value={form.notes}\r\n                onChange={(e) => setForm(prev => ({...prev, notes: e.target.value}))}\r\n                placeholder=\"DÃ©tails de l'interaction...\"\r\n              />\r\n            </label>\r\n\r\n            <label className=\"flex flex-col text-sm\">\r\n              <span className=\"mb-1 font-medium\">Prochaine action</span>\r\n              <input\r\n                type=\"text\"\r\n                className=\"border rounded p-2\"\r\n                value={form.prochaine_action}\r\n                onChange={(e) => setForm(prev => ({...prev, prochaine_action: e.target.value}))}\r\n                placeholder=\"Ex: Programmer rÃ©union bilan\"\r\n              />\r\n            </label>\r\n\r\n            <label className=\"flex flex-col text-sm\">\r\n              <span className=\"mb-1 font-medium\">Rappel le</span>\r\n              <input\r\n                type=\"date\"\r\n                className=\"border rounded p-2\"\r\n                value={form.rappel_date}\r\n                onChange={(e) => setForm(prev => ({...prev, rappel_date: e.target.value}))}\r\n              />\r\n            </label>\r\n          </div>\r\n\r\n          <div className=\"flex gap-2 mt-4\">\r\n            <button\r\n              className=\"bg-green-600 text-white px-4 py-2 rounded disabled:opacity-50\"\r\n              onClick={addInteraction}\r\n              disabled={adding || !form.sujet.trim()}\r\n            >\r\n              {adding ? \"Ajout...\" : \"âœ… Ajouter\"}\r\n            </button>\r\n            <button\r\n              className=\"border px-4 py-2 rounded\"\r\n              onClick={() => setShowForm(false)}\r\n            >\r\n              Annuler\r\n            </button>\r\n          </div>\r\n        </div>\r\n      )}\r\n\r\n      {/* Liste des interactions */}\r\n      <div>\r\n        <h4 className=\"font-medium mb-3\">Historique des interactions</h4>\r\n        \r\n        {interactions.length === 0 ? (\r\n          <p className=\"text-gray-600 text-center py-4\">\r\n            Aucune interaction enregistrÃ©e. Ajoutez la premiÃ¨re !\r\n          </p>\r\n        ) : (\r\n          <div className=\"space-y-3 max-h-96 overflow-y-auto\">\r\n            {interactions.map(interaction => (\r\n              <div \r\n                key={interaction.id} \r\n                className={`border-l-4 p-3 rounded ${getTypeColor(interaction.type_interaction)}`}\r\n              >\r\n                <div className=\"flex items-start justify-between\">\r\n                  <div className=\"flex items-center gap-2\">\r\n                    <span>{getTypeIcon(interaction.type_interaction)}</span>\r\n                    <div>\r\n                      <h5 className=\"font-medium\">{interaction.sujet}</h5>\r\n                      <div className=\"text-sm text-gray-600\">\r\n                        {interaction.type_interaction} {interaction.direction} \r\n                        {interaction.participant && (\r\n                          <>\r\n                            {\" avec \"}\r\n                            <span className=\"font-medium\">{interaction.participant}</span>\r\n                            {/* Indiquer si c'est un contact connu */}\r\n                            {suggestedContacts.find(c => c.nom === interaction.participant) && (\r\n                              <span className=\"text-xs bg-green-100 text-green-700 px-1 rounded ml-1\">\r\n                                {suggestedContacts.find(c => c.nom === interaction.participant)?.type === 'RÃ©fÃ©rent principal' ? 'ğŸ‘‘' : 'âœ“'}\r\n                              </span>\r\n                            )}\r\n                          </>\r\n                        )}\r\n                        {interaction.duree_minutes && ` (${interaction.duree_minutes}min)`}\r\n                      </div>\r\n                    </div>\r\n                  </div>\r\n                  <span className=\"text-xs text-gray-500\">\r\n                    {fmtDateTime(interaction.date_interaction)}\r\n                  </span>\r\n                </div>\r\n\r\n                {interaction.notes && (\r\n                  <div className=\"text-sm mt-2 bg-white p-2 rounded\">\r\n                    {interaction.notes}\r\n                  </div>\r\n                )}\r\n\r\n                {interaction.prochaine_action && (\r\n                  <div className=\"text-sm mt-2 text-orange-700 bg-orange-100 p-2 rounded\">\r\n                    <strong>â†’ Prochaine action:</strong> {interaction.prochaine_action}\r\n                    {interaction.rappel_date && (\r\n                      <span className=\"ml-2\">(Rappel: {fmt(interaction.rappel_date)})</span>\r\n                    )}\r\n                  </div>\r\n                )}\r\n\r\n                <div className=\"text-xs text-gray-400 mt-2\">\r\n                  Par {interaction.created_by}\r\n                </div>\r\n              </div>\r\n            ))}\r\n          </div>\r\n        )}\r\n      </div>\r\n\r\n      {stats.derniere_interaction && (\r\n        <div className=\"text-xs text-gray-500 text-center pt-2 border-t\">\r\n          DerniÃ¨re interaction: {fmtDateTime(stats.derniere_interaction)}\r\n        </div>\r\n      )}\r\n    </section>\r\n  );\r\n}"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 2852, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/giorn/Desktop/Projet/Medina/Micro_entreprise/Mockfront/ME-main/app/%28crm%29/crm/partenaires/%5Bid%5D/InvoicesCommissionsCard.js"],"sourcesContent":["\"use client\";\r\nimport { useEffect, useState } from \"react\";\r\n\r\nconst fmt = (d) => (d ? new Date(d).toLocaleDateString(\"fr-FR\") : \"â€”\");\r\nconst num = (n) => (n === 0 ? \"0\" : n != null ? Number(n).toLocaleString(\"fr-FR\") : \"â€”\");\r\n\r\nexport default function InvoicesCommissionsCard({ partnerId, data }) {\r\n  const [state, setState] = useState({ loading: false, error: null, model: null });\r\n  const [showForm, setShowForm] = useState(false);\r\n  const [form, setForm] = useState({\r\n    periode: new Date().toISOString().slice(0, 7), // \"YYYY-MM\"\r\n    echeance_jours: 30\r\n  });\r\n  const [generating, setGenerating] = useState(false);\r\n  const [preview, setPreview] = useState(null);\r\n\r\n  useEffect(() => {\r\n    if (data) build(data);\r\n    else if (partnerId) load();\r\n    // eslint-disable-next-line react-hooks/exhaustive-deps\r\n  }, [partnerId, data]);\r\n\r\n  useEffect(() => {\r\n  if (!partnerId) return;\r\n  const today = new Date();\r\n  if (today.getUTCDate() !== 1) return;\r\n\r\n  const prev = new Date(Date.UTC(today.getUTCFullYear(), today.getUTCMonth()-1, 1));\r\n  const period = `${prev.getUTCFullYear()}-${String(prev.getUTCMonth()+1).padStart(2,\"0\")}`;\r\n  const key = `autoClose:${partnerId}:${period}`;\r\n  if (localStorage.getItem(key)) return; // dÃ©jÃ  fait\r\n\r\n  fetch(\"/api/partenaires/close-month\", {\r\n    method: \"POST\",\r\n    headers: { \"Content-Type\": \"application/json\" },\r\n    body: JSON.stringify({ period, partnerId })\r\n  })\r\n    .then(() => {\r\n      localStorage.setItem(key, \"1\");\r\n      return load();\r\n    })\r\n    .catch(() => {/* silencieux */});\r\n}, [partnerId]);\r\n\r\n\r\n  async function load() {\r\n    try {\r\n      setState((s) => ({ ...s, loading: true, error: null }));\r\n      const r = await fetch(`/api/partenaires/${partnerId}`, { cache: \"no-store\" });\r\n      if (!r.ok) throw new Error(`HTTP ${r.status}`);\r\n      build(await r.json());\r\n    } catch (e) {\r\n      console.error(e);\r\n      setState({ loading: false, error: \"Impossible de charger les factures\", model: null });\r\n    }\r\n  }\r\n\r\n  function build(raw) {\r\n    const p = raw.partenaire || {};\r\n    const ca = Array.isArray(raw.ca_par_periode) ? raw.ca_par_periode : [];\r\n    const factures = Array.isArray(raw.factures) ? [...raw.factures] : [];\r\n\r\n    const taux = Number(p.taux_commission) || 0;\r\n    const nowMonth = new Date().toISOString().slice(0, 7);\r\n    const caMois = Number(ca.find((x) => x.periode === nowMonth)?.ca) || 0;\r\n\r\n    const commissionsMois = Number((caMois * taux / 100).toFixed(2));\r\n\r\n    const thisYear = new Date().getFullYear().toString();\r\n    const caAnnuel = ca\r\n      .filter((x) => String(x.periode || \"\").startsWith(thisYear))\r\n      .reduce((s, x) => s + (Number(x.ca) || 0), 0);\r\n    const commissionsAnnuelles = Number((caAnnuel * taux / 100).toFixed(2));\r\n\r\n    const payees = factures.filter((f) => f.statut === \"payee\");\r\n    const impayees = factures.filter((f) => f.statut !== \"payee\"); // tout sauf payÃ©e\r\n    const montantImpaye = impayees.reduce((s, f) => s + (Number(f.montant) || 0), 0);\r\n    const montantPaye = payees.reduce((s, f) => s + (Number(f.montant) || 0), 0);\r\n\r\n    const today = new Date().toISOString().slice(0, 10);\r\n    const enRetard = impayees.filter((f) => f.echeance && f.echeance < today);\r\n    const d30 = new Date();\r\n    d30.setDate(d30.getDate() + 30);\r\n    const prochaines = impayees.filter((f) => f.echeance && f.echeance <= d30.toISOString().slice(0, 10));\r\n\r\n    factures.sort((a, b) => new Date(b.date || 0) - new Date(a.date || 0));\r\n\r\n    setState({\r\n      loading: false,\r\n      error: null,\r\n      model: {\r\n        commissions: { ceMois: commissionsMois, caCeMois: caMois, tauxCommission: taux, periode: nowMonth, commissionsAnnuelles },\r\n        factures: { toutes: factures, impayees, payees, enRetard },\r\n        totaux: { montantImpaye, montantPaye, nombreImpayees: impayees.length, nombrePayees: payees.length },\r\n        alertes: { retard: enRetard.length, prochainesEcheances: prochaines.length },\r\n        coord: p.coordonnees_facturation || {},\r\n        partner: p\r\n      }\r\n    });\r\n  }\r\n\r\n  async function previewInvoice() {\r\n  try {\r\n    setGenerating(true);\r\n    setPreview(null);\r\n    const r = await fetch(`/api/partenaires/${partnerId}/invoices`, {\r\n      method: \"POST\",\r\n      headers: { \"Content-Type\": \"application/json\" },\r\n      body: JSON.stringify({ action: \"preview\", period: form.periode })\r\n    });\r\n    const j = await r.json().catch(() => ({}));\r\n    if (!r.ok) throw new Error(j.detail || j.error || `HTTP ${r.status}`);\r\n\r\n    const p = j.preview || {};\r\n    // normalisation champs\r\n    const normalized = {\r\n      periode: p.periode || p.period || form.periode,\r\n      dossiers_count: p.dossiers_count ?? p.dossiers ?? 0,\r\n      commission_eur: p.commission_eur ?? p.montant ?? 0\r\n    };\r\n    setPreview(normalized);\r\n  } catch (e) {\r\n    alert(`âŒ AperÃ§u impossible: ${e.message}`);\r\n  } finally {\r\n    setGenerating(false);\r\n  }\r\n}\r\n\r\n\r\n  async function generateInvoice() {\r\n    try {\r\n      setGenerating(true);\r\n      const r = await fetch(`/api/partenaires/${partnerId}/invoices`, {\r\n        method: \"POST\",\r\n        headers: { \"Content-Type\": \"application/json\" },\r\n        // mÃªme contrat que la page qui fonctionne\r\n        body: JSON.stringify({\r\n          action: \"create\",\r\n          period: form.periode,                 // \"YYYY-MM\"\r\n          echeance_jours: form.echeance_jours || 30\r\n        })\r\n      });\r\n      const j = await r.json().catch(() => ({}));\r\n      if (!r.ok) throw new Error(j.detail || j.error || `HTTP ${r.status}`);\r\n\r\n\r\n      alert(\"âœ… Facture gÃ©nÃ©rÃ©e avec succÃ¨s\");\r\n      setShowForm(false);\r\n      setForm({ periode: new Date().toISOString().slice(0, 7), echeance_jours: 30 });\r\n      setPreview(j.preview || null);\r\n\r\n      // recharger les donnÃ©es\r\n      await load();\r\n    } catch (e) {\r\n      console.error(e);\r\n      alert(`âŒ Erreur: ${e.message}`);\r\n    } finally {\r\n      setGenerating(false);\r\n    }\r\n  }\r\n\r\n  async function download(f) {\r\n  try {\r\n    if (f.pdf && f.pdf.startsWith(\"http\")) return window.open(f.pdf, \"_blank\");\r\n    const r = await fetch(`/api/partenaires/${partnerId}/invoices/${f.id}/pdf`);\r\n    if (!r.ok) throw new Error(\"Document non disponible\");\r\n    const blob = await r.blob();\r\n    const url = URL.createObjectURL(blob);\r\n    const a = Object.assign(document.createElement(\"a\"), { href: url, download: `facture_${f.id}.pdf` });\r\n    document.body.appendChild(a); a.click(); URL.revokeObjectURL(url); a.remove();\r\n  } catch (e) {\r\n    console.error(e);\r\n    alert(\"âŒ Impossible de tÃ©lÃ©charger la facture\");\r\n  }\r\n}\r\n\r\n  // reset l'aperÃ§u quand on change la pÃ©riode\r\n  useEffect(() => { setPreview(null); }, [form.periode]);\r\n\r\n  if (state.loading && !state.model) {\r\n    return (\r\n      <section className=\"bg-white border rounded-lg p-6\">\r\n        <h3 className=\"text-lg font-semibold\">ğŸ’° Facturation & Commissions</h3>\r\n      </section>\r\n    );\r\n  }\r\n  if (state.error) {\r\n    return (\r\n      <section className=\"bg-white border rounded-lg p-6\">\r\n        <h3 className=\"text-lg font-semibold mb-4\">ğŸ’° Facturation & Commissions</h3>\r\n        <div className=\"bg-red-50 border border-red-200 rounded p-4\">\r\n          <div className=\"text-red-800\">âŒ {state.error}</div>\r\n          <button onClick={load} className=\"mt-2 text-sm bg-red-600 text-white px-3 py-1 rounded hover:bg-red-700\">ğŸ”„ RÃ©essayer</button>\r\n        </div>\r\n      </section>\r\n    );\r\n  }\r\n  if (!state.model) return null;\r\n\r\n  const m = state.model;\r\n\r\n  function currentYYYYMM() {\r\n    return new Date().toISOString().slice(0, 7);\r\n  }\r\n\r\n  function displayStateLabel(f) {\r\n    if (f?.statut === 'payee') return \"ClÃ´turÃ©e\";\r\n    const nowYM = new Date().toISOString().slice(0, 7);\r\n    return String(f.periode) < nowYM ? \"ClÃ´turÃ©e\" : \"Temporaire\";\r\n  }\r\n\r\n  function stateBadge(f) {\r\n    const label = displayStateLabel(f);\r\n    const map = {\r\n      \"ClÃ´turÃ©e\":  [\"bg-green-100 text-green-800\", \"âœ… ClÃ´turÃ©e\"],\r\n      \"Temporaire\":[\"bg-orange-100 text-orange-800\", \"â³ Temporaire\"],\r\n    };\r\n    const [cls, text] = map[label] || [\"bg-gray-100 text-gray-800\", `ğŸ“‹ ${label}`];\r\n    return <span className={`inline-flex items-center px-2 py-1 text-xs font-medium rounded-full ${cls}`}>{text}</span>;\r\n  }\r\n\r\n  return (\r\n    <section className=\"bg-white border rounded-lg p-6\">\r\n      <div className=\"flex items-center justify-between mb-6\">\r\n        <h3 className=\"text-lg font-semibold\">ğŸ’° Facturation & Commissions</h3>\r\n        <div className=\"flex gap-2\">\r\n          <button onClick={load} className=\"text-xs bg-blue-100 hover:bg-blue-200 text-blue-700 px-3 py-2 rounded-md\">\r\n            ğŸ”„ Actualiser\r\n          </button>\r\n          <button onClick={() => setShowForm((s) => !s)} className=\"text-sm bg-green-600 text-white px-4 py-2 rounded-md hover:bg-green-700\">\r\n            {showForm ? \"Annuler\" : \"+ GÃ©nÃ©rer facture\"}\r\n          </button>\r\n        </div>\r\n      </div>\r\n\r\n      <button\r\n        onClick={async () => {\r\n          try {\r\n            const res = await fetch(\"/api/partenaires/close-month\", {\r\n              method: \"POST\",\r\n              headers: { \"Content-Type\": \"application/json\" },\r\n              body: JSON.stringify({\r\n                period: new Date().toISOString().slice(0,7), // mois courant\r\n                partnerId\r\n              })\r\n            });\r\n            if (!res.ok) {\r\n              const j = await res.json().catch(() => ({}));\r\n              throw new Error(j.details || j.error || `HTTP ${res.status}`);\r\n            }\r\n            await load();\r\n            alert(\"âœ… Facture clÃ´turÃ©e avec succÃ¨s !\");\r\n          } catch (e) {\r\n            alert(`âŒ Impossible de clÃ´turer la facture : ${e.message}`);\r\n          }\r\n        }}\r\n        className=\"text-xs bg-gray-100 hover:bg-gray-200 text-gray-700 px-3 py-2 rounded-md mb-6\"\r\n      >\r\n        ğŸ”’ ClÃ´turer ce mois\r\n      </button>\r\n\r\n      <div className=\"mb-6\">\r\n        <h4 className=\"text-sm font-medium text-gray-700 mb-3\">ğŸ’¸ Commissions Ã  recevoir</h4>\r\n        <div className=\"grid grid-cols-1 md:grid-cols-3 gap-4\">\r\n            <Box title=\"Ce mois (temporaire)\" value={`${num(m.commissions.ceMois)}â‚¬`} subtitle={`CA: ${num(m.commissions.caCeMois)}â‚¬`} />\r\n            <Box title=\"Taux commission\" value={`${num(m.commissions.tauxCommission)}%`} />\r\n            <Box title=\"PÃ©riode\" value={m.commissions.periode} subtitle=\"YYYY-MM\" />\r\n          </div>\r\n          <p className=\"mt-2 text-xs text-gray-500\">\r\n            Montant temporaire â€” la facture du mois prÃ©cÃ©dent est gÃ©nÃ©rÃ©e et marquÃ©e Â« payÃ©e Â» automatiquement le 1er du mois.\r\n          </p>\r\n      </div>\r\n\r\n      <div className=\"mb-6\">\r\n        <h4 className=\"text-sm font-medium text-gray-700 mb-3\">ğŸ§¾ Ã‰tat facturation</h4>\r\n        <div className=\"grid grid-cols-1 md:grid-cols-3 gap-4\">\r\n          <Box title=\"En attente\" value={`${num(m.totaux.montantImpaye)}â‚¬`} subtitle={`${m.totaux.nombreImpayees} facture(s)`} />\r\n          <Box title=\"PayÃ©\" value={`${num(m.totaux.montantPaye)}â‚¬`} subtitle={`${m.totaux.nombrePayees} facture(s)`} />\r\n          <Box title=\"Total factures\" value={m.factures.toutes.length} subtitle=\"Historique\" />\r\n        </div>\r\n      </div>\r\n\r\n      {showForm && (\r\n        <div className=\"mb-6 p-4 bg-gray-50 border rounded-lg\">\r\n          <h4 className=\"font-medium mb-3\">GÃ©nÃ©rer une nouvelle facture</h4>\r\n          <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\r\n            <label className=\"flex flex-col text-sm\">\r\n              <span className=\"mb-1 font-medium\">PÃ©riode *</span>\r\n              <input\r\n                type=\"month\"\r\n                value={form.periode}\r\n                onChange={(e) => setForm((f) => ({ ...f, periode: e.target.value }))}\r\n                className=\"border rounded px-3 py-2\"\r\n              />\r\n            </label>\r\n            <label className=\"flex flex-col text-sm\">\r\n              <span className=\"mb-1 font-medium\">Ã‰chÃ©ance (jours)</span>\r\n              <input\r\n                type=\"number\"\r\n                min=\"1\"\r\n                max=\"90\"\r\n                value={form.echeance_jours}\r\n                onChange={(e) => setForm((f) => ({ ...f, echeance_jours: parseInt(e.target.value || \"0\", 10) }))}\r\n                className=\"border rounded px-3 py-2\"\r\n              />\r\n            </label>\r\n          </div>\r\n          <div className=\"flex gap-2 mt-4\">\r\n            <button onClick={previewInvoice} disabled={generating || !form.periode} className=\"border px-4 py-2 rounded\">\r\n              {generating ? \"â€¦\" : \"ğŸ‘ï¸ PrÃ©visualiser\"}\r\n            </button>\r\n            <button onClick={generateInvoice} disabled={generating || !form.periode} className=\"bg-green-600 text-white px-4 py-2 rounded\">\r\n              {generating ? \"â³ GÃ©nÃ©rationâ€¦\" : \"âœ… GÃ©nÃ©rer facture\"}\r\n            </button>\r\n            <button onClick={() => setShowForm(false)} className=\"border px-4 py-2 rounded\">Annuler</button>\r\n          </div>\r\n\r\n          {preview && (\r\n            <div className=\"mt-4 text-sm text-gray-700\">\r\n              <div>PÃ©riode : <b>{preview.periode}</b></div>\r\n              <div>Dossiers pris en compte : <b>{preview.dossiers_count}</b></div>\r\n              <div>Montant total commissions : <b>{num(preview.commission_eur)}â‚¬</b></div>\r\n            </div>\r\n          )}\r\n\r\n        </div>\r\n      )}\r\n\r\n      <div className=\"mb-6\">\r\n        <h4 className=\"text-sm font-medium text-gray-700 mb-3\">ğŸ“„ Historique des factures</h4>\r\n        {m.factures.toutes.length === 0 ? (\r\n          <div className=\"text-center py-8 text-gray-500\">â€”</div>\r\n        ) : (\r\n          <div className=\"overflow-x-auto\">\r\n            <table className=\"min-w-full\">\r\n              <thead className=\"bg-gray-50\">\r\n                <tr>\r\n                  <th className=\"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase\">Facture</th>\r\n                  <th className=\"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase\">PÃ©riode</th>\r\n                  <th className=\"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase\">Montant</th>\r\n                  <th className=\"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase\">Ã‰tat</th>\r\n                  <th className=\"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase\">Ã‰chÃ©ance</th>\r\n                  <th className=\"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase\">Actions</th>\r\n                </tr>\r\n              </thead>\r\n              <tbody className=\"bg-white divide-y divide-gray-200\">\r\n                {m.factures.toutes.slice(0, 10).map((f) => (\r\n                  <tr key={f.id} className=\"hover:bg-gray-50\">\r\n                    <td className=\"px-4 py-4\">\r\n                      <div className=\"font-medium text-gray-900\">#{f.id}</div>\r\n                      <div className=\"text-xs text-gray-500\">{fmt(f.date)}</div>\r\n                    </td>\r\n                    <td className=\"px-4 py-4 text-sm\">{f.periode || \"â€”\"}</td>\r\n                    <td className=\"px-4 py-4 text-sm font-medium\">{num(f.montant)}â‚¬</td>\r\n                    <td className=\"px-4 py-4 text-sm\">{stateBadge(f)}</td>\r\n                    <td className=\"px-4 py-4 text-sm\">\r\n                      <div>{fmt(f.echeance)}</div>\r\n                      {f.echeance && new Date(f.echeance) < new Date() && f.statut !== \"payee\" && (\r\n                        <div className=\"text-xs text-red-600 font-medium\">En retard</div>\r\n                      )}\r\n                    </td>\r\n                    <td className=\"px-4 py-4\">\r\n                    <button onClick={() => download(f)} className=\"bg-blue-600 text-white px-3 py-1 rounded text-xs hover:bg-blue-700\">\r\n                      ğŸ“¥ PDF\r\n                    </button>\r\n                  </td>\r\n                  </tr>\r\n                ))}\r\n              </tbody>\r\n            </table>\r\n            {m.factures.toutes.length > 10 && (\r\n              <div className=\"text-center py-3 text-sm text-gray-500\">\r\n                Et {m.factures.toutes.length - 10} autres facturesâ€¦\r\n              </div>\r\n            )}\r\n          </div>\r\n        )}\r\n      </div>\r\n\r\n      <div className=\"bg-gray-50 rounded-lg p-4 text-sm\">\r\n        <h4 className=\"font-medium mb-2\">ğŸ“® CoordonnÃ©es de facturation</h4>\r\n        <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\r\n          <div>\r\n            <div className=\"font-medium\">{m.coord.societe || m.partner.nom || \"â€”\"}</div>\r\n            <div className=\"text-gray-600\">{m.coord.adresse || \"â€”\"}</div>\r\n          </div>\r\n          <div>\r\n            <div><strong>Email:</strong> {m.coord.email_facturation || \"â€”\"}</div>\r\n            <div><strong>Mode paiement:</strong> {m.partner.paiement?.mode || \"â€”\"}</div>\r\n            {m.partner.paiement?.iban && <div><strong>IBAN:</strong> {m.partner.paiement.iban.slice(0, 8)}â€¦</div>}\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </section>\r\n  );\r\n}\r\n\r\nfunction Box({ title, value, subtitle }) {\r\n  return (\r\n    <div className=\"bg-gray-50 border border-gray-200 rounded-lg p-4 text-center\">\r\n      <div className=\"text-2xl font-bold text-gray-900\">{value}</div>\r\n      <div className=\"text-sm font-medium text-gray-700\">{title}</div>\r\n      {subtitle && <div className=\"text-xs text-gray-500 mt-1\">{subtitle}</div>}\r\n    </div>\r\n  );\r\n}"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 3960, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/giorn/Desktop/Projet/Medina/Micro_entreprise/Mockfront/ME-main/app/%28crm%29/crm/entreprises/%5Bid%5D/EntrepriseCard.js"],"sourcesContent":["\"use client\";\r\nimport Link from \"next/link\";\r\n\r\n/* ---------- Helpers ---------- */\r\n\r\n// Date sÃ»re (retourne \"â€”\" si invalide)\r\nfunction fmt(d) {\r\n  if (!d) return \"â€”\";\r\n  const dt = new Date(d);\r\n  if (!Number.isFinite(dt.getTime())) return \"â€”\";\r\n  try {\r\n    return dt.toLocaleDateString(\"fr-FR\");\r\n  } catch {\r\n    return \"â€”\";\r\n  }\r\n}\r\n\r\n// Tri-Ã©tat boolÃ©en, en acceptant 1/0 et strings\r\nfunction toBoolOrUndef(v) {\r\n  if (v === true || v === false) return v;\r\n  if (v === 1 || v === 0) return Boolean(v);\r\n  if (typeof v === \"string\") {\r\n    const s = v.trim().toLowerCase();\r\n    if (s === \"true\" || s === \"oui\") return true;\r\n    if (s === \"false\" || s === \"non\") return false;\r\n  }\r\n  return undefined;\r\n}\r\nconst showBool = (v) => {\r\n  const b = toBoolOrUndef(v);\r\n  return b === true ? \"Oui\" : b === false ? \"Non\" : \"â€”\";\r\n};\r\n\r\n// Affiche valeur telle quelle, ou \"â€”\" si null/undefined/\"\"\r\nconst show = (v) => (v ?? v === 0 ? String(v) : \"â€”\");\r\n\r\n// ConcatÃ¨ne des morceaux (ex: adresse) en filtrant vides/\"â€”\"\r\nfunction joinClean(parts, sep = \", \") {\r\n  const cleaned = parts\r\n    .map((x) => (x ?? x === 0 ? String(x) : \"\"))\r\n    .map((x) => x.trim())\r\n    .filter((x) => x && x !== \"â€”\");\r\n  return cleaned.length ? cleaned.join(sep) : \"â€”\";\r\n}\r\n\r\n/* ---------- Composant ---------- */\r\n\r\nexport default function EntrepriseCard({ data }) {\r\n  if (!data?.entreprise) return null;\r\n\r\n  const e = data.entreprise;\r\n  const docs = Array.isArray(data.documents_generes) ? data.documents_generes : [];\r\n  const jobs = Array.isArray(data.scraping_jobs) ? data.scraping_jobs : [];\r\n  const dossiers = Array.isArray(data.dossiers) ? data.dossiers : [];\r\n\r\n  // Compat: mÃªmes infos, 2 chemins possibles (tout vient de la BDD)\r\n  const INPI   = e.donnees_gouvernement?.guichet_unique_INPI ?? e.gov_inpi ?? {};\r\n  const INSEE  = e.donnees_gouvernement?.INSEE_SIRENE        ?? e.gov_insee ?? {};\r\n  const URSSAF = e.donnees_gouvernement?.URSSAF              ?? e.gov_urssaf ?? {};\r\n  const RNE    = e.donnees_gouvernement?.RNE                 ?? e.gov_rne ?? {};\r\n\r\n  const TVA    = e.options_fiscales ?? {};\r\n  const check  = e.checklist_conformite ?? {};\r\n  const tit    = e.titulaire_client;\r\n\r\n  // Adresse: on construit proprement sans â€œâ€”, â€” â€”â€\r\n  const adr = e.lieu_exercice?.adresse_etablissement ?? e.lieu_exercice?.adresse ?? {};\r\n  const adresseLigne = joinClean([adr.ligne1, adr.code_postal, adr.ville], \" \");\r\n\r\n  // ActivitÃ©: description/libellÃ© avec fallback net\r\n  const activiteLabel = e.activite?.description ?? e.activite?.libelle ?? \"\";\r\n\r\n  // INSEE/SIRENE: champs normalisÃ©s\r\n  const siren = INSEE.SIREN ?? INSEE.siren;\r\n  const siret = INSEE.SIRET_principal ?? INSEE.siret;\r\n  const ape   = INSEE.code_APE ?? INSEE.ape;\r\n\r\n  // URSSAF: nÂ° affichÃ© uniquement sâ€™il existe\r\n  const urssafStatut = URSSAF.affiliation ?? URSSAF.statut;\r\n  const urssafNumero = URSSAF.numero_affiliation ?? URSSAF.numero_compte;\r\n\r\n  // Options sociales: gardes simples\r\n  const os = e.options_sociales ?? {};\r\n\r\n  return (\r\n    <section>\r\n      <h3 className=\"text-lg font-semibold mb-4\">ğŸ¢ Mon entreprise</h3>\r\n      <div className=\"bg-white border rounded p-4 space-y-5\">\r\n        {/* En-tÃªte */}\r\n        <div className=\"border-b pb-3\">\r\n          <h4 className=\"font-semibold text-lg\">{show(e.denomination)}</h4>\r\n          <div className=\"flex flex-wrap gap-4 text-sm text-gray-600 mt-1\">\r\n            <span><strong>Forme:</strong> {show(e.forme)}</span>\r\n            <span><strong>Statut:</strong> {show(e.statut_dossier)}</span>\r\n            <span>\r\n              <strong>Titulaire:</strong>{\" \"}\r\n              {tit ? (\r\n                <Link href={`/crm/clients/${tit.id}`} className=\"underline\">\r\n                  {show(joinClean([tit.prenom, tit.nom], \" \"))}\r\n                </Link>\r\n              ) : \"â€”\"}\r\n            </span>\r\n          </div>\r\n        </div>\r\n\r\n        {/* ActivitÃ© & lieu */}\r\n        <div>\r\n          <h5 className=\"font-medium text-blue-800 mb-2\">ğŸ“ ActivitÃ© & lieu</h5>\r\n          <ul className=\"list-disc pl-6 text-sm\">\r\n            <li>ActivitÃ©: {show(activiteLabel)}</li>\r\n            <li>CatÃ©gorie: {show(e.activite?.categorie)} â€” APE/NAF: {show(e.activite?.APE_NAF ?? e.activite?.code_ape)}</li>\r\n            <li>RÃ©glem.: {showBool(e.activite?.profession_reglementee)}</li>\r\n            <li>Ã‰tablissement: {adresseLigne}</li>\r\n          </ul>\r\n        </div>\r\n\r\n        {/* Dates */}\r\n        <div>\r\n          <h5 className=\"font-medium text-green-800 mb-2\">ğŸ“… Dates importantes</h5>\r\n          <ul className=\"list-disc pl-6 text-sm\">\r\n            <li>Demande: {fmt(e.dates?.date_demande ?? e.dates?.demande)}</li>\r\n            <li>DÃ©but dâ€™activitÃ©: {fmt(e.dates?.date_debut_activite ?? e.dates?.debut_activite)}</li>\r\n            <li>Immatriculation rÃ©elle: {fmt(e.dates?.date_immatriculation_reelle ?? e.dates?.immatriculation_reelle)}</li>\r\n          </ul>\r\n        </div>\r\n\r\n        {/* Options sociales & fiscales */}\r\n        {(e.options_sociales || e.options_fiscales) && (\r\n          <div>\r\n            <h5 className=\"font-medium text-purple-800 mb-2\">âš–ï¸ Options sociales & fiscales</h5>\r\n            <ul className=\"list-disc pl-6 text-sm\">\r\n              <li>RÃ©gime: {show(os.regime)}</li>\r\n              <li>PÃ©riodicitÃ©: {show(os.periodicite_versement ?? os.periodicite)}</li>\r\n              <li>Franchise TVA: {showBool(TVA.franchise_TVA ?? TVA.franchise_tva)}</li>\r\n              <li>NÂ° TVA intracom: {show(TVA.numero_TVA_intracom ?? TVA.numero_tva)}</li>\r\n              <li>Versement libÃ©ratoire IR: {showBool(TVA.versement_liberatoire_IR ?? TVA.versement_liberatoire)}</li>\r\n              <li>Compta simplifiÃ©e: {showBool(TVA.comptabilite_simplifiee)}</li>\r\n            </ul>\r\n          </div>\r\n        )}\r\n\r\n        {/* DonnÃ©es gouvernement */}\r\n        <div>\r\n          <h5 className=\"font-medium text-red-800 mb-2\">ğŸ›ï¸ DonnÃ©es gouvernement</h5>\r\n          <ul className=\"list-disc pl-6 text-sm\">\r\n            <li>\r\n              INPI: {show(INPI.etat ?? INPI.statut)} â€” dossier {show(INPI.numero_dossier ?? INPI.dossier)} â€” MAJ {fmt(INPI.derniere_mise_a_jour ?? INPI.derniere_maj)}\r\n            </li>\r\n            <li>\r\n              INSEE/SIRENE â€” SIREN {show(siren)}, SIRET {show(siret)}, APE {show(ape)}\r\n            </li>\r\n            <li>\r\n              URSSAF â€” {show(urssafStatut)}\r\n              {urssafNumero ? `, nÂ° ${urssafNumero}` : \"\"}\r\n            </li>\r\n            <li>RNE â€” {show(RNE.inscription ?? RNE.statut)}</li>\r\n          </ul>\r\n        </div>\r\n\r\n        {/* ConformitÃ© */}\r\n        {check && Object.keys(check).length > 0 && (\r\n          <div>\r\n            <h5 className=\"font-medium text-green-800 mb-2\">âœ… ConformitÃ© (checklist)</h5>\r\n            <div className=\"grid md:grid-cols-2 gap-2 text-sm\">\r\n              {Object.entries(check).map(([k, v]) => {\r\n                const ok = v === \"ok\" || v === true || v === 1 || (typeof v === \"string\" && v.toLowerCase() === \"true\");\r\n                const ko = v === \"ko\" || v === false || v === 0 || (typeof v === \"string\" && v.toLowerCase() === \"false\");\r\n                return (\r\n                  <div key={k} className=\"flex items-center gap-2\">\r\n                    <span className={ok ? \"text-green-600\" : ko ? \"text-red-600\" : \"text-gray-500\"}>\r\n                      {ok ? \"âœ…\" : ko ? \"âŒ\" : \"â€”\"}\r\n                    </span>\r\n                    <span>{k.replace(/_/g, \" \")}: {show(v)}</span>\r\n                  </div>\r\n                );\r\n              })}\r\n            </div>\r\n          </div>\r\n        )}\r\n\r\n        {/* Documents gÃ©nÃ©rÃ©s */}\r\n        <div>\r\n          <h5 className=\"font-medium text-gray-800 mb-2\">ğŸ“‹ Documents gÃ©nÃ©rÃ©s</h5>\r\n          {docs.length ? (\r\n            <ul className=\"space-y-1 text-sm\">\r\n              {docs.map((d, i) => (\r\n                <li key={i}>\r\n                  {fmt(d.date)} â€” {show(d.type)} â€” {show(d.fichier)} â€” source {show(d.source)}\r\n                </li>\r\n              ))}\r\n            </ul>\r\n          ) : (\r\n            <p className=\"text-sm text-gray-600\">â€”</p>\r\n          )}\r\n        </div>\r\n\r\n        {/* Scraping jobs */}\r\n        <div>\r\n          <h5 className=\"font-medium text-gray-800 mb-2\">ğŸ•¸ï¸ Scraping jobs</h5>\r\n          {jobs.length ? (\r\n            <ul className=\"space-y-1 text-sm\">\r\n              {jobs.map((j) => (\r\n                <li key={j.id ?? `${j.portail}-${j.updated_at ?? \"\"}`}>\r\n                  {show(j.portail)} â€” {show(j.etat)} â€” {show(j.last_event)} â€” MAJ {fmt(j.updated_at)}\r\n                </li>\r\n              ))}\r\n            </ul>\r\n          ) : (\r\n            <p className=\"text-sm text-gray-600\">â€”</p>\r\n          )}\r\n        </div>\r\n\r\n        {/* Dossiers reliÃ©s */}\r\n        <div>\r\n          <h5 className=\"font-medium text-gray-800 mb-2\">ğŸ“‚ Dossiers reliÃ©s</h5>\r\n          {dossiers.length ? (\r\n            <ul className=\"space-y-1 text-sm\">\r\n              {dossiers.map((d) => (\r\n                <li key={d.id}>\r\n                  Dossier #{show(d.id)} â€” statut {show(d.statut)} â€” client{\" \"}\r\n                  {d.client_id ? (\r\n                    <Link className=\"underline\" href={`/crm/clients/${d.client_id}`}>#{show(d.client_id)}</Link>\r\n                  ) : \"â€”\"}\r\n                </li>\r\n              ))}\r\n            </ul>\r\n          ) : (\r\n            <p className=\"text-sm text-gray-600\">â€”</p>\r\n          )}\r\n        </div>\r\n      </div>\r\n    </section>\r\n  );\r\n}\r\n"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 4663, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/giorn/Desktop/Projet/Medina/Micro_entreprise/Mockfront/ME-main/app/%28crm%29/crm/dashboard/page.js"],"sourcesContent":["\"use client\";\r\n\r\nimport { useEffect, useMemo, useState } from \"react\";\r\nimport Link from \"next/link\";\r\n\r\n/* ====== COMPOSANTS RÃ‰UTILISÃ‰S (chemins relatifs depuis /dashboard) ====== */\r\nimport DossierTimeline from \"../clients/[id]/DossierTimeline\";\r\nimport ClientIdentityCard from \"../clients/[id]/ClientIdentityCard\";\r\nimport PiecesJustificativesCard from \"../clients/[id]/PiecesJustificativesCard\";\r\nimport CommsHistory from \"../clients/[id]/CommsHistory\";\r\nimport ClientMessaging from \"../clients/[id]/ClientMessaging\";\r\n\r\n// ğŸ‘‰ cÃ´tÃ© partenaire\r\nimport PartnerTracking from \"../partenaires/[id]/PartnerTracking\";\r\nimport InvoicesCommissionsCard from \"../partenaires/[id]/InvoicesCommissionsCard\";\r\n\r\n// ğŸ‘‰ carte entreprise existante\r\nimport EntrepriseCard from \"../entreprises/[id]/EntrepriseCard\";\r\n\r\n\r\n/* ====== UTILS ====== */\r\nfunction parseISO(d){ return d ? new Date(d) : null; }\r\nfunction inRange(d, from, to){\r\n  if (!d) return true;\r\n  const dt = typeof d === \"string\" ? new Date(d) : d;\r\n  if (from && dt < from) return false;\r\n  if (to) { const end = new Date(to); end.setHours(23,59,59,999); if (dt > end) return false; }\r\n  return true;\r\n}\r\nconst fmt = (d) => d ? new Date(d).toLocaleString(\"fr-FR\") : \"-\";\r\nfunction euro(n){ if(n === 0) return \"0â‚¬\"; if(n == null) return \"â€”\"; return `${Number(n).toLocaleString(\"fr-FR\")}â‚¬`; }\r\nfunction safe(s){ return s ?? \"â€”\"; }\r\n\r\n/* ====== CARTES ALERTE & ACTIVITÃ‰ ====== */\r\nfunction AlertCard({ alert, onAction }) {\r\n  const getAlertStyle = (priority) => {\r\n    switch (priority) {\r\n      case 'critical': return 'border-red-500 bg-red-50';\r\n      case 'important': return 'border-orange-500 bg-orange-50';\r\n      case 'info': return 'border-blue-500 bg-blue-50';\r\n      default: return 'border-gray-500 bg-gray-50';\r\n    }\r\n  };\r\n  const getAlertIcon = (priority) => {\r\n    switch (priority) {\r\n      case 'critical': return 'ğŸ”´';\r\n      case 'important': return 'ğŸŸ¡';\r\n      case 'info': return 'ğŸ”µ';\r\n      default: return 'âšª';\r\n    }\r\n  };\r\n  return (\r\n    <div className={`border-l-4 p-3 rounded ${getAlertStyle(alert.priority)}`}>\r\n      <div className=\"flex items-center justify-between mb-2\">\r\n        <div className=\"flex items-center gap-2\">\r\n          <span>{getAlertIcon(alert.priority)}</span>\r\n          <span className=\"font-semibold\">{alert.title}</span>\r\n        </div>\r\n        <button \r\n          className=\"text-xs bg-white px-2 py-1 rounded border\"\r\n          onClick={() => onAction(alert)}\r\n        >\r\n          {alert.action === 'traiter' ? 'ğŸ”§ Traiter' : \r\n           alert.action === 'assigner' ? 'ğŸ‘¤ Assigner' :\r\n           alert.action === 'relancer' ? 'ğŸ“ Relancer' : 'ğŸ‘€ Voir'}\r\n        </button>\r\n      </div>\r\n      <p className=\"text-sm text-gray-600 mb-2\">{alert.description}</p>\r\n      {alert.items && alert.items.length > 0 && (\r\n        <div className=\"space-y-1\">\r\n          {alert.items.slice(0, 3).map((item, i) => (\r\n            <div key={i} className=\"text-xs bg-white p-2 rounded\">\r\n              <Link href={item.link} className=\"font-medium text-blue-600 hover:underline\">\r\n                {item.label}\r\n              </Link>\r\n              <div className=\"text-gray-500\">{item.detail}</div>\r\n            </div>\r\n          ))}\r\n          {alert.items.length > 3 && (\r\n            <div className=\"text-xs text-gray-500 text-center\">\r\n              +{alert.items.length - 3} autres...\r\n            </div>\r\n          )}\r\n        </div>\r\n      )}\r\n    </div>\r\n  );\r\n}\r\n\r\nfunction ActivityCard({ activity }) {\r\n  const getActivityColor = (color) => {\r\n    switch (color) {\r\n      case 'blue': return 'border-l-blue-500 bg-blue-50';\r\n      case 'green': return 'border-l-green-500 bg-green-50';\r\n      case 'yellow': return 'border-l-yellow-500 bg-yellow-50';\r\n      case 'orange': return 'border-l-orange-500 bg-orange-50';\r\n      default: return 'border-l-gray-500 bg-gray-50';\r\n    }\r\n  };\r\n  return (\r\n    <div className={`border-l-4 p-2 rounded ${getActivityColor(activity.color)}`}>\r\n      <div className=\"flex items-center justify-between\">\r\n        <div className=\"flex items-center gap-2\">\r\n          <span>{activity.icon}</span>\r\n          <Link href={activity.link} className=\"font-medium text-blue-600 hover:underline\">\r\n            {activity.title}\r\n          </Link>\r\n        </div>\r\n        <span className=\"text-xs text-gray-500\">\r\n          {fmt(activity.timestamp).replace(/:\\d{2}$/, '')}\r\n        </span>\r\n      </div>\r\n      <div className=\"text-sm text-gray-600 ml-6\">{activity.description}</div>\r\n      {activity.detail && (\r\n        <div className=\"text-xs text-gray-500 ml-6 mt-1\">{activity.detail}</div>\r\n      )}\r\n    </div>\r\n  );\r\n}\r\n\r\n/* ====== PAGE DASHBOARD ====== */\r\nexport default function Dashboard() {\r\n  // Ã‰tats filtres & data\r\n  const [status, setStatus] = useState(\"all\");\r\n  const [partnerId, setPartnerId] = useState(\"all\");\r\n  const [operatorId, setOperatorId] = useState(\"all\");\r\n  const [dateFrom, setDateFrom] = useState(\"\");\r\n  const [dateTo, setDateTo] = useState(\"\");\r\n  const [data, setData] = useState(null);\r\n  const [err, setErr] = useState(null);\r\n  const isLoading = !data && !err;\r\n\r\n  // Alertes & activitÃ©s\r\n  const [alerts, setAlerts] = useState(null);\r\n  const [activities, setActivities] = useState([]);\r\n  const [alertsLoading, setAlertsLoading] = useState(true);\r\n  const [showAllAlerts, setShowAllAlerts] = useState(false);\r\n\r\n  // Charger le dashboard\r\n  async function load() {\r\n    const qs = new URLSearchParams();\r\n    if (status !== \"all\") qs.set(\"status\", status);\r\n    if (partnerId !== \"all\") qs.set(\"partnerId\", partnerId);\r\n    if (operatorId !== \"all\") qs.set(\"operatorId\", operatorId);\r\n    if (dateFrom) qs.set(\"from\", dateFrom);\r\n    if (dateTo) qs.set(\"to\", dateTo);\r\n    setErr(null);\r\n    try {\r\n      const r = await fetch(`/api/dashboard?${qs.toString()}`, { cache: \"no-store\" });\r\n      if (!r.ok) throw new Error(`HTTP ${r.status}`);\r\n      const json = await r.json();\r\n      setData(json);\r\n    } catch (e) {\r\n      setErr(String(e));\r\n    }\r\n  }\r\n\r\n  // Alertes + activitÃ©s\r\n  async function loadAlerts() {\r\n    setAlertsLoading(true);\r\n    try {\r\n      const [alertsRes, activitiesRes] = await Promise.all([\r\n        fetch(\"/api/alerts\", { cache: \"no-store\" }),\r\n        fetch(\"/api/recent-activities\", { cache: \"no-store\" })\r\n      ]);\r\n      if (alertsRes.ok) setAlerts(await alertsRes.json());\r\n      if (activitiesRes.ok) {\r\n        const a = await activitiesRes.json();\r\n        setActivities(a.activities || []);\r\n      }\r\n    } catch (e) {\r\n      console.error(\"Erreur chargement alertes:\", e);\r\n    } finally {\r\n      setAlertsLoading(false);\r\n    }\r\n  }\r\n\r\n  useEffect(() => {\r\n    load();\r\n    loadAlerts();\r\n    // eslint-disable-next-line react-hooks/exhaustive-deps\r\n  }, [status, partnerId, operatorId, dateFrom, dateTo]);\r\n\r\n  // Actions\r\n  async function changeStatut(dossierId, newStatut) {\r\n    await fetch(`/api/dossiers/${dossierId}`, {\r\n      method: \"PATCH\",\r\n      headers: { \"Content-Type\": \"application/json\" },\r\n      body: JSON.stringify({ statut: newStatut })\r\n    });\r\n    await load();\r\n    await loadAlerts();\r\n  }\r\n\r\n  async function createTicket(dossierId, clientNom) {\r\n    const subject = prompt(\"Sujet du ticket:\", `Support client ${clientNom || 'Inconnu'}`);\r\n    if (!subject) return;\r\n    try {\r\n      await fetch(`/api/tickets`, {\r\n        method: \"POST\",\r\n        headers: { \"Content-Type\": \"application/json\" },\r\n        body: JSON.stringify({\r\n          dossier_id: dossierId,\r\n          subject,\r\n          priorite: \"Moyenne\",\r\n          message: \"Ticket crÃ©Ã© depuis le dashboard CRM\"\r\n        })\r\n      });\r\n      await load();\r\n      await loadAlerts();\r\n    } catch (e) {\r\n      console.error(\"Erreur crÃ©ation ticket:\", e);\r\n      alert(\"Erreur lors de la crÃ©ation du ticket\");\r\n    }\r\n  }\r\n\r\n  async function planRelance(dossierId, clientId) {\r\n    const in1h = new Date(Date.now() + 60 * 60 * 1000).toISOString();\r\n    await fetch(`/api/notifications`, {\r\n      method: \"POST\",\r\n      headers: { \"Content-Type\": \"application/json\" },\r\n      body: JSON.stringify({\r\n        type: \"relance_piece\",\r\n        client_id: clientId,\r\n        dossier_id: dossierId,\r\n        canal: \"email\",\r\n        scheduled_for: in1h\r\n      })\r\n    });\r\n    await load();\r\n  }\r\n\r\n  async function exportDossiers() {\r\n    const qs = new URLSearchParams();\r\n    if (status !== \"all\") qs.set(\"status\", status);\r\n    if (partnerId !== \"all\") qs.set(\"partnerId\", partnerId);\r\n    if (operatorId !== \"all\") qs.set(\"operatorId\", operatorId);\r\n    if (dateFrom) qs.set(\"from\", dateFrom);\r\n    if (dateTo) qs.set(\"to\", dateTo);\r\n    qs.set(\"format\", \"csv\");\r\n    try {\r\n      const url = `/api/exports/dossiers?${qs.toString()}`;\r\n      const link = document.createElement(\"a\");\r\n      link.href = url;\r\n      link.download = `dossiers_${new Date().toISOString().slice(0,10)}.csv`;\r\n      document.body.appendChild(link);\r\n      link.click();\r\n      document.body.removeChild(link);\r\n    } catch (e) {\r\n      console.error(\"Erreur export:\", e);\r\n      alert(\"Erreur lors de l'export\");\r\n    }\r\n  }\r\n\r\n  // â€¦dans Dashboard(), aprÃ¨s tes autres fonctions (changeStatut, createTicket, planRelance, exportDossiers) :\r\n\r\nfunction handleAlertAction(a) {\r\n  switch (a.action) {\r\n    case \"traiter\":\r\n      // Exemple : redirige les filtres en fonction du type dâ€™alerte\r\n      if (a.type === \"dossiers_blocked\") setStatus(\"en_attente\");\r\n      if (a.type === \"dossiers_a_corriger\") setStatus(\"a_corriger\");\r\n      break;\r\n\r\n    case \"assigner\":\r\n      window.location.href = \"/crm/tickets?priorite=Haute\";\r\n      break;\r\n\r\n    case \"relancer\":\r\n      window.alert(\"FonctionnalitÃ© de relance Ã  implÃ©menter\");\r\n      break;\r\n\r\n    default:\r\n      if (a.items && a.items.length > 0) {\r\n        window.location.href = a.items[0].link;\r\n      }\r\n  }\r\n}\r\n\r\n\r\n  // RÃ©fÃ©rentiels\r\n  const partners = data?.partenaires ?? [];\r\n  const operators = data?.operateurs ?? [];\r\n  const dossiers = data?.dossiers ?? [];\r\n  const clients = data?.clients ?? [];\r\n  const statusesRef = data?.refs?.statuts_dossier ?? [];\r\n  const notifications = data?.notifications_queue ?? [];\r\n  const authLogs = data?.auth_logs ?? [];\r\n\r\n  // Filtres\r\n  const filtered = useMemo(() => {\r\n    const from = dateFrom ? parseISO(dateFrom) : null;\r\n    const to = dateTo ? parseISO(dateTo) : null;\r\n    return dossiers.filter((d) => {\r\n      const okStatus = status === \"all\" ? true : d.statut === status;\r\n      const okPartner = partnerId === \"all\" ? true : String(d.partenaireId) === String(partnerId);\r\n      const okOperator = operatorId === \"all\" ? true : String(d.operateurId) === String(operatorId);\r\n      const okDate = inRange(d.date_creation, from, to);\r\n      return okStatus && okPartner && okOperator && okDate;\r\n    });\r\n  }, [dossiers, status, partnerId, operatorId, dateFrom, dateTo]);\r\n\r\n  const kpis = useMemo(() => {\r\n    const counts = {};\r\n    (statusesRef.length ? statusesRef : Array.from(new Set(dossiers.map(d => d.statut))))\r\n      .forEach(s => counts[s] = 0);\r\n    filtered.forEach(d => counts[d.statut] = (counts[d.statut] || 0) + 1);\r\n    return counts;\r\n  }, [filtered, dossiers, statusesRef]);\r\n\r\n  const clientById = (id) => clients.find(c => String(c.id) === String(id));\r\n  const partById = (id) => partners.find(p => String(p.id) === String(id));\r\n  const resetFilters = () => { setStatus(\"all\"); setPartnerId(\"all\"); setOperatorId(\"all\"); setDateFrom(\"\"); setDateTo(\"\"); };\r\n\r\n  if (err) return <main className=\"p-6\"><h1 className=\"text-xl font-bold\">Erreur</h1><pre className=\"mt-2\">{err}</pre></main>;\r\n  if (isLoading) return <main className=\"p-6\">Chargementâ€¦</main>;\r\n\r\n  // Alertes Ã  afficher\r\n  const allAlerts = alerts ? [\r\n    ...alerts.alerts.critical,\r\n    ...alerts.alerts.important,\r\n    ...(showAllAlerts ? alerts.alerts.info : [])\r\n  ] : [];\r\n\r\n  return (\r\n    <main className=\"p-6 space-y-8\">\r\n      <div className=\"flex items-center gap-3\">\r\n        <h1 className=\"text-2xl font-bold\">CRM â€” Dashboard</h1>\r\n        <Link href=\"/crm/tickets\" className=\"text-sm text-blue-600 underline\">â†’ Voir tous les tickets</Link>\r\n        <button onClick={loadAlerts} className=\"text-sm bg-blue-600 text-white px-3 py-1 rounded\" disabled={alertsLoading}>\r\n          {alertsLoading ? \"ğŸ”„\" : \"ğŸ”„ Actualiser alertes\"}\r\n        </button>\r\n      </div>\r\n\r\n      {/* ğŸš¨ ALERTES */}\r\n      {alerts && (\r\n        <section className=\"space-y-4\">\r\n          <div className=\"flex items-center justify-between\">\r\n            <h2 className=\"text-xl font-semibold\">ğŸš¨ Alertes prioritaires</h2>\r\n            <div className=\"flex gap-2 text-sm\">\r\n              {alerts.summary.critical > 0 && <span className=\"bg-red-100 text-red-800 px-2 py-1 rounded\">ğŸ”´ {alerts.summary.critical} critiques</span>}\r\n              {alerts.summary.important > 0 && <span className=\"bg-orange-100 text-orange-800 px-2 py-1 rounded\">ğŸŸ¡ {alerts.summary.important} importantes</span>}\r\n              {alerts.summary.info > 0 && <span className=\"bg-blue-100 text-blue-800 px-2 py-1 rounded\">ğŸ”µ {alerts.summary.info} info</span>}\r\n            </div>\r\n          </div>\r\n\r\n          {allAlerts.length === 0 ? (\r\n            <div className=\"bg-green-50 border border-green-200 rounded p-4 text-center\">\r\n              âœ… Aucune alerte critique ou importante ! Tout va bien.\r\n            </div>\r\n          ) : (\r\n            <div className=\"grid md:grid-cols-2 gap-4\">\r\n              {allAlerts.map(alert => (\r\n                <AlertCard key={alert.id} alert={alert} onAction={handleAlertAction} />\r\n              ))}\r\n            </div>\r\n          )}\r\n\r\n          {alerts.summary.info > 0 && !showAllAlerts && (\r\n            <div className=\"text-center\">\r\n              <button onClick={() => setShowAllAlerts(true)} className=\"text-sm text-blue-600 underline\">\r\n                + Voir les {alerts.summary.info} alertes informatives\r\n              </button>\r\n            </div>\r\n          )}\r\n        </section>\r\n      )}\r\n\r\n      {/* ğŸ“Š ACTIVITÃ‰S */}\r\n      {activities.length > 0 && (\r\n        <section>\r\n          <h2 className=\"text-xl font-semibold mb-4\">ğŸ“Š ActivitÃ© rÃ©cente</h2>\r\n          <div className=\"grid md:grid-cols-2 gap-3\">\r\n            {activities.slice(0, 6).map((activity, i) => (\r\n              <ActivityCard key={i} activity={activity} />\r\n            ))}\r\n          </div>\r\n          {activities.length > 6 && (\r\n            <div className=\"text-center mt-3\">\r\n              <Link href=\"/crm/activities\" className=\"text-sm text-blue-600 underline\">Voir toute l'activitÃ© â†’</Link>\r\n            </div>\r\n          )}\r\n        </section>\r\n      )}\r\n\r\n      {/* FILTRES */}\r\n      <section className=\"border rounded p-4 space-y-3\">\r\n        <div className=\"grid md:grid-cols-5 gap-3\">\r\n          <label className=\"flex flex-col text-sm\">\r\n            <span className=\"mb-1 font-medium\">Statut</span>\r\n            <select className=\"border rounded p-2\" value={status} onChange={(e)=>setStatus(e.target.value)}>\r\n              <option value=\"all\">Tous</option>\r\n              {(statusesRef.length ? statusesRef : Array.from(new Set(dossiers.map(d=>d.statut)))).map(s => (\r\n                <option key={s} value={s}>{s}</option>\r\n              ))}\r\n            </select>\r\n          </label>\r\n\r\n          <label className=\"flex flex-col text-sm\">\r\n            <span className=\"mb-1 font-medium\">Partenaire</span>\r\n            <select className=\"border rounded p-2\" value={partnerId} onChange={(e)=>setPartnerId(e.target.value)}>\r\n              <option value=\"all\">Tous</option>\r\n              {partners.map(p => <option key={p.id} value={p.id}>{p.nom}</option>)}\r\n            </select>\r\n          </label>\r\n\r\n          <label className=\"flex flex-col text-sm\">\r\n            <span className=\"mb-1 font-medium\">OpÃ©rateur</span>\r\n            <select className=\"border rounded p-2\" value={operatorId} onChange={(e)=>setOperatorId(e.target.value)}>\r\n              <option value=\"all\">Tous</option>\r\n              {operators.map(o => <option key={o.id} value={o.id}>{o.nom}</option>)}\r\n            </select>\r\n          </label>\r\n\r\n          <label className=\"flex flex-col text-sm\">\r\n            <span className=\"mb-1 font-medium\">Du</span>\r\n            <input type=\"date\" className=\"border rounded p-2\" value={dateFrom} onChange={(e)=>setDateFrom(e.target.value)} />\r\n          </label>\r\n\r\n          <label className=\"flex flex-col text-sm\">\r\n            <span className=\"mb-1 font-medium\">Au</span>\r\n            <input type=\"date\" className=\"border rounded p-2\" value={dateTo} onChange={(e)=>setDateTo(e.target.value)} />\r\n          </label>\r\n        </div>\r\n\r\n        <div className=\"flex gap-3\">\r\n          <button className=\"border rounded px-3 py-2\" onClick={resetFilters}>RÃ©initialiser</button>\r\n          <button className=\"bg-green-600 text-white px-3 py-2 rounded\" onClick={exportDossiers}>\r\n            ğŸ“Š Exporter CSV ({filtered.length})\r\n          </button>\r\n          <div className=\"text-sm text-gray-600 self-center\">{filtered.length} dossier(s) sur {dossiers.length}</div>\r\n        </div>\r\n      </section>\r\n\r\n      {/* KPIs */}\r\n      <section>\r\n        <h2 className=\"text-xl font-semibold mb-2\">KPIs dossiers (filtrÃ©s)</h2>\r\n        <div className=\"flex gap-3 flex-wrap\">\r\n          {Object.entries(kpis).map(([s, n]) => (\r\n            <div key={s} className=\"border rounded p-3\">\r\n              <div className=\"text-sm text-gray-600\">{s}</div>\r\n              <div className=\"text-2xl font-bold\">{n}</div>\r\n            </div>\r\n          ))}\r\n          <div className=\"border rounded p-3\">\r\n            <div className=\"text-sm text-gray-600\">Total</div>\r\n            <div className=\"text-2xl font-bold\">{filtered.length}</div>\r\n          </div>\r\n        </div>\r\n      </section>\r\n\r\n      {/* LISTE DOSSIERS */}\r\n      <section>\r\n        <h2 className=\"text-xl font-semibold mb-2\">Dossiers</h2>\r\n        {filtered.length === 0 ? (\r\n          <p className=\"text-sm text-gray-600\">Aucun rÃ©sultat avec ces filtres.</p>\r\n        ) : (\r\n          <ul className=\"list-disc pl-6 space-y-3\">\r\n            {filtered.map(d => {\r\n              const client = clientById(d.clientId);\r\n              return (\r\n                <DossierRow\r\n                  key={d.id}\r\n                  dossier={d}\r\n                  client={client}\r\n                  partner={partById(d.partenaireId)}\r\n                  changeStatut={changeStatut}\r\n                  createTicket={createTicket}\r\n                  planRelance={planRelance}\r\n                />\r\n              );\r\n            })}\r\n          </ul>\r\n        )}\r\n      </section>\r\n\r\n      {/* NOTIFS */}\r\n      <section>\r\n        <h2 className=\"text-xl font-semibold mb-2\">Notifications & relances programmÃ©es</h2>\r\n        <ul className=\"list-disc pl-6 space-y-1\">\r\n          {notifications.length ? notifications.map((n) => (\r\n            <li key={n.id}>\r\n              {n.type} â€” client{\" \"}\r\n              <Link className=\"underline\" href={`/crm/clients/${n.clientId}`}>\r\n                #{n.clientId}\r\n              </Link>{\" \"}\r\n              â€” <span className=\"italic text-gray-700\">\"{n.message || \"â€”\"}\"</span> â€” dossier #{n.dossierId} â€” {n.canal} â€” prÃ©vu le{\" \"}\r\n              {new Date(n.scheduled_for).toLocaleString(\"fr-FR\")}\r\n            </li>\r\n          )) : (\r\n            <li>Aucune notification programmÃ©e.</li>\r\n          )}\r\n        </ul>\r\n      </section>\r\n\r\n\r\n      {/* TICKETS */}\r\n      <section>\r\n        <h2 className=\"text-xl font-semibold mb-2\">Tickets rÃ©cents</h2>\r\n        <div className=\"text-sm\">\r\n          <Link href=\"/crm/tickets\" className=\"underline\">Voir tous les tickets â†’</Link>\r\n        </div>\r\n      </section>\r\n\r\n      {/* LOGS */}\r\n      <section>\r\n        <h2 className=\"text-xl font-semibold mb-2\">Connexions (sÃ©curitÃ©)</h2>\r\n        <ul className=\"list-disc pl-6 space-y-1\">\r\n          {authLogs.length ? authLogs.map((l,i) => (\r\n            <li key={i}>{l.at} â€” {l.role} {l.who} â€” {l.action} â€” {l.success ? \"âœ…\" : \"âŒ\"} â€” IP {l.ip}</li>\r\n          )) : <li>Aucune entrÃ©e</li>}\r\n        </ul>\r\n      </section>\r\n    </main>\r\n  );\r\n}\r\n\r\n\r\n\r\n\r\nfunction DossierRow({ dossier, client, partner, changeStatut, createTicket, planRelance }) {\r\n  const [showRelanceModal, setShowRelanceModal] = useState(false);\r\n  const [relanceMessage, setRelanceMessage] = useState(\"\");\r\n\r\n  async function envoyerRelance() {\r\n  try {\r\n    const res = await fetch(`/api/notifications`, {\r\n      method: \"POST\",\r\n      headers: { \"Content-Type\": \"application/json\" },\r\n      body: JSON.stringify({\r\n        type: \"relance_piece\",\r\n        client_id: dossier.clientId,\r\n        dossier_id: dossier.id,\r\n        canal: \"email\",\r\n        scheduled_for: new Date().toISOString(),\r\n        message: relanceMessage || \"Pas de message fourni\"\r\n      }),\r\n    });\r\n\r\n    if (!res.ok) throw new Error(`HTTP ${res.status}`);\r\n    \r\n    // âœ… AJOUTEZ CES LIGNES :\r\n    // Recharger les donnÃ©es du client pour voir la nouvelle notification\r\n    if (details && dossier.clientId) {\r\n      const r = await fetch(`/api/clients/${dossier.clientId}`, { cache: \"no-store\" });\r\n      if (r.ok) {\r\n        const updatedData = await r.json();\r\n        setDetails(updatedData); // Mettre Ã  jour les dÃ©tails\r\n      }\r\n    }\r\n    \r\n    alert(\"âœ… Relance envoyÃ©e !\");\r\n    setShowRelanceModal(false);\r\n    setRelanceMessage(\"\");\r\n  } catch (e) {\r\n    console.error(\"Erreur relance:\", e);\r\n    alert(\"âŒ Impossible d'envoyer la relance\");\r\n  }\r\n}\r\n\r\n\r\n\r\n  const [open, setOpen] = useState(false);               // panneau client/dossier\r\n  const [loading, setLoading] = useState(false);\r\n  const [err, setErr] = useState(null);\r\n  const [details, setDetails] = useState(null);\r\n\r\n  // ğŸ¢ Ã‰tat pour la fiche entreprise inline (CE QUI MANQUAIT)\r\n  const [entrepriseCard, setEntrepriseCard] = useState(null);\r\n  const [entrepriseCardLoading, setEntrepriseCardLoading] = useState(false);\r\n  const [entrepriseCardErr, setEntrepriseCardErr] = useState(null);\r\n\r\n  // ğŸ‘‡ panneau partenaire (au clic sur le nom)\r\n  const [pOpen, setPOpen] = useState(false);\r\n  const [pLoading, setPLoading] = useState(false);\r\n  const [pErr, setPErr] = useState(null);\r\n  const [pDetails, setPDetails] = useState(null);\r\n\r\n  // charge fiche client/dossier quand on ouvre \"Voir plus\"\r\n  async function toggle() {\r\n    if (open) { setOpen(false); return; }\r\n    setOpen(true);\r\n    if (details) return; // dÃ©jÃ  chargÃ©\r\n    try {\r\n      setLoading(true); setErr(null);\r\n      const r = await fetch(`/api/clients/${dossier.clientId}`, { cache: \"no-store\" });\r\n      const j = await r.json();\r\n      if (!r.ok) throw new Error(j.error || `HTTP ${r.status}`);\r\n      setDetails(j);\r\n    } catch (e) {\r\n      setErr(String(e.message || e));\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  }\r\n\r\n  useEffect(() => {\r\n    if (!open) return;\r\n    const eid = dossier?.entrepriseId;\r\n    if (!eid || entrepriseCard) return; // dÃ©jÃ  chargÃ© ou pas d'entreprise\r\n\r\n    let cancelled = false;\r\n    (async () => {\r\n      try {\r\n        setEntrepriseCardLoading(true);\r\n        const r = await fetch(`/api/entreprises/${eid}`, { cache: \"no-store\" });\r\n        const j = await r.json().catch(() => ({}));\r\n        if (!r.ok) throw new Error(j.error || r.statusText);\r\n        if (!cancelled) setEntrepriseCard(j);\r\n      } catch (e) {\r\n        if (!cancelled) setEntrepriseCardErr(String(e.message || e));\r\n      } finally {\r\n        if (!cancelled) setEntrepriseCardLoading(false);\r\n      }\r\n    })();\r\n\r\n    return () => { cancelled = true; };\r\n  }, [open, dossier?.entrepriseId, entrepriseCard]); // âš ï¸ taille FIXE (3)\r\n\r\n  // charge fiche partenaire quand on clique sur le nom\r\n  async function togglePartner(e) {\r\n    e.preventDefault();\r\n    e.stopPropagation();\r\n    if (pOpen) { setPOpen(false); return; }\r\n    setPOpen(true);\r\n    if (pDetails) return; // dÃ©jÃ  chargÃ©\r\n    try {\r\n      setPLoading(true); setPErr(null);\r\n      const r = await fetch(`/api/partenaires/${dossier.partenaireId}`, { cache: \"no-store\" });\r\n      const j = await r.json().catch(() => ({}));\r\n      if (!r.ok) throw new Error(j.error || r.statusText);\r\n      setPDetails(j);\r\n    } catch (e) {\r\n      setPErr(String(e.message || e));\r\n    } finally {\r\n      setPLoading(false);\r\n    }\r\n  }\r\n\r\n  const clientNom = client ? `${client.prenom ?? \"\"} ${client.nom ?? \"\"}`.trim() || `#${client.id}` : `#${dossier.clientId}`;\r\n\r\n  // helpers partenaire\r\n  const p = pDetails?.partenaire || {};\r\n  const docs = p.docs || {};\r\n\r\n  return (\r\n    <li className=\"space-y-2\">\r\n      {/* â€”â€”â€” LIGNE RÃ‰SUMÃ‰ â€”â€”â€” */}\r\n      <div className=\"flex flex-wrap items-center gap-2\">\r\n        <span className=\"font-semibold\">#{dossier.id}</span>\r\n        <span>â€” statut: {dossier.statut}</span>\r\n        <span>â€” crÃ©Ã©: {dossier.date_creation}</span>\r\n        <span>â€” modif: {dossier.derniere_modification ?? \"-\"}</span>\r\n        <span>â€” client: {client ? clientNom : dossier.clientId}</span>\r\n\r\n        {/* ğŸ‘‡ rend le nom partenaire cliquable pour ouvrir le panneau partenaire inline */}\r\n        <span>\r\n          â€” partenaire:{\" \"}\r\n          <button\r\n            type=\"button\"\r\n            onClick={togglePartner}\r\n            className=\"underline text-blue-600 hover:text-blue-800\"\r\n            title=\"Afficher les infos du partenaire\"\r\n          >\r\n            {partner ? partner.nom : dossier.partenaireId}\r\n          </button>\r\n        </span>\r\n\r\n        <span>â€” entreprise: #{dossier.entrepriseId}</span>\r\n        {(dossier.blocages || []).length ? <span>â€” blocages: {(dossier.blocages || []).join(\", \")}</span> : null}\r\n        <span>â€” commission: {dossier.commission_partenaire_eur ?? 0}â‚¬</span>\r\n\r\n        {/* Actions */}\r\n        <div className=\"inline-flex gap-2 ml-2\">\r\n          <select\r\n            className=\"border rounded px-1 py-0.5 text-sm\"\r\n            value={dossier.statut}\r\n            onChange={(e) => changeStatut(dossier.id, e.target.value)}\r\n          >\r\n            {[\"nouveau\",\"en_cours\",\"en_attente\",\"a_corriger\",\"valide\",\"rejete\"].map(s => (\r\n              <option key={s} value={s}>{s}</option>\r\n            ))}\r\n          </select>\r\n\r\n          {/*<button className=\"border rounded px-2 py-0.5 text-sm\" onClick={() => createTicket(dossier.id, clientNom)}>+ Ticket</button>*/}\r\n\r\n         <button\r\n  className=\"border rounded px-2 py-0.5 text-sm\"\r\n  onClick={() => setShowRelanceModal(true)}\r\n>\r\n  ğŸ“© Relancer\r\n</button>\r\n\r\n{showRelanceModal && (\r\n  <div className=\"fixed inset-0 bg-black bg-opacity-40 flex items-center justify-center z-50\">\r\n    <div className=\"bg-white rounded-lg shadow-lg p-6 w-96\">\r\n      <h3 className=\"text-lg font-semibold mb-4\">Relancer le client</h3>\r\n      <textarea\r\n        value={relanceMessage}\r\n        onChange={(e) => setRelanceMessage(e.target.value)}\r\n        placeholder=\"Votre message...\"\r\n        className=\"border rounded w-full p-2 mb-4 h-24\"\r\n      />\r\n      <div className=\"flex justify-end gap-3\">\r\n        <button\r\n          onClick={() => setShowRelanceModal(false)}\r\n          className=\"px-3 py-1 rounded bg-gray-200 hover:bg-gray-300\"\r\n        >\r\n          Annuler\r\n        </button>\r\n        <button\r\n          onClick={envoyerRelance}\r\n          className=\"px-3 py-1 rounded bg-blue-600 text-white hover:bg-blue-700\"\r\n        >\r\n          Envoyer\r\n        </button>\r\n      </div>\r\n    </div>\r\n  </div>\r\n)}\r\n\r\n\r\n\r\n          {/* Voir plus -> ouvre le panneau inline (client/dossier) */}\r\n          <button className=\"border rounded px-2 py-0.5 text-sm\" onClick={toggle}>\r\n            {open ? \"Masquer\" : \"Voir plus\"}\r\n          </button>\r\n        </div>\r\n      </div>\r\n\r\n      {/* â€”â€”â€” PANNEAU PARTENAIRE INLINE (clic sur le nom) â€”â€”â€” */}\r\n      {pOpen && (\r\n        <div className=\"mt-2 border-l-2 pl-4\">\r\n          {pLoading && <div className=\"text-sm text-gray-500\">Chargementâ€¦</div>}\r\n          {pErr && <div className=\"text-sm text-red-600\">âŒ {pErr}</div>}\r\n\r\n          {!pLoading && !pErr && (\r\n            <div className=\"space-y-6\">\r\n              {/* En-tÃªte partenaire + infos clÃ©s */}\r\n              <section className=\"bg-gray-50 rounded p-3\">\r\n                <h4 className=\"font-semibold mb-1\">ğŸ¤ Partenaire</h4>\r\n                {p && Object.keys(p).length ? (\r\n                  <div className=\"text-sm\">\r\n                    <div><b>{p.nom || `#${dossier.partenaireId}`}</b> â€” segment {p.segment || \"â€”\"}</div>\r\n                    <div>RÃ©fÃ©rent: {p.referent?.nom || \"â€”\"} â€” {p.referent?.email || \"â€”\"} â€” {p.referent?.telephone || \"â€”\"}</div>\r\n                    <div>Taux commission: {p.taux_commission ?? \"â€”\"}% â€¢ Facturation: {p.type_facturation || \"â€”\"}</div>\r\n                    <div>Paiement: {p.paiement?.mode || \"â€”\"} â€¢ IBAN: {p.paiement?.iban ? `${p.paiement.iban.slice(0, 8)}â€¦` : \"â€”\"} â€¢ BIC: {p.paiement?.bic || \"â€”\"}</div>\r\n                    <div className=\"text-xs text-gray-500 mt-1\">\r\n                      Contrat: {p.contrat?.statut || \"â€”\"} â€¢ signÃ© le {p.contrat?.date_signature || \"â€”\"} â€¢ durÃ©e {p.contrat?.duree_mois ?? \"â€”\"} mois\r\n                    </div>\r\n                  </div>\r\n                ) : (\r\n                  <div className=\"text-sm text-gray-500\">â€”</div>\r\n                )}\r\n              </section>\r\n\r\n              {/* ğŸ“Š Tableau de Bord (commissions/factures) â€“ rÃ©utilise ton composant */}\r\n              <section>\r\n                <h4 className=\"font-semibold mb-2\">ğŸ“Š Tableau de Bord</h4>\r\n                <InvoicesCommissionsCard\r\n                  partnerId={dossier.partenaireId}\r\n                  data={pDetails}                 // â¬…ï¸ on passe le JSON dÃ©jÃ  chargÃ©: { partenaire, factures, ... }\r\n                />\r\n              </section>\r\n\r\n\r\n              {/* ğŸ“ˆ Suivi Commercial â€“ rÃ©utilise ton composant */}\r\n              <section>\r\n                <h4 className=\"font-semibold mb-2\">ğŸ“ˆ Suivi Commercial</h4>\r\n                <PartnerTracking partnerId={dossier.partenaireId} />\r\n              </section>\r\n\r\n              {/* ğŸ“ Espace documentaire */}\r\n              <section className=\"bg-gray-50 rounded p-3\">\r\n                <h4 className=\"font-semibold mb-1\">ğŸ“ Espace documentaire</h4>\r\n                {docs && (docs.contrat_pdf || docs.modalites_collaboration_pdf || (docs.documentation_tech || []).length) ? (\r\n                  <ul className=\"list-disc pl-5 text-sm\">\r\n                    <li>\r\n                      Contrat:{\" \"}\r\n                      {docs.contrat_pdf\r\n                        ? <a className=\"underline text-blue-600\" href={docs.contrat_pdf} target=\"_blank\" rel=\"noreferrer\">ouvrir</a>\r\n                        : \"â€”\"}\r\n                    </li>\r\n                    <li>\r\n                      ModalitÃ©s:{\" \"}\r\n                      {docs.modalites_collaboration_pdf\r\n                        ? <a className=\"underline text-blue-600\" href={docs.modalites_collaboration_pdf} target=\"_blank\" rel=\"noreferrer\">ouvrir</a>\r\n                        : \"â€”\"}\r\n                    </li>\r\n                    {(docs.documentation_tech || []).map((d, i) => (\r\n                      <li key={i}>{d.type || \"Doc\"} â€” {d.url ? <a className=\"underline text-blue-600\" href={d.url} target=\"_blank\" rel=\"noreferrer\">{d.url}</a> : \"â€”\"}</li>\r\n                    ))}\r\n                  </ul>\r\n                ) : (\r\n                  <div className=\"text-sm text-gray-500\">â€”</div>\r\n                )}\r\n              </section>\r\n\r\n              {/* ğŸ“‹ Informations dÃ©taillÃ©es */}\r\n              <section>\r\n                <h4 className=\"font-semibold mb-1\">ğŸ“‹ Informations dÃ©taillÃ©es</h4>\r\n                <ul className=\"list-disc pl-5 text-sm\">\r\n                  <li>Adresse: {p.adresse || \"â€”\"}</li>\r\n                  <li>Coord. facturation: {p.coordonnees_facturation?.societe || \"â€”\"} â€” {p.coordonnees_facturation?.email_facturation || \"â€”\"} â€” {p.coordonnees_facturation?.adresse || \"â€”\"}</li>\r\n                  <li>IntÃ©gration: {p.integration || \"â€”\"} â€¢ Segment: {p.segment || \"â€”\"}</li>\r\n                </ul>\r\n              </section>\r\n            </div>\r\n          )}\r\n        </div>\r\n      )}\r\n\r\n      {/* â€”â€”â€” PANNEAU CLIENT/DOSSIER INLINE (bouton Voir plus) â€”â€”â€” */}\r\n      {open && (\r\n        <div className=\"mt-2 border-l-2 pl-4\">\r\n          {loading && <div className=\"text-sm text-gray-500\">Chargementâ€¦</div>}\r\n          {err && <div className=\"text-sm text-red-600\">âŒ {err}</div>}\r\n\r\n          {details && (\r\n            <div className=\"space-y-6\">\r\n              {/* ğŸ‘¥ Suivi des clients (mini rÃ©sumÃ©) */}\r\n              <section className=\"bg-gray-50 rounded p-3\">\r\n                <h4 className=\"font-semibold mb-2\">ğŸ‘¥ Suivi des clients</h4>\r\n                <div className=\"text-sm\">\r\n                  <div>\r\n                    <b>{safe(details.client?.prenom)} {safe(details.client?.nom)}</b>{\" â€” \"}{safe(details.client?.email)}\r\n                    {details.client?.telephone ? ` â€¢ ${details.client.telephone}` : \"\"}\r\n                  </div>\r\n                  <div className=\"text-gray-600\">\r\n                    Dossier #{dossier.id} â€” statut {dossier.statut} â€” crÃ©Ã© {dossier.date_creation} â€” commission {euro(dossier.commission_partenaire_eur)}\r\n                  </div>\r\n                </div>\r\n              </section>\r\n\r\n              {/* â±ï¸ Timeline du dossier courant */}\r\n              <DossierTimeline dossier={(details.dossiers || []).find(dd => dd.id === dossier.id) || dossier} />\r\n\r\n              {/* ğŸ“¨ Historique (relances & notifications) */}\r\n              <section>\r\n                <h4 className=\"font-semibold mb-2\">ğŸ“¨ Historique (relances & notifications)</h4>\r\n                <CommsHistory\r\n                  communications={details.communications || details.historique_echanges || []}\r\n                  relances={details.relances || []}\r\n                  notifications={details.notifications || []}\r\n                  compact\r\n                />\r\n              </section>\r\n\r\n              {/* ğŸ’¬ Messagerie client */}\r\n              <ClientMessaging clientId={dossier.clientId} dossiers={details.dossiers || []} />\r\n\r\n              {/* ğŸ†” IdentitÃ© & adresses */}\r\n              <section>\r\n                <h4 className=\"font-semibold mb-2\">ğŸ†” IdentitÃ© & adresses</h4>\r\n                <ClientIdentityCard client={details.client} />\r\n              </section>\r\n\r\n              {/* ğŸ“„ PiÃ¨ces justificatives (+ tÃ©lÃ©chargements) */}\r\n              <section>\r\n                <h4 className=\"font-semibold mb-2\">ğŸ“„ PiÃ¨ces justificatives</h4>\r\n                <PiecesJustificativesCard\r\n                  pieces={details.pieces_justificatives || []}\r\n                  downloads={details.telechargements_disponibles || []}\r\n                />\r\n              </section>\r\n\r\n              {/* ğŸ¢ Mon entreprise â€” rÃ©utilise ton composant complet */}\r\n              <section className=\"bg-gray-50 rounded p-3\">\r\n                <h4 className=\"font-semibold mb-2\">ğŸ¢ Mon entreprise</h4>\r\n                {entrepriseCardLoading && <div className=\"text-sm text-gray-500\">Chargementâ€¦</div>}\r\n                {entrepriseCardErr && <div className=\"text-sm text-red-600\">âŒ {entrepriseCardErr}</div>}\r\n                {entrepriseCard ? (\r\n                  <EntrepriseCard data={entrepriseCard} />\r\n                ) : (\r\n                  !entrepriseCardLoading && <div className=\"text-sm text-gray-500\">â€”</div>\r\n                )}\r\n              </section>\r\n\r\n            </div>\r\n          )}\r\n        </div>\r\n      )}\r\n    </li>\r\n  );\r\n}\r\n"],"names":[],"mappings":"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","debugId":null}}]
}