{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 5, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/giorn/Desktop/Projet/Medina/Micro_entreprise/Mockfront/ME-main/app/%28crm%29/crm/clients/%5Bid%5D/DossierTimeline.js"],"sourcesContent":["\"use client\";\r\nimport { useState, useEffect, useMemo, useCallback } from \"react\";\r\n\r\n/* ---------- Utils globaux (hors composant) ---------- */\r\nconst fmt = (d) => (d ? new Date(d).toLocaleDateString(\"fr-FR\") : null);\r\nconst fmtDateTime = (d) => (d ? new Date(d).toLocaleString(\"fr-FR\") : null);\r\n\r\nconst STEP_ORDER = [\r\n  \"formulaire\",\r\n  \"pieces\",\r\n  \"mandat\",\r\n  \"transmission\",\r\n  \"traitement\",\r\n  \"siren\",\r\n  \"attestation\",\r\n];\r\n\r\nfunction computeProgress(steps) {\r\n  const total = steps.length;\r\n  const completed = steps.filter((s) => s.status === \"completed\").length;\r\n  const raw = total ? (completed / total) * 100 : 0;\r\n  return { completed, total, raw, percent: Math.round(raw) };\r\n}\r\n\r\n/* ---------- Composant ---------- */\r\nexport default function DossierTimeline({ dossier }) {\r\n  const [timelineData, setTimelineData] = useState(null);\r\n  const [loading, setLoading] = useState(true);\r\n  const [error, setError] = useState(null);\r\n\r\n  const [piecesData, setPiecesData] = useState(null); // { pieces_expected, pieces_state, summary, capabilities }\r\n  const [loadingPieces, setLoadingPieces] = useState(true);\r\n  const [uploadingStep, setUploadingStep] = useState(null);\r\n\r\n  /* ---------- Fetch ---------- */\r\n  useEffect(() => {\r\n    if (!dossier?.id) return;\r\n    loadTimelineData();\r\n    loadPiecesData();\r\n    // eslint-disable-next-line react-hooks/exhaustive-deps\r\n  }, [dossier?.id]);\r\n\r\n  const loadTimelineData = useCallback(async () => {\r\n    setLoading(true);\r\n    setError(null);\r\n    try {\r\n      const res = await fetch(`/api/dossiers/${dossier.id}/timeline`, { cache: \"no-store\" });\r\n      if (!res.ok) throw new Error(`HTTP ${res.status}`);\r\n      const data = await res.json();\r\n      setTimelineData(data);\r\n    } catch (e) {\r\n      console.error(\"Erreur chargement timeline:\", e);\r\n      setError(\"Impossible de charger les détails du suivi\");\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  }, [dossier?.id]);\r\n\r\n  const loadPiecesData = useCallback(async () => {\r\n    setLoadingPieces(true);\r\n    try {\r\n      const res = await fetch(`/api/dossiers/${dossier.id}/pieces`, { cache: \"no-store\" });\r\n      if (!res.ok) throw new Error(`HTTP ${res.status}`);\r\n      const data = await res.json();\r\n      setPiecesData(data);\r\n    } catch (e) {\r\n      console.error(\"Erreur chargement pièces:\", e);\r\n    } finally {\r\n      setLoadingPieces(false);\r\n    }\r\n  }, [dossier?.id]);\r\n\r\n  /* ---------- Helpers pièces / mandat (binaire) ---------- */\r\n  const getPieceState = useCallback(\r\n    (key) => piecesData?.pieces_state?.find((p) => p.piece_key === key),\r\n    [piecesData]\r\n  );\r\n  const getPieceExpected = useCallback(\r\n    (key) => piecesData?.pieces_expected?.find((p) => p.piece_key === key),\r\n    [piecesData]\r\n  );\r\n\r\n  const piecesStatus = useMemo(() => {\r\n    if (!piecesData) return \"pending\";\r\n    const required = new Set(\r\n      (piecesData.pieces_expected || [])\r\n        .filter((p) => p.piece_key !== \"MandatSigne\" && p.required !== false)\r\n        .map((p) => p.piece_key)\r\n    );\r\n    const states = (piecesData.pieces_state || []).filter((p) => p.piece_key !== \"MandatSigne\");\r\n    if (states.length === 0) return \"pending\";\r\n    const allRequiredUploaded = [...required].every((key) => {\r\n      const piece = states.find((p) => p.piece_key === key);\r\n      return piece && (piece.status === \"valide\" || piece.status === \"en_attente\");\r\n    });\r\n    return allRequiredUploaded ? \"completed\" : \"pending\";\r\n  }, [piecesData]);\r\n\r\n  const mandatStatus = useMemo(() => {\r\n    const mandat = getPieceState(\"MandatSigne\");\r\n    if (!mandat) return \"pending\";\r\n    return mandat.status === \"valide\" || mandat.status === \"en_attente\" ? \"completed\" : \"pending\";\r\n  }, [getPieceState]);\r\n\r\n  /* ---------- Actions ---------- */\r\n  const handleUploadPiece = useCallback(\r\n    async (pieceKey) => {\r\n      if (!dossier?.id || uploadingStep || piecesData?.capabilities?.canUpload === false) return;\r\n      try {\r\n        const input = document.createElement(\"input\");\r\n        input.type = \"file\";\r\n        const exp = getPieceExpected(pieceKey);\r\n        const acc = Array.isArray(exp?.accept_ext) ? exp.accept_ext : [\".pdf\", \".jpg\", \".jpeg\", \".png\"];\r\n        input.accept = acc.join(\",\");\r\n        input.style.display = \"none\";\r\n        document.body.appendChild(input);\r\n\r\n        input.onchange = async (e) => {\r\n          const file = e.target.files?.[0];\r\n          if (!file) return document.body.removeChild(input);\r\n          if (file.size > 10 * 1024 * 1024) {\r\n            alert(\"❌ Fichier trop volumineux (max 10MB)\");\r\n            return document.body.removeChild(input);\r\n          }\r\n          try {\r\n            setUploadingStep(pieceKey);\r\n            const form = new FormData();\r\n            form.append(\"file\", file);\r\n            const res = await fetch(\r\n              `/api/dossiers/${dossier.id}/pieces/${encodeURIComponent(pieceKey)}/upload`,\r\n              { method: \"POST\", body: form }\r\n            );\r\n            if (!res.ok) {\r\n              const body = await res.json().catch(() => ({}));\r\n              const code = body?.error_code ? ` [${body.error_code}]` : \"\";\r\n              throw new Error((body?.error || `HTTP ${res.status}`) + code);\r\n            }\r\n            await loadPiecesData();\r\n            alert(\"✅ Fichier uploadé avec succès !\");\r\n          } catch (err) {\r\n            alert(`❌ Upload échoué: ${err.message}`);\r\n          } finally {\r\n            setUploadingStep(null);\r\n            input.value = \"\";\r\n            if (document.body.contains(input)) document.body.removeChild(input);\r\n          }\r\n        };\r\n\r\n        input.click();\r\n      } catch (error) {\r\n        setUploadingStep(null);\r\n        alert(`❌ Erreur: ${error.message}`);\r\n      }\r\n    },\r\n    [dossier?.id, uploadingStep, piecesData?.capabilities?.canUpload, getPieceExpected, loadPiecesData]\r\n  );\r\n\r\n  const handleDownload = useCallback(\r\n    async (documentType) => {\r\n      try {\r\n        const response = await fetch(`/api/dossiers/${dossier.id}/documents/${documentType}/download`);\r\n        if (!response.ok) throw new Error(\"Document non disponible\");\r\n        const blob = await response.blob();\r\n        const url = window.URL.createObjectURL(blob);\r\n        const a = document.createElement(\"a\");\r\n        a.href = url;\r\n        a.download = `${documentType}_${dossier.id}.pdf`;\r\n        document.body.appendChild(a);\r\n        a.click();\r\n        window.URL.revokeObjectURL(url);\r\n        document.body.removeChild(a);\r\n      } catch (error) {\r\n        console.error(\"Erreur téléchargement:\", error);\r\n        alert(\"❌ Impossible de télécharger le document\");\r\n      }\r\n    },\r\n    [dossier?.id]\r\n  );\r\n\r\n  const handleCompleteForm = useCallback(async () => {\r\n    if (!dossier?.id) return;\r\n    try {\r\n      const res = await fetch(`/api/dossiers/${dossier.id}/etapes/formulaire/completer`, { method: \"POST\" });\r\n      if (!res.ok) {\r\n        const body = await res.json().catch(() => ({}));\r\n        throw new Error(body?.error || `HTTP ${res.status}`);\r\n      }\r\n      await loadTimelineData();\r\n    } catch (e) {\r\n      alert(`❌ ${e.message || \"Erreur\"}`);\r\n    }\r\n  }, [dossier?.id, loadTimelineData]);\r\n\r\n  /* ---------- Étapes standardisées (lecture API + état pièces/mandat) ---------- */\r\n  const steps = useMemo(() => {\r\n    if (!timelineData) return [];\r\n    const { timeline_steps, documents_officiels } = timelineData;\r\n\r\n    // Formulaire\r\n    const formEntry = timeline_steps?.find((s) => s.id === \"formulaire\");\r\n    const formDone = formEntry?.done ?? Boolean(dossier?.date_creation);\r\n    const formDate = formEntry?.date || dossier?.date_creation || null;\r\n    const formDesc = formDone ? \"Vos informations ont été enregistrées\" : \"Informations à compléter\";\r\n\r\n    // Pièces\r\n    const regularPieces = (piecesData?.pieces_state || []).filter((p) => p.piece_key !== \"MandatSigne\");\r\n    const uploadedPieces = regularPieces.filter(\r\n      (p) => p.status === \"valide\" || p.status === \"en_attente\"\r\n    );\r\n    const lastPieceUploadDate = uploadedPieces\r\n      .map((p) => p.uploaded_at)\r\n      .filter(Boolean)\r\n      .map((d) => new Date(d).getTime())\r\n      .sort((a, b) => b - a)[0];\r\n    const lastPieceUpload = lastPieceUploadDate ? new Date(lastPieceUploadDate) : null;\r\n\r\n    // Mandat\r\n    const mandat = getPieceState(\"MandatSigne\");\r\n\r\n    // Transmission & Traitement : on fait confiance à l’API\r\n    const tx = (timeline_steps || []).find((s) => s.id === \"transmission\");\r\n    const transmissionStatus = tx?.status || \"pending\";\r\n    const transmissionDate = tx?.date || null;\r\n\r\n    const proc = (timeline_steps || []).find((s) => s.id === \"processing\");\r\n    const traitementStatus = proc?.status || \"pending\";\r\n    const traitementDate = proc?.date || null;\r\n\r\n    return [\r\n      {\r\n        id: \"formulaire\",\r\n        title: \"Formulaire rempli\",\r\n        description: formDesc,\r\n        status: formDone ? \"completed\" : \"pending\",\r\n        icon: \"📝\",\r\n        date: formDate,\r\n      },\r\n      {\r\n        id: \"pieces\",\r\n        title: \"Pièces requises\",\r\n        description: loadingPieces\r\n          ? \"Chargement des pièces…\"\r\n          : piecesStatus === \"completed\"\r\n          ? \"Toutes les pièces requises sont envoyées\"\r\n          : `${uploadedPieces.length} / ${regularPieces.length} pièces uploadées`,\r\n        status: piecesStatus,\r\n        icon: \"📄\",\r\n        date: piecesStatus === \"completed\" ? lastPieceUpload : null,\r\n      },\r\n      {\r\n        id: \"mandat\",\r\n        title: \"Mandat signé\",\r\n        description:\r\n          mandatStatus === \"completed\"\r\n            ? `Mandat uploadé${mandat?.uploaded_at ? \" le \" + fmtDateTime(mandat.uploaded_at) : \"\"}`\r\n            : \"Mandat à signer\",\r\n        status: mandatStatus,\r\n        icon: \"✍️\",\r\n        date: mandat?.uploaded_at || null,\r\n      },\r\n      {\r\n        id: \"transmission\",\r\n        title: \"Dossier transmis\",\r\n        description:\r\n          transmissionStatus === \"completed\"\r\n            ? \"Dossier transmis aux administrations\"\r\n            : \"En attente de transmission\",\r\n        status: transmissionStatus,\r\n        icon: \"📤\",\r\n        date: transmissionDate,\r\n      },\r\n      {\r\n        id: \"traitement\",\r\n        title: \"Dossier en cours de traitement\",\r\n        description: \"Vérification par les administrations\",\r\n        status: traitementStatus, // on prend le statut API\r\n        icon: \"🏛️\",\r\n        date: traitementDate,\r\n      },\r\n      {\r\n        id: \"siren\",\r\n        title: \"SIREN attribué\",\r\n        description: \"Numéro d'identification reçu\",\r\n        status: documents_officiels?.some(\r\n          (d) =>\r\n            d.type === \"Avis de situation SIRENE\" ||\r\n            d.type?.toUpperCase()?.includes(\"SIRENE\") ||\r\n            d.type?.toUpperCase()?.includes(\"SIREN\")\r\n        )\r\n          ? \"completed\"\r\n          : \"pending\",\r\n        icon: \"🆔\",\r\n        date:\r\n          documents_officiels?.find(\r\n            (d) =>\r\n              d.type === \"Avis de situation SIRENE\" ||\r\n              d.type?.toUpperCase()?.includes(\"SIRENE\") ||\r\n              d.type?.toUpperCase()?.includes(\"SIREN\")\r\n          )?.date || null,\r\n      },\r\n      {\r\n        id: \"attestation\",\r\n        title: \"Attestation à télécharger\",\r\n        description: \"Tous vos documents sont prêts\",\r\n        status:\r\n          documents_officiels?.some((d) => d.type === \"Attestation URSSAF\" || d.type?.includes(\"Attestation\")) &&\r\n          dossier?.statut === \"valide\"\r\n            ? \"completed\"\r\n            : documents_officiels?.some((d) => d.type === \"Attestation URSSAF\" || d.type?.includes(\"Attestation\"))\r\n            ? \"active\"\r\n            : \"pending\",\r\n        icon: \"🎉\",\r\n        date:\r\n          documents_officiels?.find(\r\n            (d) => d.type === \"Attestation URSSAF\" || d.type?.includes(\"Attestation\")\r\n          )?.date || null,\r\n      },\r\n    ];\r\n  }, [timelineData, dossier?.date_creation, dossier?.statut, piecesData, loadingPieces, getPieceState, mandatStatus, piecesStatus]);\r\n\r\n  /* ---------- Ordre + progression ---------- */\r\n  const orderedSteps = useMemo(() => {\r\n    return [...steps].sort((a, b) => STEP_ORDER.indexOf(a.id) - STEP_ORDER.indexOf(b.id));\r\n  }, [steps]);\r\n\r\n  const { completed, total, raw, percent } = useMemo(\r\n    () => computeProgress(orderedSteps),\r\n    [orderedSteps]\r\n  );\r\n  const progressPercent = Math.round(raw);\r\n\r\n  /* ---------- Rendu ---------- */\r\n  if (!dossier) {\r\n    return (\r\n      <section className=\"border rounded p-4\">\r\n        <h3 className=\"text-lg font-semibold mb-3\">📍 Suivi de votre dossier</h3>\r\n        <p className=\"text-gray-600\">Aucun dossier sélectionné</p>\r\n      </section>\r\n    );\r\n  }\r\n\r\n  if (loading) {\r\n    return (\r\n      <section className=\"border rounded p-4\">\r\n        <h3 className=\"text-lg font-semibold mb-3\">📍 Suivi de votre micro-entreprise</h3>\r\n        <div className=\"flex items-center justify-center py-8\">\r\n          <div className=\"text-sm text-gray-600\">🔄 Chargement du suivi...</div>\r\n        </div>\r\n      </section>\r\n    );\r\n  }\r\n\r\n  if (error) {\r\n    return (\r\n      <section className=\"border rounded p-4\">\r\n        <h3 className=\"text-lg font-semibold mb-3\">📍 Suivi de votre micro-entreprise</h3>\r\n        <div className=\"bg-red-50 border border-red-200 rounded p-4\">\r\n          <div className=\"text-red-800\">❌ {error}</div>\r\n          <button\r\n            onClick={loadTimelineData}\r\n            className=\"mt-2 text-sm bg-red-600 text-white px-3 py-1 rounded hover:bg-red-700\"\r\n          >\r\n            🔄 Réessayer\r\n          </button>\r\n        </div>\r\n      </section>\r\n    );\r\n  }\r\n\r\n  const getStepStyle = (status) => {\r\n    const base = \"flex items-center justify-center w-10 h-10 rounded-full text-sm font-medium\";\r\n    if (status === \"completed\") return `${base} bg-green-500 text-white`;\r\n    if (status === \"active\") return `${base} bg-blue-500 text-white animate-pulse`;\r\n    if (status === \"warning\") return `${base} bg-orange-500 text-white`;\r\n    if (status === \"error\") return `${base} bg-red-500 text-white`;\r\n    return `${base} bg-gray-300 text-gray-600`;\r\n  };\r\n\r\n  const getConnectorStyle = (status) => {\r\n    if (status === \"completed\" || status === \"active\") return \"bg-green-300\";\r\n    if (status === \"warning\") return \"bg-orange-300\";\r\n    if (status === \"error\") return \"bg-red-300\";\r\n    return \"bg-gray-200\";\r\n  };\r\n\r\n  return (\r\n    <section className=\"border rounded p-4\">\r\n      <div className=\"flex items-center justify-between mb-4\">\r\n        <h3 className=\"text-lg font-semibold\">📍 Suivi de votre micro-entreprise</h3>\r\n\r\n        {/* DEBUG progression — à retirer en prod */}\r\n        <div className=\"mb-3 text-xs p-2 rounded border bg-gray-50 text-gray-700\">\r\n          <div>\r\n            <b>Calcul progression</b>\r\n          </div>\r\n          <div>\r\n            completed: {completed} / total: {total} → raw: {raw.toFixed(2)}% → affiché: {progressPercent}%\r\n          </div>\r\n          <div className=\"mt-1\">\r\n            {orderedSteps.map((s) => (\r\n              <span key={s.id} className=\"inline-block mr-2 mt-1 px-2 py-0.5 rounded border\">\r\n                {s.id}: <b>{s.status}</b>\r\n              </span>\r\n            ))}\r\n          </div>\r\n        </div>\r\n\r\n        <div className=\"text-sm text-right\">\r\n          <span className=\"font-medium\">{progressPercent}% terminé</span>\r\n          <div className=\"w-32 bg-gray-200 rounded-full h-2 mt-1\" aria-hidden=\"true\">\r\n            <div\r\n              className=\"bg-blue-600 h-2 rounded-full transition-all duration-300\"\r\n              style={{ width: `${progressPercent}%` }}\r\n            />\r\n          </div>\r\n          {timelineData?.metrics?.estimated_completion && (\r\n            <div className=\"text-xs text-gray-600 mt-1\">\r\n              Finalisation estimée: {fmt(timelineData.metrics.estimated_completion)}\r\n            </div>\r\n          )}\r\n        </div>\r\n      </div>\r\n\r\n      {dossier?.blocages?.length > 0 && (\r\n        <div className=\"mb-4 p-3 rounded border bg-orange-50 text-orange-800\">\r\n          <span className=\"mr-2\">⚠️</span>\r\n          <strong>Action requise :</strong> {dossier.blocages.join(\", \")}\r\n        </div>\r\n      )}\r\n\r\n      <div className=\"mb-6 p-4 bg-blue-50 rounded-lg\">\r\n        <div className=\"flex items-center gap-3\">\r\n          <span className=\"text-2xl\">\r\n            {dossier.statut === \"valide\" ? \"🎉\" : dossier.statut === \"rejete\" ? \"❌\" : dossier.blocages?.length > 0 ? \"⚠️\" : \"🔄\"}\r\n          </span>\r\n          <div className=\"flex-1\">\r\n            <div className=\"font-semibold text-lg\">\r\n              {dossier.statut === \"valide\"\r\n                ? \"Félicitations ! Votre micro-entreprise est créée !\"\r\n                : dossier.statut === \"rejete\"\r\n                ? \"Dossier rejeté - Contactez votre conseiller\"\r\n                : dossier.blocages?.length > 0\r\n                ? \"Action requise de votre part\"\r\n                : \"Votre dossier est en cours de traitement\"}\r\n            </div>\r\n            <div className=\"text-sm text-gray-600 mt-1\">\r\n              Statut: <strong>{dossier.statut}</strong> • Dossier #{dossier.id}\r\n            </div>\r\n          </div>\r\n          <button\r\n            onClick={() => {\r\n              loadTimelineData();\r\n              loadPiecesData();\r\n            }}\r\n            className=\"text-xs bg-blue-600 text-white px-2 py-1 rounded hover:bg-blue-700\"\r\n            disabled={loading || loadingPieces}\r\n            aria-label=\"Actualiser le suivi\"\r\n            aria-busy={loading || loadingPieces}\r\n          >\r\n            🔄 Actualiser\r\n          </button>\r\n        </div>\r\n      </div>\r\n\r\n      {/* Timeline des étapes */}\r\n      <div className=\"space-y-6\">\r\n        {orderedSteps.map((step, index) => (\r\n          <div key={step.id} className=\"flex gap-4\">\r\n            <div className=\"flex flex-col items-center\">\r\n              <div className={getStepStyle(step.status)}>{step.icon}</div>\r\n              {index < orderedSteps.length - 1 && (\r\n                <div className={`w-1 h-12 mt-2 ${getConnectorStyle(step.status)}`} />\r\n              )}\r\n            </div>\r\n\r\n            <div className=\"flex-1 pb-3\">\r\n              <div className=\"flex items-center justify-between mb-1\">\r\n                <h4 className=\"font-semibold text-lg\">{step.title}</h4>\r\n                {step.date && (\r\n                  <span className=\"text-sm text-gray-500 bg-gray-100 px-2 py-1 rounded\" title={new Date(step.date).toISOString()}>\r\n                    {fmt(step.date)}\r\n                  </span>\r\n                )}\r\n              </div>\r\n\r\n              <p className=\"text-gray-600 mb-2\">{step.description}</p>\r\n\r\n              {step.id === \"formulaire\" && step.status !== \"completed\" && (\r\n                <button\r\n                  onClick={handleCompleteForm}\r\n                  className=\"px-3 py-1.5 rounded text-xs font-medium border bg-blue-600 text-white hover:bg-blue-700\"\r\n                >\r\n                  ✅ Marquer le formulaire comme fait\r\n                </button>\r\n              )}\r\n\r\n              {step.id === \"pieces\" && !loadingPieces && (\r\n                <>\r\n                  <div className=\"flex flex-wrap gap-2\">\r\n                    {(piecesData?.pieces_state || [])\r\n                      .filter((p) => p.piece_key !== \"MandatSigne\")\r\n                      .map((p) => {\r\n                        const isUploaded = p.status === \"valide\" || p.status === \"en_attente\";\r\n                        const canUpload = piecesData?.capabilities?.canUpload !== false;\r\n                        const disabled = uploadingStep === p.piece_key || p.status === \"valide\" || !canUpload;\r\n\r\n                        const exp = getPieceExpected(p.piece_key);\r\n                        const ext = Array.isArray(exp?.accept_ext) ? exp.accept_ext.join(\", \") : \"pdf, jpg, png\";\r\n                        const title =\r\n                          (p.status === \"valide\"\r\n                            ? \"Validée\"\r\n                            : p.status === \"en_attente\"\r\n                            ? \"En revue\"\r\n                            : p.status === \"refusee\"\r\n                            ? `Refusée${p.reason ? \" — \" + p.reason : \"\"}`\r\n                            : \"À fournir\") + ` • Formats: ${ext}`;\r\n\r\n                        return (\r\n                          <button\r\n                            key={p.piece_key}\r\n                            onClick={() => handleUploadPiece(p.piece_key)}\r\n                            disabled={disabled}\r\n                            title={title}\r\n                            className={`px-3 py-1.5 rounded text-xs font-medium border transition disabled:opacity-50 ${\r\n                              isUploaded\r\n                                ? \"bg-green-50 text-green-800 border-green-200 hover:bg-green-100\"\r\n                                : \"bg-red-50 text-red-800 border-red-200 hover:bg-red-100\"\r\n                            }`}\r\n                          >\r\n                            {uploadingStep === p.piece_key ? \"📤 Envoi…\" : p.piece_label || p.piece_key}\r\n                          </button>\r\n                        );\r\n                      })}\r\n                  </div>\r\n                  <div className=\"mt-1 text-[11px] text-gray-500\">🟢 Uploadé / en revue • 🔴 À uploader</div>\r\n                </>\r\n              )}\r\n\r\n              {step.id === \"mandat\" && (\r\n                <div className=\"flex items-center gap-2\">\r\n                  {(() => {\r\n                    const m = getPieceState(\"MandatSigne\");\r\n                    const status = m?.status || \"missing\";\r\n                    const isUploaded = status === \"valide\" || status === \"en_attente\";\r\n                    const canUpload = piecesData?.capabilities?.canUpload !== false;\r\n                    const disabled = uploadingStep === \"MandatSigne\" || status === \"valide\" || !canUpload;\r\n\r\n                    const exp = getPieceExpected(\"MandatSigne\");\r\n                    const ext = Array.isArray(exp?.accept_ext) ? exp.accept_ext.join(\", \") : \"pdf, jpg, png\";\r\n                    const title =\r\n                      (status === \"valide\"\r\n                        ? \"Mandat validé\"\r\n                        : status === \"en_attente\"\r\n                        ? \"En revue\"\r\n                        : status === \"refusee\"\r\n                        ? `Refusé${m?.reason ? \" — \" + m.reason : \"\"}`\r\n                        : \"À fournir\") + ` • Formats: ${ext}`;\r\n\r\n                    return (\r\n                      <button\r\n                        onClick={() => handleUploadPiece(\"MandatSigne\")}\r\n                        disabled={disabled}\r\n                        title={title}\r\n                        className={`px-3 py-1.5 rounded text-xs font-medium border transition disabled:opacity-50 ${\r\n                          isUploaded\r\n                            ? \"bg-green-50 text-green-800 border-green-200 hover:bg-green-100\"\r\n                            : \"bg-red-50 text-red-800 border-red-200 hover:bg-red-100\"\r\n                        }`}\r\n                      >\r\n                        {uploadingStep === \"MandatSigne\" ? \"📤 Envoi…\" : isUploaded ? \"Mandat ✅\" : \"Uploader le mandat\"}\r\n                      </button>\r\n                    );\r\n                  })()}\r\n                </div>\r\n              )}\r\n\r\n              {step.id === \"siren\" && step.status === \"completed\" && (\r\n                <div className=\"mt-2\">\r\n                  <button\r\n                    onClick={() => handleDownload(\"sirene\")}\r\n                    className=\"px-3 py-1.5 rounded text-xs font-semibold bg-green-600 text-white hover:bg-green-700\"\r\n                  >\r\n                    📥 Télécharger l'avis SIRENE\r\n                  </button>\r\n                </div>\r\n              )}\r\n\r\n              {step.id === \"attestation\" && step.status === \"completed\" && (\r\n                <div className=\"mt-2\">\r\n                  <button\r\n                    onClick={() => handleDownload(\"attestation\")}\r\n                    className=\"px-3 py-1.5 rounded text-xs font-semibold bg-green-600 text-white hover:bg-green-700\"\r\n                  >\r\n                    📥 Télécharger l'attestation\r\n                  </button>\r\n                </div>\r\n              )}\r\n            </div>\r\n          </div>\r\n        ))}\r\n      </div>\r\n\r\n      {/* Métriques */}\r\n      <div className=\"mt-4 pt-3 border-t bg-gray-50 -m-4 p-4 rounded-b\">\r\n        <div className=\"grid md:grid-cols-4 gap-4 text-sm\">\r\n          <div>\r\n            <span className=\"font-medium\">Créé le:</span>\r\n            <br />\r\n            {fmt(dossier.date_creation)}\r\n          </div>\r\n          <div>\r\n            <span className=\"font-medium\">Dernière MAJ:</span>\r\n            <br />\r\n            {fmt(dossier.derniere_modification)}\r\n          </div>\r\n          <div>\r\n            <span className=\"font-medium\">Documents générés:</span>\r\n            <br />\r\n            {timelineData?.metrics?.documents_officiels_count || 0}\r\n          </div>\r\n          <div>\r\n            <span className=\"font-medium\">Référence:</span>\r\n            <br />#{dossier.id}\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </section>\r\n  );\r\n}\r\n"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 973, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/giorn/Desktop/Projet/Medina/Micro_entreprise/Mockfront/ME-main/app/%28crm%29/crm/clients/%5Bid%5D/ClientIdentityCard.js"],"sourcesContent":["\"use client\";\r\nconst fmt = (d) => (d ? new Date(d).toLocaleDateString(\"fr-FR\") : \"—\");\r\nconst show = (v) => (v ?? v === 0 ? String(v) : \"—\");\r\n\r\nexport default function ClientIdentityCard({ client }) {\r\n  if (!client) return null;\r\n\r\n  const adr = client.adresse_personnelle ?? {};\r\n  const adrfis = client.adresse_fiscale ?? {};\r\n\r\n  return (\r\n    <section>\r\n      <h3 className=\"text-lg font-semibold mb-3\">🆔 Identité & adresses</h3>\r\n      <div className=\"bg-white border rounded p-4\">\r\n        <ul className=\"list-disc pl-6\">\r\n          <li>\r\n            Naissance: {fmt(client.date_naissance)} — {show(client.commune_naissance)}, {show(client.pays_naissance)} — {show(client.nationalite)}\r\n          </li>\r\n          <li>\r\n            Adresse perso: {show(adr.ligne1)}, {show(adr.code_postal)} {show(adr.ville)}\r\n          </li>\r\n          <li>\r\n            Adresse fiscale{adrfis.est_differente ? \"\" : \" (identique)\"}: {show(adrfis.ligne1)}, {show(adrfis.code_postal)} {show(adrfis.ville)}\r\n          </li>\r\n          <li>NIR: {show(client.numero_securite_sociale)}</li>\r\n        </ul>\r\n      </div>\r\n    </section>\r\n  );\r\n}\r\n"],"names":[],"mappings":";;;;AAAA;;AACA,MAAM,MAAM,CAAC,IAAO,IAAI,IAAI,KAAK,GAAG,kBAAkB,CAAC,WAAW;AAClE,MAAM,OAAO,CAAC,IAAO,KAAK,MAAM,IAAI,OAAO,KAAK;AAEjC,SAAS,mBAAmB,EAAE,MAAM,EAAE;IACnD,IAAI,CAAC,QAAQ,OAAO;IAEpB,MAAM,MAAM,OAAO,mBAAmB,IAAI,CAAC;IAC3C,MAAM,SAAS,OAAO,eAAe,IAAI,CAAC;IAE1C,qBACE,8OAAC;;0BACC,8OAAC;gBAAG,WAAU;0BAA6B;;;;;;0BAC3C,8OAAC;gBAAI,WAAU;0BACb,cAAA,8OAAC;oBAAG,WAAU;;sCACZ,8OAAC;;gCAAG;gCACU,IAAI,OAAO,cAAc;gCAAE;gCAAI,KAAK,OAAO,iBAAiB;gCAAE;gCAAG,KAAK,OAAO,cAAc;gCAAE;gCAAI,KAAK,OAAO,WAAW;;;;;;;sCAEtI,8OAAC;;gCAAG;gCACc,KAAK,IAAI,MAAM;gCAAE;gCAAG,KAAK,IAAI,WAAW;gCAAE;gCAAE,KAAK,IAAI,KAAK;;;;;;;sCAE5E,8OAAC;;gCAAG;gCACc,OAAO,cAAc,GAAG,KAAK;gCAAe;gCAAG,KAAK,OAAO,MAAM;gCAAE;gCAAG,KAAK,OAAO,WAAW;gCAAE;gCAAE,KAAK,OAAO,KAAK;;;;;;;sCAEpI,8OAAC;;gCAAG;gCAAM,KAAK,OAAO,uBAAuB;;;;;;;;;;;;;;;;;;;;;;;;AAKvD","debugId":null}},
    {"offset": {"line": 1078, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/giorn/Desktop/Projet/Medina/Micro_entreprise/Mockfront/ME-main/app/%28crm%29/crm/clients/%5Bid%5D/PiecesJustificativesCard.js"],"sourcesContent":["\"use client\";\r\nconst fmt = (d) => (d ? new Date(d).toISOString().slice(0,10) : \"—\");\r\nconst show = (v) => (v ?? v === 0 ? String(v) : \"—\");\r\n\r\n/**\r\n * props:\r\n * - pieces: [{type, fichier, statut, motif_refus, uploaded_at}]\r\n * - downloads: [{type, fichier}]\r\n * - requiredTypes?: [\"Passeport\",\"PhotoIdentite\",\"RIB\",\"CNI\"] (optionnel)\r\n */\r\nexport default function PiecesJustificativesCard({ pieces = [], downloads = [], requiredTypes = [] }) {\r\n  // Comptes dérivés de la BDD (pas de valeurs par défaut)\r\n  const total = pieces.length;\r\n  const valides = pieces.filter(p => p.statut === \"valide\").length;\r\n\r\n  const missing = requiredTypes.length\r\n    ? requiredTypes.filter(t => !pieces.some(p => p.type === t))\r\n    : [];\r\n\r\n  return (\r\n    <section>\r\n      <h3 className=\"text-lg font-semibold mb-3\">📄 Pièces justificatives</h3>\r\n      <div className=\"bg-white border rounded p-4\">\r\n        {/* État synthétique sans forcer: on affiche ce que dit la BDD */}\r\n        <div className=\"text-sm mb-3\">\r\n          <strong>Statut:</strong> {valides}/{total} validées\r\n          {requiredTypes.length ? (\r\n            <span className=\"ml-2\">\r\n              — Requises manquantes: {missing.length ? missing.join(\", \") : \"—\"}\r\n            </span>\r\n          ) : null}\r\n        </div>\r\n\r\n        <ul className=\"list-disc pl-6\">\r\n          {total ? pieces.map((p, i) => (\r\n            <li key={i}>\r\n              {show(p.type)} — {show(p.fichier)} — {show(p.statut)}\r\n              {p.motif_refus ? ` (${p.motif_refus})` : \"\"} {p.uploaded_at ? `(${fmt(p.uploaded_at)})` : \"\"}\r\n            </li>\r\n          )) : <li>—</li>}\r\n        </ul>\r\n\r\n        <h4 className=\"font-medium mt-3\">Téléchargements disponibles</h4>\r\n        <ul className=\"list-disc pl-6\">\r\n          {downloads.length ? downloads.map((d, i) => (\r\n            <li key={i}>{show(d.type)} — {show(d.fichier)}</li>\r\n          )) : <li>—</li>}\r\n        </ul>\r\n      </div>\r\n    </section>\r\n  );\r\n}\r\n"],"names":[],"mappings":";;;;AAAA;;AACA,MAAM,MAAM,CAAC,IAAO,IAAI,IAAI,KAAK,GAAG,WAAW,GAAG,KAAK,CAAC,GAAE,MAAM;AAChE,MAAM,OAAO,CAAC,IAAO,KAAK,MAAM,IAAI,OAAO,KAAK;AAQjC,SAAS,yBAAyB,EAAE,SAAS,EAAE,EAAE,YAAY,EAAE,EAAE,gBAAgB,EAAE,EAAE;IAClG,wDAAwD;IACxD,MAAM,QAAQ,OAAO,MAAM;IAC3B,MAAM,UAAU,OAAO,MAAM,CAAC,CAAA,IAAK,EAAE,MAAM,KAAK,UAAU,MAAM;IAEhE,MAAM,UAAU,cAAc,MAAM,GAChC,cAAc,MAAM,CAAC,CAAA,IAAK,CAAC,OAAO,IAAI,CAAC,CAAA,IAAK,EAAE,IAAI,KAAK,MACvD,EAAE;IAEN,qBACE,8OAAC;;0BACC,8OAAC;gBAAG,WAAU;0BAA6B;;;;;;0BAC3C,8OAAC;gBAAI,WAAU;;kCAEb,8OAAC;wBAAI,WAAU;;0CACb,8OAAC;0CAAO;;;;;;4BAAgB;4BAAE;4BAAQ;4BAAE;4BAAM;4BACzC,cAAc,MAAM,iBACnB,8OAAC;gCAAK,WAAU;;oCAAO;oCACG,QAAQ,MAAM,GAAG,QAAQ,IAAI,CAAC,QAAQ;;;;;;uCAE9D;;;;;;;kCAGN,8OAAC;wBAAG,WAAU;kCACX,QAAQ,OAAO,GAAG,CAAC,CAAC,GAAG,kBACtB,8OAAC;;oCACE,KAAK,EAAE,IAAI;oCAAE;oCAAI,KAAK,EAAE,OAAO;oCAAE;oCAAI,KAAK,EAAE,MAAM;oCAClD,EAAE,WAAW,GAAG,CAAC,EAAE,EAAE,EAAE,WAAW,CAAC,CAAC,CAAC,GAAG;oCAAG;oCAAE,EAAE,WAAW,GAAG,CAAC,CAAC,EAAE,IAAI,EAAE,WAAW,EAAE,CAAC,CAAC,GAAG;;+BAFnF;;;;sDAIN,8OAAC;sCAAG;;;;;;;;;;;kCAGX,8OAAC;wBAAG,WAAU;kCAAmB;;;;;;kCACjC,8OAAC;wBAAG,WAAU;kCACX,UAAU,MAAM,GAAG,UAAU,GAAG,CAAC,CAAC,GAAG,kBACpC,8OAAC;;oCAAY,KAAK,EAAE,IAAI;oCAAE;oCAAI,KAAK,EAAE,OAAO;;+BAAnC;;;;sDACN,8OAAC;sCAAG;;;;;;;;;;;;;;;;;;;;;;;AAKnB","debugId":null}},
    {"offset": {"line": 1214, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/giorn/Desktop/Projet/Medina/Micro_entreprise/Mockfront/ME-main/app/%28crm%29/crm/clients/%5Bid%5D/CommsHistory.js"],"sourcesContent":["\"use client\";\r\n\r\nexport default function NotificationsRelancesCard({ relances = [], notifications = [] }) {\r\n  // Fusionner relances + notifications\r\n  let items = [...relances, ...notifications];\r\n\r\n  // Trier par date décroissante\r\n  items = items.sort(\r\n    (a, b) =>\r\n      (new Date(b.scheduled_for).getTime() || 0) -\r\n      (new Date(a.scheduled_for).getTime() || 0)\r\n  );\r\n\r\n  if (!items.length) {\r\n    return (\r\n      <section className=\"bg-white border rounded p-4\">\r\n        <h3 className=\"text-lg font-semibold mb-3\">📨 Historique (relances & notifications)</h3>\r\n        <p className=\"text-gray-500 text-sm\">\r\n          Aucune relance ou notification programmée.\r\n        </p>\r\n      </section>\r\n    );\r\n  }\r\n\r\n  // Badge couleur selon le type\r\n  const badge = (type) => {\r\n    if (type.startsWith(\"relance\")) {\r\n      return (\r\n        <span className=\"text-xs px-2 py-0.5 rounded bg-amber-100 text-amber-800\">\r\n          Relance\r\n        </span>\r\n      );\r\n    }\r\n    return (\r\n      <span className=\"text-xs px-2 py-0.5 rounded bg-blue-100 text-blue-800\">\r\n        Notification\r\n      </span>\r\n    );\r\n  };\r\n\r\n  // Format date\r\n  const fmt = (d) => (d ? new Date(d).toLocaleString(\"fr-FR\") : \"—\");\r\n\r\n  return (\r\n    <section className=\"bg-white border rounded p-4\">\r\n      <h3 className=\"text-lg font-semibold mb-3\">📨 Historique (relances & notifications)</h3>\r\n      <ul className=\"space-y-3\">\r\n        {items.map((x) => (\r\n          <li key={x.id} className=\"border rounded p-3\">\r\n            <div className=\"flex items-center justify-between\">\r\n              <div className=\"flex items-center gap-2\">\r\n                {badge(x.type)}\r\n                <span className=\"text-sm text-gray-600\">\r\n                  {x.canal || \"—\"}\r\n                </span>\r\n              </div>\r\n              <div className=\"text-xs text-gray-500\">\r\n                {fmt(x.scheduled_for)}\r\n              </div>\r\n            </div>\r\n\r\n            {x.message && x.message.trim() !== \"\" ? (\r\n              <div className=\"mt-1 text-sm text-gray-700 whitespace-pre-wrap\">\r\n                {x.message}\r\n              </div>\r\n            ) : (\r\n              <div className=\"mt-1 text-sm text-gray-400 italic\">\r\n                Aucun message\r\n              </div>\r\n            )}\r\n          </li>\r\n        ))}\r\n      </ul>\r\n    </section>\r\n  );\r\n}\r\n"],"names":[],"mappings":";;;;AAAA;;AAEe,SAAS,0BAA0B,EAAE,WAAW,EAAE,EAAE,gBAAgB,EAAE,EAAE;IACrF,qCAAqC;IACrC,IAAI,QAAQ;WAAI;WAAa;KAAc;IAE3C,8BAA8B;IAC9B,QAAQ,MAAM,IAAI,CAChB,CAAC,GAAG,IACF,CAAC,IAAI,KAAK,EAAE,aAAa,EAAE,OAAO,MAAM,CAAC,IACzC,CAAC,IAAI,KAAK,EAAE,aAAa,EAAE,OAAO,MAAM,CAAC;IAG7C,IAAI,CAAC,MAAM,MAAM,EAAE;QACjB,qBACE,8OAAC;YAAQ,WAAU;;8BACjB,8OAAC;oBAAG,WAAU;8BAA6B;;;;;;8BAC3C,8OAAC;oBAAE,WAAU;8BAAwB;;;;;;;;;;;;IAK3C;IAEA,8BAA8B;IAC9B,MAAM,QAAQ,CAAC;QACb,IAAI,KAAK,UAAU,CAAC,YAAY;YAC9B,qBACE,8OAAC;gBAAK,WAAU;0BAA0D;;;;;;QAI9E;QACA,qBACE,8OAAC;YAAK,WAAU;sBAAwD;;;;;;IAI5E;IAEA,cAAc;IACd,MAAM,MAAM,CAAC,IAAO,IAAI,IAAI,KAAK,GAAG,cAAc,CAAC,WAAW;IAE9D,qBACE,8OAAC;QAAQ,WAAU;;0BACjB,8OAAC;gBAAG,WAAU;0BAA6B;;;;;;0BAC3C,8OAAC;gBAAG,WAAU;0BACX,MAAM,GAAG,CAAC,CAAC,kBACV,8OAAC;wBAAc,WAAU;;0CACvB,8OAAC;gCAAI,WAAU;;kDACb,8OAAC;wCAAI,WAAU;;4CACZ,MAAM,EAAE,IAAI;0DACb,8OAAC;gDAAK,WAAU;0DACb,EAAE,KAAK,IAAI;;;;;;;;;;;;kDAGhB,8OAAC;wCAAI,WAAU;kDACZ,IAAI,EAAE,aAAa;;;;;;;;;;;;4BAIvB,EAAE,OAAO,IAAI,EAAE,OAAO,CAAC,IAAI,OAAO,mBACjC,8OAAC;gCAAI,WAAU;0CACZ,EAAE,OAAO;;;;;qDAGZ,8OAAC;gCAAI,WAAU;0CAAoC;;;;;;;uBAlB9C,EAAE,EAAE;;;;;;;;;;;;;;;;AA2BvB","debugId":null}},
    {"offset": {"line": 1366, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/giorn/Desktop/Projet/Medina/Micro_entreprise/Mockfront/ME-main/app/%28crm%29/crm/clients/%5Bid%5D/ClientMessaging.js"],"sourcesContent":["\"use client\";\r\nimport { useEffect, useState } from \"react\";\r\n\r\nconst fmt = (d) => d ? new Date(d).toLocaleString(\"fr-FR\") : \"-\";\r\n\r\nexport default function ClientMessaging({ clientId, dossiers, senderType = \"Opérateur\" }) {\r\n  const [selectedDossier, setSelectedDossier] = useState(null);\r\n  const [messages, setMessages] = useState([]);\r\n  const [newMessage, setNewMessage] = useState(\"\");\r\n  const [sending, setSending] = useState(false);\r\n  const [loading, setLoading] = useState(false);\r\n\r\n  // Détermine qui envoie le message\r\n  const isClientSending = senderType === \"Client\";\r\n  const isOperatorSending = senderType === \"Opérateur\";\r\n\r\n  // Sélectionner le premier dossier par défaut\r\n  useEffect(() => {\r\n    if (dossiers.length > 0 && !selectedDossier) {\r\n      setSelectedDossier(dossiers[0]);\r\n    }\r\n  }, [dossiers, selectedDossier]);\r\n\r\n  // Charger messages du dossier sélectionné\r\n  useEffect(() => {\r\n    if (!selectedDossier) return;\r\n    \r\n    setLoading(true);\r\n    fetch(`/api/dossiers/${selectedDossier.id}/messages`, { cache: \"no-store\" })\r\n      .then(r => r.ok ? r.json() : Promise.reject(r))\r\n      .then(data => setMessages(data.messages || []))\r\n      .catch(e => {\r\n        console.error(\"Erreur chargement messages:\", e);\r\n        setMessages([]);\r\n      })\r\n      .finally(() => setLoading(false));\r\n  }, [selectedDossier]);\r\n\r\n  // Envoyer nouveau message (adapté selon le sender)\r\n  async function sendMessage() {\r\n    if (!newMessage.trim() || !selectedDossier) return;\r\n    \r\n    setSending(true);\r\n    try {\r\n      const r = await fetch(`/api/dossiers/${selectedDossier.id}/messages`, {\r\n        method: \"POST\",\r\n        headers: { \"Content-Type\": \"application/json\" },\r\n        body: JSON.stringify({\r\n          sender_type: senderType, // 🔥 Utilise la prop\r\n          body: newMessage.trim(),\r\n          send_email: isOperatorSending // Email seulement si opérateur envoie\r\n        })\r\n      });\r\n      \r\n      if (!r.ok) throw new Error(`HTTP ${r.status}`);\r\n      \r\n      const data = await r.json();\r\n      \r\n      // Recharger les messages\r\n      setMessages(prev => [...prev, data.message]);\r\n      setNewMessage(\"\");\r\n      \r\n      // Alerte différente selon qui envoie\r\n      if (isOperatorSending && data.email_sent) {\r\n        alert(`Message envoyé et email automatique expédié à ${data.client_email}`);\r\n      } else if (isClientSending) {\r\n        alert(\"Message envoyé à l'équipe !\");\r\n      }\r\n    } catch (e) {\r\n      console.error(\"Erreur envoi message:\", e);\r\n      alert(\"Erreur lors de l'envoi du message\");\r\n    } finally {\r\n      setSending(false);\r\n    }\r\n  }\r\n\r\n  const getSenderColor = (senderType) => {\r\n    switch (senderType) {\r\n      case \"Client\": return \"bg-blue-50 border-l-4 border-l-blue-500\";\r\n      case \"Opérateur\": return \"bg-green-50 border-l-4 border-l-green-500\";\r\n      case \"Système\": return \"bg-gray-50 border-l-4 border-l-gray-500\";\r\n      default: return \"bg-gray-50\";\r\n    }\r\n  };\r\n\r\n  const getSenderIcon = (senderType) => {\r\n    switch (senderType) {\r\n      case \"Client\": return \"👤\";\r\n      case \"Opérateur\": return \"👨‍💼\";\r\n      case \"Système\": return \"🤖\";\r\n      default: return \"💬\";\r\n    }\r\n  };\r\n\r\n  // Affichage du nom de l'expéditeur selon le contexte\r\n  const getSenderDisplayName = (msgSenderType) => {\r\n    if (isClientSending) {\r\n      // Vue client : \"Vous\" pour ses messages, \"Équipe\" pour les opérateurs\r\n      return msgSenderType === \"Client\" ? \"Vous\" : \r\n             msgSenderType === \"Opérateur\" ? \"Équipe\" : \r\n             msgSenderType;\r\n    } else {\r\n      // Vue opérateur : noms normaux\r\n      return msgSenderType;\r\n    }\r\n  };\r\n\r\n  if (dossiers.length === 0) {\r\n    return (\r\n      <section className=\"border rounded p-4\">\r\n        <h3 className=\"text-lg font-semibold mb-3\">💬 Messagerie</h3>\r\n        <p className=\"text-gray-600\">Aucun dossier trouvé{isClientSending ? \"\" : \" pour ce client\"}.</p>\r\n      </section>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <section className=\"border rounded p-4 space-y-4\">\r\n      <h3 className=\"text-lg font-semibold\">\r\n        💬 {isClientSending ? \"Messagerie avec votre équipe\" : \"Messagerie Client\"}\r\n        <span className=\"text-sm font-normal text-gray-600 ml-2\">\r\n          {isClientSending \r\n            ? \"(Communication avec nos opérateurs)\" \r\n            : \"(Communication directe avec le client)\"\r\n          }\r\n        </span>\r\n      </h3>\r\n\r\n      {/* Sélecteur de dossier */}\r\n      {dossiers.length > 1 && (\r\n        <div>\r\n          <label className=\"block text-sm font-medium mb-1\">\r\n            Dossier à afficher :\r\n          </label>\r\n          <select\r\n            className=\"border rounded p-2\"\r\n            value={selectedDossier?.id || \"\"}\r\n            onChange={(e) => {\r\n              const dossier = dossiers.find(d => d.id === parseInt(e.target.value));\r\n              setSelectedDossier(dossier);\r\n            }}\r\n          >\r\n            {dossiers.map(d => (\r\n              <option key={d.id} value={d.id}>\r\n                Dossier #{d.id} - {d.statut}\r\n              </option>\r\n            ))}\r\n          </select>\r\n        </div>\r\n      )}\r\n\r\n      {selectedDossier && (\r\n        <>\r\n          <div className=\"text-sm bg-blue-50 p-2 rounded\">\r\n            📁 <strong>Dossier #{selectedDossier.id}</strong> - Statut: {selectedDossier.statut}\r\n          </div>\r\n\r\n          {/* Messages */}\r\n          <div className=\"space-y-3 max-h-96 overflow-y-auto\">\r\n            {loading ? (\r\n              <p className=\"text-gray-600\">Chargement des messages...</p>\r\n            ) : messages.length === 0 ? (\r\n              <p className=\"text-gray-600\">Aucun message pour ce dossier.</p>\r\n            ) : (\r\n              messages.map(msg => (\r\n                <div \r\n                  key={msg.id} \r\n                  className={`p-3 rounded ${getSenderColor(msg.sender_type)}`}\r\n                >\r\n                  <div className=\"flex items-center justify-between mb-1\">\r\n                    <div className=\"flex items-center gap-2\">\r\n                      <span>{getSenderIcon(msg.sender_type)}</span>\r\n                      <strong className=\"text-sm\">\r\n                        {getSenderDisplayName(msg.sender_type)}\r\n                      </strong>\r\n                    </div>\r\n                    <span className=\"text-xs text-gray-600\">\r\n                      {fmt(msg.at)}\r\n                    </span>\r\n                  </div>\r\n                  <div className=\"whitespace-pre-wrap\">{msg.body}</div>\r\n                </div>\r\n              ))\r\n            )}\r\n          </div>\r\n\r\n          {/* Nouveau message */}\r\n          <div className=\"border-t pt-4 space-y-3\">\r\n            <h4 className=\"font-medium\">\r\n              {isClientSending ? \"✉️ Envoyer un message à l'équipe\" : \"✉️ Répondre au client\"}\r\n            </h4>\r\n            <textarea\r\n              className=\"w-full border rounded p-3 h-24\"\r\n              placeholder={isClientSending \r\n                ? \"Votre message à l'équipe...\" \r\n                : \"Votre message sera envoyé au client par email...\"\r\n              }\r\n              value={newMessage}\r\n              onChange={(e) => setNewMessage(e.target.value)}\r\n              disabled={sending}\r\n            />\r\n            <div className=\"flex gap-2\">\r\n              <button\r\n                className=\"bg-blue-600 text-white px-4 py-2 rounded disabled:opacity-50\"\r\n                onClick={sendMessage}\r\n                disabled={sending || !newMessage.trim()}\r\n              >\r\n                {sending ? \"Envoi...\" : \r\n                 isClientSending ? \"📤 Envoyer à l'équipe\" : \"📧 Envoyer au client\"}\r\n              </button>\r\n              <button\r\n                className=\"border px-4 py-2 rounded\"\r\n                onClick={() => setNewMessage(\"\")}\r\n                disabled={sending}\r\n              >\r\n                Effacer\r\n              </button>\r\n            </div>\r\n            <p className=\"text-xs text-gray-600\">\r\n              💡 {isClientSending \r\n                ? \"Votre message sera envoyé à l'équipe et ajouté à l'historique de votre dossier.\" \r\n                : \"Le message sera ajouté à l'historique et envoyé automatiquement par email au client.\"\r\n              }\r\n            </p>\r\n          </div>\r\n        </>\r\n      )}\r\n    </section>\r\n  );\r\n}"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 1755, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/giorn/Desktop/Projet/Medina/Micro_entreprise/Mockfront/ME-main/app/%28crm%29/crm/partenaires/%5Bid%5D/PartnerTracking.js"],"sourcesContent":["\"use client\";\r\nimport { useEffect, useState } from \"react\";\r\n\r\nconst fmt = (d) => d ? new Date(d).toLocaleDateString(\"fr-FR\") : \"-\";\r\nconst fmtDateTime = (d) => d ? new Date(d).toLocaleString(\"fr-FR\") : \"-\";\r\n\r\nexport default function PartnerTracking({ partnerId }) {\r\n  const [data, setData] = useState(null);\r\n  const [loading, setLoading] = useState(true);\r\n  const [adding, setAdding] = useState(false);\r\n  const [showForm, setShowForm] = useState(false);\r\n  \r\n  // Formulaire nouvelle interaction\r\n  const [form, setForm] = useState({\r\n    type_interaction: 'appel',\r\n    direction: 'sortant',\r\n    sujet: '',\r\n    notes: '',\r\n    participant: '',\r\n    duree_minutes: '',\r\n    prochaine_action: '',\r\n    rappel_date: ''\r\n  });\r\n\r\n  useEffect(() => {\r\n    if (partnerId) {\r\n      loadData();\r\n    }\r\n  }, [partnerId]);\r\n\r\n  async function loadData() {\r\n    setLoading(true);\r\n    try {\r\n      const r = await fetch(`/api/partenaires/${partnerId}/interactions`, { cache: \"no-store\" });\r\n      if (r.ok) {\r\n        const json = await r.json();\r\n        setData(json);\r\n      }\r\n    } catch (e) {\r\n      console.error(\"Erreur chargement interactions:\", e);\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  }\r\n\r\n  async function addInteraction() {\r\n    if (!form.sujet.trim()) {\r\n      alert(\"Sujet requis\");\r\n      return;\r\n    }\r\n\r\n    setAdding(true);\r\n    try {\r\n      const r = await fetch(`/api/partenaires/${partnerId}/interactions`, {\r\n        method: \"POST\",\r\n        headers: { \"Content-Type\": \"application/json\" },\r\n        body: JSON.stringify(form)\r\n      });\r\n\r\n      if (r.ok) {\r\n        await loadData();\r\n        setForm({\r\n          type_interaction: 'appel',\r\n          direction: 'sortant',\r\n          sujet: '',\r\n          notes: '',\r\n          participant: '',\r\n          duree_minutes: '',\r\n          prochaine_action: '',\r\n          rappel_date: ''\r\n        });\r\n        setShowForm(false);\r\n      } else {\r\n        throw new Error(\"Erreur création\");\r\n      }\r\n    } catch (e) {\r\n      console.error(\"Erreur ajout interaction:\", e);\r\n      alert(\"Erreur lors de l'ajout\");\r\n    } finally {\r\n      setAdding(false);\r\n    }\r\n  }\r\n\r\n  const getTypeIcon = (type) => {\r\n    switch (type) {\r\n      case 'appel': return '📞';\r\n      case 'email': return '✉️';\r\n      case 'reunion': return '🤝';\r\n      case 'relance': return '📋';\r\n      case 'note': return '📝';\r\n      default: return '📄';\r\n    }\r\n  };\r\n\r\n  const getTypeColor = (type) => {\r\n    switch (type) {\r\n      case 'appel': return 'bg-blue-50 border-l-blue-500';\r\n      case 'email': return 'bg-green-50 border-l-green-500';\r\n      case 'reunion': return 'bg-purple-50 border-l-purple-500';\r\n      case 'relance': return 'bg-orange-50 border-l-orange-500';\r\n      case 'note': return 'bg-gray-50 border-l-gray-500';\r\n      default: return 'bg-gray-50 border-l-gray-500';\r\n    }\r\n  };\r\n\r\n  if (!partnerId) {\r\n    return null;\r\n  }\r\n\r\n  if (loading) {\r\n    return (\r\n      <section className=\"border rounded p-4\">\r\n        <h3 className=\"text-lg font-semibold mb-3\">🤝 Suivi Commercial</h3>\r\n        <p className=\"text-gray-600\">Chargement...</p>\r\n      </section>\r\n    );\r\n  }\r\n\r\n  const interactions = data?.interactions || [];\r\n  const prochaines = data?.prochaines_actions || [];\r\n  const stats = data?.stats || {};\r\n  const types = data?.references?.types || [];\r\n  const directions = data?.references?.directions || [];\r\n  const suggestedContacts = data?.suggested_contacts || [];\r\n\r\n  // Fonction pour sélectionner un contact suggéré\r\n  const selectContact = (contact) => {\r\n    setForm(prev => ({\r\n      ...prev,\r\n      participant: contact.nom\r\n    }));\r\n  };\r\n\r\n  return (\r\n    <section className=\"border rounded p-4 space-y-4\">\r\n      <div className=\"flex items-center justify-between\">\r\n        <h3 className=\"text-lg font-semibold\">🤝 Suivi Commercial</h3>\r\n        <button\r\n          className=\"bg-blue-600 text-white px-3 py-2 rounded text-sm\"\r\n          onClick={() => setShowForm(!showForm)}\r\n        >\r\n          {showForm ? \"Annuler\" : \"+ Nouvelle interaction\"}\r\n        </button>\r\n      </div>\r\n\r\n      {/* Statistiques rapides */}\r\n      <div className=\"grid grid-cols-2 md:grid-cols-4 gap-3\">\r\n        <div className=\"bg-blue-50 p-3 rounded text-center\">\r\n          <div className=\"text-2xl font-bold text-blue-600\">{stats.total_interactions || 0}</div>\r\n          <div className=\"text-xs text-gray-600\">Total interactions</div>\r\n        </div>\r\n        <div className=\"bg-green-50 p-3 rounded text-center\">\r\n          <div className=\"text-2xl font-bold text-green-600\">{stats.interactions_30j || 0}</div>\r\n          <div className=\"text-xs text-gray-600\">Ce mois</div>\r\n        </div>\r\n        <div className=\"bg-purple-50 p-3 rounded text-center\">\r\n          <div className=\"text-2xl font-bold text-purple-600\">{stats.nb_reunions || 0}</div>\r\n          <div className=\"text-xs text-gray-600\">Réunions</div>\r\n        </div>\r\n        <div className=\"bg-orange-50 p-3 rounded text-center\">\r\n          <div className=\"text-2xl font-bold text-orange-600\">{stats.actions_en_attente || 0}</div>\r\n          <div className=\"text-xs text-gray-600\">Actions en attente</div>\r\n        </div>\r\n      </div>\r\n\r\n      {/* Prochaines actions */}\r\n      {prochaines.length > 0 && (\r\n        <div className=\"bg-yellow-50 border border-yellow-200 rounded p-3\">\r\n          <h4 className=\"font-medium text-yellow-800 mb-2\">⏰ Prochaines actions</h4>\r\n          <div className=\"space-y-1\">\r\n            {prochaines.map(action => (\r\n              <div key={action.id} className=\"text-sm\">\r\n                <span className=\"font-medium\">{action.prochaine_action}</span>\r\n                {action.rappel_date && (\r\n                  <span className=\"text-yellow-700 ml-2\">\r\n                    (Rappel: {fmt(action.rappel_date)})\r\n                  </span>\r\n                )}\r\n              </div>\r\n            ))}\r\n          </div>\r\n        </div>\r\n      )}\r\n\r\n      {/* Formulaire nouvelle interaction */}\r\n      {showForm && (\r\n        <div className=\"border rounded p-4 bg-gray-50\">\r\n          <h4 className=\"font-medium mb-3\">Nouvelle interaction</h4>\r\n          \r\n          <div className=\"grid md:grid-cols-2 gap-3\">\r\n            <label className=\"flex flex-col text-sm\">\r\n              <span className=\"mb-1 font-medium\">Type *</span>\r\n              <select\r\n                className=\"border rounded p-2\"\r\n                value={form.type_interaction}\r\n                onChange={(e) => setForm(prev => ({...prev, type_interaction: e.target.value}))}\r\n              >\r\n                {types.map(type => (\r\n                  <option key={type.value} value={type.value}>{type.label}</option>\r\n                ))}\r\n              </select>\r\n            </label>\r\n\r\n            <label className=\"flex flex-col text-sm\">\r\n              <span className=\"mb-1 font-medium\">Direction</span>\r\n              <select\r\n                className=\"border rounded p-2\"\r\n                value={form.direction}\r\n                onChange={(e) => setForm(prev => ({...prev, direction: e.target.value}))}\r\n              >\r\n                {directions.map(dir => (\r\n                  <option key={dir.value} value={dir.value}>{dir.label}</option>\r\n                ))}\r\n              </select>\r\n            </label>\r\n\r\n            <label className=\"flex flex-col text-sm md:col-span-2\">\r\n              <span className=\"mb-1 font-medium\">Sujet *</span>\r\n              <input\r\n                type=\"text\"\r\n                className=\"border rounded p-2\"\r\n                value={form.sujet}\r\n                onChange={(e) => setForm(prev => ({...prev, sujet: e.target.value}))}\r\n                placeholder=\"Ex: Suivi mensuel performance\"\r\n              />\r\n            </label>\r\n\r\n            <label className=\"flex flex-col text-sm\">\r\n              <span className=\"mb-1 font-medium\">Participant</span>\r\n              \r\n              {/* Contacts suggérés */}\r\n              {suggestedContacts.length > 0 && (\r\n                <div className=\"mb-2\">\r\n                  <div className=\"text-xs text-gray-600 mb-1\">Contacts suggérés :</div>\r\n                  <div className=\"flex flex-wrap gap-1\">\r\n                    {suggestedContacts.map((contact, i) => (\r\n                      <button\r\n                        key={i}\r\n                        type=\"button\"\r\n                        className=\"text-xs bg-blue-100 text-blue-700 px-2 py-1 rounded hover:bg-blue-200\"\r\n                        onClick={() => selectContact(contact)}\r\n                      >\r\n                        {contact.nom}\r\n                        {contact.type === 'Référent principal' && ' 👑'}\r\n                      </button>\r\n                    ))}\r\n                  </div>\r\n                </div>\r\n              )}\r\n              \r\n              {/* Champ de saisie */}\r\n              <input\r\n                type=\"text\"\r\n                className=\"border rounded p-2\"\r\n                value={form.participant}\r\n                onChange={(e) => setForm(prev => ({...prev, participant: e.target.value}))}\r\n                placeholder=\"Nom du contact ou sélectionnez ci-dessus\"\r\n                list=\"contacts-datalist\"\r\n              />\r\n              \r\n              {/* Datalist pour autocomplétion */}\r\n              <datalist id=\"contacts-datalist\">\r\n                {suggestedContacts.map((contact, i) => (\r\n                  <option key={i} value={contact.nom}>\r\n                    {contact.display}\r\n                  </option>\r\n                ))}\r\n              </datalist>\r\n            </label>\r\n\r\n            <label className=\"flex flex-col text-sm\">\r\n              <span className=\"mb-1 font-medium\">Durée (minutes)</span>\r\n              <input\r\n                type=\"number\"\r\n                className=\"border rounded p-2\"\r\n                value={form.duree_minutes}\r\n                onChange={(e) => setForm(prev => ({...prev, duree_minutes: e.target.value}))}\r\n                placeholder=\"30\"\r\n              />\r\n            </label>\r\n\r\n            <label className=\"flex flex-col text-sm md:col-span-2\">\r\n              <span className=\"mb-1 font-medium\">Notes</span>\r\n              <textarea\r\n                className=\"border rounded p-2 h-20\"\r\n                value={form.notes}\r\n                onChange={(e) => setForm(prev => ({...prev, notes: e.target.value}))}\r\n                placeholder=\"Détails de l'interaction...\"\r\n              />\r\n            </label>\r\n\r\n            <label className=\"flex flex-col text-sm\">\r\n              <span className=\"mb-1 font-medium\">Prochaine action</span>\r\n              <input\r\n                type=\"text\"\r\n                className=\"border rounded p-2\"\r\n                value={form.prochaine_action}\r\n                onChange={(e) => setForm(prev => ({...prev, prochaine_action: e.target.value}))}\r\n                placeholder=\"Ex: Programmer réunion bilan\"\r\n              />\r\n            </label>\r\n\r\n            <label className=\"flex flex-col text-sm\">\r\n              <span className=\"mb-1 font-medium\">Rappel le</span>\r\n              <input\r\n                type=\"date\"\r\n                className=\"border rounded p-2\"\r\n                value={form.rappel_date}\r\n                onChange={(e) => setForm(prev => ({...prev, rappel_date: e.target.value}))}\r\n              />\r\n            </label>\r\n          </div>\r\n\r\n          <div className=\"flex gap-2 mt-4\">\r\n            <button\r\n              className=\"bg-green-600 text-white px-4 py-2 rounded disabled:opacity-50\"\r\n              onClick={addInteraction}\r\n              disabled={adding || !form.sujet.trim()}\r\n            >\r\n              {adding ? \"Ajout...\" : \"✅ Ajouter\"}\r\n            </button>\r\n            <button\r\n              className=\"border px-4 py-2 rounded\"\r\n              onClick={() => setShowForm(false)}\r\n            >\r\n              Annuler\r\n            </button>\r\n          </div>\r\n        </div>\r\n      )}\r\n\r\n      {/* Liste des interactions */}\r\n      <div>\r\n        <h4 className=\"font-medium mb-3\">Historique des interactions</h4>\r\n        \r\n        {interactions.length === 0 ? (\r\n          <p className=\"text-gray-600 text-center py-4\">\r\n            Aucune interaction enregistrée. Ajoutez la première !\r\n          </p>\r\n        ) : (\r\n          <div className=\"space-y-3 max-h-96 overflow-y-auto\">\r\n            {interactions.map(interaction => (\r\n              <div \r\n                key={interaction.id} \r\n                className={`border-l-4 p-3 rounded ${getTypeColor(interaction.type_interaction)}`}\r\n              >\r\n                <div className=\"flex items-start justify-between\">\r\n                  <div className=\"flex items-center gap-2\">\r\n                    <span>{getTypeIcon(interaction.type_interaction)}</span>\r\n                    <div>\r\n                      <h5 className=\"font-medium\">{interaction.sujet}</h5>\r\n                      <div className=\"text-sm text-gray-600\">\r\n                        {interaction.type_interaction} {interaction.direction} \r\n                        {interaction.participant && (\r\n                          <>\r\n                            {\" avec \"}\r\n                            <span className=\"font-medium\">{interaction.participant}</span>\r\n                            {/* Indiquer si c'est un contact connu */}\r\n                            {suggestedContacts.find(c => c.nom === interaction.participant) && (\r\n                              <span className=\"text-xs bg-green-100 text-green-700 px-1 rounded ml-1\">\r\n                                {suggestedContacts.find(c => c.nom === interaction.participant)?.type === 'Référent principal' ? '👑' : '✓'}\r\n                              </span>\r\n                            )}\r\n                          </>\r\n                        )}\r\n                        {interaction.duree_minutes && ` (${interaction.duree_minutes}min)`}\r\n                      </div>\r\n                    </div>\r\n                  </div>\r\n                  <span className=\"text-xs text-gray-500\">\r\n                    {fmtDateTime(interaction.date_interaction)}\r\n                  </span>\r\n                </div>\r\n\r\n                {interaction.notes && (\r\n                  <div className=\"text-sm mt-2 bg-white p-2 rounded\">\r\n                    {interaction.notes}\r\n                  </div>\r\n                )}\r\n\r\n                {interaction.prochaine_action && (\r\n                  <div className=\"text-sm mt-2 text-orange-700 bg-orange-100 p-2 rounded\">\r\n                    <strong>→ Prochaine action:</strong> {interaction.prochaine_action}\r\n                    {interaction.rappel_date && (\r\n                      <span className=\"ml-2\">(Rappel: {fmt(interaction.rappel_date)})</span>\r\n                    )}\r\n                  </div>\r\n                )}\r\n\r\n                <div className=\"text-xs text-gray-400 mt-2\">\r\n                  Par {interaction.created_by}\r\n                </div>\r\n              </div>\r\n            ))}\r\n          </div>\r\n        )}\r\n      </div>\r\n\r\n      {stats.derniere_interaction && (\r\n        <div className=\"text-xs text-gray-500 text-center pt-2 border-t\">\r\n          Dernière interaction: {fmtDateTime(stats.derniere_interaction)}\r\n        </div>\r\n      )}\r\n    </section>\r\n  );\r\n}"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 2665, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/giorn/Desktop/Projet/Medina/Micro_entreprise/Mockfront/ME-main/app/%28crm%29/crm/partenaires/%5Bid%5D/InvoicesCommissionsCard.js"],"sourcesContent":["\"use client\";\r\nimport { useEffect, useState } from \"react\";\r\n\r\nconst fmt = (d) => (d ? new Date(d).toLocaleDateString(\"fr-FR\") : \"—\");\r\nconst num = (n) => (n === 0 ? \"0\" : n != null ? Number(n).toLocaleString(\"fr-FR\") : \"—\");\r\n\r\nexport default function InvoicesCommissionsCard({ partnerId, data }) {\r\n  const [state, setState] = useState({ loading: false, error: null, model: null });\r\n  const [showForm, setShowForm] = useState(false);\r\n  const [form, setForm] = useState({\r\n    periode: new Date().toISOString().slice(0, 7), // \"YYYY-MM\"\r\n    echeance_jours: 30\r\n  });\r\n  const [generating, setGenerating] = useState(false);\r\n  const [preview, setPreview] = useState(null);\r\n\r\n  useEffect(() => {\r\n    if (data) build(data);\r\n    else if (partnerId) load();\r\n    // eslint-disable-next-line react-hooks/exhaustive-deps\r\n  }, [partnerId, data]);\r\n\r\n  useEffect(() => {\r\n  if (!partnerId) return;\r\n  const today = new Date();\r\n  if (today.getUTCDate() !== 1) return;\r\n\r\n  const prev = new Date(Date.UTC(today.getUTCFullYear(), today.getUTCMonth()-1, 1));\r\n  const period = `${prev.getUTCFullYear()}-${String(prev.getUTCMonth()+1).padStart(2,\"0\")}`;\r\n  const key = `autoClose:${partnerId}:${period}`;\r\n  if (localStorage.getItem(key)) return; // déjà fait\r\n\r\n  fetch(\"/api/partenaires/close-month\", {\r\n    method: \"POST\",\r\n    headers: { \"Content-Type\": \"application/json\" },\r\n    body: JSON.stringify({ period, partnerId })\r\n  })\r\n    .then(() => {\r\n      localStorage.setItem(key, \"1\");\r\n      return load();\r\n    })\r\n    .catch(() => {/* silencieux */});\r\n}, [partnerId]);\r\n\r\n\r\n  async function load() {\r\n    try {\r\n      setState((s) => ({ ...s, loading: true, error: null }));\r\n      const r = await fetch(`/api/partenaires/${partnerId}`, { cache: \"no-store\" });\r\n      if (!r.ok) throw new Error(`HTTP ${r.status}`);\r\n      build(await r.json());\r\n    } catch (e) {\r\n      console.error(e);\r\n      setState({ loading: false, error: \"Impossible de charger les factures\", model: null });\r\n    }\r\n  }\r\n\r\n  function build(raw) {\r\n    const p = raw.partenaire || {};\r\n    const ca = Array.isArray(raw.ca_par_periode) ? raw.ca_par_periode : [];\r\n    const factures = Array.isArray(raw.factures) ? [...raw.factures] : [];\r\n\r\n    const taux = Number(p.taux_commission) || 0;\r\n    const nowMonth = new Date().toISOString().slice(0, 7);\r\n    const caMois = Number(ca.find((x) => x.periode === nowMonth)?.ca) || 0;\r\n\r\n    const commissionsMois = Number((caMois * taux / 100).toFixed(2));\r\n\r\n    const thisYear = new Date().getFullYear().toString();\r\n    const caAnnuel = ca\r\n      .filter((x) => String(x.periode || \"\").startsWith(thisYear))\r\n      .reduce((s, x) => s + (Number(x.ca) || 0), 0);\r\n    const commissionsAnnuelles = Number((caAnnuel * taux / 100).toFixed(2));\r\n\r\n    const payees = factures.filter((f) => f.statut === \"payee\");\r\n    const impayees = factures.filter((f) => f.statut !== \"payee\"); // tout sauf payée\r\n    const montantImpaye = impayees.reduce((s, f) => s + (Number(f.montant) || 0), 0);\r\n    const montantPaye = payees.reduce((s, f) => s + (Number(f.montant) || 0), 0);\r\n\r\n    const today = new Date().toISOString().slice(0, 10);\r\n    const enRetard = impayees.filter((f) => f.echeance && f.echeance < today);\r\n    const d30 = new Date();\r\n    d30.setDate(d30.getDate() + 30);\r\n    const prochaines = impayees.filter((f) => f.echeance && f.echeance <= d30.toISOString().slice(0, 10));\r\n\r\n    factures.sort((a, b) => new Date(b.date || 0) - new Date(a.date || 0));\r\n\r\n    setState({\r\n      loading: false,\r\n      error: null,\r\n      model: {\r\n        commissions: { ceMois: commissionsMois, caCeMois: caMois, tauxCommission: taux, periode: nowMonth, commissionsAnnuelles },\r\n        factures: { toutes: factures, impayees, payees, enRetard },\r\n        totaux: { montantImpaye, montantPaye, nombreImpayees: impayees.length, nombrePayees: payees.length },\r\n        alertes: { retard: enRetard.length, prochainesEcheances: prochaines.length },\r\n        coord: p.coordonnees_facturation || {},\r\n        partner: p\r\n      }\r\n    });\r\n  }\r\n\r\n  async function previewInvoice() {\r\n  try {\r\n    setGenerating(true);\r\n    setPreview(null);\r\n    const r = await fetch(`/api/partenaires/${partnerId}/invoices`, {\r\n      method: \"POST\",\r\n      headers: { \"Content-Type\": \"application/json\" },\r\n      body: JSON.stringify({ action: \"preview\", period: form.periode })\r\n    });\r\n    const j = await r.json().catch(() => ({}));\r\n    if (!r.ok) throw new Error(j.detail || j.error || `HTTP ${r.status}`);\r\n\r\n    const p = j.preview || {};\r\n    // normalisation champs\r\n    const normalized = {\r\n      periode: p.periode || p.period || form.periode,\r\n      dossiers_count: p.dossiers_count ?? p.dossiers ?? 0,\r\n      commission_eur: p.commission_eur ?? p.montant ?? 0\r\n    };\r\n    setPreview(normalized);\r\n  } catch (e) {\r\n    alert(`❌ Aperçu impossible: ${e.message}`);\r\n  } finally {\r\n    setGenerating(false);\r\n  }\r\n}\r\n\r\n\r\n  async function generateInvoice() {\r\n    try {\r\n      setGenerating(true);\r\n      const r = await fetch(`/api/partenaires/${partnerId}/invoices`, {\r\n        method: \"POST\",\r\n        headers: { \"Content-Type\": \"application/json\" },\r\n        // même contrat que la page qui fonctionne\r\n        body: JSON.stringify({\r\n          action: \"create\",\r\n          period: form.periode,                 // \"YYYY-MM\"\r\n          echeance_jours: form.echeance_jours || 30\r\n        })\r\n      });\r\n      const j = await r.json().catch(() => ({}));\r\n      if (!r.ok) throw new Error(j.detail || j.error || `HTTP ${r.status}`);\r\n\r\n\r\n      alert(\"✅ Facture générée avec succès\");\r\n      setShowForm(false);\r\n      setForm({ periode: new Date().toISOString().slice(0, 7), echeance_jours: 30 });\r\n      setPreview(j.preview || null);\r\n\r\n      // recharger les données\r\n      await load();\r\n    } catch (e) {\r\n      console.error(e);\r\n      alert(`❌ Erreur: ${e.message}`);\r\n    } finally {\r\n      setGenerating(false);\r\n    }\r\n  }\r\n\r\n  async function download(f) {\r\n  try {\r\n    if (f.pdf && f.pdf.startsWith(\"http\")) return window.open(f.pdf, \"_blank\");\r\n    const r = await fetch(`/api/partenaires/${partnerId}/invoices/${f.id}/pdf`);\r\n    if (!r.ok) throw new Error(\"Document non disponible\");\r\n    const blob = await r.blob();\r\n    const url = URL.createObjectURL(blob);\r\n    const a = Object.assign(document.createElement(\"a\"), { href: url, download: `facture_${f.id}.pdf` });\r\n    document.body.appendChild(a); a.click(); URL.revokeObjectURL(url); a.remove();\r\n  } catch (e) {\r\n    console.error(e);\r\n    alert(\"❌ Impossible de télécharger la facture\");\r\n  }\r\n}\r\n\r\n  // reset l'aperçu quand on change la période\r\n  useEffect(() => { setPreview(null); }, [form.periode]);\r\n\r\n  if (state.loading && !state.model) {\r\n    return (\r\n      <section className=\"bg-white border rounded-lg p-6\">\r\n        <h3 className=\"text-lg font-semibold\">💰 Facturation & Commissions</h3>\r\n      </section>\r\n    );\r\n  }\r\n  if (state.error) {\r\n    return (\r\n      <section className=\"bg-white border rounded-lg p-6\">\r\n        <h3 className=\"text-lg font-semibold mb-4\">💰 Facturation & Commissions</h3>\r\n        <div className=\"bg-red-50 border border-red-200 rounded p-4\">\r\n          <div className=\"text-red-800\">❌ {state.error}</div>\r\n          <button onClick={load} className=\"mt-2 text-sm bg-red-600 text-white px-3 py-1 rounded hover:bg-red-700\">🔄 Réessayer</button>\r\n        </div>\r\n      </section>\r\n    );\r\n  }\r\n  if (!state.model) return null;\r\n\r\n  const m = state.model;\r\n\r\n  function currentYYYYMM() {\r\n    return new Date().toISOString().slice(0, 7);\r\n  }\r\n\r\n  function displayStateLabel(f) {\r\n    if (f?.statut === 'payee') return \"Clôturée\";\r\n    const nowYM = new Date().toISOString().slice(0, 7);\r\n    return String(f.periode) < nowYM ? \"Clôturée\" : \"Temporaire\";\r\n  }\r\n\r\n  function stateBadge(f) {\r\n    const label = displayStateLabel(f);\r\n    const map = {\r\n      \"Clôturée\":  [\"bg-green-100 text-green-800\", \"✅ Clôturée\"],\r\n      \"Temporaire\":[\"bg-orange-100 text-orange-800\", \"⏳ Temporaire\"],\r\n    };\r\n    const [cls, text] = map[label] || [\"bg-gray-100 text-gray-800\", `📋 ${label}`];\r\n    return <span className={`inline-flex items-center px-2 py-1 text-xs font-medium rounded-full ${cls}`}>{text}</span>;\r\n  }\r\n\r\n  return (\r\n    <section className=\"bg-white border rounded-lg p-6\">\r\n      <div className=\"flex items-center justify-between mb-6\">\r\n        <h3 className=\"text-lg font-semibold\">💰 Facturation & Commissions</h3>\r\n        <div className=\"flex gap-2\">\r\n          <button onClick={load} className=\"text-xs bg-blue-100 hover:bg-blue-200 text-blue-700 px-3 py-2 rounded-md\">\r\n            🔄 Actualiser\r\n          </button>\r\n          <button onClick={() => setShowForm((s) => !s)} className=\"text-sm bg-green-600 text-white px-4 py-2 rounded-md hover:bg-green-700\">\r\n            {showForm ? \"Annuler\" : \"+ Générer facture\"}\r\n          </button>\r\n        </div>\r\n      </div>\r\n\r\n      <button\r\n        onClick={async () => {\r\n          try {\r\n            const res = await fetch(\"/api/partenaires/close-month\", {\r\n              method: \"POST\",\r\n              headers: { \"Content-Type\": \"application/json\" },\r\n              body: JSON.stringify({\r\n                period: new Date().toISOString().slice(0,7), // mois courant\r\n                partnerId\r\n              })\r\n            });\r\n            if (!res.ok) {\r\n              const j = await res.json().catch(() => ({}));\r\n              throw new Error(j.details || j.error || `HTTP ${res.status}`);\r\n            }\r\n            await load();\r\n            alert(\"✅ Facture clôturée avec succès !\");\r\n          } catch (e) {\r\n            alert(`❌ Impossible de clôturer la facture : ${e.message}`);\r\n          }\r\n        }}\r\n        className=\"text-xs bg-gray-100 hover:bg-gray-200 text-gray-700 px-3 py-2 rounded-md mb-6\"\r\n      >\r\n        🔒 Clôturer ce mois\r\n      </button>\r\n\r\n      <div className=\"mb-6\">\r\n        <h4 className=\"text-sm font-medium text-gray-700 mb-3\">💸 Commissions à recevoir</h4>\r\n        <div className=\"grid grid-cols-1 md:grid-cols-3 gap-4\">\r\n            <Box title=\"Ce mois (temporaire)\" value={`${num(m.commissions.ceMois)}€`} subtitle={`CA: ${num(m.commissions.caCeMois)}€`} />\r\n            <Box title=\"Taux commission\" value={`${num(m.commissions.tauxCommission)}%`} />\r\n            <Box title=\"Période\" value={m.commissions.periode} subtitle=\"YYYY-MM\" />\r\n          </div>\r\n          <p className=\"mt-2 text-xs text-gray-500\">\r\n            Montant temporaire — la facture du mois précédent est générée et marquée « payée » automatiquement le 1er du mois.\r\n          </p>\r\n      </div>\r\n\r\n      <div className=\"mb-6\">\r\n        <h4 className=\"text-sm font-medium text-gray-700 mb-3\">🧾 État facturation</h4>\r\n        <div className=\"grid grid-cols-1 md:grid-cols-3 gap-4\">\r\n          <Box title=\"En attente\" value={`${num(m.totaux.montantImpaye)}€`} subtitle={`${m.totaux.nombreImpayees} facture(s)`} />\r\n          <Box title=\"Payé\" value={`${num(m.totaux.montantPaye)}€`} subtitle={`${m.totaux.nombrePayees} facture(s)`} />\r\n          <Box title=\"Total factures\" value={m.factures.toutes.length} subtitle=\"Historique\" />\r\n        </div>\r\n      </div>\r\n\r\n      {showForm && (\r\n        <div className=\"mb-6 p-4 bg-gray-50 border rounded-lg\">\r\n          <h4 className=\"font-medium mb-3\">Générer une nouvelle facture</h4>\r\n          <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\r\n            <label className=\"flex flex-col text-sm\">\r\n              <span className=\"mb-1 font-medium\">Période *</span>\r\n              <input\r\n                type=\"month\"\r\n                value={form.periode}\r\n                onChange={(e) => setForm((f) => ({ ...f, periode: e.target.value }))}\r\n                className=\"border rounded px-3 py-2\"\r\n              />\r\n            </label>\r\n            <label className=\"flex flex-col text-sm\">\r\n              <span className=\"mb-1 font-medium\">Échéance (jours)</span>\r\n              <input\r\n                type=\"number\"\r\n                min=\"1\"\r\n                max=\"90\"\r\n                value={form.echeance_jours}\r\n                onChange={(e) => setForm((f) => ({ ...f, echeance_jours: parseInt(e.target.value || \"0\", 10) }))}\r\n                className=\"border rounded px-3 py-2\"\r\n              />\r\n            </label>\r\n          </div>\r\n          <div className=\"flex gap-2 mt-4\">\r\n            <button onClick={previewInvoice} disabled={generating || !form.periode} className=\"border px-4 py-2 rounded\">\r\n              {generating ? \"…\" : \"👁️ Prévisualiser\"}\r\n            </button>\r\n            <button onClick={generateInvoice} disabled={generating || !form.periode} className=\"bg-green-600 text-white px-4 py-2 rounded\">\r\n              {generating ? \"⏳ Génération…\" : \"✅ Générer facture\"}\r\n            </button>\r\n            <button onClick={() => setShowForm(false)} className=\"border px-4 py-2 rounded\">Annuler</button>\r\n          </div>\r\n\r\n          {preview && (\r\n            <div className=\"mt-4 text-sm text-gray-700\">\r\n              <div>Période : <b>{preview.periode}</b></div>\r\n              <div>Dossiers pris en compte : <b>{preview.dossiers_count}</b></div>\r\n              <div>Montant total commissions : <b>{num(preview.commission_eur)}€</b></div>\r\n            </div>\r\n          )}\r\n\r\n        </div>\r\n      )}\r\n\r\n      <div className=\"mb-6\">\r\n        <h4 className=\"text-sm font-medium text-gray-700 mb-3\">📄 Historique des factures</h4>\r\n        {m.factures.toutes.length === 0 ? (\r\n          <div className=\"text-center py-8 text-gray-500\">—</div>\r\n        ) : (\r\n          <div className=\"overflow-x-auto\">\r\n            <table className=\"min-w-full\">\r\n              <thead className=\"bg-gray-50\">\r\n                <tr>\r\n                  <th className=\"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase\">Facture</th>\r\n                  <th className=\"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase\">Période</th>\r\n                  <th className=\"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase\">Montant</th>\r\n                  <th className=\"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase\">État</th>\r\n                  <th className=\"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase\">Échéance</th>\r\n                  <th className=\"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase\">Actions</th>\r\n                </tr>\r\n              </thead>\r\n              <tbody className=\"bg-white divide-y divide-gray-200\">\r\n                {m.factures.toutes.slice(0, 10).map((f) => (\r\n                  <tr key={f.id} className=\"hover:bg-gray-50\">\r\n                    <td className=\"px-4 py-4\">\r\n                      <div className=\"font-medium text-gray-900\">#{f.id}</div>\r\n                      <div className=\"text-xs text-gray-500\">{fmt(f.date)}</div>\r\n                    </td>\r\n                    <td className=\"px-4 py-4 text-sm\">{f.periode || \"—\"}</td>\r\n                    <td className=\"px-4 py-4 text-sm font-medium\">{num(f.montant)}€</td>\r\n                    <td className=\"px-4 py-4 text-sm\">{stateBadge(f)}</td>\r\n                    <td className=\"px-4 py-4 text-sm\">\r\n                      <div>{fmt(f.echeance)}</div>\r\n                      {f.echeance && new Date(f.echeance) < new Date() && f.statut !== \"payee\" && (\r\n                        <div className=\"text-xs text-red-600 font-medium\">En retard</div>\r\n                      )}\r\n                    </td>\r\n                    <td className=\"px-4 py-4\">\r\n                    <button onClick={() => download(f)} className=\"bg-blue-600 text-white px-3 py-1 rounded text-xs hover:bg-blue-700\">\r\n                      📥 PDF\r\n                    </button>\r\n                  </td>\r\n                  </tr>\r\n                ))}\r\n              </tbody>\r\n            </table>\r\n            {m.factures.toutes.length > 10 && (\r\n              <div className=\"text-center py-3 text-sm text-gray-500\">\r\n                Et {m.factures.toutes.length - 10} autres factures…\r\n              </div>\r\n            )}\r\n          </div>\r\n        )}\r\n      </div>\r\n\r\n      <div className=\"bg-gray-50 rounded-lg p-4 text-sm\">\r\n        <h4 className=\"font-medium mb-2\">📮 Coordonnées de facturation</h4>\r\n        <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\r\n          <div>\r\n            <div className=\"font-medium\">{m.coord.societe || m.partner.nom || \"—\"}</div>\r\n            <div className=\"text-gray-600\">{m.coord.adresse || \"—\"}</div>\r\n          </div>\r\n          <div>\r\n            <div><strong>Email:</strong> {m.coord.email_facturation || \"—\"}</div>\r\n            <div><strong>Mode paiement:</strong> {m.partner.paiement?.mode || \"—\"}</div>\r\n            {m.partner.paiement?.iban && <div><strong>IBAN:</strong> {m.partner.paiement.iban.slice(0, 8)}…</div>}\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </section>\r\n  );\r\n}\r\n\r\nfunction Box({ title, value, subtitle }) {\r\n  return (\r\n    <div className=\"bg-gray-50 border border-gray-200 rounded-lg p-4 text-center\">\r\n      <div className=\"text-2xl font-bold text-gray-900\">{value}</div>\r\n      <div className=\"text-sm font-medium text-gray-700\">{title}</div>\r\n      {subtitle && <div className=\"text-xs text-gray-500 mt-1\">{subtitle}</div>}\r\n    </div>\r\n  );\r\n}"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 3745, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/giorn/Desktop/Projet/Medina/Micro_entreprise/Mockfront/ME-main/app/%28crm%29/crm/entreprises/%5Bid%5D/EntrepriseCard.js"],"sourcesContent":["\"use client\";\r\nimport Link from \"next/link\";\r\n\r\n/* ---------- Helpers ---------- */\r\n\r\n// Date sûre (retourne \"—\" si invalide)\r\nfunction fmt(d) {\r\n  if (!d) return \"—\";\r\n  const dt = new Date(d);\r\n  if (!Number.isFinite(dt.getTime())) return \"—\";\r\n  try {\r\n    return dt.toLocaleDateString(\"fr-FR\");\r\n  } catch {\r\n    return \"—\";\r\n  }\r\n}\r\n\r\n// Tri-état booléen, en acceptant 1/0 et strings\r\nfunction toBoolOrUndef(v) {\r\n  if (v === true || v === false) return v;\r\n  if (v === 1 || v === 0) return Boolean(v);\r\n  if (typeof v === \"string\") {\r\n    const s = v.trim().toLowerCase();\r\n    if (s === \"true\" || s === \"oui\") return true;\r\n    if (s === \"false\" || s === \"non\") return false;\r\n  }\r\n  return undefined;\r\n}\r\nconst showBool = (v) => {\r\n  const b = toBoolOrUndef(v);\r\n  return b === true ? \"Oui\" : b === false ? \"Non\" : \"—\";\r\n};\r\n\r\n// Affiche valeur telle quelle, ou \"—\" si null/undefined/\"\"\r\nconst show = (v) => (v ?? v === 0 ? String(v) : \"—\");\r\n\r\n// Concatène des morceaux (ex: adresse) en filtrant vides/\"—\"\r\nfunction joinClean(parts, sep = \", \") {\r\n  const cleaned = parts\r\n    .map((x) => (x ?? x === 0 ? String(x) : \"\"))\r\n    .map((x) => x.trim())\r\n    .filter((x) => x && x !== \"—\");\r\n  return cleaned.length ? cleaned.join(sep) : \"—\";\r\n}\r\n\r\n/* ---------- Composant ---------- */\r\n\r\nexport default function EntrepriseCard({ data }) {\r\n  if (!data?.entreprise) return null;\r\n\r\n  const e = data.entreprise;\r\n  const docs = Array.isArray(data.documents_generes) ? data.documents_generes : [];\r\n  const jobs = Array.isArray(data.scraping_jobs) ? data.scraping_jobs : [];\r\n  const dossiers = Array.isArray(data.dossiers) ? data.dossiers : [];\r\n\r\n  // Compat: mêmes infos, 2 chemins possibles (tout vient de la BDD)\r\n  const INPI   = e.donnees_gouvernement?.guichet_unique_INPI ?? e.gov_inpi ?? {};\r\n  const INSEE  = e.donnees_gouvernement?.INSEE_SIRENE        ?? e.gov_insee ?? {};\r\n  const URSSAF = e.donnees_gouvernement?.URSSAF              ?? e.gov_urssaf ?? {};\r\n  const RNE    = e.donnees_gouvernement?.RNE                 ?? e.gov_rne ?? {};\r\n\r\n  const TVA    = e.options_fiscales ?? {};\r\n  const check  = e.checklist_conformite ?? {};\r\n  const tit    = e.titulaire_client;\r\n\r\n  // Adresse: on construit proprement sans “—, — —”\r\n  const adr = e.lieu_exercice?.adresse_etablissement ?? e.lieu_exercice?.adresse ?? {};\r\n  const adresseLigne = joinClean([adr.ligne1, adr.code_postal, adr.ville], \" \");\r\n\r\n  // Activité: description/libellé avec fallback net\r\n  const activiteLabel = e.activite?.description ?? e.activite?.libelle ?? \"\";\r\n\r\n  // INSEE/SIRENE: champs normalisés\r\n  const siren = INSEE.SIREN ?? INSEE.siren;\r\n  const siret = INSEE.SIRET_principal ?? INSEE.siret;\r\n  const ape   = INSEE.code_APE ?? INSEE.ape;\r\n\r\n  // URSSAF: n° affiché uniquement s’il existe\r\n  const urssafStatut = URSSAF.affiliation ?? URSSAF.statut;\r\n  const urssafNumero = URSSAF.numero_affiliation ?? URSSAF.numero_compte;\r\n\r\n  // Options sociales: gardes simples\r\n  const os = e.options_sociales ?? {};\r\n\r\n  return (\r\n    <section>\r\n      <h3 className=\"text-lg font-semibold mb-4\">🏢 Mon entreprise</h3>\r\n      <div className=\"bg-white border rounded p-4 space-y-5\">\r\n        {/* En-tête */}\r\n        <div className=\"border-b pb-3\">\r\n          <h4 className=\"font-semibold text-lg\">{show(e.denomination)}</h4>\r\n          <div className=\"flex flex-wrap gap-4 text-sm text-gray-600 mt-1\">\r\n            <span><strong>Forme:</strong> {show(e.forme)}</span>\r\n            <span><strong>Statut:</strong> {show(e.statut_dossier)}</span>\r\n            <span>\r\n              <strong>Titulaire:</strong>{\" \"}\r\n              {tit ? (\r\n                <Link href={`/crm/clients/${tit.id}`} className=\"underline\">\r\n                  {show(joinClean([tit.prenom, tit.nom], \" \"))}\r\n                </Link>\r\n              ) : \"—\"}\r\n            </span>\r\n          </div>\r\n        </div>\r\n\r\n        {/* Activité & lieu */}\r\n        <div>\r\n          <h5 className=\"font-medium text-blue-800 mb-2\">📍 Activité & lieu</h5>\r\n          <ul className=\"list-disc pl-6 text-sm\">\r\n            <li>Activité: {show(activiteLabel)}</li>\r\n            <li>Catégorie: {show(e.activite?.categorie)} — APE/NAF: {show(e.activite?.APE_NAF ?? e.activite?.code_ape)}</li>\r\n            <li>Réglem.: {showBool(e.activite?.profession_reglementee)}</li>\r\n            <li>Établissement: {adresseLigne}</li>\r\n          </ul>\r\n        </div>\r\n\r\n        {/* Dates */}\r\n        <div>\r\n          <h5 className=\"font-medium text-green-800 mb-2\">📅 Dates importantes</h5>\r\n          <ul className=\"list-disc pl-6 text-sm\">\r\n            <li>Demande: {fmt(e.dates?.date_demande ?? e.dates?.demande)}</li>\r\n            <li>Début d’activité: {fmt(e.dates?.date_debut_activite ?? e.dates?.debut_activite)}</li>\r\n            <li>Immatriculation réelle: {fmt(e.dates?.date_immatriculation_reelle ?? e.dates?.immatriculation_reelle)}</li>\r\n          </ul>\r\n        </div>\r\n\r\n        {/* Options sociales & fiscales */}\r\n        {(e.options_sociales || e.options_fiscales) && (\r\n          <div>\r\n            <h5 className=\"font-medium text-purple-800 mb-2\">⚖️ Options sociales & fiscales</h5>\r\n            <ul className=\"list-disc pl-6 text-sm\">\r\n              <li>Régime: {show(os.regime)}</li>\r\n              <li>Périodicité: {show(os.periodicite_versement ?? os.periodicite)}</li>\r\n              <li>Franchise TVA: {showBool(TVA.franchise_TVA ?? TVA.franchise_tva)}</li>\r\n              <li>N° TVA intracom: {show(TVA.numero_TVA_intracom ?? TVA.numero_tva)}</li>\r\n              <li>Versement libératoire IR: {showBool(TVA.versement_liberatoire_IR ?? TVA.versement_liberatoire)}</li>\r\n              <li>Compta simplifiée: {showBool(TVA.comptabilite_simplifiee)}</li>\r\n            </ul>\r\n          </div>\r\n        )}\r\n\r\n        {/* Données gouvernement */}\r\n        <div>\r\n          <h5 className=\"font-medium text-red-800 mb-2\">🏛️ Données gouvernement</h5>\r\n          <ul className=\"list-disc pl-6 text-sm\">\r\n            <li>\r\n              INPI: {show(INPI.etat ?? INPI.statut)} — dossier {show(INPI.numero_dossier ?? INPI.dossier)} — MAJ {fmt(INPI.derniere_mise_a_jour ?? INPI.derniere_maj)}\r\n            </li>\r\n            <li>\r\n              INSEE/SIRENE — SIREN {show(siren)}, SIRET {show(siret)}, APE {show(ape)}\r\n            </li>\r\n            <li>\r\n              URSSAF — {show(urssafStatut)}\r\n              {urssafNumero ? `, n° ${urssafNumero}` : \"\"}\r\n            </li>\r\n            <li>RNE — {show(RNE.inscription ?? RNE.statut)}</li>\r\n          </ul>\r\n        </div>\r\n\r\n        {/* Conformité */}\r\n        {check && Object.keys(check).length > 0 && (\r\n          <div>\r\n            <h5 className=\"font-medium text-green-800 mb-2\">✅ Conformité (checklist)</h5>\r\n            <div className=\"grid md:grid-cols-2 gap-2 text-sm\">\r\n              {Object.entries(check).map(([k, v]) => {\r\n                const ok = v === \"ok\" || v === true || v === 1 || (typeof v === \"string\" && v.toLowerCase() === \"true\");\r\n                const ko = v === \"ko\" || v === false || v === 0 || (typeof v === \"string\" && v.toLowerCase() === \"false\");\r\n                return (\r\n                  <div key={k} className=\"flex items-center gap-2\">\r\n                    <span className={ok ? \"text-green-600\" : ko ? \"text-red-600\" : \"text-gray-500\"}>\r\n                      {ok ? \"✅\" : ko ? \"❌\" : \"—\"}\r\n                    </span>\r\n                    <span>{k.replace(/_/g, \" \")}: {show(v)}</span>\r\n                  </div>\r\n                );\r\n              })}\r\n            </div>\r\n          </div>\r\n        )}\r\n\r\n        {/* Documents générés */}\r\n        <div>\r\n          <h5 className=\"font-medium text-gray-800 mb-2\">📋 Documents générés</h5>\r\n          {docs.length ? (\r\n            <ul className=\"space-y-1 text-sm\">\r\n              {docs.map((d, i) => (\r\n                <li key={i}>\r\n                  {fmt(d.date)} — {show(d.type)} — {show(d.fichier)} — source {show(d.source)}\r\n                </li>\r\n              ))}\r\n            </ul>\r\n          ) : (\r\n            <p className=\"text-sm text-gray-600\">—</p>\r\n          )}\r\n        </div>\r\n\r\n        {/* Scraping jobs */}\r\n        <div>\r\n          <h5 className=\"font-medium text-gray-800 mb-2\">🕸️ Scraping jobs</h5>\r\n          {jobs.length ? (\r\n            <ul className=\"space-y-1 text-sm\">\r\n              {jobs.map((j) => (\r\n                <li key={j.id ?? `${j.portail}-${j.updated_at ?? \"\"}`}>\r\n                  {show(j.portail)} — {show(j.etat)} — {show(j.last_event)} — MAJ {fmt(j.updated_at)}\r\n                </li>\r\n              ))}\r\n            </ul>\r\n          ) : (\r\n            <p className=\"text-sm text-gray-600\">—</p>\r\n          )}\r\n        </div>\r\n\r\n        {/* Dossiers reliés */}\r\n        <div>\r\n          <h5 className=\"font-medium text-gray-800 mb-2\">📂 Dossiers reliés</h5>\r\n          {dossiers.length ? (\r\n            <ul className=\"space-y-1 text-sm\">\r\n              {dossiers.map((d) => (\r\n                <li key={d.id}>\r\n                  Dossier #{show(d.id)} — statut {show(d.statut)} — client{\" \"}\r\n                  {d.client_id ? (\r\n                    <Link className=\"underline\" href={`/crm/clients/${d.client_id}`}>#{show(d.client_id)}</Link>\r\n                  ) : \"—\"}\r\n                </li>\r\n              ))}\r\n            </ul>\r\n          ) : (\r\n            <p className=\"text-sm text-gray-600\">—</p>\r\n          )}\r\n        </div>\r\n      </div>\r\n    </section>\r\n  );\r\n}\r\n"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 4418, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/giorn/Desktop/Projet/Medina/Micro_entreprise/Mockfront/ME-main/app/%28crm%29/crm/dashboard/page.js"],"sourcesContent":["\"use client\";\r\n\r\nimport { useEffect, useMemo, useState } from \"react\";\r\nimport Link from \"next/link\";\r\n\r\n/* ====== COMPOSANTS RÉUTILISÉS (chemins relatifs depuis /dashboard) ====== */\r\nimport DossierTimeline from \"../clients/[id]/DossierTimeline\";\r\nimport ClientIdentityCard from \"../clients/[id]/ClientIdentityCard\";\r\nimport PiecesJustificativesCard from \"../clients/[id]/PiecesJustificativesCard\";\r\nimport CommsHistory from \"../clients/[id]/CommsHistory\";\r\nimport ClientMessaging from \"../clients/[id]/ClientMessaging\";\r\n\r\n// 👉 côté partenaire\r\nimport PartnerTracking from \"../partenaires/[id]/PartnerTracking\";\r\nimport InvoicesCommissionsCard from \"../partenaires/[id]/InvoicesCommissionsCard\";\r\n\r\n// 👉 carte entreprise existante\r\nimport EntrepriseCard from \"../entreprises/[id]/EntrepriseCard\";\r\n\r\n\r\n/* ====== UTILS ====== */\r\nfunction parseISO(d){ return d ? new Date(d) : null; }\r\nfunction inRange(d, from, to){\r\n  if (!d) return true;\r\n  const dt = typeof d === \"string\" ? new Date(d) : d;\r\n  if (from && dt < from) return false;\r\n  if (to) { const end = new Date(to); end.setHours(23,59,59,999); if (dt > end) return false; }\r\n  return true;\r\n}\r\nconst fmt = (d) => d ? new Date(d).toLocaleString(\"fr-FR\") : \"-\";\r\nfunction euro(n){ if(n === 0) return \"0€\"; if(n == null) return \"—\"; return `${Number(n).toLocaleString(\"fr-FR\")}€`; }\r\nfunction safe(s){ return s ?? \"—\"; }\r\n\r\n/* ====== CARTES ALERTE & ACTIVITÉ ====== */\r\nfunction AlertCard({ alert, onAction }) {\r\n  const getAlertStyle = (priority) => {\r\n    switch (priority) {\r\n      case 'critical': return 'border-red-500 bg-red-50';\r\n      case 'important': return 'border-orange-500 bg-orange-50';\r\n      case 'info': return 'border-blue-500 bg-blue-50';\r\n      default: return 'border-gray-500 bg-gray-50';\r\n    }\r\n  };\r\n  const getAlertIcon = (priority) => {\r\n    switch (priority) {\r\n      case 'critical': return '🔴';\r\n      case 'important': return '🟡';\r\n      case 'info': return '🔵';\r\n      default: return '⚪';\r\n    }\r\n  };\r\n  return (\r\n    <div className={`border-l-4 p-3 rounded ${getAlertStyle(alert.priority)}`}>\r\n      <div className=\"flex items-center justify-between mb-2\">\r\n        <div className=\"flex items-center gap-2\">\r\n          <span>{getAlertIcon(alert.priority)}</span>\r\n          <span className=\"font-semibold\">{alert.title}</span>\r\n        </div>\r\n        <button \r\n          className=\"text-xs bg-white px-2 py-1 rounded border\"\r\n          onClick={() => onAction(alert)}\r\n        >\r\n          {alert.action === 'traiter' ? '🔧 Traiter' : \r\n           alert.action === 'assigner' ? '👤 Assigner' :\r\n           alert.action === 'relancer' ? '📞 Relancer' : '👀 Voir'}\r\n        </button>\r\n      </div>\r\n      <p className=\"text-sm text-gray-600 mb-2\">{alert.description}</p>\r\n      {alert.items && alert.items.length > 0 && (\r\n        <div className=\"space-y-1\">\r\n          {alert.items.slice(0, 3).map((item, i) => (\r\n            <div key={i} className=\"text-xs bg-white p-2 rounded\">\r\n              <Link href={item.link} className=\"font-medium text-blue-600 hover:underline\">\r\n                {item.label}\r\n              </Link>\r\n              <div className=\"text-gray-500\">{item.detail}</div>\r\n            </div>\r\n          ))}\r\n          {alert.items.length > 3 && (\r\n            <div className=\"text-xs text-gray-500 text-center\">\r\n              +{alert.items.length - 3} autres...\r\n            </div>\r\n          )}\r\n        </div>\r\n      )}\r\n    </div>\r\n  );\r\n}\r\n\r\nfunction ActivityCard({ activity }) {\r\n  const getActivityColor = (color) => {\r\n    switch (color) {\r\n      case 'blue': return 'border-l-blue-500 bg-blue-50';\r\n      case 'green': return 'border-l-green-500 bg-green-50';\r\n      case 'yellow': return 'border-l-yellow-500 bg-yellow-50';\r\n      case 'orange': return 'border-l-orange-500 bg-orange-50';\r\n      default: return 'border-l-gray-500 bg-gray-50';\r\n    }\r\n  };\r\n  return (\r\n    <div className={`border-l-4 p-2 rounded ${getActivityColor(activity.color)}`}>\r\n      <div className=\"flex items-center justify-between\">\r\n        <div className=\"flex items-center gap-2\">\r\n          <span>{activity.icon}</span>\r\n          <Link href={activity.link} className=\"font-medium text-blue-600 hover:underline\">\r\n            {activity.title}\r\n          </Link>\r\n        </div>\r\n        <span className=\"text-xs text-gray-500\">\r\n          {fmt(activity.timestamp).replace(/:\\d{2}$/, '')}\r\n        </span>\r\n      </div>\r\n      <div className=\"text-sm text-gray-600 ml-6\">{activity.description}</div>\r\n      {activity.detail && (\r\n        <div className=\"text-xs text-gray-500 ml-6 mt-1\">{activity.detail}</div>\r\n      )}\r\n    </div>\r\n  );\r\n}\r\n\r\n/* ====== PAGE DASHBOARD ====== */\r\nexport default function Dashboard() {\r\n  // États filtres & data\r\n  const [status, setStatus] = useState(\"all\");\r\n  const [partnerId, setPartnerId] = useState(\"all\");\r\n  const [operatorId, setOperatorId] = useState(\"all\");\r\n  const [dateFrom, setDateFrom] = useState(\"\");\r\n  const [dateTo, setDateTo] = useState(\"\");\r\n  const [data, setData] = useState(null);\r\n  const [err, setErr] = useState(null);\r\n  const isLoading = !data && !err;\r\n\r\n  // Alertes & activités\r\n  const [alerts, setAlerts] = useState(null);\r\n  const [activities, setActivities] = useState([]);\r\n  const [alertsLoading, setAlertsLoading] = useState(true);\r\n  const [showAllAlerts, setShowAllAlerts] = useState(false);\r\n\r\n  // Charger le dashboard\r\n  async function load() {\r\n    const qs = new URLSearchParams();\r\n    if (status !== \"all\") qs.set(\"status\", status);\r\n    if (partnerId !== \"all\") qs.set(\"partnerId\", partnerId);\r\n    if (operatorId !== \"all\") qs.set(\"operatorId\", operatorId);\r\n    if (dateFrom) qs.set(\"from\", dateFrom);\r\n    if (dateTo) qs.set(\"to\", dateTo);\r\n    setErr(null);\r\n    try {\r\n      const r = await fetch(`/api/dashboard?${qs.toString()}`, { cache: \"no-store\" });\r\n      if (!r.ok) throw new Error(`HTTP ${r.status}`);\r\n      const json = await r.json();\r\n      setData(json);\r\n    } catch (e) {\r\n      setErr(String(e));\r\n    }\r\n  }\r\n\r\n  // Alertes + activités\r\n  async function loadAlerts() {\r\n    setAlertsLoading(true);\r\n    try {\r\n      const [alertsRes, activitiesRes] = await Promise.all([\r\n        fetch(\"/api/alerts\", { cache: \"no-store\" }),\r\n        fetch(\"/api/recent-activities\", { cache: \"no-store\" })\r\n      ]);\r\n      if (alertsRes.ok) setAlerts(await alertsRes.json());\r\n      if (activitiesRes.ok) {\r\n        const a = await activitiesRes.json();\r\n        setActivities(a.activities || []);\r\n      }\r\n    } catch (e) {\r\n      console.error(\"Erreur chargement alertes:\", e);\r\n    } finally {\r\n      setAlertsLoading(false);\r\n    }\r\n  }\r\n\r\n  useEffect(() => {\r\n    load();\r\n    loadAlerts();\r\n    // eslint-disable-next-line react-hooks/exhaustive-deps\r\n  }, [status, partnerId, operatorId, dateFrom, dateTo]);\r\n\r\n  // Actions\r\n  async function changeStatut(dossierId, newStatut) {\r\n    await fetch(`/api/dossiers/${dossierId}`, {\r\n      method: \"PATCH\",\r\n      headers: { \"Content-Type\": \"application/json\" },\r\n      body: JSON.stringify({ statut: newStatut })\r\n    });\r\n    await load();\r\n    await loadAlerts();\r\n  }\r\n\r\n  async function createTicket(dossierId, clientNom) {\r\n    const subject = prompt(\"Sujet du ticket:\", `Support client ${clientNom || 'Inconnu'}`);\r\n    if (!subject) return;\r\n    try {\r\n      await fetch(`/api/tickets`, {\r\n        method: \"POST\",\r\n        headers: { \"Content-Type\": \"application/json\" },\r\n        body: JSON.stringify({\r\n          dossier_id: dossierId,\r\n          subject,\r\n          priorite: \"Moyenne\",\r\n          message: \"Ticket créé depuis le dashboard CRM\"\r\n        })\r\n      });\r\n      await load();\r\n      await loadAlerts();\r\n    } catch (e) {\r\n      console.error(\"Erreur création ticket:\", e);\r\n      alert(\"Erreur lors de la création du ticket\");\r\n    }\r\n  }\r\n\r\n  async function planRelance(dossierId, clientId) {\r\n    const in1h = new Date(Date.now() + 60 * 60 * 1000).toISOString();\r\n    await fetch(`/api/notifications`, {\r\n      method: \"POST\",\r\n      headers: { \"Content-Type\": \"application/json\" },\r\n      body: JSON.stringify({\r\n        type: \"relance_piece\",\r\n        client_id: clientId,\r\n        dossier_id: dossierId,\r\n        canal: \"email\",\r\n        scheduled_for: in1h\r\n      })\r\n    });\r\n    await load();\r\n  }\r\n\r\n  async function exportDossiers() {\r\n    const qs = new URLSearchParams();\r\n    if (status !== \"all\") qs.set(\"status\", status);\r\n    if (partnerId !== \"all\") qs.set(\"partnerId\", partnerId);\r\n    if (operatorId !== \"all\") qs.set(\"operatorId\", operatorId);\r\n    if (dateFrom) qs.set(\"from\", dateFrom);\r\n    if (dateTo) qs.set(\"to\", dateTo);\r\n    qs.set(\"format\", \"csv\");\r\n    try {\r\n      const url = `/api/exports/dossiers?${qs.toString()}`;\r\n      const link = document.createElement(\"a\");\r\n      link.href = url;\r\n      link.download = `dossiers_${new Date().toISOString().slice(0,10)}.csv`;\r\n      document.body.appendChild(link);\r\n      link.click();\r\n      document.body.removeChild(link);\r\n    } catch (e) {\r\n      console.error(\"Erreur export:\", e);\r\n      alert(\"Erreur lors de l'export\");\r\n    }\r\n  }\r\n\r\n  // …dans Dashboard(), après tes autres fonctions (changeStatut, createTicket, planRelance, exportDossiers) :\r\n\r\nfunction handleAlertAction(a) {\r\n  switch (a.action) {\r\n    case \"traiter\":\r\n      // Exemple : redirige les filtres en fonction du type d’alerte\r\n      if (a.type === \"dossiers_blocked\") setStatus(\"en_attente\");\r\n      if (a.type === \"dossiers_a_corriger\") setStatus(\"a_corriger\");\r\n      break;\r\n\r\n    case \"assigner\":\r\n      window.location.href = \"/crm/tickets?priorite=Haute\";\r\n      break;\r\n\r\n    case \"relancer\":\r\n      window.alert(\"Fonctionnalité de relance à implémenter\");\r\n      break;\r\n\r\n    default:\r\n      if (a.items && a.items.length > 0) {\r\n        window.location.href = a.items[0].link;\r\n      }\r\n  }\r\n}\r\n\r\n\r\n  // Référentiels\r\n  const partners = data?.partenaires ?? [];\r\n  const operators = data?.operateurs ?? [];\r\n  const dossiers = data?.dossiers ?? [];\r\n  const clients = data?.clients ?? [];\r\n  const statusesRef = data?.refs?.statuts_dossier ?? [];\r\n  const notifications = data?.notifications_queue ?? [];\r\n  const authLogs = data?.auth_logs ?? [];\r\n\r\n  // Filtres\r\n  const filtered = useMemo(() => {\r\n    const from = dateFrom ? parseISO(dateFrom) : null;\r\n    const to = dateTo ? parseISO(dateTo) : null;\r\n    return dossiers.filter((d) => {\r\n      const okStatus = status === \"all\" ? true : d.statut === status;\r\n      const okPartner = partnerId === \"all\" ? true : String(d.partenaireId) === String(partnerId);\r\n      const okOperator = operatorId === \"all\" ? true : String(d.operateurId) === String(operatorId);\r\n      const okDate = inRange(d.date_creation, from, to);\r\n      return okStatus && okPartner && okOperator && okDate;\r\n    });\r\n  }, [dossiers, status, partnerId, operatorId, dateFrom, dateTo]);\r\n\r\n  const kpis = useMemo(() => {\r\n    const counts = {};\r\n    (statusesRef.length ? statusesRef : Array.from(new Set(dossiers.map(d => d.statut))))\r\n      .forEach(s => counts[s] = 0);\r\n    filtered.forEach(d => counts[d.statut] = (counts[d.statut] || 0) + 1);\r\n    return counts;\r\n  }, [filtered, dossiers, statusesRef]);\r\n\r\n  const clientById = (id) => clients.find(c => String(c.id) === String(id));\r\n  const partById = (id) => partners.find(p => String(p.id) === String(id));\r\n  const resetFilters = () => { setStatus(\"all\"); setPartnerId(\"all\"); setOperatorId(\"all\"); setDateFrom(\"\"); setDateTo(\"\"); };\r\n\r\n  if (err) return <main className=\"p-6\"><h1 className=\"text-xl font-bold\">Erreur</h1><pre className=\"mt-2\">{err}</pre></main>;\r\n  if (isLoading) return <main className=\"p-6\">Chargement…</main>;\r\n\r\n  // Alertes à afficher\r\n  const allAlerts = alerts ? [\r\n    ...alerts.alerts.critical,\r\n    ...alerts.alerts.important,\r\n    ...(showAllAlerts ? alerts.alerts.info : [])\r\n  ] : [];\r\n\r\n  return (\r\n    <main className=\"p-6 space-y-8\">\r\n      <div className=\"flex items-center gap-3\">\r\n        <h1 className=\"text-2xl font-bold\">CRM — Dashboard</h1>\r\n        <Link href=\"/crm/tickets\" className=\"text-sm text-blue-600 underline\">→ Voir tous les tickets</Link>\r\n        <button onClick={loadAlerts} className=\"text-sm bg-blue-600 text-white px-3 py-1 rounded\" disabled={alertsLoading}>\r\n          {alertsLoading ? \"🔄\" : \"🔄 Actualiser alertes\"}\r\n        </button>\r\n      </div>\r\n\r\n      {/* 🚨 ALERTES */}\r\n      {alerts && (\r\n        <section className=\"space-y-4\">\r\n          <div className=\"flex items-center justify-between\">\r\n            <h2 className=\"text-xl font-semibold\">🚨 Alertes prioritaires</h2>\r\n            <div className=\"flex gap-2 text-sm\">\r\n              {alerts.summary.critical > 0 && <span className=\"bg-red-100 text-red-800 px-2 py-1 rounded\">🔴 {alerts.summary.critical} critiques</span>}\r\n              {alerts.summary.important > 0 && <span className=\"bg-orange-100 text-orange-800 px-2 py-1 rounded\">🟡 {alerts.summary.important} importantes</span>}\r\n              {alerts.summary.info > 0 && <span className=\"bg-blue-100 text-blue-800 px-2 py-1 rounded\">🔵 {alerts.summary.info} info</span>}\r\n            </div>\r\n          </div>\r\n\r\n          {allAlerts.length === 0 ? (\r\n            <div className=\"bg-green-50 border border-green-200 rounded p-4 text-center\">\r\n              ✅ Aucune alerte critique ou importante ! Tout va bien.\r\n            </div>\r\n          ) : (\r\n            <div className=\"grid md:grid-cols-2 gap-4\">\r\n              {allAlerts.map(alert => (\r\n                <AlertCard key={alert.id} alert={alert} onAction={handleAlertAction} />\r\n              ))}\r\n            </div>\r\n          )}\r\n\r\n          {alerts.summary.info > 0 && !showAllAlerts && (\r\n            <div className=\"text-center\">\r\n              <button onClick={() => setShowAllAlerts(true)} className=\"text-sm text-blue-600 underline\">\r\n                + Voir les {alerts.summary.info} alertes informatives\r\n              </button>\r\n            </div>\r\n          )}\r\n        </section>\r\n      )}\r\n\r\n      {/* 📊 ACTIVITÉS */}\r\n      {activities.length > 0 && (\r\n        <section>\r\n          <h2 className=\"text-xl font-semibold mb-4\">📊 Activité récente</h2>\r\n          <div className=\"grid md:grid-cols-2 gap-3\">\r\n            {activities.slice(0, 6).map((activity, i) => (\r\n              <ActivityCard key={i} activity={activity} />\r\n            ))}\r\n          </div>\r\n          {activities.length > 6 && (\r\n            <div className=\"text-center mt-3\">\r\n              <Link href=\"/crm/activities\" className=\"text-sm text-blue-600 underline\">Voir toute l'activité →</Link>\r\n            </div>\r\n          )}\r\n        </section>\r\n      )}\r\n\r\n      {/* FILTRES */}\r\n      <section className=\"border rounded p-4 space-y-3\">\r\n        <div className=\"grid md:grid-cols-5 gap-3\">\r\n          <label className=\"flex flex-col text-sm\">\r\n            <span className=\"mb-1 font-medium\">Statut</span>\r\n            <select className=\"border rounded p-2\" value={status} onChange={(e)=>setStatus(e.target.value)}>\r\n              <option value=\"all\">Tous</option>\r\n              {(statusesRef.length ? statusesRef : Array.from(new Set(dossiers.map(d=>d.statut)))).map(s => (\r\n                <option key={s} value={s}>{s}</option>\r\n              ))}\r\n            </select>\r\n          </label>\r\n\r\n          <label className=\"flex flex-col text-sm\">\r\n            <span className=\"mb-1 font-medium\">Partenaire</span>\r\n            <select className=\"border rounded p-2\" value={partnerId} onChange={(e)=>setPartnerId(e.target.value)}>\r\n              <option value=\"all\">Tous</option>\r\n              {partners.map(p => <option key={p.id} value={p.id}>{p.nom}</option>)}\r\n            </select>\r\n          </label>\r\n\r\n          <label className=\"flex flex-col text-sm\">\r\n            <span className=\"mb-1 font-medium\">Opérateur</span>\r\n            <select className=\"border rounded p-2\" value={operatorId} onChange={(e)=>setOperatorId(e.target.value)}>\r\n              <option value=\"all\">Tous</option>\r\n              {operators.map(o => <option key={o.id} value={o.id}>{o.nom}</option>)}\r\n            </select>\r\n          </label>\r\n\r\n          <label className=\"flex flex-col text-sm\">\r\n            <span className=\"mb-1 font-medium\">Du</span>\r\n            <input type=\"date\" className=\"border rounded p-2\" value={dateFrom} onChange={(e)=>setDateFrom(e.target.value)} />\r\n          </label>\r\n\r\n          <label className=\"flex flex-col text-sm\">\r\n            <span className=\"mb-1 font-medium\">Au</span>\r\n            <input type=\"date\" className=\"border rounded p-2\" value={dateTo} onChange={(e)=>setDateTo(e.target.value)} />\r\n          </label>\r\n        </div>\r\n\r\n        <div className=\"flex gap-3\">\r\n          <button className=\"border rounded px-3 py-2\" onClick={resetFilters}>Réinitialiser</button>\r\n          <button className=\"bg-green-600 text-white px-3 py-2 rounded\" onClick={exportDossiers}>\r\n            📊 Exporter CSV ({filtered.length})\r\n          </button>\r\n          <div className=\"text-sm text-gray-600 self-center\">{filtered.length} dossier(s) sur {dossiers.length}</div>\r\n        </div>\r\n      </section>\r\n\r\n      {/* KPIs */}\r\n      <section>\r\n        <h2 className=\"text-xl font-semibold mb-2\">KPIs dossiers (filtrés)</h2>\r\n        <div className=\"flex gap-3 flex-wrap\">\r\n          {Object.entries(kpis).map(([s, n]) => (\r\n            <div key={s} className=\"border rounded p-3\">\r\n              <div className=\"text-sm text-gray-600\">{s}</div>\r\n              <div className=\"text-2xl font-bold\">{n}</div>\r\n            </div>\r\n          ))}\r\n          <div className=\"border rounded p-3\">\r\n            <div className=\"text-sm text-gray-600\">Total</div>\r\n            <div className=\"text-2xl font-bold\">{filtered.length}</div>\r\n          </div>\r\n        </div>\r\n      </section>\r\n\r\n      {/* LISTE DOSSIERS */}\r\n      <section>\r\n        <h2 className=\"text-xl font-semibold mb-2\">Dossiers</h2>\r\n        {filtered.length === 0 ? (\r\n          <p className=\"text-sm text-gray-600\">Aucun résultat avec ces filtres.</p>\r\n        ) : (\r\n          <ul className=\"list-disc pl-6 space-y-3\">\r\n            {filtered.map(d => {\r\n              const client = clientById(d.clientId);\r\n              return (\r\n                <DossierRow\r\n                  key={d.id}\r\n                  dossier={d}\r\n                  client={client}\r\n                  partner={partById(d.partenaireId)}\r\n                  changeStatut={changeStatut}\r\n                  createTicket={createTicket}\r\n                  planRelance={planRelance}\r\n                />\r\n              );\r\n            })}\r\n          </ul>\r\n        )}\r\n      </section>\r\n\r\n      {/* NOTIFS */}\r\n      <section>\r\n        <h2 className=\"text-xl font-semibold mb-2\">Notifications & relances programmées</h2>\r\n        <ul className=\"list-disc pl-6 space-y-1\">\r\n          {notifications.length ? notifications.map((n) => (\r\n            <li key={n.id}>\r\n              {n.type} — client{\" \"}\r\n              <Link className=\"underline\" href={`/crm/clients/${n.clientId}`}>\r\n                #{n.clientId}\r\n              </Link>{\" \"}\r\n              — <span className=\"italic text-gray-700\">\"{n.message || \"—\"}\"</span> — dossier #{n.dossierId} — {n.canal} — prévu le{\" \"}\r\n              {new Date(n.scheduled_for).toLocaleString(\"fr-FR\")}\r\n            </li>\r\n          )) : (\r\n            <li>Aucune notification programmée.</li>\r\n          )}\r\n        </ul>\r\n      </section>\r\n\r\n\r\n      {/* TICKETS */}\r\n      <section>\r\n        <h2 className=\"text-xl font-semibold mb-2\">Tickets récents</h2>\r\n        <div className=\"text-sm\">\r\n          <Link href=\"/crm/tickets\" className=\"underline\">Voir tous les tickets →</Link>\r\n        </div>\r\n      </section>\r\n\r\n      {/* LOGS */}\r\n      <section>\r\n        <h2 className=\"text-xl font-semibold mb-2\">Connexions (sécurité)</h2>\r\n        <ul className=\"list-disc pl-6 space-y-1\">\r\n          {authLogs.length ? authLogs.map((l,i) => (\r\n            <li key={i}>{l.at} — {l.role} {l.who} — {l.action} — {l.success ? \"✅\" : \"❌\"} — IP {l.ip}</li>\r\n          )) : <li>Aucune entrée</li>}\r\n        </ul>\r\n      </section>\r\n    </main>\r\n  );\r\n}\r\n\r\n\r\n\r\n\r\nfunction DossierRow({ dossier, client, partner, changeStatut, createTicket, planRelance }) {\r\n  const [showRelanceModal, setShowRelanceModal] = useState(false);\r\n  const [relanceMessage, setRelanceMessage] = useState(\"\");\r\n\r\n  async function envoyerRelance() {\r\n  try {\r\n    const res = await fetch(`/api/notifications`, {\r\n      method: \"POST\",\r\n      headers: { \"Content-Type\": \"application/json\" },\r\n      body: JSON.stringify({\r\n        type: \"relance_piece\",\r\n        client_id: dossier.clientId,\r\n        dossier_id: dossier.id,\r\n        canal: \"email\",\r\n        scheduled_for: new Date().toISOString(),\r\n        message: relanceMessage || \"Pas de message fourni\"\r\n      }),\r\n    });\r\n\r\n    if (!res.ok) throw new Error(`HTTP ${res.status}`);\r\n    \r\n    // ✅ AJOUTEZ CES LIGNES :\r\n    // Recharger les données du client pour voir la nouvelle notification\r\n    if (details && dossier.clientId) {\r\n      const r = await fetch(`/api/clients/${dossier.clientId}`, { cache: \"no-store\" });\r\n      if (r.ok) {\r\n        const updatedData = await r.json();\r\n        setDetails(updatedData); // Mettre à jour les détails\r\n      }\r\n    }\r\n    \r\n    alert(\"✅ Relance envoyée !\");\r\n    setShowRelanceModal(false);\r\n    setRelanceMessage(\"\");\r\n  } catch (e) {\r\n    console.error(\"Erreur relance:\", e);\r\n    alert(\"❌ Impossible d'envoyer la relance\");\r\n  }\r\n}\r\n\r\n\r\n\r\n  const [open, setOpen] = useState(false);               // panneau client/dossier\r\n  const [loading, setLoading] = useState(false);\r\n  const [err, setErr] = useState(null);\r\n  const [details, setDetails] = useState(null);\r\n\r\n  // 🏢 État pour la fiche entreprise inline (CE QUI MANQUAIT)\r\n  const [entrepriseCard, setEntrepriseCard] = useState(null);\r\n  const [entrepriseCardLoading, setEntrepriseCardLoading] = useState(false);\r\n  const [entrepriseCardErr, setEntrepriseCardErr] = useState(null);\r\n\r\n  // 👇 panneau partenaire (au clic sur le nom)\r\n  const [pOpen, setPOpen] = useState(false);\r\n  const [pLoading, setPLoading] = useState(false);\r\n  const [pErr, setPErr] = useState(null);\r\n  const [pDetails, setPDetails] = useState(null);\r\n\r\n  // charge fiche client/dossier quand on ouvre \"Voir plus\"\r\n  async function toggle() {\r\n    if (open) { setOpen(false); return; }\r\n    setOpen(true);\r\n    if (details) return; // déjà chargé\r\n    try {\r\n      setLoading(true); setErr(null);\r\n      const r = await fetch(`/api/clients/${dossier.clientId}`, { cache: \"no-store\" });\r\n      const j = await r.json();\r\n      if (!r.ok) throw new Error(j.error || `HTTP ${r.status}`);\r\n      setDetails(j);\r\n    } catch (e) {\r\n      setErr(String(e.message || e));\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  }\r\n\r\n  useEffect(() => {\r\n    if (!open) return;\r\n    const eid = dossier?.entrepriseId;\r\n    if (!eid || entrepriseCard) return; // déjà chargé ou pas d'entreprise\r\n\r\n    let cancelled = false;\r\n    (async () => {\r\n      try {\r\n        setEntrepriseCardLoading(true);\r\n        const r = await fetch(`/api/entreprises/${eid}`, { cache: \"no-store\" });\r\n        const j = await r.json().catch(() => ({}));\r\n        if (!r.ok) throw new Error(j.error || r.statusText);\r\n        if (!cancelled) setEntrepriseCard(j);\r\n      } catch (e) {\r\n        if (!cancelled) setEntrepriseCardErr(String(e.message || e));\r\n      } finally {\r\n        if (!cancelled) setEntrepriseCardLoading(false);\r\n      }\r\n    })();\r\n\r\n    return () => { cancelled = true; };\r\n  }, [open, dossier?.entrepriseId, entrepriseCard]); // ⚠️ taille FIXE (3)\r\n\r\n  // charge fiche partenaire quand on clique sur le nom\r\n  async function togglePartner(e) {\r\n    e.preventDefault();\r\n    e.stopPropagation();\r\n    if (pOpen) { setPOpen(false); return; }\r\n    setPOpen(true);\r\n    if (pDetails) return; // déjà chargé\r\n    try {\r\n      setPLoading(true); setPErr(null);\r\n      const r = await fetch(`/api/partenaires/${dossier.partenaireId}`, { cache: \"no-store\" });\r\n      const j = await r.json().catch(() => ({}));\r\n      if (!r.ok) throw new Error(j.error || r.statusText);\r\n      setPDetails(j);\r\n    } catch (e) {\r\n      setPErr(String(e.message || e));\r\n    } finally {\r\n      setPLoading(false);\r\n    }\r\n  }\r\n\r\n  const clientNom = client ? `${client.prenom ?? \"\"} ${client.nom ?? \"\"}`.trim() || `#${client.id}` : `#${dossier.clientId}`;\r\n\r\n  // helpers partenaire\r\n  const p = pDetails?.partenaire || {};\r\n  const docs = p.docs || {};\r\n\r\n  return (\r\n    <li className=\"space-y-2\">\r\n      {/* ——— LIGNE RÉSUMÉ ——— */}\r\n      <div className=\"flex flex-wrap items-center gap-2\">\r\n        <span className=\"font-semibold\">#{dossier.id}</span>\r\n        <span>— statut: {dossier.statut}</span>\r\n        <span>— créé: {dossier.date_creation}</span>\r\n        <span>— modif: {dossier.derniere_modification ?? \"-\"}</span>\r\n        <span>— client: {client ? clientNom : dossier.clientId}</span>\r\n\r\n        {/* 👇 rend le nom partenaire cliquable pour ouvrir le panneau partenaire inline */}\r\n        <span>\r\n          — partenaire:{\" \"}\r\n          <button\r\n            type=\"button\"\r\n            onClick={togglePartner}\r\n            className=\"underline text-blue-600 hover:text-blue-800\"\r\n            title=\"Afficher les infos du partenaire\"\r\n          >\r\n            {partner ? partner.nom : dossier.partenaireId}\r\n          </button>\r\n        </span>\r\n\r\n        <span>— entreprise: #{dossier.entrepriseId}</span>\r\n        {(dossier.blocages || []).length ? <span>— blocages: {(dossier.blocages || []).join(\", \")}</span> : null}\r\n        <span>— commission: {dossier.commission_partenaire_eur ?? 0}€</span>\r\n\r\n        {/* Actions */}\r\n        <div className=\"inline-flex gap-2 ml-2\">\r\n          <select\r\n            className=\"border rounded px-1 py-0.5 text-sm\"\r\n            value={dossier.statut}\r\n            onChange={(e) => changeStatut(dossier.id, e.target.value)}\r\n          >\r\n            {[\"nouveau\",\"en_cours\",\"en_attente\",\"a_corriger\",\"valide\",\"rejete\"].map(s => (\r\n              <option key={s} value={s}>{s}</option>\r\n            ))}\r\n          </select>\r\n\r\n          {/*<button className=\"border rounded px-2 py-0.5 text-sm\" onClick={() => createTicket(dossier.id, clientNom)}>+ Ticket</button>*/}\r\n\r\n         <button\r\n  className=\"border rounded px-2 py-0.5 text-sm\"\r\n  onClick={() => setShowRelanceModal(true)}\r\n>\r\n  📩 Relancer\r\n</button>\r\n\r\n{showRelanceModal && (\r\n  <div className=\"fixed inset-0 bg-black bg-opacity-40 flex items-center justify-center z-50\">\r\n    <div className=\"bg-white rounded-lg shadow-lg p-6 w-96\">\r\n      <h3 className=\"text-lg font-semibold mb-4\">Relancer le client</h3>\r\n      <textarea\r\n        value={relanceMessage}\r\n        onChange={(e) => setRelanceMessage(e.target.value)}\r\n        placeholder=\"Votre message...\"\r\n        className=\"border rounded w-full p-2 mb-4 h-24\"\r\n      />\r\n      <div className=\"flex justify-end gap-3\">\r\n        <button\r\n          onClick={() => setShowRelanceModal(false)}\r\n          className=\"px-3 py-1 rounded bg-gray-200 hover:bg-gray-300\"\r\n        >\r\n          Annuler\r\n        </button>\r\n        <button\r\n          onClick={envoyerRelance}\r\n          className=\"px-3 py-1 rounded bg-blue-600 text-white hover:bg-blue-700\"\r\n        >\r\n          Envoyer\r\n        </button>\r\n      </div>\r\n    </div>\r\n  </div>\r\n)}\r\n\r\n\r\n\r\n          {/* Voir plus -> ouvre le panneau inline (client/dossier) */}\r\n          <button className=\"border rounded px-2 py-0.5 text-sm\" onClick={toggle}>\r\n            {open ? \"Masquer\" : \"Voir plus\"}\r\n          </button>\r\n        </div>\r\n      </div>\r\n\r\n      {/* ——— PANNEAU PARTENAIRE INLINE (clic sur le nom) ——— */}\r\n      {pOpen && (\r\n        <div className=\"mt-2 border-l-2 pl-4\">\r\n          {pLoading && <div className=\"text-sm text-gray-500\">Chargement…</div>}\r\n          {pErr && <div className=\"text-sm text-red-600\">❌ {pErr}</div>}\r\n\r\n          {!pLoading && !pErr && (\r\n            <div className=\"space-y-6\">\r\n              {/* En-tête partenaire + infos clés */}\r\n              <section className=\"bg-gray-50 rounded p-3\">\r\n                <h4 className=\"font-semibold mb-1\">🤝 Partenaire</h4>\r\n                {p && Object.keys(p).length ? (\r\n                  <div className=\"text-sm\">\r\n                    <div><b>{p.nom || `#${dossier.partenaireId}`}</b> — segment {p.segment || \"—\"}</div>\r\n                    <div>Référent: {p.referent?.nom || \"—\"} — {p.referent?.email || \"—\"} — {p.referent?.telephone || \"—\"}</div>\r\n                    <div>Taux commission: {p.taux_commission ?? \"—\"}% • Facturation: {p.type_facturation || \"—\"}</div>\r\n                    <div>Paiement: {p.paiement?.mode || \"—\"} • IBAN: {p.paiement?.iban ? `${p.paiement.iban.slice(0, 8)}…` : \"—\"} • BIC: {p.paiement?.bic || \"—\"}</div>\r\n                    <div className=\"text-xs text-gray-500 mt-1\">\r\n                      Contrat: {p.contrat?.statut || \"—\"} • signé le {p.contrat?.date_signature || \"—\"} • durée {p.contrat?.duree_mois ?? \"—\"} mois\r\n                    </div>\r\n                  </div>\r\n                ) : (\r\n                  <div className=\"text-sm text-gray-500\">—</div>\r\n                )}\r\n              </section>\r\n\r\n              {/* 📊 Tableau de Bord (commissions/factures) – réutilise ton composant */}\r\n              <section>\r\n                <h4 className=\"font-semibold mb-2\">📊 Tableau de Bord</h4>\r\n                <InvoicesCommissionsCard\r\n                  partnerId={dossier.partenaireId}\r\n                  data={pDetails}                 // ⬅️ on passe le JSON déjà chargé: { partenaire, factures, ... }\r\n                />\r\n              </section>\r\n\r\n\r\n              {/* 📈 Suivi Commercial – réutilise ton composant */}\r\n              <section>\r\n                <h4 className=\"font-semibold mb-2\">📈 Suivi Commercial</h4>\r\n                <PartnerTracking partnerId={dossier.partenaireId} />\r\n              </section>\r\n\r\n              {/* 📁 Espace documentaire */}\r\n              <section className=\"bg-gray-50 rounded p-3\">\r\n                <h4 className=\"font-semibold mb-1\">📁 Espace documentaire</h4>\r\n                {docs && (docs.contrat_pdf || docs.modalites_collaboration_pdf || (docs.documentation_tech || []).length) ? (\r\n                  <ul className=\"list-disc pl-5 text-sm\">\r\n                    <li>\r\n                      Contrat:{\" \"}\r\n                      {docs.contrat_pdf\r\n                        ? <a className=\"underline text-blue-600\" href={docs.contrat_pdf} target=\"_blank\" rel=\"noreferrer\">ouvrir</a>\r\n                        : \"—\"}\r\n                    </li>\r\n                    <li>\r\n                      Modalités:{\" \"}\r\n                      {docs.modalites_collaboration_pdf\r\n                        ? <a className=\"underline text-blue-600\" href={docs.modalites_collaboration_pdf} target=\"_blank\" rel=\"noreferrer\">ouvrir</a>\r\n                        : \"—\"}\r\n                    </li>\r\n                    {(docs.documentation_tech || []).map((d, i) => (\r\n                      <li key={i}>{d.type || \"Doc\"} — {d.url ? <a className=\"underline text-blue-600\" href={d.url} target=\"_blank\" rel=\"noreferrer\">{d.url}</a> : \"—\"}</li>\r\n                    ))}\r\n                  </ul>\r\n                ) : (\r\n                  <div className=\"text-sm text-gray-500\">—</div>\r\n                )}\r\n              </section>\r\n\r\n              {/* 📋 Informations détaillées */}\r\n              <section>\r\n                <h4 className=\"font-semibold mb-1\">📋 Informations détaillées</h4>\r\n                <ul className=\"list-disc pl-5 text-sm\">\r\n                  <li>Adresse: {p.adresse || \"—\"}</li>\r\n                  <li>Coord. facturation: {p.coordonnees_facturation?.societe || \"—\"} — {p.coordonnees_facturation?.email_facturation || \"—\"} — {p.coordonnees_facturation?.adresse || \"—\"}</li>\r\n                  <li>Intégration: {p.integration || \"—\"} • Segment: {p.segment || \"—\"}</li>\r\n                </ul>\r\n              </section>\r\n            </div>\r\n          )}\r\n        </div>\r\n      )}\r\n\r\n      {/* ——— PANNEAU CLIENT/DOSSIER INLINE (bouton Voir plus) ——— */}\r\n      {open && (\r\n        <div className=\"mt-2 border-l-2 pl-4\">\r\n          {loading && <div className=\"text-sm text-gray-500\">Chargement…</div>}\r\n          {err && <div className=\"text-sm text-red-600\">❌ {err}</div>}\r\n\r\n          {details && (\r\n            <div className=\"space-y-6\">\r\n              {/* 👥 Suivi des clients (mini résumé) */}\r\n              <section className=\"bg-gray-50 rounded p-3\">\r\n                <h4 className=\"font-semibold mb-2\">👥 Suivi des clients</h4>\r\n                <div className=\"text-sm\">\r\n                  <div>\r\n                    <b>{safe(details.client?.prenom)} {safe(details.client?.nom)}</b>{\" — \"}{safe(details.client?.email)}\r\n                    {details.client?.telephone ? ` • ${details.client.telephone}` : \"\"}\r\n                  </div>\r\n                  <div className=\"text-gray-600\">\r\n                    Dossier #{dossier.id} — statut {dossier.statut} — créé {dossier.date_creation} — commission {euro(dossier.commission_partenaire_eur)}\r\n                  </div>\r\n                </div>\r\n              </section>\r\n\r\n              {/* ⏱️ Timeline du dossier courant */}\r\n              <DossierTimeline dossier={(details.dossiers || []).find(dd => dd.id === dossier.id) || dossier} />\r\n\r\n              {/* 📨 Historique (relances & notifications) */}\r\n              <section>\r\n                <h4 className=\"font-semibold mb-2\">📨 Historique (relances & notifications)</h4>\r\n                <CommsHistory\r\n                  communications={details.communications || details.historique_echanges || []}\r\n                  relances={details.relances || []}\r\n                  notifications={details.notifications || []}\r\n                  compact\r\n                />\r\n              </section>\r\n\r\n              {/* 💬 Messagerie client */}\r\n              <ClientMessaging clientId={dossier.clientId} dossiers={details.dossiers || []} />\r\n\r\n              {/* 🆔 Identité & adresses */}\r\n              <section>\r\n                <h4 className=\"font-semibold mb-2\">🆔 Identité & adresses</h4>\r\n                <ClientIdentityCard client={details.client} />\r\n              </section>\r\n\r\n              {/* 📄 Pièces justificatives (+ téléchargements) */}\r\n              <section>\r\n                <h4 className=\"font-semibold mb-2\">📄 Pièces justificatives</h4>\r\n                <PiecesJustificativesCard\r\n                  pieces={details.pieces_justificatives || []}\r\n                  downloads={details.telechargements_disponibles || []}\r\n                />\r\n              </section>\r\n\r\n              {/* 🏢 Mon entreprise — réutilise ton composant complet */}\r\n              <section className=\"bg-gray-50 rounded p-3\">\r\n                <h4 className=\"font-semibold mb-2\">🏢 Mon entreprise</h4>\r\n                {entrepriseCardLoading && <div className=\"text-sm text-gray-500\">Chargement…</div>}\r\n                {entrepriseCardErr && <div className=\"text-sm text-red-600\">❌ {entrepriseCardErr}</div>}\r\n                {entrepriseCard ? (\r\n                  <EntrepriseCard data={entrepriseCard} />\r\n                ) : (\r\n                  !entrepriseCardLoading && <div className=\"text-sm text-gray-500\">—</div>\r\n                )}\r\n              </section>\r\n\r\n            </div>\r\n          )}\r\n        </div>\r\n      )}\r\n    </li>\r\n  );\r\n}\r\n"],"names":[],"mappings":";;;;AAEA;AACA;AAEA,4EAA4E,GAC5E;AACA;AACA;AACA;AACA;AAEA,qBAAqB;AACrB;AACA;AAEA,gCAAgC;AAChC;AAjBA;;;;;;;;;;;;AAoBA,uBAAuB,GACvB,SAAS,SAAS,CAAC;IAAG,OAAO,IAAI,IAAI,KAAK,KAAK;AAAM;AACrD,SAAS,QAAQ,CAAC,EAAE,IAAI,EAAE,EAAE;IAC1B,IAAI,CAAC,GAAG,OAAO;IACf,MAAM,KAAK,OAAO,MAAM,WAAW,IAAI,KAAK,KAAK;IACjD,IAAI,QAAQ,KAAK,MAAM,OAAO;IAC9B,IAAI,IAAI;QAAE,MAAM,MAAM,IAAI,KAAK;QAAK,IAAI,QAAQ,CAAC,IAAG,IAAG,IAAG;QAAM,IAAI,KAAK,KAAK,OAAO;IAAO;IAC5F,OAAO;AACT;AACA,MAAM,MAAM,CAAC,IAAM,IAAI,IAAI,KAAK,GAAG,cAAc,CAAC,WAAW;AAC7D,SAAS,KAAK,CAAC;IAAG,IAAG,MAAM,GAAG,OAAO;IAAM,IAAG,KAAK,MAAM,OAAO;IAAK,OAAO,GAAG,OAAO,GAAG,cAAc,CAAC,SAAS,CAAC,CAAC;AAAE;AACrH,SAAS,KAAK,CAAC;IAAG,OAAO,KAAK;AAAK;AAEnC,0CAA0C,GAC1C,SAAS,UAAU,EAAE,OAAA,MAAK,EAAE,QAAQ,EAAE;IACpC,MAAM,gBAAgB,CAAC;QACrB,OAAQ;YACN,KAAK;gBAAY,OAAO;YACxB,KAAK;gBAAa,OAAO;YACzB,KAAK;gBAAQ,OAAO;YACpB;gBAAS,OAAO;QAClB;IACF;IACA,MAAM,eAAe,CAAC;QACpB,OAAQ;YACN,KAAK;gBAAY,OAAO;YACxB,KAAK;gBAAa,OAAO;YACzB,KAAK;gBAAQ,OAAO;YACpB;gBAAS,OAAO;QAClB;IACF;IACA,qBACE,8OAAC;QAAI,WAAW,CAAC,uBAAuB,EAAE,cAAc,OAAM,QAAQ,GAAG;;0BACvE,8OAAC;gBAAI,WAAU;;kCACb,8OAAC;wBAAI,WAAU;;0CACb,8OAAC;0CAAM,aAAa,OAAM,QAAQ;;;;;;0CAClC,8OAAC;gCAAK,WAAU;0CAAiB,OAAM,KAAK;;;;;;;;;;;;kCAE9C,8OAAC;wBACC,WAAU;wBACV,SAAS,IAAM,SAAS;kCAEvB,OAAM,MAAM,KAAK,YAAY,eAC7B,OAAM,MAAM,KAAK,aAAa,gBAC9B,OAAM,MAAM,KAAK,aAAa,gBAAgB;;;;;;;;;;;;0BAGnD,8OAAC;gBAAE,WAAU;0BAA8B,OAAM,WAAW;;;;;;YAC3D,OAAM,KAAK,IAAI,OAAM,KAAK,CAAC,MAAM,GAAG,mBACnC,8OAAC;gBAAI,WAAU;;oBACZ,OAAM,KAAK,CAAC,KAAK,CAAC,GAAG,GAAG,GAAG,CAAC,CAAC,MAAM,kBAClC,8OAAC;4BAAY,WAAU;;8CACrB,8OAAC,4JAAA,CAAA,UAAI;oCAAC,MAAM,KAAK,IAAI;oCAAE,WAAU;8CAC9B,KAAK,KAAK;;;;;;8CAEb,8OAAC;oCAAI,WAAU;8CAAiB,KAAK,MAAM;;;;;;;2BAJnC;;;;;oBAOX,OAAM,KAAK,CAAC,MAAM,GAAG,mBACpB,8OAAC;wBAAI,WAAU;;4BAAoC;4BAC/C,OAAM,KAAK,CAAC,MAAM,GAAG;4BAAE;;;;;;;;;;;;;;;;;;;AAOvC;AAEA,SAAS,aAAa,EAAE,QAAQ,EAAE;IAChC,MAAM,mBAAmB,CAAC;QACxB,OAAQ;YACN,KAAK;gBAAQ,OAAO;YACpB,KAAK;gBAAS,OAAO;YACrB,KAAK;gBAAU,OAAO;YACtB,KAAK;gBAAU,OAAO;YACtB;gBAAS,OAAO;QAClB;IACF;IACA,qBACE,8OAAC;QAAI,WAAW,CAAC,uBAAuB,EAAE,iBAAiB,SAAS,KAAK,GAAG;;0BAC1E,8OAAC;gBAAI,WAAU;;kCACb,8OAAC;wBAAI,WAAU;;0CACb,8OAAC;0CAAM,SAAS,IAAI;;;;;;0CACpB,8OAAC,4JAAA,CAAA,UAAI;gCAAC,MAAM,SAAS,IAAI;gCAAE,WAAU;0CAClC,SAAS,KAAK;;;;;;;;;;;;kCAGnB,8OAAC;wBAAK,WAAU;kCACb,IAAI,SAAS,SAAS,EAAE,OAAO,CAAC,WAAW;;;;;;;;;;;;0BAGhD,8OAAC;gBAAI,WAAU;0BAA8B,SAAS,WAAW;;;;;;YAChE,SAAS,MAAM,kBACd,8OAAC;gBAAI,WAAU;0BAAmC,SAAS,MAAM;;;;;;;;;;;;AAIzE;AAGe,SAAS;IACtB,uBAAuB;IACvB,MAAM,CAAC,QAAQ,UAAU,GAAG,CAAA,GAAA,qMAAA,CAAA,WAAQ,AAAD,EAAE;IACrC,MAAM,CAAC,WAAW,aAAa,GAAG,CAAA,GAAA,qMAAA,CAAA,WAAQ,AAAD,EAAE;IAC3C,MAAM,CAAC,YAAY,cAAc,GAAG,CAAA,GAAA,qMAAA,CAAA,WAAQ,AAAD,EAAE;IAC7C,MAAM,CAAC,UAAU,YAAY,GAAG,CAAA,GAAA,qMAAA,CAAA,WAAQ,AAAD,EAAE;IACzC,MAAM,CAAC,QAAQ,UAAU,GAAG,CAAA,GAAA,qMAAA,CAAA,WAAQ,AAAD,EAAE;IACrC,MAAM,CAAC,MAAM,QAAQ,GAAG,CAAA,GAAA,qMAAA,CAAA,WAAQ,AAAD,EAAE;IACjC,MAAM,CAAC,KAAK,OAAO,GAAG,CAAA,GAAA,qMAAA,CAAA,WAAQ,AAAD,EAAE;IAC/B,MAAM,YAAY,CAAC,QAAQ,CAAC;IAE5B,sBAAsB;IACtB,MAAM,CAAC,QAAQ,UAAU,GAAG,CAAA,GAAA,qMAAA,CAAA,WAAQ,AAAD,EAAE;IACrC,MAAM,CAAC,YAAY,cAAc,GAAG,CAAA,GAAA,qMAAA,CAAA,WAAQ,AAAD,EAAE,EAAE;IAC/C,MAAM,CAAC,eAAe,iBAAiB,GAAG,CAAA,GAAA,qMAAA,CAAA,WAAQ,AAAD,EAAE;IACnD,MAAM,CAAC,eAAe,iBAAiB,GAAG,CAAA,GAAA,qMAAA,CAAA,WAAQ,AAAD,EAAE;IAEnD,uBAAuB;IACvB,eAAe;QACb,MAAM,KAAK,IAAI;QACf,IAAI,WAAW,OAAO,GAAG,GAAG,CAAC,UAAU;QACvC,IAAI,cAAc,OAAO,GAAG,GAAG,CAAC,aAAa;QAC7C,IAAI,eAAe,OAAO,GAAG,GAAG,CAAC,cAAc;QAC/C,IAAI,UAAU,GAAG,GAAG,CAAC,QAAQ;QAC7B,IAAI,QAAQ,GAAG,GAAG,CAAC,MAAM;QACzB,OAAO;QACP,IAAI;YACF,MAAM,IAAI,MAAM,MAAM,CAAC,eAAe,EAAE,GAAG,QAAQ,IAAI,EAAE;gBAAE,OAAO;YAAW;YAC7E,IAAI,CAAC,EAAE,EAAE,EAAE,MAAM,IAAI,MAAM,CAAC,KAAK,EAAE,EAAE,MAAM,EAAE;YAC7C,MAAM,OAAO,MAAM,EAAE,IAAI;YACzB,QAAQ;QACV,EAAE,OAAO,GAAG;YACV,OAAO,OAAO;QAChB;IACF;IAEA,sBAAsB;IACtB,eAAe;QACb,iBAAiB;QACjB,IAAI;YACF,MAAM,CAAC,WAAW,cAAc,GAAG,MAAM,QAAQ,GAAG,CAAC;gBACnD,MAAM,eAAe;oBAAE,OAAO;gBAAW;gBACzC,MAAM,0BAA0B;oBAAE,OAAO;gBAAW;aACrD;YACD,IAAI,UAAU,EAAE,EAAE,UAAU,MAAM,UAAU,IAAI;YAChD,IAAI,cAAc,EAAE,EAAE;gBACpB,MAAM,IAAI,MAAM,cAAc,IAAI;gBAClC,cAAc,EAAE,UAAU,IAAI,EAAE;YAClC;QACF,EAAE,OAAO,GAAG;YACV,QAAQ,KAAK,CAAC,8BAA8B;QAC9C,SAAU;YACR,iBAAiB;QACnB;IACF;IAEA,CAAA,GAAA,qMAAA,CAAA,YAAS,AAAD,EAAE;QACR;QACA;IACA,uDAAuD;IACzD,GAAG;QAAC;QAAQ;QAAW;QAAY;QAAU;KAAO;IAEpD,UAAU;IACV,eAAe,aAAa,SAAS,EAAE,SAAS;QAC9C,MAAM,MAAM,CAAC,cAAc,EAAE,WAAW,EAAE;YACxC,QAAQ;YACR,SAAS;gBAAE,gBAAgB;YAAmB;YAC9C,MAAM,KAAK,SAAS,CAAC;gBAAE,QAAQ;YAAU;QAC3C;QACA,MAAM;QACN,MAAM;IACR;IAEA,eAAe,aAAa,SAAS,EAAE,SAAS;QAC9C,MAAM,UAAU,OAAO,oBAAoB,CAAC,eAAe,EAAE,aAAa,WAAW;QACrF,IAAI,CAAC,SAAS;QACd,IAAI;YACF,MAAM,MAAM,CAAC,YAAY,CAAC,EAAE;gBAC1B,QAAQ;gBACR,SAAS;oBAAE,gBAAgB;gBAAmB;gBAC9C,MAAM,KAAK,SAAS,CAAC;oBACnB,YAAY;oBACZ;oBACA,UAAU;oBACV,SAAS;gBACX;YACF;YACA,MAAM;YACN,MAAM;QACR,EAAE,OAAO,GAAG;YACV,QAAQ,KAAK,CAAC,2BAA2B;YACzC,MAAM;QACR;IACF;IAEA,eAAe,YAAY,SAAS,EAAE,QAAQ;QAC5C,MAAM,OAAO,IAAI,KAAK,KAAK,GAAG,KAAK,KAAK,KAAK,MAAM,WAAW;QAC9D,MAAM,MAAM,CAAC,kBAAkB,CAAC,EAAE;YAChC,QAAQ;YACR,SAAS;gBAAE,gBAAgB;YAAmB;YAC9C,MAAM,KAAK,SAAS,CAAC;gBACnB,MAAM;gBACN,WAAW;gBACX,YAAY;gBACZ,OAAO;gBACP,eAAe;YACjB;QACF;QACA,MAAM;IACR;IAEA,eAAe;QACb,MAAM,KAAK,IAAI;QACf,IAAI,WAAW,OAAO,GAAG,GAAG,CAAC,UAAU;QACvC,IAAI,cAAc,OAAO,GAAG,GAAG,CAAC,aAAa;QAC7C,IAAI,eAAe,OAAO,GAAG,GAAG,CAAC,cAAc;QAC/C,IAAI,UAAU,GAAG,GAAG,CAAC,QAAQ;QAC7B,IAAI,QAAQ,GAAG,GAAG,CAAC,MAAM;QACzB,GAAG,GAAG,CAAC,UAAU;QACjB,IAAI;YACF,MAAM,MAAM,CAAC,sBAAsB,EAAE,GAAG,QAAQ,IAAI;YACpD,MAAM,OAAO,SAAS,aAAa,CAAC;YACpC,KAAK,IAAI,GAAG;YACZ,KAAK,QAAQ,GAAG,CAAC,SAAS,EAAE,IAAI,OAAO,WAAW,GAAG,KAAK,CAAC,GAAE,IAAI,IAAI,CAAC;YACtE,SAAS,IAAI,CAAC,WAAW,CAAC;YAC1B,KAAK,KAAK;YACV,SAAS,IAAI,CAAC,WAAW,CAAC;QAC5B,EAAE,OAAO,GAAG;YACV,QAAQ,KAAK,CAAC,kBAAkB;YAChC,MAAM;QACR;IACF;IAEA,4GAA4G;IAE9G,SAAS,kBAAkB,CAAC;QAC1B,OAAQ,EAAE,MAAM;YACd,KAAK;gBACH,8DAA8D;gBAC9D,IAAI,EAAE,IAAI,KAAK,oBAAoB,UAAU;gBAC7C,IAAI,EAAE,IAAI,KAAK,uBAAuB,UAAU;gBAChD;YAEF,KAAK;gBACH,OAAO,QAAQ,CAAC,IAAI,GAAG;gBACvB;YAEF,KAAK;gBACH,OAAO,KAAK,CAAC;gBACb;YAEF;gBACE,IAAI,EAAE,KAAK,IAAI,EAAE,KAAK,CAAC,MAAM,GAAG,GAAG;oBACjC,OAAO,QAAQ,CAAC,IAAI,GAAG,EAAE,KAAK,CAAC,EAAE,CAAC,IAAI;gBACxC;QACJ;IACF;IAGE,eAAe;IACf,MAAM,WAAW,MAAM,eAAe,EAAE;IACxC,MAAM,YAAY,MAAM,cAAc,EAAE;IACxC,MAAM,WAAW,MAAM,YAAY,EAAE;IACrC,MAAM,UAAU,MAAM,WAAW,EAAE;IACnC,MAAM,cAAc,MAAM,MAAM,mBAAmB,EAAE;IACrD,MAAM,gBAAgB,MAAM,uBAAuB,EAAE;IACrD,MAAM,WAAW,MAAM,aAAa,EAAE;IAEtC,UAAU;IACV,MAAM,WAAW,CAAA,GAAA,qMAAA,CAAA,UAAO,AAAD,EAAE;QACvB,MAAM,OAAO,WAAW,SAAS,YAAY;QAC7C,MAAM,KAAK,SAAS,SAAS,UAAU;QACvC,OAAO,SAAS,MAAM,CAAC,CAAC;YACtB,MAAM,WAAW,WAAW,QAAQ,OAAO,EAAE,MAAM,KAAK;YACxD,MAAM,YAAY,cAAc,QAAQ,OAAO,OAAO,EAAE,YAAY,MAAM,OAAO;YACjF,MAAM,aAAa,eAAe,QAAQ,OAAO,OAAO,EAAE,WAAW,MAAM,OAAO;YAClF,MAAM,SAAS,QAAQ,EAAE,aAAa,EAAE,MAAM;YAC9C,OAAO,YAAY,aAAa,cAAc;QAChD;IACF,GAAG;QAAC;QAAU;QAAQ;QAAW;QAAY;QAAU;KAAO;IAE9D,MAAM,OAAO,CAAA,GAAA,qMAAA,CAAA,UAAO,AAAD,EAAE;QACnB,MAAM,SAAS,CAAC;QAChB,CAAC,YAAY,MAAM,GAAG,cAAc,MAAM,IAAI,CAAC,IAAI,IAAI,SAAS,GAAG,CAAC,CAAA,IAAK,EAAE,MAAM,GAAG,EACjF,OAAO,CAAC,CAAA,IAAK,MAAM,CAAC,EAAE,GAAG;QAC5B,SAAS,OAAO,CAAC,CAAA,IAAK,MAAM,CAAC,EAAE,MAAM,CAAC,GAAG,CAAC,MAAM,CAAC,EAAE,MAAM,CAAC,IAAI,CAAC,IAAI;QACnE,OAAO;IACT,GAAG;QAAC;QAAU;QAAU;KAAY;IAEpC,MAAM,aAAa,CAAC,KAAO,QAAQ,IAAI,CAAC,CAAA,IAAK,OAAO,EAAE,EAAE,MAAM,OAAO;IACrE,MAAM,WAAW,CAAC,KAAO,SAAS,IAAI,CAAC,CAAA,IAAK,OAAO,EAAE,EAAE,MAAM,OAAO;IACpE,MAAM,eAAe;QAAQ,UAAU;QAAQ,aAAa;QAAQ,cAAc;QAAQ,YAAY;QAAK,UAAU;IAAK;IAE1H,IAAI,KAAK,qBAAO,8OAAC;QAAK,WAAU;;0BAAM,8OAAC;gBAAG,WAAU;0BAAoB;;;;;;0BAAW,8OAAC;gBAAI,WAAU;0BAAQ;;;;;;;;;;;;IAC1G,IAAI,WAAW,qBAAO,8OAAC;QAAK,WAAU;kBAAM;;;;;;IAE5C,qBAAqB;IACrB,MAAM,YAAY,SAAS;WACtB,OAAO,MAAM,CAAC,QAAQ;WACtB,OAAO,MAAM,CAAC,SAAS;WACtB,gBAAgB,OAAO,MAAM,CAAC,IAAI,GAAG,EAAE;KAC5C,GAAG,EAAE;IAEN,qBACE,8OAAC;QAAK,WAAU;;0BACd,8OAAC;gBAAI,WAAU;;kCACb,8OAAC;wBAAG,WAAU;kCAAqB;;;;;;kCACnC,8OAAC,4JAAA,CAAA,UAAI;wBAAC,MAAK;wBAAe,WAAU;kCAAkC;;;;;;kCACtE,8OAAC;wBAAO,SAAS;wBAAY,WAAU;wBAAmD,UAAU;kCACjG,gBAAgB,OAAO;;;;;;;;;;;;YAK3B,wBACC,8OAAC;gBAAQ,WAAU;;kCACjB,8OAAC;wBAAI,WAAU;;0CACb,8OAAC;gCAAG,WAAU;0CAAwB;;;;;;0CACtC,8OAAC;gCAAI,WAAU;;oCACZ,OAAO,OAAO,CAAC,QAAQ,GAAG,mBAAK,8OAAC;wCAAK,WAAU;;4CAA4C;4CAAI,OAAO,OAAO,CAAC,QAAQ;4CAAC;;;;;;;oCACvH,OAAO,OAAO,CAAC,SAAS,GAAG,mBAAK,8OAAC;wCAAK,WAAU;;4CAAkD;4CAAI,OAAO,OAAO,CAAC,SAAS;4CAAC;;;;;;;oCAC/H,OAAO,OAAO,CAAC,IAAI,GAAG,mBAAK,8OAAC;wCAAK,WAAU;;4CAA8C;4CAAI,OAAO,OAAO,CAAC,IAAI;4CAAC;;;;;;;;;;;;;;;;;;;oBAIrH,UAAU,MAAM,KAAK,kBACpB,8OAAC;wBAAI,WAAU;kCAA8D;;;;;6CAI7E,8OAAC;wBAAI,WAAU;kCACZ,UAAU,GAAG,CAAC,CAAA,uBACb,8OAAC;gCAAyB,OAAO;gCAAO,UAAU;+BAAlC,OAAM,EAAE;;;;;;;;;;oBAK7B,OAAO,OAAO,CAAC,IAAI,GAAG,KAAK,CAAC,+BAC3B,8OAAC;wBAAI,WAAU;kCACb,cAAA,8OAAC;4BAAO,SAAS,IAAM,iBAAiB;4BAAO,WAAU;;gCAAkC;gCAC7E,OAAO,OAAO,CAAC,IAAI;gCAAC;;;;;;;;;;;;;;;;;;YAQzC,WAAW,MAAM,GAAG,mBACnB,8OAAC;;kCACC,8OAAC;wBAAG,WAAU;kCAA6B;;;;;;kCAC3C,8OAAC;wBAAI,WAAU;kCACZ,WAAW,KAAK,CAAC,GAAG,GAAG,GAAG,CAAC,CAAC,UAAU,kBACrC,8OAAC;gCAAqB,UAAU;+BAAb;;;;;;;;;;oBAGtB,WAAW,MAAM,GAAG,mBACnB,8OAAC;wBAAI,WAAU;kCACb,cAAA,8OAAC,4JAAA,CAAA,UAAI;4BAAC,MAAK;4BAAkB,WAAU;sCAAkC;;;;;;;;;;;;;;;;;0BAOjF,8OAAC;gBAAQ,WAAU;;kCACjB,8OAAC;wBAAI,WAAU;;0CACb,8OAAC;gCAAM,WAAU;;kDACf,8OAAC;wCAAK,WAAU;kDAAmB;;;;;;kDACnC,8OAAC;wCAAO,WAAU;wCAAqB,OAAO;wCAAQ,UAAU,CAAC,IAAI,UAAU,EAAE,MAAM,CAAC,KAAK;;0DAC3F,8OAAC;gDAAO,OAAM;0DAAM;;;;;;4CACnB,CAAC,YAAY,MAAM,GAAG,cAAc,MAAM,IAAI,CAAC,IAAI,IAAI,SAAS,GAAG,CAAC,CAAA,IAAG,EAAE,MAAM,GAAG,EAAE,GAAG,CAAC,CAAA,kBACvF,8OAAC;oDAAe,OAAO;8DAAI;mDAAd;;;;;;;;;;;;;;;;;0CAKnB,8OAAC;gCAAM,WAAU;;kDACf,8OAAC;wCAAK,WAAU;kDAAmB;;;;;;kDACnC,8OAAC;wCAAO,WAAU;wCAAqB,OAAO;wCAAW,UAAU,CAAC,IAAI,aAAa,EAAE,MAAM,CAAC,KAAK;;0DACjG,8OAAC;gDAAO,OAAM;0DAAM;;;;;;4CACnB,SAAS,GAAG,CAAC,CAAA,kBAAK,8OAAC;oDAAkB,OAAO,EAAE,EAAE;8DAAG,EAAE,GAAG;mDAAzB,EAAE,EAAE;;;;;;;;;;;;;;;;;0CAIxC,8OAAC;gCAAM,WAAU;;kDACf,8OAAC;wCAAK,WAAU;kDAAmB;;;;;;kDACnC,8OAAC;wCAAO,WAAU;wCAAqB,OAAO;wCAAY,UAAU,CAAC,IAAI,cAAc,EAAE,MAAM,CAAC,KAAK;;0DACnG,8OAAC;gDAAO,OAAM;0DAAM;;;;;;4CACnB,UAAU,GAAG,CAAC,CAAA,kBAAK,8OAAC;oDAAkB,OAAO,EAAE,EAAE;8DAAG,EAAE,GAAG;mDAAzB,EAAE,EAAE;;;;;;;;;;;;;;;;;0CAIzC,8OAAC;gCAAM,WAAU;;kDACf,8OAAC;wCAAK,WAAU;kDAAmB;;;;;;kDACnC,8OAAC;wCAAM,MAAK;wCAAO,WAAU;wCAAqB,OAAO;wCAAU,UAAU,CAAC,IAAI,YAAY,EAAE,MAAM,CAAC,KAAK;;;;;;;;;;;;0CAG9G,8OAAC;gCAAM,WAAU;;kDACf,8OAAC;wCAAK,WAAU;kDAAmB;;;;;;kDACnC,8OAAC;wCAAM,MAAK;wCAAO,WAAU;wCAAqB,OAAO;wCAAQ,UAAU,CAAC,IAAI,UAAU,EAAE,MAAM,CAAC,KAAK;;;;;;;;;;;;;;;;;;kCAI5G,8OAAC;wBAAI,WAAU;;0CACb,8OAAC;gCAAO,WAAU;gCAA2B,SAAS;0CAAc;;;;;;0CACpE,8OAAC;gCAAO,WAAU;gCAA4C,SAAS;;oCAAgB;oCACnE,SAAS,MAAM;oCAAC;;;;;;;0CAEpC,8OAAC;gCAAI,WAAU;;oCAAqC,SAAS,MAAM;oCAAC;oCAAiB,SAAS,MAAM;;;;;;;;;;;;;;;;;;;0BAKxG,8OAAC;;kCACC,8OAAC;wBAAG,WAAU;kCAA6B;;;;;;kCAC3C,8OAAC;wBAAI,WAAU;;4BACZ,OAAO,OAAO,CAAC,MAAM,GAAG,CAAC,CAAC,CAAC,GAAG,EAAE,iBAC/B,8OAAC;oCAAY,WAAU;;sDACrB,8OAAC;4CAAI,WAAU;sDAAyB;;;;;;sDACxC,8OAAC;4CAAI,WAAU;sDAAsB;;;;;;;mCAF7B;;;;;0CAKZ,8OAAC;gCAAI,WAAU;;kDACb,8OAAC;wCAAI,WAAU;kDAAwB;;;;;;kDACvC,8OAAC;wCAAI,WAAU;kDAAsB,SAAS,MAAM;;;;;;;;;;;;;;;;;;;;;;;;0BAM1D,8OAAC;;kCACC,8OAAC;wBAAG,WAAU;kCAA6B;;;;;;oBAC1C,SAAS,MAAM,KAAK,kBACnB,8OAAC;wBAAE,WAAU;kCAAwB;;;;;6CAErC,8OAAC;wBAAG,WAAU;kCACX,SAAS,GAAG,CAAC,CAAA;4BACZ,MAAM,SAAS,WAAW,EAAE,QAAQ;4BACpC,qBACE,8OAAC;gCAEC,SAAS;gCACT,QAAQ;gCACR,SAAS,SAAS,EAAE,YAAY;gCAChC,cAAc;gCACd,cAAc;gCACd,aAAa;+BANR,EAAE,EAAE;;;;;wBASf;;;;;;;;;;;;0BAMN,8OAAC;;kCACC,8OAAC;wBAAG,WAAU;kCAA6B;;;;;;kCAC3C,8OAAC;wBAAG,WAAU;kCACX,cAAc,MAAM,GAAG,cAAc,GAAG,CAAC,CAAC,kBACzC,8OAAC;;oCACE,EAAE,IAAI;oCAAC;oCAAU;kDAClB,8OAAC,4JAAA,CAAA,UAAI;wCAAC,WAAU;wCAAY,MAAM,CAAC,aAAa,EAAE,EAAE,QAAQ,EAAE;;4CAAE;4CAC5D,EAAE,QAAQ;;;;;;;oCACN;oCAAI;kDACV,8OAAC;wCAAK,WAAU;;4CAAuB;4CAAE,EAAE,OAAO,IAAI;4CAAI;;;;;;;oCAAQ;oCAAa,EAAE,SAAS;oCAAC;oCAAI,EAAE,KAAK;oCAAC;oCAAY;oCACpH,IAAI,KAAK,EAAE,aAAa,EAAE,cAAc,CAAC;;+BANnC,EAAE,EAAE;;;;sDASb,8OAAC;sCAAG;;;;;;;;;;;;;;;;;0BAOV,8OAAC;;kCACC,8OAAC;wBAAG,WAAU;kCAA6B;;;;;;kCAC3C,8OAAC;wBAAI,WAAU;kCACb,cAAA,8OAAC,4JAAA,CAAA,UAAI;4BAAC,MAAK;4BAAe,WAAU;sCAAY;;;;;;;;;;;;;;;;;0BAKpD,8OAAC;;kCACC,8OAAC;wBAAG,WAAU;kCAA6B;;;;;;kCAC3C,8OAAC;wBAAG,WAAU;kCACX,SAAS,MAAM,GAAG,SAAS,GAAG,CAAC,CAAC,GAAE,kBACjC,8OAAC;;oCAAY,EAAE,EAAE;oCAAC;oCAAI,EAAE,IAAI;oCAAC;oCAAE,EAAE,GAAG;oCAAC;oCAAI,EAAE,MAAM;oCAAC;oCAAI,EAAE,OAAO,GAAG,MAAM;oCAAI;oCAAO,EAAE,EAAE;;+BAA9E;;;;sDACN,8OAAC;sCAAG;;;;;;;;;;;;;;;;;;;;;;;AAKnB;AAKA,SAAS,WAAW,EAAE,OAAO,EAAE,MAAM,EAAE,OAAO,EAAE,YAAY,EAAE,YAAY,EAAE,WAAW,EAAE;IACvF,MAAM,CAAC,kBAAkB,oBAAoB,GAAG,CAAA,GAAA,qMAAA,CAAA,WAAQ,AAAD,EAAE;IACzD,MAAM,CAAC,gBAAgB,kBAAkB,GAAG,CAAA,GAAA,qMAAA,CAAA,WAAQ,AAAD,EAAE;IAErD,eAAe;QACf,IAAI;YACF,MAAM,MAAM,MAAM,MAAM,CAAC,kBAAkB,CAAC,EAAE;gBAC5C,QAAQ;gBACR,SAAS;oBAAE,gBAAgB;gBAAmB;gBAC9C,MAAM,KAAK,SAAS,CAAC;oBACnB,MAAM;oBACN,WAAW,QAAQ,QAAQ;oBAC3B,YAAY,QAAQ,EAAE;oBACtB,OAAO;oBACP,eAAe,IAAI,OAAO,WAAW;oBACrC,SAAS,kBAAkB;gBAC7B;YACF;YAEA,IAAI,CAAC,IAAI,EAAE,EAAE,MAAM,IAAI,MAAM,CAAC,KAAK,EAAE,IAAI,MAAM,EAAE;YAEjD,yBAAyB;YACzB,qEAAqE;YACrE,IAAI,WAAW,QAAQ,QAAQ,EAAE;gBAC/B,MAAM,IAAI,MAAM,MAAM,CAAC,aAAa,EAAE,QAAQ,QAAQ,EAAE,EAAE;oBAAE,OAAO;gBAAW;gBAC9E,IAAI,EAAE,EAAE,EAAE;oBACR,MAAM,cAAc,MAAM,EAAE,IAAI;oBAChC,WAAW,cAAc,4BAA4B;gBACvD;YACF;YAEA,MAAM;YACN,oBAAoB;YACpB,kBAAkB;QACpB,EAAE,OAAO,GAAG;YACV,QAAQ,KAAK,CAAC,mBAAmB;YACjC,MAAM;QACR;IACF;IAIE,MAAM,CAAC,MAAM,QAAQ,GAAG,CAAA,GAAA,qMAAA,CAAA,WAAQ,AAAD,EAAE,QAAsB,yBAAyB;IAChF,MAAM,CAAC,SAAS,WAAW,GAAG,CAAA,GAAA,qMAAA,CAAA,WAAQ,AAAD,EAAE;IACvC,MAAM,CAAC,KAAK,OAAO,GAAG,CAAA,GAAA,qMAAA,CAAA,WAAQ,AAAD,EAAE;IAC/B,MAAM,CAAC,SAAS,WAAW,GAAG,CAAA,GAAA,qMAAA,CAAA,WAAQ,AAAD,EAAE;IAEvC,4DAA4D;IAC5D,MAAM,CAAC,gBAAgB,kBAAkB,GAAG,CAAA,GAAA,qMAAA,CAAA,WAAQ,AAAD,EAAE;IACrD,MAAM,CAAC,uBAAuB,yBAAyB,GAAG,CAAA,GAAA,qMAAA,CAAA,WAAQ,AAAD,EAAE;IACnE,MAAM,CAAC,mBAAmB,qBAAqB,GAAG,CAAA,GAAA,qMAAA,CAAA,WAAQ,AAAD,EAAE;IAE3D,6CAA6C;IAC7C,MAAM,CAAC,OAAO,SAAS,GAAG,CAAA,GAAA,qMAAA,CAAA,WAAQ,AAAD,EAAE;IACnC,MAAM,CAAC,UAAU,YAAY,GAAG,CAAA,GAAA,qMAAA,CAAA,WAAQ,AAAD,EAAE;IACzC,MAAM,CAAC,MAAM,QAAQ,GAAG,CAAA,GAAA,qMAAA,CAAA,WAAQ,AAAD,EAAE;IACjC,MAAM,CAAC,UAAU,YAAY,GAAG,CAAA,GAAA,qMAAA,CAAA,WAAQ,AAAD,EAAE;IAEzC,yDAAyD;IACzD,eAAe;QACb,IAAI,MAAM;YAAE,QAAQ;YAAQ;QAAQ;QACpC,QAAQ;QACR,IAAI,SAAS,QAAQ,cAAc;QACnC,IAAI;YACF,WAAW;YAAO,OAAO;YACzB,MAAM,IAAI,MAAM,MAAM,CAAC,aAAa,EAAE,QAAQ,QAAQ,EAAE,EAAE;gBAAE,OAAO;YAAW;YAC9E,MAAM,IAAI,MAAM,EAAE,IAAI;YACtB,IAAI,CAAC,EAAE,EAAE,EAAE,MAAM,IAAI,MAAM,EAAE,KAAK,IAAI,CAAC,KAAK,EAAE,EAAE,MAAM,EAAE;YACxD,WAAW;QACb,EAAE,OAAO,GAAG;YACV,OAAO,OAAO,EAAE,OAAO,IAAI;QAC7B,SAAU;YACR,WAAW;QACb;IACF;IAEA,CAAA,GAAA,qMAAA,CAAA,YAAS,AAAD,EAAE;QACR,IAAI,CAAC,MAAM;QACX,MAAM,MAAM,SAAS;QACrB,IAAI,CAAC,OAAO,gBAAgB,QAAQ,kCAAkC;QAEtE,IAAI,YAAY;QAChB,CAAC;YACC,IAAI;gBACF,yBAAyB;gBACzB,MAAM,IAAI,MAAM,MAAM,CAAC,iBAAiB,EAAE,KAAK,EAAE;oBAAE,OAAO;gBAAW;gBACrE,MAAM,IAAI,MAAM,EAAE,IAAI,GAAG,KAAK,CAAC,IAAM,CAAC,CAAC,CAAC;gBACxC,IAAI,CAAC,EAAE,EAAE,EAAE,MAAM,IAAI,MAAM,EAAE,KAAK,IAAI,EAAE,UAAU;gBAClD,IAAI,CAAC,WAAW,kBAAkB;YACpC,EAAE,OAAO,GAAG;gBACV,IAAI,CAAC,WAAW,qBAAqB,OAAO,EAAE,OAAO,IAAI;YAC3D,SAAU;gBACR,IAAI,CAAC,WAAW,yBAAyB;YAC3C;QACF,CAAC;QAED,OAAO;YAAQ,YAAY;QAAM;IACnC,GAAG;QAAC;QAAM,SAAS;QAAc;KAAe,GAAG,qBAAqB;IAExE,qDAAqD;IACrD,eAAe,cAAc,CAAC;QAC5B,EAAE,cAAc;QAChB,EAAE,eAAe;QACjB,IAAI,OAAO;YAAE,SAAS;YAAQ;QAAQ;QACtC,SAAS;QACT,IAAI,UAAU,QAAQ,cAAc;QACpC,IAAI;YACF,YAAY;YAAO,QAAQ;YAC3B,MAAM,IAAI,MAAM,MAAM,CAAC,iBAAiB,EAAE,QAAQ,YAAY,EAAE,EAAE;gBAAE,OAAO;YAAW;YACtF,MAAM,IAAI,MAAM,EAAE,IAAI,GAAG,KAAK,CAAC,IAAM,CAAC,CAAC,CAAC;YACxC,IAAI,CAAC,EAAE,EAAE,EAAE,MAAM,IAAI,MAAM,EAAE,KAAK,IAAI,EAAE,UAAU;YAClD,YAAY;QACd,EAAE,OAAO,GAAG;YACV,QAAQ,OAAO,EAAE,OAAO,IAAI;QAC9B,SAAU;YACR,YAAY;QACd;IACF;IAEA,MAAM,YAAY,SAAS,GAAG,OAAO,MAAM,IAAI,GAAG,CAAC,EAAE,OAAO,GAAG,IAAI,IAAI,CAAC,IAAI,MAAM,CAAC,CAAC,EAAE,OAAO,EAAE,EAAE,GAAG,CAAC,CAAC,EAAE,QAAQ,QAAQ,EAAE;IAE1H,qBAAqB;IACrB,MAAM,IAAI,UAAU,cAAc,CAAC;IACnC,MAAM,OAAO,EAAE,IAAI,IAAI,CAAC;IAExB,qBACE,8OAAC;QAAG,WAAU;;0BAEZ,8OAAC;gBAAI,WAAU;;kCACb,8OAAC;wBAAK,WAAU;;4BAAgB;4BAAE,QAAQ,EAAE;;;;;;;kCAC5C,8OAAC;;4BAAK;4BAAW,QAAQ,MAAM;;;;;;;kCAC/B,8OAAC;;4BAAK;4BAAS,QAAQ,aAAa;;;;;;;kCACpC,8OAAC;;4BAAK;4BAAU,QAAQ,qBAAqB,IAAI;;;;;;;kCACjD,8OAAC;;4BAAK;4BAAW,SAAS,YAAY,QAAQ,QAAQ;;;;;;;kCAGtD,8OAAC;;4BAAK;4BACU;0CACd,8OAAC;gCACC,MAAK;gCACL,SAAS;gCACT,WAAU;gCACV,OAAM;0CAEL,UAAU,QAAQ,GAAG,GAAG,QAAQ,YAAY;;;;;;;;;;;;kCAIjD,8OAAC;;4BAAK;4BAAgB,QAAQ,YAAY;;;;;;;oBACzC,CAAC,QAAQ,QAAQ,IAAI,EAAE,EAAE,MAAM,iBAAG,8OAAC;;4BAAK;4BAAa,CAAC,QAAQ,QAAQ,IAAI,EAAE,EAAE,IAAI,CAAC;;;;;;+BAAgB;kCACpG,8OAAC;;4BAAK;4BAAe,QAAQ,yBAAyB,IAAI;4BAAE;;;;;;;kCAG5D,8OAAC;wBAAI,WAAU;;0CACb,8OAAC;gCACC,WAAU;gCACV,OAAO,QAAQ,MAAM;gCACrB,UAAU,CAAC,IAAM,aAAa,QAAQ,EAAE,EAAE,EAAE,MAAM,CAAC,KAAK;0CAEvD;oCAAC;oCAAU;oCAAW;oCAAa;oCAAa;oCAAS;iCAAS,CAAC,GAAG,CAAC,CAAA,kBACtE,8OAAC;wCAAe,OAAO;kDAAI;uCAAd;;;;;;;;;;0CAMlB,8OAAC;gCACR,WAAU;gCACV,SAAS,IAAM,oBAAoB;0CACpC;;;;;;4BAIA,kCACC,8OAAC;gCAAI,WAAU;0CACb,cAAA,8OAAC;oCAAI,WAAU;;sDACb,8OAAC;4CAAG,WAAU;sDAA6B;;;;;;sDAC3C,8OAAC;4CACC,OAAO;4CACP,UAAU,CAAC,IAAM,kBAAkB,EAAE,MAAM,CAAC,KAAK;4CACjD,aAAY;4CACZ,WAAU;;;;;;sDAEZ,8OAAC;4CAAI,WAAU;;8DACb,8OAAC;oDACC,SAAS,IAAM,oBAAoB;oDACnC,WAAU;8DACX;;;;;;8DAGD,8OAAC;oDACC,SAAS;oDACT,WAAU;8DACX;;;;;;;;;;;;;;;;;;;;;;;0CAWC,8OAAC;gCAAO,WAAU;gCAAqC,SAAS;0CAC7D,OAAO,YAAY;;;;;;;;;;;;;;;;;;YAMzB,uBACC,8OAAC;gBAAI,WAAU;;oBACZ,0BAAY,8OAAC;wBAAI,WAAU;kCAAwB;;;;;;oBACnD,sBAAQ,8OAAC;wBAAI,WAAU;;4BAAuB;4BAAG;;;;;;;oBAEjD,CAAC,YAAY,CAAC,sBACb,8OAAC;wBAAI,WAAU;;0CAEb,8OAAC;gCAAQ,WAAU;;kDACjB,8OAAC;wCAAG,WAAU;kDAAqB;;;;;;oCAClC,KAAK,OAAO,IAAI,CAAC,GAAG,MAAM,iBACzB,8OAAC;wCAAI,WAAU;;0DACb,8OAAC;;kEAAI,8OAAC;kEAAG,EAAE,GAAG,IAAI,CAAC,CAAC,EAAE,QAAQ,YAAY,EAAE;;;;;;oDAAK;oDAAY,EAAE,OAAO,IAAI;;;;;;;0DAC1E,8OAAC;;oDAAI;oDAAW,EAAE,QAAQ,EAAE,OAAO;oDAAI;oDAAI,EAAE,QAAQ,EAAE,SAAS;oDAAI;oDAAI,EAAE,QAAQ,EAAE,aAAa;;;;;;;0DACjG,8OAAC;;oDAAI;oDAAkB,EAAE,eAAe,IAAI;oDAAI;oDAAkB,EAAE,gBAAgB,IAAI;;;;;;;0DACxF,8OAAC;;oDAAI;oDAAW,EAAE,QAAQ,EAAE,QAAQ;oDAAI;oDAAU,EAAE,QAAQ,EAAE,OAAO,GAAG,EAAE,QAAQ,CAAC,IAAI,CAAC,KAAK,CAAC,GAAG,GAAG,CAAC,CAAC,GAAG;oDAAI;oDAAS,EAAE,QAAQ,EAAE,OAAO;;;;;;;0DACzI,8OAAC;gDAAI,WAAU;;oDAA6B;oDAChC,EAAE,OAAO,EAAE,UAAU;oDAAI;oDAAa,EAAE,OAAO,EAAE,kBAAkB;oDAAI;oDAAU,EAAE,OAAO,EAAE,cAAc;oDAAI;;;;;;;;;;;;6DAI5H,8OAAC;wCAAI,WAAU;kDAAwB;;;;;;;;;;;;0CAK3C,8OAAC;;kDACC,8OAAC;wCAAG,WAAU;kDAAqB;;;;;;kDACnC,8OAAC,yKAAA,CAAA,UAAuB;wCACtB,WAAW,QAAQ,YAAY;wCAC/B,MAAM;;;;;;;;;;;;0CAMV,8OAAC;;kDACC,8OAAC;wCAAG,WAAU;kDAAqB;;;;;;kDACnC,8OAAC,iKAAA,CAAA,UAAe;wCAAC,WAAW,QAAQ,YAAY;;;;;;;;;;;;0CAIlD,8OAAC;gCAAQ,WAAU;;kDACjB,8OAAC;wCAAG,WAAU;kDAAqB;;;;;;oCAClC,QAAQ,CAAC,KAAK,WAAW,IAAI,KAAK,2BAA2B,IAAI,CAAC,KAAK,kBAAkB,IAAI,EAAE,EAAE,MAAM,kBACtG,8OAAC;wCAAG,WAAU;;0DACZ,8OAAC;;oDAAG;oDACO;oDACR,KAAK,WAAW,iBACb,8OAAC;wDAAE,WAAU;wDAA0B,MAAM,KAAK,WAAW;wDAAE,QAAO;wDAAS,KAAI;kEAAa;;;;;+DAChG;;;;;;;0DAEN,8OAAC;;oDAAG;oDACS;oDACV,KAAK,2BAA2B,iBAC7B,8OAAC;wDAAE,WAAU;wDAA0B,MAAM,KAAK,2BAA2B;wDAAE,QAAO;wDAAS,KAAI;kEAAa;;;;;+DAChH;;;;;;;4CAEL,CAAC,KAAK,kBAAkB,IAAI,EAAE,EAAE,GAAG,CAAC,CAAC,GAAG,kBACvC,8OAAC;;wDAAY,EAAE,IAAI,IAAI;wDAAM;wDAAI,EAAE,GAAG,iBAAG,8OAAC;4DAAE,WAAU;4DAA0B,MAAM,EAAE,GAAG;4DAAE,QAAO;4DAAS,KAAI;sEAAc,EAAE,GAAG;;;;;mEAAQ;;mDAAnI;;;;;;;;;;6DAIb,8OAAC;wCAAI,WAAU;kDAAwB;;;;;;;;;;;;0CAK3C,8OAAC;;kDACC,8OAAC;wCAAG,WAAU;kDAAqB;;;;;;kDACnC,8OAAC;wCAAG,WAAU;;0DACZ,8OAAC;;oDAAG;oDAAU,EAAE,OAAO,IAAI;;;;;;;0DAC3B,8OAAC;;oDAAG;oDAAqB,EAAE,uBAAuB,EAAE,WAAW;oDAAI;oDAAI,EAAE,uBAAuB,EAAE,qBAAqB;oDAAI;oDAAI,EAAE,uBAAuB,EAAE,WAAW;;;;;;;0DACrK,8OAAC;;oDAAG;oDAAc,EAAE,WAAW,IAAI;oDAAI;oDAAa,EAAE,OAAO,IAAI;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;YAS5E,sBACC,8OAAC;gBAAI,WAAU;;oBACZ,yBAAW,8OAAC;wBAAI,WAAU;kCAAwB;;;;;;oBAClD,qBAAO,8OAAC;wBAAI,WAAU;;4BAAuB;4BAAG;;;;;;;oBAEhD,yBACC,8OAAC;wBAAI,WAAU;;0CAEb,8OAAC;gCAAQ,WAAU;;kDACjB,8OAAC;wCAAG,WAAU;kDAAqB;;;;;;kDACnC,8OAAC;wCAAI,WAAU;;0DACb,8OAAC;;kEACC,8OAAC;;4DAAG,KAAK,QAAQ,MAAM,EAAE;4DAAQ;4DAAE,KAAK,QAAQ,MAAM,EAAE;;;;;;;oDAAU;oDAAO,KAAK,QAAQ,MAAM,EAAE;oDAC7F,QAAQ,MAAM,EAAE,YAAY,CAAC,GAAG,EAAE,QAAQ,MAAM,CAAC,SAAS,EAAE,GAAG;;;;;;;0DAElE,8OAAC;gDAAI,WAAU;;oDAAgB;oDACnB,QAAQ,EAAE;oDAAC;oDAAW,QAAQ,MAAM;oDAAC;oDAAS,QAAQ,aAAa;oDAAC;oDAAe,KAAK,QAAQ,yBAAyB;;;;;;;;;;;;;;;;;;;0CAMzI,8OAAC,6JAAA,CAAA,UAAe;gCAAC,SAAS,CAAC,QAAQ,QAAQ,IAAI,EAAE,EAAE,IAAI,CAAC,CAAA,KAAM,GAAG,EAAE,KAAK,QAAQ,EAAE,KAAK;;;;;;0CAGvF,8OAAC;;kDACC,8OAAC;wCAAG,WAAU;kDAAqB;;;;;;kDACnC,8OAAC,0JAAA,CAAA,UAAY;wCACX,gBAAgB,QAAQ,cAAc,IAAI,QAAQ,mBAAmB,IAAI,EAAE;wCAC3E,UAAU,QAAQ,QAAQ,IAAI,EAAE;wCAChC,eAAe,QAAQ,aAAa,IAAI,EAAE;wCAC1C,OAAO;;;;;;;;;;;;0CAKX,8OAAC,6JAAA,CAAA,UAAe;gCAAC,UAAU,QAAQ,QAAQ;gCAAE,UAAU,QAAQ,QAAQ,IAAI,EAAE;;;;;;0CAG7E,8OAAC;;kDACC,8OAAC;wCAAG,WAAU;kDAAqB;;;;;;kDACnC,8OAAC,gKAAA,CAAA,UAAkB;wCAAC,QAAQ,QAAQ,MAAM;;;;;;;;;;;;0CAI5C,8OAAC;;kDACC,8OAAC;wCAAG,WAAU;kDAAqB;;;;;;kDACnC,8OAAC,sKAAA,CAAA,UAAwB;wCACvB,QAAQ,QAAQ,qBAAqB,IAAI,EAAE;wCAC3C,WAAW,QAAQ,2BAA2B,IAAI,EAAE;;;;;;;;;;;;0CAKxD,8OAAC;gCAAQ,WAAU;;kDACjB,8OAAC;wCAAG,WAAU;kDAAqB;;;;;;oCAClC,uCAAyB,8OAAC;wCAAI,WAAU;kDAAwB;;;;;;oCAChE,mCAAqB,8OAAC;wCAAI,WAAU;;4CAAuB;4CAAG;;;;;;;oCAC9D,+BACC,8OAAC,gKAAA,CAAA,UAAc;wCAAC,MAAM;;;;;+CAEtB,CAAC,uCAAyB,8OAAC;wCAAI,WAAU;kDAAwB;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAUnF","debugId":null}}]
}