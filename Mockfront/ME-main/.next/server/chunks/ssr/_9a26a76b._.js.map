{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 5, "column": 0}, "map": {"version":3,"sources":["file:///workspaces/ME/app/%28crm%29/crm/commercial/page.js"],"sourcesContent":["\"use client\";\r\nimport { useEffect, useState } from \"react\";\r\nimport Link from \"next/link\";\r\n\r\nconst fmt = (d) => d ? new Date(d).toLocaleDateString(\"fr-FR\") : \"-\";\r\n\r\nexport default function CommercialDashboard() {\r\n  const [rappels, setRappels] = useState([]);\r\n  const [stats, setStats] = useState({});\r\n  const [loading, setLoading] = useState(true);\r\n\r\n  useEffect(() => {\r\n    loadRappels();\r\n  }, []);\r\n\r\n  async function loadRappels() {\r\n    setLoading(true);\r\n    try {\r\n      const r = await fetch(\"/api/commercial/rappels\", { cache: \"no-store\" });\r\n      if (r.ok) {\r\n        const data = await r.json();\r\n        setRappels(data.rappels || []);\r\n        setStats(data.stats || {});\r\n      }\r\n    } catch (e) {\r\n      console.error(\"Erreur chargement rappels:\", e);\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  }\r\n\r\n  const getUrgenceColor = (rappel) => {\r\n    if (!rappel.rappel_date) return 'border-l-gray-500 bg-gray-50';\r\n    \r\n    const today = new Date();\r\n    const rappelDate = new Date(rappel.rappel_date);\r\n    const diffDays = Math.ceil((rappelDate - today) / (1000 * 60 * 60 * 24));\r\n    \r\n    if (diffDays < 0) return 'border-l-red-500 bg-red-50'; // En retard\r\n    if (diffDays === 0) return 'border-l-orange-500 bg-orange-50'; // Aujourd'hui\r\n    if (diffDays <= 3) return 'border-l-yellow-500 bg-yellow-50'; // Cette semaine\r\n    return 'border-l-blue-500 bg-blue-50'; // Plus tard\r\n  };\r\n\r\n  const getUrgenceLabel = (rappel) => {\r\n    if (!rappel.rappel_date) return 'üìÖ Sans √©ch√©ance';\r\n    \r\n    const today = new Date();\r\n    const rappelDate = new Date(rappel.rappel_date);\r\n    const diffDays = Math.ceil((rappelDate - today) / (1000 * 60 * 60 * 24));\r\n    \r\n    if (diffDays < 0) return `üî¥ En retard (${Math.abs(diffDays)}j)`;\r\n    if (diffDays === 0) return 'üü° Aujourd\\'hui';\r\n    if (diffDays === 1) return 'üü° Demain';\r\n    if (diffDays <= 7) return `üîµ Dans ${diffDays} jours`;\r\n    return `‚ö™ Dans ${diffDays} jours`;\r\n  };\r\n\r\n  const groupedRappels = rappels.reduce((acc, rappel) => {\r\n    const urgence = getUrgenceLabel(rappel);\r\n    if (!acc[urgence]) acc[urgence] = [];\r\n    acc[urgence].push(rappel);\r\n    return acc;\r\n  }, {});\r\n\r\n  if (loading) return <main className=\"p-6\">Chargement du dashboard commercial...</main>;\r\n\r\n  return (\r\n    <main className=\"p-6 space-y-8\">\r\n      <div className=\"flex items-center gap-3\">\r\n        <h1 className=\"text-2xl font-bold\">ü§ù Dashboard Commercial</h1>\r\n        <Link href=\"/crm/dashboard\" className=\"text-sm text-blue-600 underline\">\r\n          ‚Üê Retour dashboard\r\n        </Link>\r\n      </div>\r\n\r\n      {/* Stats rapides */}\r\n      <div className=\"grid md:grid-cols-4 gap-4\">\r\n        <div className=\"bg-red-50 border border-red-200 rounded p-4\">\r\n          <div className=\"text-2xl font-bold text-red-600\">{stats.en_retard || 0}</div>\r\n          <div className=\"text-sm text-gray-600\">Rappels en retard</div>\r\n        </div>\r\n        <div className=\"bg-orange-50 border border-orange-200 rounded p-4\">\r\n          <div className=\"text-2xl font-bold text-orange-600\">{stats.aujourd_hui || 0}</div>\r\n          <div className=\"text-sm text-gray-600\">√Ä faire aujourd'hui</div>\r\n        </div>\r\n        <div className=\"bg-yellow-50 border border-yellow-200 rounded p-4\">\r\n          <div className=\"text-2xl font-bold text-yellow-600\">{stats.cette_semaine || 0}</div>\r\n          <div className=\"text-sm text-gray-600\">Cette semaine</div>\r\n        </div>\r\n        <div className=\"bg-blue-50 border border-blue-200 rounded p-4\">\r\n          <div className=\"text-2xl font-bold text-blue-600\">{stats.total || 0}</div>\r\n          <div className=\"text-sm text-gray-600\">Total actions</div>\r\n        </div>\r\n      </div>\r\n\r\n      {/* Rappels par urgence */}\r\n      {Object.keys(groupedRappels).length === 0 ? (\r\n        <div className=\"bg-green-50 border border-green-200 rounded p-6 text-center\">\r\n          <h3 className=\"text-lg font-semibold text-green-800 mb-2\">\r\n            ‚úÖ Aucune action commerciale en attente !\r\n          </h3>\r\n          <p className=\"text-green-600\">\r\n            Toutes les actions de suivi partenaires sont √† jour.\r\n          </p>\r\n        </div>\r\n      ) : (\r\n        Object.entries(groupedRappels).map(([urgence, rappelsGroup]) => (\r\n          <section key={urgence}>\r\n            <h2 className=\"text-xl font-semibold mb-3\">{urgence}</h2>\r\n            <div className=\"space-y-3\">\r\n              {rappelsGroup.map(rappel => (\r\n                <div \r\n                  key={rappel.id} \r\n                  className={`border-l-4 p-4 rounded ${getUrgenceColor(rappel)}`}\r\n                >\r\n                  <div className=\"flex items-start justify-between\">\r\n                    <div className=\"flex-1\">\r\n                      <div className=\"flex items-center gap-2 mb-2\">\r\n                        <Link \r\n                          href={`/partenaires/${rappel.partner_id}`}\r\n                          className=\"font-semibold text-blue-600 hover:underline\"\r\n                        >\r\n                          {rappel.partner_nom}\r\n                        </Link>\r\n                        <span className=\"text-sm bg-white px-2 py-1 rounded border\">\r\n                          {rappel.type_interaction}\r\n                        </span>\r\n                      </div>\r\n                      \r\n                      <h4 className=\"font-medium mb-1\">{rappel.sujet}</h4>\r\n                      <p className=\"text-sm text-gray-700 mb-2\">\r\n                        <strong>Action √† faire :</strong> {rappel.prochaine_action}\r\n                      </p>\r\n                      \r\n                      {rappel.notes && (\r\n                        <p className=\"text-sm text-gray-600 bg-white p-2 rounded\">\r\n                          {rappel.notes}\r\n                        </p>\r\n                      )}\r\n                    </div>\r\n                    \r\n                    <div className=\"text-right text-sm text-gray-500\">\r\n                      <div>Interaction: {fmt(rappel.date_interaction)}</div>\r\n                      {rappel.rappel_date && (\r\n                        <div className=\"font-medium\">Rappel: {fmt(rappel.rappel_date)}</div>\r\n                      )}\r\n                      <div>Par: {rappel.created_by}</div>\r\n                    </div>\r\n                  </div>\r\n                  \r\n                  <div className=\"flex gap-2 mt-3\">\r\n                    <Link\r\n                      href={`/partenaires/${rappel.partner_id}`}\r\n                      className=\"bg-blue-600 text-white px-3 py-1 rounded text-sm\"\r\n                    >\r\n                      üìû Voir partenaire\r\n                    </Link>\r\n                    <button className=\"border px-3 py-1 rounded text-sm\">\r\n                      ‚úÖ Marquer fait\r\n                    </button>\r\n                  </div>\r\n                </div>\r\n              ))}\r\n            </div>\r\n          </section>\r\n        ))\r\n      )}\r\n\r\n      {/* Actions rapides */}\r\n      <section className=\"bg-gray-50 rounded p-4\">\r\n        <h3 className=\"font-semibold mb-3\">‚ö° Actions rapides</h3>\r\n        <div className=\"flex gap-3 flex-wrap\">\r\n          <button \r\n            onClick={loadRappels}\r\n            className=\"border rounded px-4 py-2 text-sm\"\r\n          >\r\n            üîÑ Actualiser\r\n          </button>\r\n          <Link \r\n            href=\"/crm/exports?export=commercial\"\r\n            className=\"border rounded px-4 py-2 text-sm underline\"\r\n          >\r\n            üìä Export rappels\r\n          </Link>\r\n          <Link \r\n            href=\"/crm/partenaires\"\r\n            className=\"border rounded px-4 py-2 text-sm underline\"\r\n          >\r\n            üë• Tous les partenaires\r\n          </Link>\r\n        </div>\r\n      </section>\r\n    </main>\r\n  );\r\n}"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 479, "column": 0}, "map": {"version":3,"sources":["file:///workspaces/ME/node_modules/next/src/server/route-modules/app-page/vendored/ssr/react-jsx-dev-runtime.ts"],"sourcesContent":["module.exports = (\n  require('../../module.compiled') as typeof import('../../module.compiled')\n).vendored['react-ssr']!.ReactJsxDevRuntime\n"],"names":["module","exports","require","vendored","ReactJsxDevRuntime"],"mappings":"AAAAA,OAAOC,OAAO,GACZC,QAAQ,4HACRC,QAAQ,CAAC,YAAY,CAAEC,kBAAkB","ignoreList":[0],"debugId":null}}]
}